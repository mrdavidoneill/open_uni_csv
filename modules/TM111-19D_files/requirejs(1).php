define('core/ajax', ["jquery","core/config","core/log","core/url"],function(a,b,c,d){var e=!1,f=function(a){var b,c,e=this,f=null,g=0;if(a.error)for(;g<e.length;g++)b=e[g],b.deferred.reject(a);else{for(g=0;g<e.length;g++){if(b=e[g],c=a[g],"undefined"==typeof c){f=new Error("missing response");break}if(c.error!==!1){f=c.exception;break}b.deferred.resolve(c.data)}null!==f&&("servicerequireslogin"===f.errorcode?window.location=d.relativeUrl("/login/index.php"):e.forEach(function(a){a.deferred.reject(f)}))}},g=function(a,b,d){var f=this,g=0;for(g=0;g<f.length;g++){var h=f[g];e?(c.error("Page unloaded."),c.error(d)):h.deferred.reject(d)}};return{call:function(c,d,h){a(window).bind("beforeunload",function(){e=!0});var i,j=[],k=[],l=[],m="";for("undefined"==typeof h&&(h=!0),"undefined"==typeof d&&(d=!0),i=0;i<c.length;i++){var n=c[i];j.push({index:i,methodname:n.methodname,args:n.args}),n.deferred=a.Deferred(),k.push(n.deferred.promise()),"undefined"!=typeof n.done&&n.deferred.done(n.done),"undefined"!=typeof n.fail&&n.deferred.fail(n.fail),n.index=i,l.push(n.methodname)}m=l.length<=5?l.sort().join():l.length+"-method-calls",j=JSON.stringify(j);var o={type:"POST",data:j,context:c,dataType:"json",processData:!1,async:d,contentType:"application/json"},p="service.php";h||(p="service-nologin.php");var q=b.wwwroot+"/lib/ajax/"+p+"?sesskey="+b.sesskey+"&info="+m;return d?a.ajax(q,o).done(f).fail(g):(o.success=f,o.error=g,a.ajax(q,o)),k}}});
define('core/config', function(){return M.cfg});
define('core/first', ["jquery"],function(a){a(document).bind("ajaxStart",function(){M.util.js_pending("jq")}).bind("ajaxStop",function(){M.util.js_complete("jq")})});
define('core/paged_content_events', [],function(){return{SHOW_PAGES:"core-paged-content-show-pages"}});
define('core/localstorage', ["core/config","core/storagewrapper"],function(a,b){var c=new b(window.localStorage);return{get:function(a){return c.get(a)},set:function(a,b){return c.set(a,b)}}});
define('core/log', ["core/loglevel"],function(a){var b=a.methodFactory;return a.methodFactory=function(a,c){var d=b(a,c);return function(a,b){d(b?b+": "+a:a)}},a.setConfig=function(b){"undefined"!=typeof b.level&&a.setLevel(b.level)},a});
!function(a,b){"use strict";"function"==typeof define&&define.amd?define('core/loglevel', b):"object"==typeof module&&module.exports?module.exports=b():a.log=b()}(this,function(){"use strict";function a(a,b){var c=a[b];if("function"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(d){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function b(b){return"debug"===b&&(b="log"),typeof console!==h&&(void 0!==console[b]?a(console,b):void 0!==console.log?a(console,"log"):g)}function c(a,b){for(var c=0;c<i.length;c++){var d=i[c];this[d]=c<a?g:this.methodFactory(d,a,b)}this.log=this.debug}function d(a,b,d){return function(){typeof console!==h&&(c.call(this,b,d),this[a].apply(this,arguments))}}function e(a,c,e){return b(a)||d.apply(this,arguments)}function f(a,b,d){function f(a){var b=(i[a]||"silent").toUpperCase();if(typeof window!==h){try{return void(window.localStorage[l]=b)}catch(c){}try{window.document.cookie=encodeURIComponent(l)+"="+b+";"}catch(c){}}}function g(){var a;if(typeof window!==h){try{a=window.localStorage[l]}catch(b){}if(typeof a===h)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(l)+"=");d!==-1&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(b){}return void 0===k.levels[a]&&(a=void 0),a}}var j,k=this,l="loglevel";a&&(l+=":"+a),k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=d||e,k.getLevel=function(){return j},k.setLevel=function(b,d){if("string"==typeof b&&void 0!==k.levels[b.toUpperCase()]&&(b=k.levels[b.toUpperCase()]),!("number"==typeof b&&b>=0&&b<=k.levels.SILENT))throw"log.setLevel() called with invalid level: "+b;if(j=b,d!==!1&&f(b),c.call(k,b,a),typeof console===h&&b<k.levels.SILENT)return"No console available for logging"},k.setDefaultLevel=function(a){g()||k.setLevel(a,!1)},k.enableAll=function(a){k.setLevel(k.levels.TRACE,a)},k.disableAll=function(a){k.setLevel(k.levels.SILENT,a)};var m=g();null==m&&(m=null==b?"WARN":b),k.setLevel(m,!1)}var g=function(){},h="undefined",i=["trace","debug","info","warn","error"],j=new f,k={};j.getLogger=function(a){if("string"!=typeof a||""===a)throw new TypeError("You must supply a name when creating a logger.");var b=k[a];return b||(b=k[a]=new f(a,j.getLevel(),j.methodFactory)),b};var l=typeof window!==h?window.log:void 0;return j.noConflict=function(){return typeof window!==h&&window.log===j&&(window.log=l),j},j});
!function(a,b){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?b(exports):"function"==typeof define&&define.amd?define('core/mustache', ["exports"],b):(a.Mustache={},b(a.Mustache))}(this,function(a){function b(a){return"function"==typeof a}function c(a){return p(a)?"array":typeof a}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a,b){return null!=a&&"object"==typeof a&&b in a}function f(a,b){return q.call(a,b)}function g(a){return!f(r,a)}function h(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return s[a]})}function i(b,c){function e(){if(r&&!s)for(;q.length;)delete o[q.pop()];else q=[];r=!1,s=!1}function f(a){if("string"==typeof a&&(a=a.split(u,2)),!p(a)||2!==a.length)throw new Error("Invalid tags: "+a);h=new RegExp(d(a[0])+"\\s*"),i=new RegExp("\\s*"+d(a[1])),m=new RegExp("\\s*"+d("}"+a[1]))}if(!b)return[];var h,i,m,n=[],o=[],q=[],r=!1,s=!1;f(c||a.tags);for(var y,z,A,B,C,D,E=new l(b);!E.eos();){if(y=E.pos,A=E.scanUntil(h))for(var F=0,G=A.length;F<G;++F)B=A.charAt(F),g(B)?q.push(o.length):s=!0,o.push(["text",B,y,y+1]),y+=1,"\n"===B&&e();if(!E.scan(h))break;if(r=!0,z=E.scan(x)||"name",E.scan(t),"="===z?(A=E.scanUntil(v),E.scan(v),E.scanUntil(i)):"{"===z?(A=E.scanUntil(m),E.scan(w),E.scanUntil(i),z="&"):A=E.scanUntil(i),!E.scan(i))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],o.push(C),"#"===z||"^"===z||"$"===z||"<"===z)n.push(C);else if("/"===z){if(D=n.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?s=!0:"="===z&&f(A)}if(D=n.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return k(j(o))}function j(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function k(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;g<h;++g)switch(b=a[g],b[0]){case"$":case"<":case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function l(a){this.string=a,this.tail=a,this.pos=0}function m(a,b){this.view=a,this.blocks={},this.cache={".":this.view},this.parent=b}function n(){this.cache={}}var o=Object.prototype.toString,p=Array.isArray||function(a){return"[object Array]"===o.call(a)},q=RegExp.prototype.test,r=/\S/,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},t=/\s*/,u=/\s+/,v=/\s*=/,w=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!|\$|</;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},l.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},m.prototype.push=function(a){return new m(a,this)},m.prototype.setBlockVar=function(a,b){var c=this.blocks;return c[a]=b,b},m.prototype.clearBlockVars=function(){this.blocks={}},m.prototype.getBlockVar=function(a){var b,c=this.blocks;return c.hasOwnProperty(a)?b=c[a]:this.parent&&(b=this.parent.getBlockVar(a)),b},m.prototype.lookup=function(a){var c,d=this.cache;if(d.hasOwnProperty(a))c=d[a];else{for(var f,g,h=this,i=!1;h;){if(a.indexOf(".")>0)for(c=h.view,f=a.split("."),g=0;null!=c&&g<f.length;)g===f.length-1&&(i=e(c,f[g])),c=c[f[g++]];else c=h.view[a],i=e(h.view,a);if(i)break;h=h.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},n.prototype.clearCache=function(){this.cache={}},n.prototype.parse=function(b,c){var d=this.cache,e=d[b];return null==e&&(e=d[b+":"+(c||a.tags).join(":")]=i(b,c)),e},n.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof m?b:new m(b);return this.renderTokens(d,e,c,a)},n.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;i<j;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this.renderSection(e,b,c,d):"^"===f?g=this.renderInverted(e,b,c,d):">"===f?g=this.renderPartial(e,b,c,d):"<"===f?g=this.renderBlock(e,b,c,d):"$"===f?g=this.renderBlockVariable(e,b,c,d):"&"===f?g=this.unescapedValue(e,b):"name"===f?g=this.escapedValue(e,b):"text"===f&&(g=this.rawValue(e)),void 0!==g&&(h+=g);return h},n.prototype.renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(p(i))for(var j=0,k=i.length;j<k;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},n.prototype.renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);if(!e||p(e)&&0===e.length)return this.renderTokens(a[4],b,c,d)},n.prototype.renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},n.prototype.renderBlock=function(a,c,d,e){if(d){var f=b(d)?d(a[1]):d[a[1]];null!=f&&c.clearBlockVars(),this.renderTokens(a[4],c,d,e);var g=this.renderTokens(this.parse(f),c,d,f);return c.clearBlockVars(),g}},n.prototype.renderBlockVariable=function(a,b,c,d){var e=a[1],f=b.getBlockVar(e);return f?this.renderTokens(this.parse(f),b,c,f):(b.setBlockVar(e,d.slice(a[3],a[5])),this.renderTokens(a[4],b,c,d))},n.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c},n.prototype.escapedValue=function(b,c){var d=c.lookup(b[1]);if(null!=d)return a.escape(d)},n.prototype.rawValue=function(a){return a[1]},a.name="mustache.js",a.version="2.3.0",a.tags=["{{","}}"];var y=new n;return a.clearCache=function(){return y.clearCache()},a.parse=function(a,b){return y.parse(a,b)},a.render=function(a,b,d){if("string"!=typeof a)throw new TypeError('Invalid template! Template should be a "string" but "'+c(a)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(a,b,d)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=h,a.Scanner=l,a.Context=m,a.Writer=n,a});
define('core/notification', ["core/yui","jquery","core/log"],function(a,b,c){var d={types:{success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},fieldName:"user-notifications",fetchNotifications:function(){require(["core/ajax"],function(a){var b=a.call([{methodname:"core_fetch_notifications",args:{contextid:d.contextid}}]);b[0].done(d.addNotifications)})},addNotifications:function(a){a||(a=[]),b.each(a,function(a,b){d.renderNotification(b.template,b.variables)})},setupTargetRegion:function(){var a=b("#"+d.fieldName);if(a.length)return!1;var c=b("<span>").attr("id",d.fieldName);return a=b("#region-main"),a.length?a.prepend(c):(a=b('[role="main"]'),a.length?a.prepend(c):(a=b("body"),a.prepend(c)))},addNotification:function(a){var c=d.types.error;return a=b.extend({closebutton:!0,announce:!0,type:"error"},a),a.template?(c=a.template,delete a.template):a.type&&("undefined"!=typeof d.types[a.type]&&(c=d.types[a.type]),delete a.type),d.renderNotification(c,a)},renderNotification:function(a,e){return"undefined"!=typeof e.message&&e.message?void require(["core/templates"],function(c){c.render(a,e).done(function(a,e){b("#"+d.fieldName).prepend(a),c.runTemplateJS(e)}).fail(d.exception)}):void c.debug("Notification received without content. Skipping.")},alert:function(b,c,d){a.use("moodle-core-notification-alert",function(){var a=new M.core.alert({title:b,message:c,yesLabel:d});a.show()})},confirm:function(b,c,d,e,f,g){a.use("moodle-core-notification-confirm",function(){var a=new M.core.confirm({title:b,question:c,yesLabel:d,noLabel:e});a.on("complete-yes",function(){f()}),g&&a.on("complete-no",function(){g()}),a.show()})},exception:function(b){if("undefined"==typeof b.stack&&(b.stack=""),b.debuginfo&&(b.stack+=b.debuginfo+"\n"),!b.backtrace&&b.stacktrace&&(b.backtrace=b.stacktrace),b.backtrace){b.stack+=b.backtrace;var c=b.backtrace.match(/line ([^ ]*) of/),d=b.backtrace.match(/ of ([^:]*): /);c&&c[1]&&(b.lineNumber=c[1]),d&&d[1]&&(b.fileName=d[1],b.fileName.length>30&&(b.fileName="..."+b.fileName.substr(b.fileName.length-27)))}"undefined"==typeof b.name&&b.errorcode&&(b.name=b.errorcode),a.use("moodle-core-notification-exception",function(){var a=new M.core.exception(b);a.show()})}};return{init:function(a,b){d.contextid=a,d.setupTargetRegion(),d.addNotifications(b),d.fetchNotifications()},fetchNotifications:d.fetchNotifications,addNotification:d.addNotification,alert:d.alert,confirm:d.confirm,exception:d.exception}});
define('core/str', ["jquery","core/ajax","core/localstorage"],function(a,b,c){var d=[];return{get_string:function(a,b,c,d){var e=this.get_strings([{key:a,component:b,param:c,lang:d}]);return e.then(function(a){return a[0]})},get_strings:function(e){var f,g=a.Deferred(),h=[],i=0,j=!1;for(i=0;i<e.length;i++)if(f=e[i],"undefined"==typeof f.lang&&(f.lang=a("html").attr("lang").replace(/-/g,"_")),f.cacheKey="core_str/"+f.key+"/"+f.component+"/"+f.lang,"undefined"==typeof M.str[f.component]||"undefined"==typeof M.str[f.component][f.key]){var k=c.get(f.cacheKey);k?("undefined"==typeof M.str[f.component]&&(M.str[f.component]=[]),M.str[f.component][f.key]=k):j=!0}if(j){var l=[],m=[],n=function(a){this.resolve(a)},o=function(a){this.reject(a)};for(i=0;i<e.length;i++)if(f=e[i],"undefined"!=typeof d[f.cacheKey])m.push(d[f.cacheKey]);else{var p=a.Deferred();l.push({methodname:"core_get_string",args:{stringid:f.key,component:f.component,lang:f.lang,stringparams:[]},done:n.bind(p),fail:o.bind(p)}),d[f.cacheKey]=p.promise(),m.push(d[f.cacheKey])}l.length>0&&b.call(l,!0,!1),a.when.apply(null,m).done(function(){var a=0;for(a=0;a<arguments.length;a++)f=e[a],"undefined"==typeof M.str[f.component]&&(M.str[f.component]=[]),M.str[f.component][f.key]=arguments[a],c.set("core_str/"+f.key+"/"+f.component+"/"+f.lang,arguments[a]),h[a]=M.util.get_string(f.key,f.component,f.param).trim();g.resolve(h)}).fail(function(a){g.reject(a)})}else{for(i=0;i<e.length;i++)f=e[i],h[i]=M.util.get_string(f.key,f.component,f.param);g.resolve(h)}return g.promise()}}});
define('core/templates', ["core/mustache","jquery","core/ajax","core/str","core/notification","core/url","core/config","core/localstorage","core/icon_system","core/event","core/yui","core/log","core/truncate","core/user_date","core/pending"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=0,q={},r={},s={},t={},u=function(){this.requiredStrings=[],this.requiredJS=[],this.requiredDates=[],this.currentThemeName=""};u.prototype.requiredStrings=null,u.prototype.requiredDates=[],u.prototype.requiredJS=null,u.prototype.currentThemeName="",u.prototype.getTemplate=function(a){var d=a.split("/"),e=d.shift(),f=d.shift(),g=this.currentThemeName+"/"+a;if(g in r)return r[g];var i=h.get("core_template/"+g);if(i)return q[g]=i,r[g]=b.Deferred().resolve(i).promise(),r[g];var j=c.call([{methodname:"core_output_load_template",args:{component:e,template:f,themename:this.currentThemeName}}],!0,!1);return r[g]=j[0].then(function(a){return q[g]=a,h.set("core_template/"+g,a),a}),r[g]},u.prototype.partialHelper=function(a){var b=this.currentThemeName+"/"+a;return b in q||e.exception(new Error("Failed to pre-fetch the template: "+a)),q[b]},u.prototype.renderIcon=function(a,c,d){var f=g.iconsystemmodule,h=b.Deferred();return require([f],function(a){var b=new a;b instanceof i?(t=b,b.init().then(h.resolve)["catch"](e.exception)):h.reject("Invalid icon system specified"+g.iconsystemmodule)}),h.then(function(a){return this.getTemplate(a.getTemplateName())}.bind(this)).then(function(b){return t.renderIcon(a,c,d,b)})},u.prototype.pixHelper=function(a,b,c){var d=b.split(","),e="",f="",g="";d.length>0&&(e=c(d.shift().trim(),a)),d.length>0&&(f=c(d.shift().trim(),a)),d.length>0&&(g=c(d.join(",").trim(),a));var h=t.getTemplateName(),i=this.currentThemeName+"/"+h,j=q[i];return e=e.replace(/&#x2F;/gi,"/"),t.renderIcon(e,f,g,j)},u.prototype.jsHelper=function(a,b,c){return this.requiredJS.push(c(b,a)),""},u.prototype.stringHelper=function(a,b,c){var d=b.split(","),e="",f="",g="";d.length>0&&(e=d.shift().trim()),d.length>0&&(f=d.shift().trim()),d.length>0&&(g=d.join(",").trim()),""!==g&&(g=c(g,a)),0===g.indexOf("{")&&0!==g.indexOf("{{")&&(g=JSON.parse(g));var h=this.requiredStrings.length;return this.requiredStrings.push({key:e,component:f,param:g}),"[[_s"+h+"]]"},u.prototype.quoteHelper=function(a,b,c){var d=c(b.trim(),a);return d=d.replace('"','\\"').replace(/([\{\}]{2,3})/g,"{{=<% %>=}}$1<%={{ }}=%>"),'"'+d+'"'},u.prototype.shortenTextHelper=function(a,b,c){var d=/(.*?),(.*)/,e=b.match(d),f=e[1].trim(),g=e[2].trim(),h=c(g,a);return m.truncate(h,{length:f,words:!0,ellipsis:"..."})},u.prototype.userDateHelper=function(a,b,c){var d=/(.*?),(.*)/,e=b.match(d),f=c(e[1].trim(),a),g=c(e[2].trim(),a),h=this.requiredDates.length;return this.requiredDates.push({timestamp:f,format:g}),"[[_t_"+h+"]]"},u.prototype.addHelpers=function(a,b){this.currentThemeName=b,this.requiredStrings=[],this.requiredJS=[],a.uniqid=p++,a.str=function(){return this.stringHelper.bind(this,a)}.bind(this),a.pix=function(){return this.pixHelper.bind(this,a)}.bind(this),a.js=function(){return this.jsHelper.bind(this,a)}.bind(this),a.quote=function(){return this.quoteHelper.bind(this,a)}.bind(this),a.shortentext=function(){return this.shortenTextHelper.bind(this,a)}.bind(this),a.userdate=function(){return this.userDateHelper.bind(this,a)}.bind(this),a.globals={config:g},a.currentTheme=b},u.prototype.getJS=function(){var a="";return this.requiredJS.length>0&&(a=this.requiredJS.join(";\n")),a},u.prototype.treatStringsInContent=function(a,b){var c,d,e,f,g,h,i=/\[\[_s\d+\]\]/;do{for(c="",d=a.search(i);d>-1;){c+=a.substring(0,d),a=a.substr(d),e="",f=4,g=a.substr(f,1);do e+=g,f++,g=a.substr(f,1);while("]"!=g);h=b[parseInt(e,10)],"undefined"==typeof h&&(l.debug("Could not find string for pattern [[_s"+e+"]]."),h=""),c+=h,a=a.substr(6+e.length),d=a.search(i)}a=c+a,d=a.search(i)}while(d>-1);return a},u.prototype.treatDatesInContent=function(a,b){return b.forEach(function(b,c){var d="\\[\\[_t_"+c+"\\]\\]",e=new RegExp(d,"g");a=a.replace(e,b)}),a},u.prototype.doRender=function(c,e,f){this.currentThemeName=f;var g=t.getTemplateName(),h=new o("core/templates:doRender");return this.getTemplate(g).then(function(){this.addHelpers(e,f);var d=a.render(c,e,this.partialHelper.bind(this));return b.Deferred().resolve(d.trim(),this.getJS()).promise()}.bind(this)).then(function(a,c){return this.requiredStrings.length>0?d.get_strings(this.requiredStrings).then(function(d){return this.requiredDates=this.requiredDates.map(function(a){return{timestamp:this.treatStringsInContent(a.timestamp,d),format:this.treatStringsInContent(a.format,d)}}.bind(this)),a=this.treatStringsInContent(a,d),c=this.treatStringsInContent(c,d),b.Deferred().resolve(a,c).promise()}.bind(this)):b.Deferred().resolve(a,c).promise()}.bind(this)).then(function(a,c){return this.requiredDates.length>0?n.get(this.requiredDates).then(function(d){return a=this.treatDatesInContent(a,d),c=this.treatDatesInContent(c,d),b.Deferred().resolve(a,c).promise()}.bind(this)):b.Deferred().resolve(a,c).promise()}.bind(this)).then(function(a,c){return h.resolve(),b.Deferred().resolve(a,c).promise()})};var v=function(a){if(""!==a.trim()){var c=b("<script>").attr("type","text/javascript").html(a);b("head").append(c)}},w=function(a,c,d,e){var f=b(a);if(f.length){var g=b(c),h=null;e?(h=new k.NodeList(f.children().get()),h.destroy(!0),f.empty(),f.append(g)):(h=new k.NodeList(f.get()),h.destroy(!0),f.replaceWith(g)),v(d),j.notifyFilterContentUpdated(g)}};u.prototype.scanForPartials=function(b){var c=a.parse(b),d=[],e=function(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c],">"!=d[0]&&"<"!=d[0]||b.push(d[1]),d.length>4&&e(d[4],b)};return e(c,d),d},u.prototype.cachePartials=function(a,c){var d=this.currentThemeName+"/"+a;return d in s?s[d]:(c=c||[d],s[d]=b.Deferred(),this.getTemplate(a).then(function(e){var f=this.scanForPartials(e),g=f.filter(function(b){return!(c.indexOf(this.currentThemeName+"/"+b)>=0)&&b!=a}.bind(this)),h=g.map(function(a){return c.push(this.currentThemeName+"/"+a),this.cachePartials(a,c)}.bind(this));return b.when.apply(b,h).then(function(){return s[d].resolve(e)})}.bind(this))["catch"](s[d].reject),s[d])},u.prototype.render=function(a,c,d){"undefined"==typeof d&&(d=g.theme),this.currentThemeName=d;var f=g.iconsystemmodule,h=b.Deferred();return require([f],function(a){var b=new a;b instanceof i?(t=b,b.init().then(h.resolve)["catch"](e.exception)):h.reject("Invalid icon system specified"+g.iconsystem)}),h.then(function(){return this.cachePartials(a)}.bind(this)).then(function(a){return this.doRender(a,c,d)}.bind(this))};var x=function(a,c,d){var e=b(a);e.length&&(e.prepend(c),v(d),j.notifyFilterContentUpdated(e))},y=function(a,c,d){var e=b(a);e.length&&(e.append(c),v(d),j.notifyFilterContentUpdated(e))};return{render:function(a,b,c){var d=new u;return d.render(a,b,c)},renderPix:function(a,b,c){var d=new u;return d.renderIcon(a,b,c)},runTemplateJS:v,replaceNodeContents:function(a,b,c){w(a,b,c,!0)},replaceNode:function(a,b,c){w(a,b,c,!1)},prependNodeContents:function(a,b,c){x(a,b,c)},appendNodeContents:function(a,b,c){y(a,b,c)}}});
define('core/url', ["jquery","core/config"],function(a,b){return{fileUrl:function(a,c){var d=b.wwwroot+a;return"/"!=c.charAt(0)&&(c="/"+c),d+=b.slasharguments?c:"?file="+encodeURIComponent(c)},relativeUrl:function(c,d,e){if(0===c.indexOf("http:")||0===c.indexOf("https:")||c.indexOf("://")>=0)throw new Error("relativeUrl function does not accept absolute urls");"/"!=c.charAt(0)&&(c="/"+c),"admin"!==b.admin&&(c=c.replace(/^\/admin\//,"/"+b.admin+"/")),d=d||{},e&&(d.sesskey=b.sesskey);var f="";return Object.keys(d).length&&(f=a.map(d,function(a,b){return b+"="+a}).join("&")),""!==f?b.wwwroot+c+"?"+f:b.wwwroot+c},imageUrl:function(a,b){return M.util.image_url(a,b)}}});
define('core/yui', function(){return Y});
define('core/event', ["jquery","core/yui"],function(a,b){return{Events:{FORM_FIELD_VALIDATION:"core_form-field-validation"},getLegacyEvents:function(){var c=a.Deferred();return b.use("event","moodle-core-event",function(){c.resolve(window.M.core.event)}),c.promise()},notifyFilterContentUpdated:function(c){c=a(c),b.use("event","moodle-core-event",function(b){a(document).trigger(M.core.event.FILTER_CONTENT_UPDATED,[c]);var d=new b.NodeList(c.get());b.fire(M.core.event.FILTER_CONTENT_UPDATED,{nodes:d})})},notifyEditorContentRestored:function(){b.use("event","moodle-core-event",function(b){a(document).trigger(M.core.event.EDITOR_CONTENT_RESTORED),b.fire(M.core.event.EDITOR_CONTENT_RESTORED)})}}});
define('core/modal_registry', ["core/notification"],function(a){var b={},c=function(a){return b[a]},d=function(d,e,f){c(d)&&a.exception({message:"Modal of  type '"+d+"' is already registered"}),e&&"function"==typeof e||a.exception({message:"You must provide a modal module"}),f||a.exception({message:"You must provide a modal template"}),b[d]={module:e,template:f}};return{register:d,get:c}});
define('core/form-autocomplete', ["jquery","core/log","core/str","core/templates","core/notification"],function(a,b,c,d,e){var f={DOWN:40,ENTER:13,SPACE:32,ESCAPE:27,COMMA:44,UP:38},g=a.now(),h=function(b,c){var d=a(document.getElementById(c.selectionId)),e=d.children("[aria-selected=true]").length;for(b%=e;b<0;)b+=e;var f=a(d.children("[aria-selected=true]").get(b)),g=c.selectionId+"-"+b;d.children().attr("data-active-selection",!1).attr("id",""),f.attr("data-active-selection",!0).attr("id",g),d.attr("aria-activedescendant",g)},i=function(b,c,f){var g=[],i=a(document.getElementById(c.selectionId)),j=i.attr("aria-activedescendant"),k=!1;j&&(k=a(document.getElementById(j)).attr("data-value")),f.children("option").each(function(b,c){if(a(c).prop("selected")){var d;d=a(c).data("html")?a(c).data("html"):a(c).html(),g.push({label:d,value:a(c).attr("value")})}});var l=a.extend({items:g},b,c);d.render("core/form_autocomplete_selection",l).done(function(b){i.empty().append(a(b).html()),k!==!1&&i.children("[aria-selected=true]").each(function(b,d){a(d).attr("data-value")===k&&h(b,c)})}).fail(e.exception)},j=function(a){"undefined"!=typeof M.core_formchangechecker&&M.core_formchangechecker.set_form_changed(),a.change()},k=function(b,c,d,e){var f=a(d).attr("data-value");b.multiple&&e.children("option").each(function(b,c){a(c).attr("value")==f&&(a(c).prop("selected",!1),a(c).attr("data-iscustom")&&a(c).remove())}),i(b,c,e),j(e)},l=function(b,c){var d=a(document.getElementById(c.inputId)),e=a(document.getElementById(c.suggestionsId)),f=e.children("[aria-hidden=false]").length;for(b%=f;b<0;)b+=f;var g=a(e.children("[aria-hidden=false]").get(b)),h=a(e.children("[role=option]")).index(g),i=c.suggestionsId+"-"+h;e.children().attr("aria-selected",!1).attr("id",""),g.attr("aria-selected",!0).attr("id",i),d.attr("aria-activedescendant",i);var j=g.offset().top-e.offset().top+e.scrollTop()-e.height()/2;e.animate({scrollTop:j},100)},m=function(b){var c=a(document.getElementById(b.suggestionsId)),d=c.children("[aria-selected=true]"),e=c.children("[aria-hidden=false]").index(d);l(e+1,b)},n=function(b){var c=a(document.getElementById(b.selectionId)),d=c.children("[data-active-selection=true]");if(!d)return void h(0,b);var e=c.children("[aria-selected=true]").index(d);h(e-1,b)},o=function(b){var c=a(document.getElementById(b.selectionId)),d=c.children("[data-active-selection=true]");if(!d)return void h(0,b);var e=c.children("[aria-selected=true]").index(d);h(e+1,b)},p=function(b){var c=a(document.getElementById(b.suggestionsId)),d=c.children("[aria-selected=true]"),e=c.children("[aria-hidden=false]").index(d);l(e-1,b)},q=function(b){var c=a(document.getElementById(b.inputId)),d=a(document.getElementById(b.suggestionsId));c.attr("aria-expanded",!1).attr("aria-activedescendant",b.selectionId),d.hide().attr("aria-hidden",!0)},r=function(b,f,g,h){var i=a(document.getElementById(f.inputId)),j=a(document.getElementById(f.suggestionsId)),k=!1,m=[];h.children("option").each(function(b,c){a(c).prop("selected")!==!0&&(m[m.length]={label:c.innerHTML,value:a(c).attr("value")})});var n=f.caseSensitive?g:g.toLocaleLowerCase(),o=a.extend({options:m},b,f);d.render("core/form_autocomplete_suggestions",o).done(function(d){j.replaceWith(d),j=a(document.getElementById(f.suggestionsId)),j.show().attr("aria-hidden",!1),j.children().each(function(c,d){d=a(d),b.caseSensitive&&d.text().indexOf(n)>-1||!b.caseSensitive&&d.text().toLocaleLowerCase().indexOf(n)>-1?(d.show().attr("aria-hidden",!1),k=!0):d.hide().attr("aria-hidden",!0)}),i.attr("aria-expanded",!0),h.attr("data-notice")?j.html(h.attr("data-notice")):k?b.tags||l(0,f):c.get_string("nosuggestions","form").done(function(a){j.html(a)})}).fail(e.exception)},s=function(b,c,d){var e=a(document.getElementById(c.inputId)),f=e.val(),g=f.split(","),h=!1;a.each(g,function(c,e){if(e=e.trim(),""!==e&&(b.multiple||d.children("option").prop("selected",!1),d.children("option").each(function(b,c){a(c).attr("value")==e&&(h=!0,a(c).prop("selected",!0))}),!h)){var f=a("<option>");f.append(document.createTextNode(e)),f.attr("value",e),d.append(f),f.prop("selected",!0),f.attr("data-iscustom",!0)}}),i(b,c,d),j(d),e.val(""),q(c)},t=function(b,c,d){var e=a(document.getElementById(c.inputId)),f=a(document.getElementById(c.suggestionsId)),g=f.children("[aria-selected=true]").attr("data-value");b.multiple||d.children("option").prop("selected",!1),d.children("option").each(function(b,c){a(c).attr("value")==g&&a(c).prop("selected",!0)}),i(b,c,d),j(d),b.closeSuggestionsOnSelect?(e.val(""),q(c)):(e.focus(),r(b,c,e.val(),d))},u=function(b,c,d,f,g){var h="form-autocomplete-updateajax";M.util.js_pending(h);var i=a(b.currentTarget).val();g.transport(c.selector,i,function(b){var e=g.processResults(c.selector,b),i=[];if(f.children("option").each(function(b,c){c=a(c),c.prop("selected")?i.push(String(c.attr("value"))):c.remove()}),!c.multiple&&0===f.children("option").length){var j=a("<option>");f.append(j)}a.isArray(e)?(a.each(e,function(b,c){if(i.indexOf(String(c.value))===-1){var d=a("<option>");d.append(c.label),d.attr("value",c.value),f.append(d)}}),f.attr("data-notice","")):f.attr("data-notice",e),r(c,d,"",f),M.util.js_complete(h)},function(a){M.util.js_complete(h),e.exception(a)})},v=function(b,c,d){var e=a(document.getElementById(c.inputId));if(e.on("keydown",function(g){var h="form-autocomplete-addnav-"+c.inputId+"-"+g.keyCode;switch(M.util.js_pending(h),g.keyCode){case f.DOWN:return b.showSuggestions?("true"===e.attr("aria-expanded")?m(c):!e.val()&&b.ajax?require([b.ajax],function(a){u(g,b,c,d,a)}):r(b,c,e.val(),d),g.preventDefault(),M.util.js_complete(h),!1):(M.util.js_complete(h),!0);case f.UP:return p(c),g.preventDefault(),M.util.js_complete(h),!1;case f.ENTER:var i=a(document.getElementById(c.suggestionsId));return"true"===e.attr("aria-expanded")&&i.children("[aria-selected=true]").length>0?t(b,c,d):b.tags&&s(b,c,d),g.preventDefault(),M.util.js_complete(h),!1;case f.ESCAPE:return"true"===e.attr("aria-expanded")&&q(c),g.preventDefault(),M.util.js_complete(h),!1}return M.util.js_complete(h),!0}),e.on("keypress",function(a){var e="form-autocomplete-keypress-"+a.keyCode;return M.util.js_pending(e),a.keyCode===f.COMMA?(b.tags&&s(b,c,d),a.preventDefault(),M.util.js_complete(e),!1):(M.util.js_complete(e),!0)}),e.on("behat:set-value",function(){var f=a(document.getElementById(c.suggestionsId)),g="form-autocomplete-behat";M.util.js_pending(g),"true"===e.attr("aria-expanded")&&f.children("[aria-selected=true]").length>0?t(b,c,d):b.tags&&s(b,c,d),M.util.js_complete(g)}),e.on("blur",function(){var f="form-autocomplete-blur";M.util.js_pending(f),window.setTimeout(function(){var g=a(document.activeElement);g.attr("id")!=e.attr("id")&&(b.tags&&s(b,c,d),q(c)),M.util.js_complete(f)},500)}),b.showSuggestions){var g=a(document.getElementById(c.downArrowId));g.on("click",function(a){var f="form-autocomplete-show-suggestions";M.util.js_pending(f),e.focus(),!e.val()&&b.ajax?require([b.ajax],function(e){u(a,b,c,d,e)}):r(b,c,e.val(),d),M.util.js_complete(f)})}var h=a(document.getElementById(c.suggestionsId));h.parent().prop("onclick",null).off("click"),h.parent().on("click","[role=option]",function(e){var f="form-autocomplete-parent";M.util.js_pending(f);var g=a(e.currentTarget).closest("[role=option]"),h=a(document.getElementById(c.suggestionsId)),i=h.children("[aria-hidden=false]").index(g);l(i,c),t(b,c,d),M.util.js_complete(f)});var i=a(document.getElementById(c.selectionId));i.on("click","[role=listitem]",function(e){var f="form-autocomplete-clicks";M.util.js_pending(f);var g=a(e.currentTarget);k(b,c,g,d),M.util.js_complete(f)}),i.on("keydown",function(e){var g="form-autocomplete-keydown-"+e.keyCode;switch(M.util.js_pending(g),e.keyCode){case f.DOWN:return o(c),e.preventDefault(),M.util.js_complete(g),!1;case f.UP:return n(c),e.preventDefault(),M.util.js_complete(g),!1;case f.SPACE:case f.ENTER:var h=a(document.getElementById(c.selectionId)).children("[data-active-selection=true]");return h&&(k(b,c,h,d),e.preventDefault()),M.util.js_complete(g),!1}return M.util.js_complete(g),!0}),b.showSuggestions&&(b.ajax?require([b.ajax],function(a){var f=null,g="autocomplete-throttledhandler",h=function(e){u(e,b,c,d,a),M.util.js_complete(g)},i=function(a){null!==f?(window.clearTimeout(f),f=null):M.util.js_pending(g),f=window.setTimeout(h.bind(this,a),300)};e.on("input",i)}):e.on("input",function(e){var f=a(e.currentTarget).val(),g=a(e.currentTarget).data("last-value");g!==f&&r(b,c,f,d),a(e.currentTarget).data("last-value",f)}))};return{enhance:function(f,h,j,k,l,m,n,o){var p={selector:f,tags:!1,ajax:!1,placeholder:k,caseSensitive:!1,showSuggestions:!0,noSelectionString:n},q="autocomplete-setup-"+f;M.util.js_pending(q),"undefined"!=typeof h&&(p.tags=h),"undefined"!=typeof j&&(p.ajax=j),"undefined"!=typeof l&&(p.caseSensitive=l),"undefined"!=typeof m&&(p.showSuggestions=m),"undefined"==typeof n&&c.get_string("noselection","form").done(function(a){p.noSelectionString=a}).fail(e.exception);var r=a(f);if(!r)return b.debug("Selector not found: "+f),M.util.js_complete(q),!1;r.css("visibility","hidden").attr("aria-hidden",!0);var s={selectId:r.attr("id"),inputId:"form_autocomplete_input-"+g,suggestionsId:"form_autocomplete_suggestions-"+g,selectionId:"form_autocomplete_selection-"+g,downArrowId:"form_autocomplete_downarrow-"+g};g++,p.multiple=r.attr("multiple"),"undefined"!=typeof o?p.closeSuggestionsOnSelect=o:p.closeSuggestionsOnSelect=!p.multiple;var t=a("[for="+s.selectId+"]"),u=[];r.children("option").each(function(b,c){u[b]={label:c.innerHTML,value:a(c).attr("value")}});var w=a.extend({},p,s);w.options=u,w.items=[];var x="",y=d.render("core/form_autocomplete_input",w).then(function(a,b){return x+=b,a}),z=d.render("core/form_autocomplete_suggestions",w).then(function(a,b){return x+=b,a}),A=d.render("core/form_autocomplete_selection",w).then(function(a,b){return x+=b,a});return a.when(y,z,A).then(function(b,c,e){r.hide(),r.after(c),r.after(b),r.after(e),d.runTemplateJS(x),t.attr("for",s.inputId),v(p,s,r);var f=a(document.getElementById(s.suggestionsId));return f.hide().attr("aria-hidden",!0),i(p,s,r),M.util.js_complete(q),!0}).fail(function(a){M.util.js_complete(q),e.exception(a)})}}});
define('core/sessionstorage', ["core/config","core/storagewrapper"],function(a,b){var c=new b(window.sessionStorage);return{get:function(a){return c.get(a)},set:function(a,b){return c.set(a,b)}}});
define('core/permissionmanager', ["jquery","core/config","core/notification","core/templates","core/yui"],function(a,b,c,d,e){var f,g,h,i,j={ADDROLE:"a.allowlink, a.prohibitlink",REMOVEROLE:"a.preventlink, a.unprohibitlink",UNPROHIBIT:"a.unprohibitlink"},k=a.Event("rolesloaded"),l=null,m=function(){var d={contextid:f,getroles:1,sesskey:b.sesskey};a.post(h+"roles/ajax.php",d,null,"json").done(function(b){try{i=b,m=function(){a("body").trigger(k)},m()}catch(d){c.exception(d)}}).fail(function(a,b,d){c.exception(d)})},n=function(b,e,g){var j={contextid:f,roleid:e,sesskey:M.cfg.sesskey,action:g,capability:b.data("name")};a.post(h+"roles/ajax.php",j,null,"json").done(function(f){var g=f;try{var j={rolename:i[e],roleid:e,adminurl:h,imageurl:M.util.image_url("t/delete","moodle")};switch(g){case"allow":j.spanclass="allowed",j.linkclass="preventlink",j.action="prevent",j.icon="t/delete";break;case"prohibit":j.spanclass="forbidden",j.linkclass="unprohibitlink",j.action="unprohibit",j.icon="t/delete";break;case"prevent":return void b.find('a[data-role-id="'+e+'"]').first().closest(".allowed").remove();case"unprohibit":return void b.find('a[data-role-id="'+e+'"]').first().closest(".forbidden").remove();default:return}d.render("core/permissionmanager_role",j).done(function(c){if("allow"==g)a(c).insertBefore(b.find(".allowmore:first"));else if("prohibit"==g){a(c).insertBefore(b.find(".prohibitmore:first"));var d=b.find(".allowedroles").first().find('a[data-role-id="'+e+'"]');d&&d.first().closest(".allowed").remove()}l.hide()}).fail(c.exception)}catch(k){c.exception(k)}}).fail(function(a,b,d){c.exception(d)})},o=function(b){b.preventDefault(),e.use("moodle-core-notification-dialogue",function(){a("body").one("rolesloaded",function(){var e=a(b.currentTarget),f=e.data("action"),h=e.closest("tr.rolecap"),k={cap:h.data("humanname"),context:g},m=M.util.get_string("role"+f+"info","core_role",k);null===l&&(l=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})),l.set("headerContent",M.util.get_string("role"+f+"header","core_role"));var o,p,q=[];switch(f){case"allow":p=h.find(j.REMOVEROLE);break;case"prohibit":p=h.find(j.UNPROHIBIT)}for(o in i){var r="",s=p.filter("[data-role-id='"+o+"']").length;s&&(r="disabled");var t={roleid:o,rolename:i[o],disabled:r};q.push(t)}d.render("core/permissionmanager_panelcontent",{message:m,roles:q}).done(function(b){l.set("bodyContent",b),l.show(),a("div.role_buttons").delegate("input","click",function(b){var c=a(b.currentTarget).data("role-id");n(h,c,f)})}).fail(c.exception)})}),m()},p=function(b){b.preventDefault(),a("body").one("rolesloaded",function(){var d=a(b.currentTarget),e=d.data("action"),f=d.data("role-id"),h=d.closest("tr.rolecap"),j={role:i[f],cap:h.data("humanname"),context:g};c.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+e,"core_role",j),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),function(){n(h,f,e)})}),m()};return{initialize:function(b){f=b.contextid,g=b.contextname,h=b.adminurl;var c=a("body");c.delegate(j.ADDROLE,"click",o),c.delegate(j.REMOVEROLE,"click",p)}}});
define('core/tag', ["jquery","core/ajax","core/templates","core/notification","core/str","core/yui"],function(a,b,c,d,e,f){return{initTagindexPage:function(){a("body").delegate(".tagarea[data-ta] a[data-quickload=1]","click",function(d){d.preventDefault();var e=a(this),f=e[0].search.replace(/^\?/,""),g=e.closest(".tagarea[data-ta]"),h=f.split("&").reduce(function(a,b){var c=b.split("=");return a[c[0]]=decodeURIComponent(c[1]),a},{}),i=b.call([{methodname:"core_tag_get_tagindex",args:{tagindex:h}}],!0);a.when.apply(a,i).done(function(a){c.render("core_tag/index",a).done(function(a){g.replaceWith(a)})})})},initManagePage:function(){a("body").on("updated","[data-inplaceeditable]",function(b){if(e.get_string("selecttag","core_tag",b.ajaxreturn.value).then(function(c){return a('label[for="tagselect'+b.ajaxreturn.itemid+'"]').html(c)}).fail(d.exception),e.get_string("now").done(function(c){a(b.target).closest("tr").find("td.col-timemodified").html(c)}),"tagflag"===b.ajaxreturn.itemtype){var c=a(b.target).closest("tr");"0"===b.ajaxreturn.value?c.removeClass("flagged-tag"):c.addClass("flagged-tag")}}),a(".tag-management-table").delegate("a.tagdelete","click",function(b){b.preventDefault();var c=a(this).attr("href");e.get_strings([{key:"delete"},{key:"confirmdeletetag",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})}),a("#tag-management-delete").click(function(b){var c=a(this).closest("form").get(0),f=a(c).find("input[type=checkbox]:checked").length;if(f){var g=a("<input type='hidden'/>").attr("name",this.name);b.preventDefault(),e.get_strings([{key:"delete"},{key:"confirmdeletetags",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){g.appendTo(c),c.submit()})})}}),a("#tag-management-combine").click(function(b){b.preventDefault();var c=a(this).closest("form").get(0),g=a(c).find("input[type=checkbox]:checked");if(g.length<=1)return void e.get_strings([{key:"combineselected",component:"tag"},{key:"selectmultipletags",component:"tag"},{key:"ok"}]).done(function(a){d.alert(a[0],a[1],a[2])});var h=a("<input type='hidden'/>").attr("name",this.name);e.get_strings([{key:"combineselected",component:"tag"},{key:"selectmaintag",component:"tag"},{key:"continue"},{key:"cancel"}]).done(function(b){var d=a('<div><form id="combinetags_form"><div class="description"></div><div class="form-group options"></div><div class="form-group">   <input type="submit" class="btn btn-primary" id="combinetags_submit"/>   <input type="button" class="btn btn-secondary" id="combinetags_cancel"/></div></form></div>');d.find(".description").html(b[1]),d.find("#combinetags_submit").attr("value",b[2]),d.find("#combinetags_cancel").attr("value",b[3]);var e=d.find(".options");g.each(function(){var b=a(this).val(),c=a(".inplaceeditable[data-itemtype=tagname][data-itemid="+b+"]").attr("data-value"),d='<div class="form-check">   <input type="radio" class="form-check-input" name="maintag"        id="combinetags_maintag_'+b+'" value="'+b+'"/>   <label class="form-check-label" for="combinetags_maintag_'+b+'">'+c+"</label></div>";e.append(a(d))}),f.use("moodle-core-notification-dialogue",function(){var e=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:b[0],bodyContent:d.html()});e.show(),a("#combinetags_form input[type=radio]").first().focus().prop("checked",!0),a("#combinetags_form #combinetags_cancel").on("click",function(){e.destroy()}),a("#combinetags_form").on("submit",function(){h.appendTo(c);var b=a("input[name=maintag]:checked","#combinetags_form").val();return a("<input type='hidden'/>").attr("name","maintag").attr("value",b).appendTo(c),c.submit(),!1})})})}),a("body").on("updatefailed","[data-inplaceeditable][data-itemtype=tagname]",function(b){var c=b.exception,f=b.newvalue,g=a(b.target).attr("data-itemid");"namesalreadybeeingused"===c.errorcode&&(b.preventDefault(),e.get_strings([{key:"nameuseddocombine",component:"tag"},{key:"yes"},{key:"cancel"}]).done(function(a){d.confirm(b.message,a[0],a[1],a[2],function(){window.location.href=window.location.href+"&newname="+encodeURIComponent(f)+"&tagid="+encodeURIComponent(g)+"&action=renamecombine&sesskey="+M.cfg.sesskey})}))}),a("body").on("click","a[data-action=addstandardtag]",function(b){b.preventDefault(),e.get_strings([{key:"addotags",component:"tag"},{key:"inputstandardtags",component:"tag"},{key:"continue"},{key:"cancel"}]).done(function(b){var c=a('<div><form id="addtags_form" method="POST"><input type="hidden" name="action" value="addstandardtag"/><input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'"/><div class="form-group">   <label for="id_tagslist">'+b[1]+'</label>   <input type="text" id="id_tagslist" class="form-control" name="tagslist"/></div><div class="form-group">   <input type="submit" class="btn btn-primary" id="addtags_submit"/>   <input type="button" class="btn btn-secondary" id="addtags_cancel"/></div></form></div>');c.find("#addtags_form").attr("action",window.location.href),c.find("#addtags_submit").attr("value",b[2]),c.find("#addtags_cancel").attr("value",b[3]),f.use("moodle-core-notification-dialogue",function(){var d=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:b[0],bodyContent:c.html()});d.show(),a("#addtags_form input[type=text]").focus(),a("#addtags_form #addtags_cancel").on("click",function(){d.destroy()})})})})},initManageCollectionsPage:function(){a("body").on("updated","[data-inplaceeditable]",function(b){var c,d,e,f=b.ajaxreturn;"core_tag"===f.component&&"tagareaenable"===f.itemtype&&(c=a(this).attr("data-itemid"),a(".tag-collections-table ul[data-collectionid] li[data-areaid="+c+"]").hide(),e=f.value,"1"===e?(a(this).closest("tr").removeClass("dimmed_text"),d=a(this).closest("tr").find('[data-itemtype="tagareacollection"]').attr("data-value"),a(".tag-collections-table ul[data-collectionid="+d+"] li[data-areaid="+c+"]").show()):a(this).closest("tr").addClass("dimmed_text")),"core_tag"===f.component&&"tagareacollection"===f.itemtype&&(c=a(this).attr("data-itemid"),a(".tag-collections-table ul[data-collectionid] li[data-areaid="+c+"]").hide(),d=a(this).attr("data-value"),e=a(this).closest("tr").find('[data-itemtype="tagareaenable"]').attr("data-value"),"1"===e&&a(".tag-collections-table ul[data-collectionid="+d+"] li[data-areaid="+c+"]").show())}),a("body").on("click",".addtagcoll > a",function(b){b.preventDefault();var c=a(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;e.get_strings([{key:"addtagcoll",component:"tag"},{key:"name"},{key:"searchable",component:"tag"},{key:"create"},{key:"cancel"}]).done(function(b){var d=a('<div><form id="addtagcoll_form"><div class="form-group">   <label for="addtagcoll_name"></label>    <input id="addtagcoll_name" type="text" class="form-control"/>  </div><div class="form-group form-check">   <input id="addtagcoll_searchable" type="checkbox" value="1" checked class="form-check-input"/>   <label for="addtagcoll_searchable" class="form-check-label"></label></div><div class="form-group">   <input type="submit" class="btn btn-primary" id="addtagcoll_submit"/>   <input type="button" class="btn btn-secondary" id="addtagcoll_cancel"/></div></form></div>');d.find('label[for="addtagcoll_name"]').html(b[1]),d.find('label[for="addtagcoll_searchable"]').html(b[2]),d.find("#addtagcoll_submit").attr("value",b[3]),d.find("#addtagcoll_cancel").attr("value",b[4]),f.use("moodle-core-notification-dialogue",function(){var e=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:b[0],bodyContent:d.html()});e.show(),a("#addtagcoll_form #addtagcoll_name").focus(),a("#addtagcoll_form #addtagcoll_cancel").on("click",function(){e.destroy()}),a("#addtagcoll_form").on("submit",function(){var b=a("#addtagcoll_form #addtagcoll_name").val(),d=a("#addtagcoll_form #addtagcoll_searchable").prop("checked")?1:0;return String(b).length>0&&(window.location.href=c+"&name="+encodeURIComponent(b)+"&searchable="+d),!1})})})}),a("body").on("click",".tag-collections-table .action_delete",function(b){b.preventDefault();var c=a(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;e.get_strings([{key:"delete"},{key:"suredeletecoll",component:"tag",param:a(this).attr("data-collname")},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})})}}});
define('core/truncate', ["jquery"],function(a){var b=/(\s*\S+|\s)$/,c=/^(\S*)/,d=/\s/,e=function(a,b){if(null==this)throw TypeError();var c=String(a),d=c.length,e=b?Number(b):0;if(e!=e&&(e=0),e<=-1||e>=d)return"";e=0|e;var f,g=c.charCodeAt(e),h=e+1,i=1;return g>=55296&&g<=56319&&d>h&&(f=c.charCodeAt(h),f>=56320&&f<=57343&&(i=2)),i},f=function(a){for(var b=0,c=0;c<a.length;c+=e(a,c))b++;return b},g=function(a,b){if(!a.length)return 0;var c=0,d=0;do c+=e(a,c),d++;while(c<a.length&&d<b);return c};return a.truncate=function(b,c){return a("<div></div>").append(b).truncate(c).html()},a.fn.truncate=function(e){a.isNumeric(e)&&(e={length:e});var h=a.extend({},a.truncate.defaults,e);return this.each(function(){var e=a(this);h.noBreaks&&e.find("br").replaceWith(" ");var i=h.ellipsis.length,j=e.text(),k=f(j),l=k-h.length+i;if(!(k<h.length)){if(h.stripTags&&e.text(j),h.words&&l>0){var m=j.slice(0,g(j,h.length-i)+1),n=m.replace(b,""),o=f(n),p=!m.match(d);l=h.keepFirstWord&&0===o?k-f(c.exec(j)[0])-i:p&&0===o?k-h.length+i:k-o-1}l>k&&(l=k-h.length),l<0||!l&&!h.truncated||a.each(e.contents().get().reverse(),function(b,c){var d=a(c),e=d.text(),j=f(e);if(j<=l)return h.truncated=!0,l-=j,void d.remove();if(3===c.nodeType){var k=j-l;return k=k>=0?g(e,k):0,a(c.splitText(k)).replaceWith(h.ellipsis),!1}return d.truncate(a.extend(h,{length:j-l+i})),!1})}})},a.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:"…"},{truncate:a.truncate}});
define('core/form-course-selector', ["core/ajax","jquery"],function(a,b){return{processResults:function(a,c){var d=[],e=0,f=String(b(a).data("exclude")).split(",");for(e=0;e<c.courses.length;e++)f.indexOf(String(c.courses[e].id))===-1&&d.push({value:c.courses[e].id,label:c.courses[e].displayname});return d},transport:function(c,d,e,f){var g=b(c),h=g.data("requiredcapabilities");h=""!==h.trim()?h.split(","):[];var i=g.data("limittoenrolled"),j=g.data("includefrontpage"),k=null;"undefined"==typeof d&&(d="");var l={criterianame:"search",criteriavalue:d,page:0,perpage:100,requiredcapabilities:h,limittoenrolled:i},m=[{methodname:"core_course_search_courses",args:l}];j&&m.push({methodname:"core_course_get_courses",args:{options:{ids:[j]}}}),k=a.call(m),b.when.apply(b.when,k).done(function(a,b){if(b&&1==b.length){var c=b.pop(),f=""===d||c.fullname.toUpperCase().indexOf(d.toUpperCase())>-1||c.shortname.toUpperCase().indexOf(d.toUpperCase())>-1;f&&a.courses.splice(0,0,c)}e(a)}).fail(f)}}});
define('core/fragment', ["jquery","core/ajax"],function(a,b){var c=function(a,c,d,e){var f=[];for(var g in e)f.push({name:g,value:e[g]});return b.call([{methodname:"core_get_fragment",args:{component:a,callback:c,contextid:d,args:f}}])[0]};return{loadFragment:function(b,d,e,f){var g=a.Deferred();return c(b,d,e,f).then(function(b){var c=a(b.javascript),d="";c.each(function(b,c){c=a(c);var e=c.prop("tagName");if(e&&"script"==e.toLowerCase())if(c.attr("src")){var f=!1;a("script").each(function(b,d){return a(d).attr("src")==c.attr("src")&&(f=!0),!f}),f||(d+=" { ",d+=' node = document.createElement("script"); ',d+=' node.type = "text/javascript"; ',d+=' node.src = decodeURI("'+encodeURI(c.attr("src"))+'"); ',d+=' document.getElementsByTagName("head")[0].appendChild(node); ',d+=" } ")}else d+=" "+c.text()}),g.resolve(b.html,d)}).fail(function(a){g.reject(a)}),g.promise()}}});
define('core/storagewrapper', ["core/config"],function(a){var b=function(b){this.storage=b,this.supported=this.detectSupport(),this.hashSource=a.wwwroot+"/"+a.jsrev,this.hash=this.hashString(this.hashSource),this.prefix=this.hash+"/",this.jsrevPrefix=this.hash+"/jsrev"};return b.prototype.detectSupport=function(){if(a.jsrev==-1)return!1;if("undefined"==typeof this.storage)return!1;var b="test";try{return null!==this.storage&&(this.storage.setItem(b,"1"),this.storage.removeItem(b),!0)}catch(c){return!1}},b.prototype.prefixKey=function(a){return this.prefix+a},b.prototype.validateCache=function(){var b=this.storage.getItem(this.jsrevPrefix);if(null===b)return void this.storage.setItem(this.jsrevPrefix,a.jsrev);var c=a.jsrev;c!=b&&(this.storage.clear(),this.storage.setItem(this.jsrevPrefix,a.jsrev))},b.prototype.hashString=function(a){var b,c,d,e=0;if(0===a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e},b.prototype.get=function(a){return!!this.supported&&(this.validateCache(),a=this.prefixKey(a),this.storage.getItem(a))},b.prototype.set=function(a,b){if(!this.supported)return!1;this.validateCache(),a=this.prefixKey(a);try{this.storage.setItem(a,b)}catch(c){return!1}return!0},b});
define('core/inplace_editable', ["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url","core/form-autocomplete"],function(a,b,c,d,e,f,g,h){return a("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",function(i){if("keypress"!==i.type||13===i.keyCode){i.stopImmediatePropagation(),i.preventDefault();var j=a(this),k=j.closest("[data-inplaceeditable]"),l=function(b){b.addClass("updating");var c=b.find("img.spinner");c.length?c.show():(c=a("<img/>").attr("src",g.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),b.append(c))},m=function(a){a.removeClass("updating"),a.find("img.spinner").hide()},n=function(e,f){var g=[e.attr("data-itemid"),e.attr("data-component"),e.attr("data-itemtype")].join("-");M.util.js_pending(g),l(e),b.call([{methodname:"core_update_inplace_editable",args:{itemid:e.attr("data-itemid"),component:e.attr("data-component"),itemtype:e.attr("data-itemtype"),value:f},done:function(b){var d=e.attr("data-value");c.render("core/inplace_editable",b).done(function(f,h){var i=a(f);c.replaceNode(e,i,h),i.find("[data-inplaceeditablelink]").focus(),i.trigger({type:"updated",ajaxreturn:b,oldvalue:d}),M.util.js_complete(g)})},fail:function(b){var c=a.Event("updatefailed",{exception:b,newvalue:f});m(e),M.util.js_complete(g),e.trigger(c),c.isDefaultPrevented()||d.exception(b)}}],!0)},o=function(a){a.find("input").off(),a.find("select").off(),a.html(a.attr("data-oldcontent")),a.removeAttr("data-oldcontent"),a.removeClass("inplaceeditingon"),a.find("[data-inplaceeditablelink]").focus()},p=function(){a("span.inplaceeditable.inplaceeditingon").each(function(){o(a(this))})},q=function(b,c){var d,e=b;for(d=0;d<c;d++)e+=String(Math.floor(10*Math.random()));return 0===a("#"+e).length?e:q(b,c)},r=function(b){e.get_string("edittitleinstructions").done(function(c){var d=a('<span class="editinstructions">'+c+"</span>").attr("id",q("id_editinstructions_",20)),e=a('<input type="text"/>').attr("id",q("id_inplacevalue_",20)).attr("value",b.attr("data-value")).attr("aria-describedby",d.attr("id")).addClass("ignoredirty").addClass("form-control"),g=a('<label class="accesshide">'+k.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));b.html("").append(d).append(g).append(e),e.focus(),e.select(),e.on("keyup keypress focusout",function(a){if(!f.behatsiterunning||"focusout"!==a.type){if("keypress"===a.type&&13===a.keyCode){var c=e.val();o(b),n(b,c)}("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&o(b)}})})},s=function(a,b){o(a),n(a,b)},t=function(b,c){var d,e=a("<select></select>").attr("id",q("id_inplacevalue_",20)).addClass("custom-select"),g=a('<label class="accesshide">'+k.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));for(d in c)e.append(a("<option>").attr("value",c[d].key).html(c[d].value));e.val(b.attr("data-value")),b.html("").append(g).append(e),e.focus(),e.select(),e.on("keyup change focusout",function(a){if(!f.behatsiterunning||"focusout"!==a.type){if("change"===a.type){var c=e.val();o(b),n(b,c)}("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&o(b)}})},u=function(b,f){var g,i=a("<select></select>").attr("id",q("id_inplacevalue_",20)).addClass("form-autocomplete-original-select").addClass("custom-select"),j=a('<label class="accesshide">'+k.attr("data-editlabel")+"</label>").attr("for",i.attr("id")),l=f.options,m=f.attributes,p=a('<a href="#"></a>'),r=a('<a href="#"></a>');for(g in l)i.append(a("<option>").attr("value",l[g].key).html(l[g].value));m.multiple&&i.attr("multiple","true"),i.val(JSON.parse(b.attr("data-value"))),e.get_string("savechanges","core").then(function(a){return c.renderPix("e/save","core",a)}).then(function(a){p.append(a)}).fail(d.exception),e.get_string("cancel","core").then(function(a){return c.renderPix("e/cancel","core",a)}).then(function(a){r.append(a)}).fail(d.exception),b.html("").append(j).append(i).append(p).append(r),i.focus(),i.select(),h.enhance(i,m.tags,m.ajax,m.placeholder,m.caseSensitive,m.showSuggestions,m.noSelectionString).then(function(){b.find("[role=combobox]").focus()}).fail(d.exception),i.on("keyup",function(a){("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&o(b)}),p.on("click",function(a){var c=JSON.stringify(i.val());i.empty(),o(b),n(b,c),a.preventDefault()}),r.on("click",function(a){i.empty(),o(b),a.preventDefault()})},v=function(b){b.addClass("inplaceeditingon"),b.attr("data-oldcontent",b.html());var c=b.attr("data-type"),d=b.attr("data-options");"toggle"===c?s(b,d):"select"===c?t(b,a.parseJSON(d)):"autocomplete"===c?u(b,a.parseJSON(d)):r(b)};p(),v(k)}}),{}});
define('core/search-input', ["jquery"],function(a){var b=null,c=function(a){b.hasClass("expanded")?e():d(a)},d=function(c){var d=a(document).width();if("keydown"!==c.type||13===c.keyCode||32===c.keyCode)return d<=767&&("click"===c.type||"keydown"===c.type)?void f():void(d<=767||("keydown"===c.type&&c.preventDefault(),b.addClass("expanded"),b.find("form").addClass("expanded"),b.find("input").focus()))},e=function(){b.removeClass("expanded"),b.find("form").removeClass("expanded")},f=function(){b.find("form").submit()};return{init:function(d){b=a("#"+d),b.on("click mouseover keydown","div",c)}}});
define('core/tooltip', ["jquery"],function(a){var b=function(b){this._regionSelector=b,a(this._regionSelector).each(function(b,c){var d=a(c).attr("aria-describedby");if(d){var e=document.getElementById(d);if(e){var f="tooltip"==a(e).attr("role");f&&(a(e).hide(),a(c).attr("tabindex","0")),a(c).on("focus",this._handleFocus.bind(this)),a(c).on("mouseover",this._handleMouseOver.bind(this)),a(c).on("mouseout",this._handleMouseOut.bind(this)),a(c).on("blur",this._handleBlur.bind(this)),a(c).on("keydown",this._handleKeyDown.bind(this))}}}.bind(this))};return b.prototype._regionSelector=null,b.prototype._showTooltip=function(b){var c=a(b.target),d=c.attr("aria-describedby");if(d){var e=a(document.getElementById(d));if(e.show(),e.attr("aria-hidden","false"),!e.is(".tooltip")){var f=a('<div class="tooltip-inner"></div>');f.append(e.contents()),e.append(f),e.addClass("tooltip"),e.addClass("bottom"),e.append('<div class="tooltip-arrow"></div>')}var g=c.offset();g.top+=c.height()+10,a(e).offset(g)}},b.prototype._hideTooltip=function(b){var c=a(b.target),d=c.attr("aria-describedby");if(d){var e=document.getElementById(d);a(e).hide(),a(e).attr("aria-hidden","true")}},b.prototype._handleFocus=function(a){this._showTooltip(a)},b.prototype._handleKeyDown=function(a){27==a.which&&this._hideTooltip(a)},b.prototype._handleMouseOver=function(a){this._showTooltip(a)},b.prototype._handleMouseOut=function(b){var c=a(b.target);c.is(":focus")||this._hideTooltip(b)},b.prototype._handleBlur=function(a){this._hideTooltip(a)},b});
define('core/tree', ["jquery"],function(a){var b={ITEM:"[role=treeitem]",GROUP:"[role=treeitem]:has([role=group]), [role=treeitem][aria-owns], [role=treeitem][data-requires-ajax=true]",CLOSED_GROUP:"[role=treeitem]:has([role=group])[aria-expanded=false], [role=treeitem][aria-owns][aria-expanded=false], [role=treeitem][data-requires-ajax=true][aria-expanded=false]",FIRST_ITEM:"[role=treeitem]:first",VISIBLE_ITEM:"[role=treeitem]:visible",UNLOADED_AJAX_ITEM:"[role=treeitem][data-requires-ajax=true][data-loaded=false][aria-expanded=true]"},c=function(c,d){this.treeRoot=a(c),this.treeRoot.data("activeItem",null),this.selectCallback=d,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,asterisk:106},this.initialiseNodes(this.treeRoot),this.setActiveItem(this.treeRoot.find(b.FIRST_ITEM)),this.refreshVisibleItemsCache(),this.bindEventHandlers()};return c.prototype.registerEnterCallback=function(a){this.enterCallback=a},c.prototype.refreshVisibleItemsCache=function(){this.treeRoot.data("visibleItems",this.treeRoot.find(b.VISIBLE_ITEM))},c.prototype.getVisibleItems=function(){return this.treeRoot.data("visibleItems")},c.prototype.setActiveItem=function(a){var b=this.treeRoot.data("activeItem");a!==b&&(b&&(b.attr("tabindex","-1"),b.attr("aria-selected","false")),a.attr("tabindex","0"),a.attr("aria-selected","true"),this.treeRoot.data("activeItem",a),"function"==typeof this.selectCallback&&this.selectCallback(a))},c.prototype.isGroupItem=function(a){return a.is(b.GROUP)},c.prototype.getGroupFromItem=function(a){var b=this.treeRoot.find("#"+a.attr("aria-owns")),c=a.children("[role=group]");return b.length>c.length?b:c},c.prototype.isGroupCollapsed=function(a){return"false"===a.attr("aria-expanded")},c.prototype.isGroupCollapsible=function(a){return"false"!==a.attr("data-collapsible")},c.prototype.initialiseNodes=function(c){this.removeAllFromTabOrder(c),this.setAriaSelectedFalseOnItems(c);var d=this;c.find(b.UNLOADED_AJAX_ITEM).each(function(){var b=a(this);d.collapseGroup(b),d.expandGroup(b)})},c.prototype.removeAllFromTabOrder=function(b){b.find("*").attr("tabindex","-1"),this.getGroupFromItem(a(b)).find("*").attr("tabindex","-1")},c.prototype.setAriaSelectedFalseOnItems=function(a){a.find(b.ITEM).attr("aria-selected","false")},c.prototype.expandAllGroups=function(){var c=this;this.treeRoot.find(b.CLOSED_GROUP).each(function(){var b=a(this);c.expandGroup(a(this)).done(function(){c.expandAllChildGroups(b)})})},c.prototype.expandAllChildGroups=function(c){var d=this;this.getGroupFromItem(c).find(b.CLOSED_GROUP).each(function(){var b=a(this);d.expandGroup(a(this)).done(function(){d.expandAllChildGroups(b)})})},c.prototype.expandGroup=function(b){var c=a.Deferred();if("false"!==b.attr("data-expandable")&&this.isGroupCollapsed(b))if("true"===b.attr("data-requires-ajax")&&"true"!==b.attr("data-loaded")){b.attr("data-loaded",!1);var d=b.closest("[data-ajax-loader]").attr("data-ajax-loader"),e=this;b.addClass("loading"),require([d],function(a){a.load(b).done(function(){b.attr("data-loaded",!0),e.initialiseNodes(b),e.finishExpandingGroup(b),b.removeClass("loading"),c.resolve()})})}else this.finishExpandingGroup(b),c.resolve();else c.resolve();return c},c.prototype.finishExpandingGroup=function(a){var b=this.getGroupFromItem(a);b.attr("aria-hidden","false"),a.attr("aria-expanded","true"),this.refreshVisibleItemsCache()},c.prototype.collapseGroup=function(a){if(this.isGroupCollapsible(a)&&!this.isGroupCollapsed(a)){var b=this.getGroupFromItem(a);b.attr("aria-hidden","true"),a.attr("aria-expanded","false"),this.refreshVisibleItemsCache()}},c.prototype.toggleGroup=function(a){"true"===a.attr("aria-expanded")?this.collapseGroup(a):this.expandGroup(a)},c.prototype.handleKeyDown=function(c,d){var e=this.getVisibleItems().index(c);if(d.altKey||d.ctrlKey||d.metaKey||d.shiftKey&&d.keyCode!=this.keys.tab)return!0;switch(d.keyCode){case this.keys.home:return this.getVisibleItems().first().focus(),d.stopPropagation(),!1;case this.keys.end:return this.getVisibleItems().last().focus(),d.stopPropagation(),!1;case this.keys.enter:var f=c.children("a").length?c.children("a"):c.children().not(b.GROUP).find("a");return f.length?"function"==typeof this.enterCallback?this.enterCallback(c):window.location.href=f.first().attr("href"):this.isGroupItem(c)&&this.toggleGroup(c,!0),d.stopPropagation(),!1;case this.keys.space:return this.isGroupItem(c)&&this.toggleGroup(c,!0),d.stopPropagation(),!1;case this.keys.left:var g=function(b){b.getVisibleItems().filter(function(){return b.getGroupFromItem(a(this)).has(c).length}).focus()};return this.isGroupItem(c)?this.isGroupCollapsed(c)?g(this):this.collapseGroup(c):g(this),d.stopPropagation(),!1;case this.keys.right:return this.isGroupItem(c)&&(this.isGroupCollapsed(c)?this.expandGroup(c):this.getGroupFromItem(c).find(b.ITEM).first().focus()),d.stopPropagation(),!1;case this.keys.up:if(e>0){var h=this.getVisibleItems().eq(e-1);h.focus()}return d.stopPropagation(),!1;case this.keys.down:if(e<this.getVisibleItems().length-1){var i=this.getVisibleItems().eq(e+1);i.focus()}return d.stopPropagation(),!1;case this.keys.asterisk:return this.expandAllGroups(),d.stopPropagation(),!1}return!0},c.prototype.handleClick=function(a,b){return!!(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(a.focus(),this.isGroupItem(a)&&this.toggleGroup(a),b.stopPropagation(),!0)},c.prototype.handleFocus=function(a,b){return this.setActiveItem(a),b.stopPropagation(),!0},c.prototype.bindEventHandlers=function(){var c=this;this.treeRoot.on({click:function(b){return c.handleClick(a(this),b)},keydown:function(b){return c.handleKeyDown(a(this),b)},focus:function(b){return c.handleFocus(a(this),b)}},b.ITEM)},c});
define('core/addblockmodal', ["jquery","core/modal_factory","core/templates","core/str","core/notification"],function(a,b,c,d,e){return{init:function(f){var g=a("[data-key=addblock]"),h=f.blocks.map(function(a){return{key:"pluginname",component:"block_"+a}}),i=d.get_strings(h).then(function(a){return a.map(function(a,b){return{name:f.blocks[b],title:a}})}).then(function(a){return f.blocks=a,c.render("core/add_block_body",f)}).fail(e.exception),j=d.get_string("addblock").fail(e.exception);b.create({title:j,body:i,type:"CANCEL"},g)}}});
define('core/auto_rows', ["jquery"],function(a){var b={ELEMENT:"[data-auto-rows]"},c={ROW_CHANGE:"autorows:rowchange"},d=function(a){var b=a.attr("rows"),c=a.data("min-rows"),d=a.attr("data-max-rows"),e=a.height(),f=a.innerHeight(),g=f-e,h=a[0].scrollHeight,i=(h-g)/(e/b);return a.css("height",""),i<c?c:d&&i>=d?d:i},e=function(b){var e=a(b.target),f=e.data("min-rows"),g=e.attr("rows");"undefined"==typeof f&&e.data("min-rows",g);var h=d(e);h!=g&&(e.attr("rows",h),e.trigger(c.ROW_CHANGE))},f=function(c){a(c).data("auto-rows")?a(c).on("input propertychange",e.bind(this)):a(c).on("input propertychange",b.ELEMENT,e.bind(this))};return{init:f,events:c}});
define('core/backoff_timer', function(){var a=function(a,b){this.callback=a,this.backOffFunction=b};return a.prototype.callback=null,a.prototype.backOffFunction=null,a.prototype.time=null,a.prototype.timeout=null,a.prototype.generateNextTime=function(){var a=this.backOffFunction(this.time);return this.time=a,a},a.prototype.reset=function(){return this.time=null,this.stop(),this},a.prototype.stop=function(){return this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),this},a.prototype.start=function(){if(!this.timeout){var a=this.generateNextTime();this.timeout=window.setTimeout(function(){this.callback(),this.stop(),this.start()}.bind(this),a)}return this},a.prototype.restart=function(){return this.reset().start()},a.getIncrementalCallback=function(a,b,c,d){return function(e){return e?e+b>c?d:e+b:a}},a});
define('core/chart_axis', [],function(){function a(){}return a.prototype.POS_DEFAULT=null,a.prototype.POS_BOTTOM="bottom",a.prototype.POS_LEFT="left",a.prototype.POS_RIGHT="right",a.prototype.POS_TOP="top",a.prototype._label=null,a.prototype._labels=null,a.prototype._max=null,a.prototype._min=null,a.prototype._position=null,a.prototype._stepSize=null,a.prototype.create=function(b){var c=new a;return c.setPosition(b.position),c.setLabel(b.label),c.setStepSize(b.stepSize),c.setMax(b.max),c.setMin(b.min),c.setLabels(b.labels),c},a.prototype.getLabel=function(){return this._label},a.prototype.getLabels=function(){return this._labels},a.prototype.getMax=function(){return this._max},a.prototype.getMin=function(){return this._min},a.prototype.getPosition=function(){return this._position},a.prototype.getStepSize=function(){return this._stepSize},a.prototype.setLabel=function(a){this._label=a||null},a.prototype.setLabels=function(a){this._labels=a||null,null===this._labels||null!==this._stepSize||null!==this._min&&0!==this._min||null!==this._max||(this.setStepSize(1),this.setMin(0),this.setMax(a.length-1))},a.prototype.setMax=function(a){this._max="undefined"!=typeof a?a:null},a.prototype.setMin=function(a){this._min="undefined"!=typeof a?a:null},a.prototype.setPosition=function(a){if(a!=this.POS_DEFAULT&&a!=this.POS_BOTTOM&&a!=this.POS_LEFT&&a!=this.POS_RIGHT&&a!=this.POS_TOP)throw new Error("Invalid axis position.");this._position=a},a.prototype.setStepSize=function(a){if("undefined"==typeof a||null===a)a=null;else{if(isNaN(Number(a)))throw new Error("Value for stepSize is not a number.");a=Number(a)}this._stepSize=a},a});
define('core/chart_bar', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype._horizontal=!1,b.prototype._stacked=!1,b.prototype.TYPE="bar",b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setHorizontal(c.horizontal),d.setStacked(c.stacked),d},b.prototype._setDefaults=function(){a.prototype._setDefaults.apply(this,arguments);var b=this.getYAxis(0,!0);b.setMin(0)},b.prototype.getHorizontal=function(){return this._horizontal},b.prototype.getStacked=function(){return this._stacked},b.prototype.setHorizontal=function(a){var b=this.getXAxis(0,!0);null===b.getMin()&&b.setMin(0),this._horizontal=Boolean(a)},b.prototype.setStacked=function(a){this._stacked=Boolean(a)},b});
define('core/chart_base', ["core/chart_series","core/chart_axis"],function(a,b){function c(){this._series=[],this._labels=[],this._xaxes=[],this._yaxes=[],this._setDefaults()}return c.prototype._series=null,c.prototype._labels=null,c.prototype._title=null,c.prototype._xaxes=null,c.prototype._yaxes=null,c.prototype.COLORSET=["#f3c300","#875692","#f38400","#a1caf1","#be0032","#c2b280","#7f180d","#008856","#e68fac","#0067a5"],c.prototype._configColorSet=null,c.prototype.TYPE=null,c.prototype.addSeries=function(a){if(this._validateSeries(a),this._series.push(a),null===a.getColor()){var b=this.getConfigColorSet()||c.prototype.COLORSET;a.setColor(b[this._series.length%b.length])}},c.prototype.create=function(c,d){var e=new c;return e.setConfigColorSet(d.config_colorset),e.setLabels(d.labels),e.setTitle(d.title),d.series.forEach(function(b){e.addSeries(a.prototype.create(b))}),d.axes.x.forEach(function(a,c){e.setXAxis(b.prototype.create(a),c)}),d.axes.y.forEach(function(a,c){e.setYAxis(b.prototype.create(a),c)}),e},c.prototype.__getAxis=function(a,c,d){var e,f="x"===a?this._xaxes:this._yaxes,g=("x"===a?this.setXAxis:this.setYAxis).bind(this);if(c="undefined"==typeof c?0:c,d="undefined"!=typeof d&&d,e=f[c],"undefined"==typeof e){if(!d)throw new Error("Unknown axis.");e=new b,g(e,c)}return e},c.prototype.getConfigColorSet=function(){return this._configColorSet},c.prototype.getLabels=function(){return this._labels},c.prototype.getSeries=function(){return this._series},c.prototype.getTitle=function(){return this._title},c.prototype.getType=function(){if(!this.TYPE)throw new Error("The TYPE property has not been set.");return this.TYPE},c.prototype.getXAxes=function(){return this._xaxes},c.prototype.getXAxis=function(a,b){return this.__getAxis("x",a,b)},c.prototype.getYAxes=function(){return this._yaxes},c.prototype.getYAxis=function(a,b){return this.__getAxis("y",a,b)},c.prototype.setConfigColorSet=function(a){this._configColorSet=a},c.prototype._setDefaults=function(){},c.prototype.setLabels=function(a){if(a.length&&this._series.length&&this._series[0].length!=a.length)throw new Error("Series must match label values.");this._labels=a},c.prototype.setTitle=function(a){this._title=a},c.prototype.setXAxis=function(a,b){b="undefined"==typeof b?0:b,this._validateAxis("x",a,b),this._xaxes[b]=a},c.prototype.setYAxis=function(a,b){b="undefined"==typeof b?0:b,this._validateAxis("y",a,b),this._yaxes[b]=a},c.prototype._validateAxis=function(a,b,c){if(c="undefined"==typeof c?0:c,c>0){var d="x"==a?this._xaxes:this._yaxes;if("undefined"==typeof d[c-1])throw new Error("Missing "+a+" axis at index lower than "+c)}},c.prototype._validateSeries=function(a){if(this._series.length&&this._series[0].getCount()!=a.getCount())throw new Error("Series do not have an equal number of values.");if(this._labels.length&&this._labels.length!=a.getCount())throw new Error("Series must match label values.")},c});
define('core/chart_builder', ["jquery"],function(a){var b={make:function(b){var c=a.Deferred();return require(["core/chart_"+b.type],function(a){var d=a.prototype.create(a,b);c.resolve(d)}),c.promise()}};return b});
define('core/chart_line', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.TYPE="line",b.prototype._smooth=!1,b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setSmooth(c.smooth),d},b.prototype.getSmooth=function(){return this._smooth},b.prototype.setSmooth=function(a){this._smooth=Boolean(a)},b});
define('core/chart_output', ["core/chart_output_chartjs"],function(a){var b=a;return b});
define('core/user_date', ["jquery","core/ajax","core/sessionstorage","core/config"],function(a,b,c,d){var e={},f=function(b){var c=a("html").attr("lang").replace(/-/g,"_");return"core_user_date/"+c+"/"+d.usertimezone+"/"+b.timestamp+"/"+b.format},g=function(a){return c.get(a)},h=function(a,b){c.set(a,b)},i=function(a){return"undefined"!=typeof e[a]},j=function(a){return e[a]},k=function(a,b){e[a]=b},l=function(a){var c=a.map(function(a){return{timestamp:a.timestamp,format:a.format}}),e={methodname:"core_get_user_dates",args:{contextid:d.contextid,timestamps:c}};return b.call([e],!0,!0)[0].then(function(b){b.dates.forEach(function(b,c){var d=a[c],e=f(d);h(e,b),d.deferred.resolve(b)})})["catch"](function(b){a.forEach(function(a){a.deferred.reject(b)})})},m=function(b){var c=[],d=[];return b.forEach(function(b){var e=f(b);if(i(e))d.push(j(e));else{var h=a.Deferred(),l=g(e);l?h.resolve(l):(b.deferred=h,c.push(b)),k(e,h.promise()),d.push(h.promise())}}),c.length&&l(c),a.when.apply(a,d).then(function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)})};return{get:m}});
define('core/chart_output_base', ["jquery"],function(a){function b(b,c){this._node=a(b),this._chart=c}return b.prototype.update=function(){throw new Error("Not supported.")},b});
define('core/form-cohort-selector', ["core/ajax","jquery"],function(a,b){return{processResults:function(a,c){var d=[],e=0,f=String(b(a).data("exclude")).split(",");for(e=0;e<c.cohorts.length;e++)f.indexOf(String(c.cohorts[e].id))===-1&&d.push({value:c.cohorts[e].id,label:c.cohorts[e].name});return d},transport:function(c,d,e,f){var g=b(c),h=null;"undefined"==typeof d&&(d="");var i=g.data("contextid"),j={query:d,includes:"parents",limitfrom:0,limitnum:100,context:{contextid:i}},k=[{methodname:"core_cohort_search_cohorts",args:j}];h=a.call(k),b.when.apply(b.when,h).done(function(a){e(a)}).fail(f)}}});
define('core/chart_output_chartjs', ["jquery","core/chartjs","core/chart_axis","core/chart_bar","core/chart_output_base","core/chart_line","core/chart_pie","core/chart_series"],function(a,b,c,d,e,f,g,h){function i(){e.prototype.constructor.apply(this,arguments),this._canvas=this._node,"CANVAS"!=this._canvas.prop("tagName")&&(this._canvas=a("<canvas>"),this._node.append(this._canvas)),this._build()}var j=function(a,b){return"axis-"+a+"-"+b};return i.prototype=Object.create(e.prototype),i.prototype._config=null,i.prototype._chartjs=null,i.prototype._canvas=null,i.prototype._build=function(){this._config=this._makeConfig(),this._chartjs=new b(this._canvas[0],this._config)},i.prototype._cleanData=function(b){return b instanceof Array?b.map(function(b){return a("<span>").html(b).text()}):a("<span>").html(b).text()},i.prototype._getChartType=function(){var a=this._chart.getType();return this._chart.getType()===d.prototype.TYPE&&this._chart.getHorizontal()===!0?a="horizontalBar":this._chart.getType()===g.prototype.TYPE&&this._chart.getDoughnut()===!0&&(a="doughnut"),a},i.prototype._makeAxisConfig=function(a,b,d){var e={id:j(b,d)};return a.getPosition()!==c.prototype.POS_DEFAULT&&(e.position=a.getPosition()),null!==a.getLabel()&&(e.scaleLabel={display:!0,labelString:this._cleanData(a.getLabel())}),null!==a.getStepSize()&&(e.ticks=e.ticks||{},e.ticks.stepSize=a.getStepSize()),null!==a.getMax()&&(e.ticks=e.ticks||{},e.ticks.max=a.getMax()),null!==a.getMin()&&(e.ticks=e.ticks||{},e.ticks.min=a.getMin()),e},i.prototype._makeConfig=function(){var a={type:this._getChartType(),data:{labels:this._cleanData(this._chart.getLabels()),datasets:this._makeDatasetsConfig()},options:{title:{display:null!==this._chart.getTitle(),text:this._cleanData(this._chart.getTitle())}}};return this._chart.getXAxes().forEach(function(b,c){var d=b.getLabels();a.options.scales=a.options.scales||{},a.options.scales.xAxes=a.options.scales.xAxes||[],a.options.scales.xAxes[c]=this._makeAxisConfig(b,"x",c),null!==d&&(a.options.scales.xAxes[c].ticks.callback=function(a,b){return d[b]||""}),a.options.scales.xAxes[c].stacked=this._isStacked()}.bind(this)),this._chart.getYAxes().forEach(function(b,c){var d=b.getLabels();a.options.scales=a.options.scales||{},a.options.scales.yAxes=a.options.scales.yAxes||[],a.options.scales.yAxes[c]=this._makeAxisConfig(b,"y",c),null!==d&&(a.options.scales.yAxes[c].ticks.callback=function(a){return d[parseInt(a,10)]||""}),a.options.scales.yAxes[c].stacked=this._isStacked()}.bind(this)),a.options.tooltips={callbacks:{label:this._makeTooltip.bind(this)}},a},i.prototype._makeDatasetsConfig=function(){var a=this._chart.getSeries().map(function(a){var b=a.hasColoredValues()?a.getColors():a.getColor(),c={label:this._cleanData(a.getLabel()),data:a.getValues(),type:a.getType(),fill:!1,backgroundColor:b,borderColor:this._chart.getType()==g.prototype.TYPE?"#fff":b,lineTension:this._isSmooth(a)?.3:0};return null!==a.getXAxis()&&(c.xAxisID=j("x",a.getXAxis())),null!==a.getYAxis()&&(c.yAxisID=j("y",a.getYAxis())),c}.bind(this));return a},i.prototype._makeTooltip=function(a,b){var c=this._chart.getSeries()[a.datasetIndex],d=c.getLabel(),e=c.getLabels(),f=b.datasets[a.datasetIndex].data,g=f[a.index],h=[];if(""==a.xLabel&&""==a.yLabel){var i=this._cleanData(this._chart.getLabels());h.push(i[a.index])}return null!==e?h.push(this._cleanData(e[a.index])):h.push(this._cleanData(d)+": "+g),h},i.prototype._isSmooth=function(a){var b=!1;return this._chart.getType()===f.prototype.TYPE?(b=a.getSmooth(),null===b&&(b=this._chart.getSmooth())):a.getType()===h.prototype.TYPE_LINE&&(b=a.getSmooth()),b},i.prototype._isStacked=function(){var a=!1;return this._chart.getType()===d.prototype.TYPE&&(a=this._chart.getStacked()),a},i.prototype.update=function(){a.extend(!0,this._config,this._makeConfig()),this._chartjs.update()},i});
define('core/chart_output_htmltable', ["jquery","core/chart_output_base"],function(a,b){function c(){b.prototype.constructor.apply(this,arguments),this._build()}return c.prototype=Object.create(b.prototype),c.prototype._build=function(){this._node.empty(),this._node.append(this._makeTable())},c.prototype._makeTable=function(){var b,c,d,e=a("<table>"),f=this._chart,g=f.getLabels(),h=g.length>0,i=f.getSeries(),j=i[0].getCount();e.addClass("chart-output-htmltable generaltable"),null!==f.getTitle()&&e.append(a("<caption>").text(f.getTitle())),b=a("<tr>"),h&&b.append(a("<td>")),i.forEach(function(c){b.append(a("<th>").text(c.getLabel()).attr("scope","col"))}),e.append(b);for(var k=0;k<j;k++){b=a("<tr>"),g.length>0&&b.append(a("<th>").text(g[k]).attr("scope","row"));for(var l=0;l<i.length;l++)c=i[l].getValues()[k],d=i[l].getLabels(),null!==d&&(c=i[l].getLabels()[k]),b.append(a("<td>").text(c));e.append(b)}return e},c.prototype.update=function(){this._build()},c});
define('core/chart_pie', ["core/chart_base"],function(a){function b(){a.prototype.constructor.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.TYPE="pie",b.prototype._doughnut=null,b.prototype.create=function(b,c){var d=a.prototype.create.apply(this,arguments);return d.setDoughnut(c.doughnut),d},b.prototype.addSeries=function(b){if(null===b.getColor()){for(var c=[],d=this.getConfigColorSet()||a.prototype.COLORSET,e=0;e<b.getCount();e++)c.push(d[e%d.length]);b.setColors(c)}return a.prototype.addSeries.apply(this,arguments)},b.prototype.getDoughnut=function(){return this._doughnut},b.prototype.setDoughnut=function(a){this._doughnut=Boolean(a)},b.prototype._validateSeries=function(){if(this._series.length>=1)throw new Error("Pie charts only support one serie.");return a.prototype._validateSeries.apply(this,arguments)},b});
define('core/chart_series', [],function(){function a(a,b){if("string"!=typeof a)throw new Error("Invalid label for series.");if("object"!=typeof b)throw new Error("Values for a series must be an array.");if(b.length<1)throw new Error("Invalid values received for series.");this._colors=[],this._label=a,this._values=b}return a.prototype.TYPE_DEFAULT=null,a.prototype.TYPE_LINE="line",a.prototype._colors=null,a.prototype._label=null,a.prototype._labels=null,a.prototype._smooth=!1,a.prototype._type=a.prototype.TYPE_DEFAULT,a.prototype._values=null,a.prototype._xaxis=null,a.prototype._yaxis=null,a.prototype.create=function(b){var c=new a(b.label,b.values);return c.setType(b.type),c.setXAxis(b.axes.x),c.setYAxis(b.axes.y),c.setLabels(b.labels),b.colors&&b.colors.length>1?c.setColors(b.colors):c.setColor(b.colors[0]),c.setSmooth(b.smooth),c},a.prototype.getColor=function(){return this._colors[0]||null},a.prototype.getColors=function(){return this._colors},a.prototype.getCount=function(){return this._values.length},a.prototype.getLabel=function(){return this._label},a.prototype.getLabels=function(){return this._labels},a.prototype.getSmooth=function(){return this._smooth},a.prototype.getType=function(){return this._type},a.prototype.getValues=function(){return this._values},a.prototype.getXAxis=function(){return this._xaxis},a.prototype.getYAxis=function(){return this._yaxis},a.prototype.hasColoredValues=function(){return this._colors.length==this.getCount()},a.prototype.setColor=function(a){this._colors=[a]},a.prototype.setColors=function(a){if(a&&a.length!=this.getCount())throw new Error("When setting multiple colors there must be one per value.");this._colors=a||[]},a.prototype.setLabels=function(a){this._validateLabels(a),a="undefined"==typeof a?null:a,this._labels=a},a.prototype.setSmooth=function(a){a="undefined"==typeof a?null:a,this._smooth=a},a.prototype.setType=function(a){if(a!=this.TYPE_DEFAULT&&a!=this.TYPE_LINE)throw new Error("Invalid serie type.");this._type=a||null},a.prototype.setXAxis=function(a){this._xaxis=a||null},a.prototype.setYAxis=function(a){this._yaxis=a||null},a.prototype._validateLabels=function(a){if(a&&a.length>0&&a.length!=this.getCount())throw new Error("Series labels must match series values.")},a});
define('core/chartjs', ["core/chartjs-lazy"],function(a){return a});
define('core/icon_system_fontawesome', ["core/icon_system","jquery","core/ajax","core/mustache","core/localstorage","core/url"],function(a,b,c,d,e,f){var g=null,h=null,i=function(){a.apply(this,arguments)};return i.prototype=Object.create(a.prototype),i.prototype.init=function(){if(g)return b.when(this);var a=e.get("core/iconmap-fontawesome");return a&&(a=JSON.parse(a)),a?(g=a,b.when(this)):(null===h&&(h=c.call([{methodname:"core_output_load_fontawesome_icon_map",args:[]}],!0,!1)[0]),h.then(function(a){return g={},b.each(a,function(a,b){g[b.component+"/"+b.pix]=b.to}),e.set("core/iconmap-fontawesome",JSON.stringify(g)),this}.bind(this)))},i.prototype.renderIcon=function(a,b,c,e){var h=g[b+"/"+a],i=!1;if("undefined"==typeof h){var j=f.imageUrl(a,b);i={attributes:[{name:"src",value:j},{name:"alt",value:c},{name:"title",value:c}]}}var k={key:h,title:c,alt:c,unmappedIcon:i};return d.render(e,k)},i.prototype.getTemplateName=function(){return"core/pix_icon_fontawesome"},i});
define('core/custom_interaction_events', ["jquery","core/key_codes"],function(a,b){var c={activate:"cie:activate",keyboardActivate:"cie:keyboardactivate",escape:"cie:escape",down:"cie:down",up:"cie:up",home:"cie:home",end:"cie:end",next:"cie:next",previous:"cie:previous",asterix:"cie:asterix",scrollLock:"cie:scrollLock",scrollTop:"cie:scrollTop",scrollBottom:"cie:scrollBottom",ctrlPageUp:"cie:ctrlPageUp",ctrlPageDown:"cie:ctrlPageDown",enter:"cie:enter"},d={},e=function(a,b){return b=b||[],!(!b.length||b.indexOf(a)===-1)},f=function(a){return a.shiftKey||a.metaKey||a.altKey||a.ctrlKey},g=function(b,c){var e="";return c.hasOwnProperty("originalEvent")?(e="triggeredCustom_"+b,c.originalEvent.hasOwnProperty(e)?void 0:(c.originalEvent[e]=!0,void a(c.target).trigger(b,[{originalEvent:c}]))):(e=""+b+c.type+c.timeStamp,void(d.hasOwnProperty(e)||(d[e]=!0,a(c.target).trigger(b,[{originalEvent:c}]))))},h=function(a,b,c){a.off("keydown."+b).on("keydown."+b,function(a){f(a)||a.keyCode==c&&g(b,a)})},i=function(a){a.off("click.cie.activate").on("click.cie.activate",function(a){g(c.activate,a)}),a.off("keydown.cie.activate").on("keydown.cie.activate",function(a){f(a)||a.keyCode!=b.enter&&a.keyCode!=b.space||g(c.activate,a)})},j=function(a){a.off("keydown.cie.keyboardactivate").on("keydown.cie.keyboardactivate",function(a){f(a)||a.keyCode!=b.enter&&a.keyCode!=b.space||g(c.keyboardActivate,a)})},k=function(a){h(a,c.escape,b.escape)},l=function(a){h(a,c.down,b.arrowDown)},m=function(a){h(a,c.up,b.arrowUp)},n=function(a){h(a,c.home,b.home)},o=function(a){h(a,c.end,b.end)},p=function(d){var e="rtl"==a("html").attr("dir")?b.arrowLeft:b.arrowRight;h(d,c.next,e)},q=function(d){var e="rtl"==a("html").attr("dir")?b.arrowRight:b.arrowLeft;h(d,c.previous,e)},r=function(a){h(a,c.asterix,b.asterix)},s=function(a){a.off("scroll.cie.scrollTop").on("scroll.cie.scrollTop",function(b){var d=a.scrollTop();0===d&&g(c.scrollTop,b)})},t=function(a){a.off("scroll.cie.scrollBottom").on("scroll.cie.scrollBottom",function(b){var d=a.scrollTop(),e=a.innerHeight(),f=a[0].scrollHeight;d+e>=f&&g(c.scrollBottom,b)})},u=function(a){a.off("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock").on("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock",function(b){var d=a.scrollTop(),e=a[0].scrollHeight,f=a.height(),h="DOMMouseScroll"==b.type?b.originalEvent.detail*-40:b.originalEvent.wheelDelta,i=h>0;return!i&&-h>e-f-d?(a.scrollTop(e),b.stopPropagation(),b.preventDefault(),b.returnValue=!1,g(c.scrollLock,b),!1):!(i&&h>d)||(a.scrollTop(0),b.stopPropagation(),b.preventDefault(),b.returnValue=!1,g(c.scrollLock,b),!1)})},v=function(a){a.off("keydown.cie.ctrlpageup").on("keydown.cie.ctrlpageup",function(a){a.ctrlKey&&a.keyCode==b.pageUp&&g(c.ctrlPageUp,a)})},w=function(a){a.off("keydown.cie.ctrlpagedown").on("keydown.cie.ctrlpagedown",function(a){a.ctrlKey&&a.keyCode==b.pageDown&&g(c.ctrlPageDown,a)})},x=function(a){h(a,c.enter,b.enter)},y=function(){var a={};return a[c.activate]=i,a[c.keyboardActivate]=j,a[c.escape]=k,a[c.down]=l,a[c.up]=m,a[c.home]=n,a[c.end]=o,a[c.next]=p,a[c.previous]=q,a[c.asterix]=r,a[c.scrollLock]=u,a[c.scrollTop]=s,a[c.scrollBottom]=t,a[c.ctrlPageUp]=v,a[c.ctrlPageDown]=w,a[c.enter]=x,a},z=function(b,c){b=a(b),c=c||[],b.length&&c.length&&a.each(y(),function(a,d){e(a,c)&&d(b)})};return{define:z,events:c}});
define('core/key_codes', function(){return{tab:9,enter:13,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}});
define('core/modal', ["jquery","core/templates","core/notification","core/key_codes","core/custom_interaction_events","core/modal_backdrop","core/event","core/modal_events"],function(a,b,c,d,e,f,g,h){var i,j={CONTAINER:'[data-region="modal-container"]',MODAL:'[data-region="modal"]',HEADER:'[data-region="header"]',TITLE:'[data-region="title"]',BODY:'[data-region="body"]',FOOTER:'[data-region="footer"]',HIDE:'[data-action="hide"]',DIALOG:"[role=dialog]",MENU_BAR:"[role=menubar]",HAS_Z_INDEX:".moodle-has-zindex",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},k={LOADING:"core/loading",BACKDROP:"core/modal_backdrop"},l=0,m=function(b){this.root=a(b),this.modal=this.root.find(j.MODAL),this.header=this.modal.find(j.HEADER),this.title=this.header.find(j.TITLE),this.body=this.modal.find(j.BODY),this.footer=this.modal.find(j.FOOTER),this.hiddenSiblings=[],this.isAttached=!1,this.bodyJS=null,this.footerJS=null,this.modalCount=l++,this.root.is(j.CONTAINER)||c.exception({message:"Element is not a modal container"}),this.modal.length||c.exception({message:"Container does not contain a modal"}),this.header.length||c.exception({message:"Modal is missing a header region"}),this.title.length||c.exception({message:"Modal header is missing a title region"}),this.body.length||c.exception({message:"Modal is missing a body region"}),this.footer.length||c.exception({message:"Modal is missing a footer region"}),this.registerEventListeners()};return m.prototype.attachToDOM=function(){this.isAttached||(a("body").append(this.root),this.bodyJS&&(b.runTemplateJS(this.bodyJS),this.bodyJS=null),this.footerJS&&(b.runTemplateJS(this.footerJS),this.footerJS=null),this.isAttached=!0)},m.prototype.countOtherVisibleModals=function(){var b=0;return a("body").find(j.CONTAINER).each(function(c,d){d=a(d),!this.root.is(d)&&d.hasClass("show")&&b++}.bind(this)),b},m.prototype.getBackdrop=function(){return i||(i=b.render(k.BACKDROP,{}).then(function(b){var c=a(b);return new f(c)}).fail(c.exception)),i},m.prototype.getRoot=function(){return this.root},m.prototype.getModal=function(){return this.modal},m.prototype.getTitle=function(){return this.title},m.prototype.getBody=function(){return this.body},m.prototype.getFooter=function(){return this.footer},m.prototype.getModalCount=function(){return this.modalCount},m.prototype.setTitle=function(a){var b=this.getTitle();this.asyncSet(a,b.html.bind(b))},m.prototype.setBody=function(d){var e=this.getBody();if("string"==typeof d)e.html(d),g.notifyFilterContentUpdated(e),this.getRoot().trigger(h.bodyRendered,this);else{var f="amd-modal-js-pending-id-"+this.getModalCount();M.util.js_pending(f);var i=null;if(e.css("overflow","hidden"),"pending"==d.state()){var j=e.innerHeight();j<100&&(j=100),e.animate({height:j+"px"},150),e.html(""),i=b.render(k.LOADING,{}).then(function(b){var c=a(b).hide();return e.html(c),c.fadeIn(150),a.when(c.promise(),d)}).then(function(a){return a.fadeOut(100).promise()}).then(function(){return d})}else i=d;i.then(function(a,c){var d=null;if(this.isVisible()){e.css("opacity",0);var f=e.innerHeight();e.html(a),e.css("height","");var i=e.innerHeight();e.css("height",f+"px"),d=e.animate({height:i+"px",opacity:1},{duration:150,queue:!1}).promise()}else e.html(a);return c&&(this.isAttached?b.runTemplateJS(c):this.bodyJS=c),g.notifyFilterContentUpdated(e),this.getRoot().trigger(h.bodyRendered,this),d}.bind(this)).fail(c.exception).always(function(){e.css("height",""),e.css("overflow",""),e.css("opacity",""),M.util.js_complete(f)}).fail(c.exception)}},m.prototype.setFooter=function(a){this.showFooter();var c=this.getFooter();"string"==typeof a?c.html(a):b.render(k.LOADING,{}).done(function(d){c.html(d),a.done(function(a,d){c.html(a),d&&(this.isAttached?b.runTemplateJS(d):this.footerJS=d)}.bind(this))}.bind(this))},m.prototype.hasFooterContent=function(){return!!this.getFooter().children().length},m.prototype.hideFooter=function(){this.getFooter().addClass("hidden")},m.prototype.showFooter=function(){this.getFooter().removeClass("hidden")},m.prototype.setLarge=function(){this.isLarge()||this.getModal().addClass("modal-lg")},m.prototype.isLarge=function(){return this.getModal().hasClass("modal-lg")},m.prototype.setSmall=function(){this.isSmall()||this.getModal().removeClass("modal-lg")},m.prototype.isSmall=function(){return!this.getModal().hasClass("modal-lg")},m.prototype.calculateZIndex=function(){var b=a(j.DIALOG+", "+j.MENU_BAR+", "+j.HAS_Z_INDEX),c=parseInt(this.root.css("z-index"));return b.each(function(b,d){d=a(d);var e=d.css("z-index")?parseInt(d.css("z-index")):0;e>c&&(c=e)}),c},m.prototype.isVisible=function(){return this.root.hasClass("show")},m.prototype.hasFocus=function(){var b=a(document.activeElement);return this.root.is(b)||this.root.has(b).length},m.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},m.prototype.show=function(){this.isVisible()||(this.hasFooterContent()?this.showFooter():this.hideFooter(),this.isAttached||this.attachToDOM(),this.getBackdrop().done(function(b){var c=this.calculateZIndex(),d=c+2,e=d-1;this.root.css("z-index",d),b.setZIndex(e),b.show(),this.root.removeClass("hide").addClass("show"),this.accessibilityShow(),this.getModal().focus(),a("body").addClass("modal-open"),this.root.trigger(h.shown,this)}.bind(this)))},m.prototype.hide=function(){this.getBackdrop().done(function(b){this.countOtherVisibleModals()||(b.hide(),a("body").removeClass("modal-open"));var c=parseInt(this.root.css("z-index"));this.root.css("z-index",""),b.setZIndex(c-3),this.accessibilityHide(),this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"),this.root.trigger(h.hidden,this)}.bind(this))},m.prototype.destroy=function(){this.root.remove(),this.root.trigger(h.destroyed,this)},m.prototype.accessibilityShow=function(){a("body").children().each(function(b,c){if(!this.root.is(c)){c=a(c);var d=c.attr("aria-hidden");"true"!==d&&(c.data("previous-aria-hidden",d),this.hiddenSiblings.push(c),c.attr("aria-hidden","true"))}}.bind(this)),this.root.attr("aria-hidden","false")},m.prototype.accessibilityHide=function(){this.root.attr("aria-hidden","true"),a.each(this.hiddenSiblings,function(b,c){c=a(c);var d=c.data("previous-aria-hidden");"undefined"==typeof d?c.removeAttr("aria-hidden"):c.attr("aria-hidden",d)}),this.hiddenSiblings=[]},m.prototype.handleTabLock=function(b){if(this.hasFocus()){var c=a(document.activeElement),d=this.modal.find(j.CAN_RECEIVE_FOCUS),e=d.first(),f=d.last();c.is(e)&&b.shiftKey?(f.focus(),b.preventDefault()):c.is(f)&&!b.shiftKey&&(e.focus(),b.preventDefault())}},m.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(a){this.isVisible()&&(a.keyCode==d.tab?this.handleTabLock(a):a.keyCode==d.escape&&this.hide())}.bind(this)),e.define(this.getModal(),[e.events.activate]),this.getModal().on(e.events.activate,j.HIDE,function(a,b){this.hide(),b.originalEvent.preventDefault()}.bind(this))},m.prototype.asyncSet=function(b,d){var e=b;return"object"==typeof b&&b.hasOwnProperty("then")||(e=a.Deferred(),e.resolve(b)),e.then(function(a){d(a)}).fail(c.exception),e},m});
define('core/modal_backdrop', ["jquery","core/templates","core/notification"],function(a,b,c){var d={ROOT:'[data-region="modal-backdrop"]'},e=function(b){this.root=a(b),this.isAttached=!1,this.root.is(d.ROOT)||c.exception({message:"Element is not a modal backdrop"})};return e.prototype.getRoot=function(){return this.root},e.prototype.attachToDOM=function(){this.isAttached||(a("body").append(this.root),this.isAttached=!0)},e.prototype.setZIndex=function(a){this.root.css("z-index",a)},e.prototype.isVisible=function(){return this.root.hasClass("show")},e.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")},e.prototype.show=function(){this.isVisible()||(this.isAttached||this.attachToDOM(),this.root.removeClass("hide").addClass("show"))},e.prototype.hide=function(){this.isVisible()&&(this.hasTransitions()?this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this)):this.getRoot().removeClass("show").addClass("hide"))},e.prototype.destroy=function(){this.root.remove()},e});
define('core/modal_cancel', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events"],function(a,b,c,d,e){var f={CANCEL_BUTTON:'[data-action="cancel"]'},g=function(a){d.call(this,a),this.getFooter().find(f.CANCEL_BUTTON).length||b.exception({message:"No cancel button found"})};return g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.setFooter=function(){b.exception({message:"Can not change the footer of a cancel modal"})},g.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,f.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g});
define('core/modal_confirm', ["jquery","core/custom_interaction_events","core/modal_events","core/modal_save_cancel","core/log"],function(a,b,c,d,e){var f=function(a){e.warn("The CONFIRM modal type has been deprecated and should not be used anymore. Please use the SAVE_CANCEL modal type instead."),d.call(this,a)};return f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f});
define('core/modal_events', [],function(){return{shown:"modal:shown",hidden:"modal:hidden",destroyed:"modal:destroyed",bodyRendered:"modal:bodyRendered",save:"modal-save-cancel:save",cancel:"modal-save-cancel:cancel",yes:"modal-save-cancel:save",no:"modal-save-cancel:cancel"}});
define('core/modal_factory', ["jquery","core/modal_events","core/modal_registry","core/modal","core/modal_save_cancel","core/modal_confirm","core/modal_cancel","core/templates","core/notification","core/custom_interaction_events"],function(a,b,c,d,e,f,g,h,i,j){var k={DEFAULT:"core/modal",SAVE_CANCEL:"core/modal_save_cancel",CONFIRM:"core/modal_save_cancel",CANCEL:"core/modal_cancel"},l={DEFAULT:"DEFAULT",SAVE_CANCEL:"SAVE_CANCEL",CONFIRM:"CONFIRM",CANCEL:"CANCEL"};c.register(l.DEFAULT,d,k.DEFAULT),c.register(l.SAVE_CANCEL,e,k.SAVE_CANCEL),c.register(l.CONFIRM,f,k.CONFIRM),c.register(l.CANCEL,g,k.CANCEL);var m=function(c,d,e){var f=null,g="function"==typeof e.preShowCallback,h=function(b,d){f=a(b.currentTarget),c.then(function(a){return g&&e.preShowCallback(f,a),a.show(),a}),d.originalEvent.preventDefault()};if(Array.isArray(d)){var i=d[1];d=d[0],j.define(d,[j.events.activate]),d.on(j.events.activate,i,h)}else j.define(d,[j.events.activate]),d.on(j.events.activate,h);c.then(function(a){return a.getRoot().on(b.hidden,function(){null!==f&&f.focus()}),a})},n=function(b,c){c=a(c);var d=b.module,e=new d(c);return e},o=function(b,c){var d=b.template,e=h.render(d,c).then(function(c){var d=a(c);return n(b,d)}).fail(i.exception);return e},p=function(a,b){var d=a.type||l.DEFAULT,e=!!a.large,f=null,g={};f=c.get(d),f||i.exception({message:"Unable to find modal of type: "+d}),"undefined"!=typeof a.templateContext&&(g=a.templateContext);var h=o(f,g).then(function(b){return"undefined"!=typeof a.title&&b.setTitle(a.title),"undefined"!=typeof a.body&&b.setBody(a.body),"undefined"!=typeof a.footer&&b.setFooter(a.footer),e&&b.setLarge(),b});return"undefined"!=typeof b&&m(h,b,a),h};return{create:p,types:l}});
define('core/adapter', [],function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c,d,e){var f=j.writeRtpDescription(a.kind,b);if(f+=j.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=j.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":e||"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=g;var h="msid:"+(d?d.id:"-")+" "+g+"\r\n";f+="a="+h,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+h,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+h,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+j.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+j.localCName+"\r\n"),f}function e(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){var d=0===a.indexOf("turn:")&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!c;return d?(c=!0,!0):0===a.indexOf("stun:")&&b>=14393&&a.indexOf("?transport=udp")===-1}),delete a.url,a.urls=e?d[0]:d,!!d.length}})}function f(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function g(a,b,c){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)!==-1}function h(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}function i(a,b){var c=new Error(b);return c.name=a,c.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a],c}var j=a("sdp");b.exports=function(a,b){function c(b,c){c.addTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:b}))}function k(b,c){c.removeTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:b}))}function l(b,c,d,e){var f=new Event("track");f.track=c,f.receiver=d,f.transceiver={receiver:d},f.streams=e,a.setTimeout(function(){b._dispatchEvent("track",f)})}var m=function(c){var d=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=f[a].bind(f)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle="max-bundle"===c.bundlePolicy,"negotiate"===c.rtcpMuxPolicy)throw i("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced"}if(c.iceServers=e(c.iceServers||[],b),this._iceGatherers=[],c.iceCandidatePoolSize)for(var g=c.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=j.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};m.prototype.onicecandidate=null,m.prototype.onaddstream=null,m.prototype.ontrack=null,m.prototype.onremovestream=null,m.prototype.onsignalingstatechange=null,m.prototype.oniceconnectionstatechange=null,m.prototype.onconnectionstatechange=null,m.prototype.onicegatheringstatechange=null,m.prototype.onnegotiationneeded=null,m.prototype.ondatachannel=null,m.prototype._dispatchEvent=function(a,b){this._isClosed||(this.dispatchEvent(b),"function"==typeof this["on"+a]&&this["on"+a](b))},m.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},m.prototype.getConfiguration=function(){return this._config},m.prototype.getLocalStreams=function(){return this.localStreams},m.prototype.getRemoteStreams=function(){return this.remoteStreams},m.prototype._createTransceiver=function(a,b){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();d.iceTransport=e.iceTransport,d.dtlsTransport=e.dtlsTransport}return b||this.transceivers.push(d),d},m.prototype.addTrack=function(b,c){if(this._isClosed)throw i("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(a){return a.track===b});if(d)throw i("InvalidAccessError","Track already exists.");for(var e,f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==b.kind||(e=this.transceivers[f]);return e||(e=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),e.track=b,e.stream=c,e.rtpSender=new a.RTCRtpSender(b,e.dtlsTransport),e.rtpSender},m.prototype.addStream=function(a){var c=this;if(b>=15025)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)})}},m.prototype.removeTrack=function(b){if(this._isClosed)throw i("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(a){return a.rtpSender===b});if(!c)throw i("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var e=this.transceivers.map(function(a){return a.stream});e.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},m.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})},m.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},m.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},m.prototype._createIceGatherer=function(b,c){var d=this;if(c&&b>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].bufferedCandidateEvents=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering",null!==d.transceivers[b].bufferedCandidateEvents&&d.transceivers[b].bufferedCandidateEvents.push(a)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},m.prototype._gather=function(b,c){var d=this,e=this.transceivers[c].iceGatherer;if(!e.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),e.onlocalcandidate=function(a){if(!(d.usingBundle&&c>0)){var f=new Event("icecandidate");f.candidate={sdpMid:b,sdpMLineIndex:c};var g=a.candidate,h=!g||0===Object.keys(g).length;if(h)"new"!==e.state&&"gathering"!==e.state||(e.state="completed");else{"new"===e.state&&(e.state="gathering"),g.component=1,g.ufrag=e.getLocalParameters().usernameFragment;var i=j.writeCandidate(g);f.candidate=Object.assign(f.candidate,j.parseCandidate(i)),f.candidate.candidate=i,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var k=j.getMediaSections(d.localDescription.sdp);h?k[f.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":k[f.candidate.sdpMLineIndex]+="a="+f.candidate.candidate+"\r\n",d.localDescription.sdp=j.getDescription(d.localDescription.sdp)+k.join("");var l=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),h||d._dispatchEvent("icecandidate",f),l&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},a.setTimeout(function(){f.forEach(function(a){e.onlocalcandidate(a)})},0)}},m.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateIceConnectionState(),b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},m.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},m.prototype._transceive=function(a,c,d){var e=f(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:j.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),d&&a.rtpReceiver&&e.codecs.length>0&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length?e.encodings=a.recvEncodingParameters:e.encodings=[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},m.prototype.setLocalDescription=function(a){var b=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(i("TypeError",'Unsupported type "'+a.type+'"'));if(!g("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(i("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));var c,d;if("offer"===a.type)c=j.splitSections(a.sdp),d=c.shift(),c.forEach(function(a,c){var d=j.parseRtpParameters(a);b.transceivers[c].localCapabilities=d}),b.transceivers.forEach(function(a,c){b._gather(a.mid,c)});else if("answer"===a.type){c=j.splitSections(b.remoteDescription.sdp),d=c.shift();var e=j.matchPrefix(d,"a=ice-lite").length>0;c.forEach(function(a,c){var g=b.transceivers[c],h=g.iceGatherer,i=g.iceTransport,k=g.dtlsTransport,l=g.localCapabilities,m=g.remoteCapabilities,n=j.isRejected(a)&&0===j.matchPrefix(a,"a=bundle-only").length;if(!n&&!g.rejected){var o=j.getIceParameters(a,d),p=j.getDtlsParameters(a,d);e&&(p.role="server"),b.usingBundle&&0!==c||(b._gather(g.mid,c),"new"===i.state&&i.start(h,o,e?"controlling":"controlled"),"new"===k.state&&k.start(p));var q=f(l,m);b._transceive(g,q.codecs.length>0,!1)}})}return b.localDescription={type:a.type,sdp:a.sdp},"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable"),Promise.resolve()},m.prototype.setRemoteDescription=function(d){var e=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(i("TypeError",'Unsupported type "'+d.type+'"'));if(!g("setRemoteDescription",d.type,e.signalingState)||e._isClosed)return Promise.reject(i("InvalidStateError","Can not set remote "+d.type+" in state "+e.signalingState));var f={};e.remoteStreams.forEach(function(a){f[a.id]=a});var m=[],n=j.splitSections(d.sdp),o=n.shift(),p=j.matchPrefix(o,"a=ice-lite").length>0,q=j.matchPrefix(o,"a=group:BUNDLE ").length>0;e.usingBundle=q;var r=j.matchPrefix(o,"a=ice-options:")[0];return r?e.canTrickleIceCandidates=r.substr(14).split(" ").indexOf("trickle")>=0:e.canTrickleIceCandidates=!1,n.forEach(function(g,i){var l=j.splitLines(g),n=j.getKind(g),r=j.isRejected(g)&&0===j.matchPrefix(g,"a=bundle-only").length,s=l[0].substr(2).split(" ")[2],t=j.getDirection(g,o),u=j.parseMsid(g),v=j.getMid(g)||j.generateIdentifier();if("application"===n&&"DTLS/SCTP"===s||r)return void(e.transceivers[i]={mid:v,kind:n,rejected:!0});!r&&e.transceivers[i]&&e.transceivers[i].rejected&&(e.transceivers[i]=e._createTransceiver(n,!0));var w,x,y,z,A,B,C,D,E,F,G,H=j.parseRtpParameters(g);r||(F=j.getIceParameters(g,o),G=j.getDtlsParameters(g,o),G.role="client"),C=j.parseRtpEncodingParameters(g);var I=j.parseRtcpParameters(g),J=j.matchPrefix(g,"a=end-of-candidates",o).length>0,K=j.matchPrefix(g,"a=candidate:").map(function(a){return j.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===d.type||"answer"===d.type)&&!r&&q&&i>0&&e.transceivers[i]&&(e._disposeIceAndDtlsTransports(i),e.transceivers[i].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[i].iceTransport=e.transceivers[0].iceTransport,e.transceivers[i].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[i].rtpSender&&e.transceivers[i].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[i].rtpReceiver&&e.transceivers[i].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),"offer"!==d.type||r)"answer"!==d.type||r||(w=e.transceivers[i],x=w.iceGatherer,y=w.iceTransport,z=w.dtlsTransport,A=w.rtpReceiver,B=w.sendEncodingParameters,D=w.localCapabilities,e.transceivers[i].recvEncodingParameters=C,e.transceivers[i].remoteCapabilities=H,e.transceivers[i].rtcpParameters=I,K.length&&"new"===y.state&&(!p&&!J||q&&0!==i?K.forEach(function(a){h(w.iceTransport,a)}):y.setRemoteCandidates(K)),q&&0!==i||("new"===y.state&&y.start(x,F,"controlling"),"new"===z.state&&z.start(G)),e._transceive(w,"sendrecv"===t||"recvonly"===t,"sendrecv"===t||"sendonly"===t),!A||"sendrecv"!==t&&"sendonly"!==t?delete w.rtpReceiver:(E=A.track,u?(f[u.stream]||(f[u.stream]=new a.MediaStream),c(E,f[u.stream]),m.push([E,A,f[u.stream]])):(f["default"]||(f["default"]=new a.MediaStream),c(E,f["default"]),m.push([E,A,f["default"]]))));else{w=e.transceivers[i]||e._createTransceiver(n),w.mid=v,w.iceGatherer||(w.iceGatherer=e._createIceGatherer(i,q)),K.length&&"new"===w.iceTransport.state&&(!J||q&&0!==i?K.forEach(function(a){h(w.iceTransport,a)}):w.iceTransport.setRemoteCandidates(K)),D=a.RTCRtpReceiver.getCapabilities(n),b<15019&&(D.codecs=D.codecs.filter(function(a){return"rtx"!==a.name})),B=w.sendEncodingParameters||[{ssrc:1001*(2*i+2)}];var L=!1;if("sendrecv"===t||"sendonly"===t){if(L=!w.rtpReceiver,A=w.rtpReceiver||new a.RTCRtpReceiver(w.dtlsTransport,n),L){var M;E=A.track,u&&"-"===u.stream||(u?(f[u.stream]||(f[u.stream]=new a.MediaStream,Object.defineProperty(f[u.stream],"id",{get:function(){return u.stream}})),Object.defineProperty(E,"id",{get:function(){return u.track}}),M=f[u.stream]):(f["default"]||(f["default"]=new a.MediaStream),M=f["default"])),M&&(c(E,M),w.associatedRemoteMediaStreams.push(M)),m.push([E,A,M])}}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===w.rtpReceiver.track.id});b&&k(b,a)}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=D,w.remoteCapabilities=H,w.rtpReceiver=A,w.rtcpParameters=I,w.sendEncodingParameters=B,w.recvEncodingParameters=C,e._transceive(e.transceivers[i],!1,L)}}),void 0===e._dtlsRole&&(e._dtlsRole="offer"===d.type?"active":"passive"),e.remoteDescription={type:d.type,sdp:d.sdp},"offer"===d.type?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(f).forEach(function(b){var c=f[b];if(c.getTracks().length){if(e.remoteStreams.indexOf(c)===-1){e.remoteStreams.push(c);var d=new Event("addstream");d.stream=c,a.setTimeout(function(){e._dispatchEvent("addstream",d)})}m.forEach(function(a){var b=a[0],d=a[1];c.id===a[2].id&&l(e,b,d,[c])})}}),m.forEach(function(a){a[2]||l(e,a[0],a[1],[])}),a.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},m.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},m.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},m.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))},m.prototype._updateIceConnectionState=function(){var a,b={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){b[a.iceTransport.state]++}),a="new",b.failed>0?a="failed":b.checking>0?a="checking":b.disconnected>0?a="disconnected":b["new"]>0?a="new":b.connected>0?a="connected":b.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},m.prototype._updateConnectionState=function(){var a,b={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){b[a.iceTransport.state]++,b[a.dtlsTransport.state]++}),b.connected+=b.completed,a="new",b.failed>0?a="failed":b.connecting>0?a="connecting":b.disconnected>0?a="disconnected":b["new"]>0?a="new":b.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},m.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createOffer after close"));var e=c.transceivers.filter(function(a){return"audio"===a.kind}).length,f=c.transceivers.filter(function(a){return"video"===a.kind}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==g.offerToReceiveAudio&&(e=g.offerToReceiveAudio===!0?1:g.offerToReceiveAudio===!1?0:g.offerToReceiveAudio),void 0!==g.offerToReceiveVideo&&(f=g.offerToReceiveVideo===!0?1:g.offerToReceiveVideo===!1?0:g.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?(e--,e<0&&(a.wantReceive=!1)):"video"===a.kind&&(f--,f<0&&(a.wantReceive=!1))});e>0||f>0;)e>0&&(c._createTransceiver("audio"),e--),f>0&&(c._createTransceiver("video"),f--);var h=j.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(d,e){var f=d.track,g=d.kind,h=d.mid||j.generateIdentifier();d.mid=h,d.iceGatherer||(d.iceGatherer=c._createIceGatherer(e,c.usingBundle));var i=a.RTCRtpSender.getCapabilities(g);b<15019&&(i.codecs=i.codecs.filter(function(a){return"rtx"!==a.name})),i.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1"),d.remoteCapabilities&&d.remoteCapabilities.codecs&&d.remoteCapabilities.codecs.forEach(function(b){a.name.toLowerCase()===b.name.toLowerCase()&&a.clockRate===b.clockRate&&(a.preferredPayloadType=b.payloadType)})}),i.headerExtensions.forEach(function(a){var b=d.remoteCapabilities&&d.remoteCapabilities.headerExtensions||[];b.forEach(function(b){a.uri===b.uri&&(a.id=b.id)})});var k=d.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];f&&b>=15019&&"video"===g&&!k[0].rtx&&(k[0].rtx={ssrc:k[0].ssrc+1}),d.wantReceive&&(d.rtpReceiver=new a.RTCRtpReceiver(d.dtlsTransport,g)),d.localCapabilities=i,d.sendEncodingParameters=k}),"max-compat"!==c._config.bundlePolicy&&(h+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),h+="a=ice-options:trickle\r\n",c.transceivers.forEach(function(a,b){h+=d(a,a.localCapabilities,"offer",a.stream,c._dtlsRole),h+="a=rtcp-rsize\r\n",!a.iceGatherer||"new"===c.iceGatheringState||0!==b&&c.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1,h+="a="+j.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))});var k=new a.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(k)},m.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==c.signalingState&&"have-local-pranswer"!==c.signalingState)return Promise.reject(i("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var e=j.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(e+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var g=j.getMediaSections(c.remoteDescription.sdp).length;c.transceivers.forEach(function(a,h){if(!(h+1>g)){if(a.rejected)return"application"===a.kind?e+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===a.kind?e+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===a.kind&&(e+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(e+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+a.mid+"\r\n");if(a.stream){var i;"audio"===a.kind?i=a.stream.getAudioTracks()[0]:"video"===a.kind&&(i=a.stream.getVideoTracks()[0]),i&&b>=15019&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}var j=f(a.localCapabilities,a.remoteCapabilities),k=j.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!k&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,e+=d(a,j,"answer",a.stream,c._dtlsRole),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(e+="a=rtcp-rsize\r\n")}});var h=new a.RTCSessionDescription({type:"answer",sdp:e});return Promise.resolve(h)},m.prototype.addIceCandidate=function(a){var b,c=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,e){if(!c.remoteDescription)return e(i("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<c.transceivers.length;g++)if(c.transceivers[g].mid===a.sdpMid){f=g;break}var k=c.transceivers[f];if(!k)return e(i("OperationError","Can not add ICE candidate"));if(k.rejected)return d();var l=Object.keys(a.candidate).length>0?j.parseCandidate(a.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return d();if(l.component&&1!==l.component)return d();if((0===f||f>0&&k.iceTransport!==c.transceivers[0].iceTransport)&&!h(k.iceTransport,l))return e(i("OperationError","Can not add ICE candidate"));var m=a.candidate.trim();0===m.indexOf("a=")&&(m=m.substr(2)),b=j.getMediaSections(c.remoteDescription.sdp),b[f]+="a="+(l.type?m:"end-of-candidates")+"\r\n",c.remoteDescription.sdp=j.getDescription(c.remoteDescription.sdp)+b.join("")}else for(var n=0;n<c.transceivers.length&&(c.transceivers[n].rejected||(c.transceivers[n].iceTransport.addRemoteCandidate({}),b=j.getMediaSections(c.remoteDescription.sdp),b[n]+="a=end-of-candidates\r\n",c.remoteDescription.sdp=j.getDescription(c.remoteDescription.sdp)+b.join(""),!c.usingBundle));n++);d()})},m.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=function(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(c){a[c].type=b(a[c]),d.set(c,a[c])})}),c(d)})})};var n=["createOffer","createAnswer"];return n.forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[0]||"function"==typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"==typeof a[0]&&a[0].apply(null,[b])},function(b){"function"==typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}}),n=["setLocalDescription","setRemoteDescription","addIceCandidate"],n.forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]||"function"==typeof a[2]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)},function(b){"function"==typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}}),["getStats"].forEach(function(a){var b=m.prototype[a];m.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}}),m}},{sdp:2}],2:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.getDescription=function(a){var b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){var b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;case"ufrag":c.ufrag=b[d+1],c.usernameFragment=b[d+1];break;default:c[b[d]]=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substr(14).split(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},d.getDtlsParameters=function(a,b){var c=d.matchPrefix(a+b,"a=fingerprint:");return{role:"auto",fingerprints:c.map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){
var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=e.fecMechanisms.indexOf("RED")!==-1,g=e.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(a,b){var c,e=void 0!==b?b:2;return c=a?a:d.generateSessionId(),"v=0\r\no=thisisadapterortc "+c+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.direction?"a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){var b=d.splitLines(a),c=b[0].split(" ");return c[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){var b=d.splitLines(a),c=b[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},d.parseOLine=function(a){var b=d.matchPrefix(a,"o=")[0],c=b.substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},"object"==typeof b&&(b.exports=d)},{}],3:[function(a,b,c){(function(c){"use strict";var d=a("./adapter_factory.js");b.exports=d({window:c.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(a,b,c){"use strict";var d=a("./utils");b.exports=function(b,c){var e=b&&b.window,f={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var g in c)hasOwnProperty.call(c,g)&&(f[g]=c[g]);var h=d.log,i=d.detectBrowser(e),j=a("./chrome/chrome_shim")||null,k=a("./edge/edge_shim")||null,l=a("./firefox/firefox_shim")||null,m=a("./safari/safari_shim")||null,n=a("./common_shim")||null,o={browserDetails:i,commonShim:n,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(i.browser){case"chrome":if(!j||!j.shimPeerConnection||!f.shimChrome)return h("Chrome shim is not included in this adapter release."),o;h("adapter.js shimming chrome."),o.browserShim=j,n.shimCreateObjectURL(e),j.shimGetUserMedia(e),j.shimMediaStream(e),j.shimSourceObject(e),j.shimPeerConnection(e),j.shimOnTrack(e),j.shimAddTrackRemoveTrack(e),j.shimGetSendersWithDtmf(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"firefox":if(!l||!l.shimPeerConnection||!f.shimFirefox)return h("Firefox shim is not included in this adapter release."),o;h("adapter.js shimming firefox."),o.browserShim=l,n.shimCreateObjectURL(e),l.shimGetUserMedia(e),l.shimSourceObject(e),l.shimPeerConnection(e),l.shimOnTrack(e),l.shimRemoveStream(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"edge":if(!k||!k.shimPeerConnection||!f.shimEdge)return h("MS edge shim is not included in this adapter release."),o;h("adapter.js shimming edge."),o.browserShim=k,n.shimCreateObjectURL(e),k.shimGetUserMedia(e),k.shimPeerConnection(e),k.shimReplaceTrack(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"safari":if(!m||!f.shimSafari)return h("Safari shim is not included in this adapter release."),o;h("adapter.js shimming safari."),o.browserShim=m,n.shimCreateObjectURL(e),m.shimRTCIceServerUrls(e),m.shimCallbacksAPI(e),m.shimLocalStreamsAPI(e),m.shimRemoteStreamsAPI(e),m.shimTrackEventTransceiver(e),m.shimGetUserMedia(e),m.shimCreateOfferLegacy(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;default:h("Unsupported browser!")}return o}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in a||d.wrapPeerConnectionEvent(a,"track",function(a){return a.transceiver||(a.transceiver={receiver:a.receiver}),a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var f=new Event("track");f.track=d.track,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)}),b.stream.getTracks().forEach(function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)})},c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=this,f=c.apply(e,arguments);return f||(f=b(e,a),e._senders.push(f)),f};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;d.apply(b,arguments);var c=b._senders.indexOf(a);c!==-1&&b._senders.splice(c,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[],e.apply(c,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[],f.apply(b,[a]),a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=g.apply(a,[]);return b.forEach(function(b){b._pc=a}),b},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(a){var b=a&&a.URL;"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;return this._srcObject=a,this.src&&b.revokeObjectURL(this.src),a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)}),void a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)})):void(this.src="")}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});if(c)throw new DOMException("Track already exists.","InvalidAccessError")});var d=b.getSenders();c.apply(this,arguments);var e=b.getSenders().filter(function(a){return d.indexOf(a)===-1});this._shimmedLocalStreams[a.id]=[a].concat(e)};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var d=b._shimmedLocalStreams[c].indexOf(a);d!==-1&&b._shimmedLocalStreams[c].splice(d,1),1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]}),e.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}function c(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})}var e=d.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&e.version>=65)return this.shimAddTrackRemoveTrackWithNative(a);var f=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=f.apply(this);return a._reverseStreams=a._reverseStreams||{},b.map(function(b){return a._reverseStreams[b.id]})};var g=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=this;if(c._streams=c._streams||{},c._reverseStreams=c._reverseStreams||{},b.getTracks().forEach(function(a){var b=c.getSenders().find(function(b){return b.track===a});if(b)throw new DOMException("Track already exists.","InvalidAccessError")}),!c._reverseStreams[b.id]){var d=new a.MediaStream(b.getTracks());c._streams[b.id]=d,c._reverseStreams[d.id]=b,b=d}g.apply(c,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._streams=b._streams||{},b._reverseStreams=b._reverseStreams||{},h.apply(b,[b._streams[a.id]||a]),delete b._reverseStreams[b._streams[a.id]?b._streams[a.id].id:a.id],delete b._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var f=d.getSenders().find(function(a){return a.track===b});if(f)throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{};var g=d._streams[c.id];if(g)g.addTrack(b),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))});else{var h=new a.MediaStream([b]);d._streams[c.id]=h,d._reverseStreams[h.id]=c,d.addStream(h)}return d.getSenders().find(function(a){return a.track===b})},["createOffer","createAnswer"].forEach(function(c){var d=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments,e=arguments.length&&"function"==typeof arguments[0];return e?d.apply(a,[function(d){var e=b(a,d);c[0].apply(null,[e])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(c){return b(a,c)})}});var i=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a=this;return arguments.length&&arguments[0].type?(arguments[0]=c(a,arguments[0]),i.apply(a,arguments)):i.apply(a,arguments)};var j=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=this,c=j.get.apply(this);return""===c.type?c:b(a,c)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var c=a._pc===b;if(!c)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var d;Object.keys(b._streams).forEach(function(c){var e=b._streams[c].getTracks().find(function(b){return a.track===b});e&&(d=b._streams[c])}),d&&(1===d.getTracks().length?b.removeStream(b._reverseStreams[d.id]):d.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(a){var b=d.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=function(b,c){return e("PeerConnection"),b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy),new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});else{var c=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new c(a,b)},a.RTCPeerConnection.prototype=c.prototype,Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})}var f=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,c){var d=this,e=arguments;if(arguments.length>0&&"function"==typeof a)return f.apply(this,arguments);if(0===f.length&&(0===arguments.length||"function"!=typeof arguments[0]))return f.apply(this,[]);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){e[1](h(g(a)))};return f.apply(this,[i,arguments[0]])}return new Promise(function(a,b){f.apply(d,[function(b){a(h(g(b)))},b])}).then(b,c)},b.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),b.version<52&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var g=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?g.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":13,"./getusermedia":6}],6:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(a,d){if(b.version>=61)return d(a);if(a=JSON.parse(JSON.stringify(a)),a&&"object"==typeof a.audio){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","googAutoGainControl"),g(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=f(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});var i=b.version<66;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||i)){delete a.video.facingMode;var j;if("environment"===h.exact||"environment"===h.ideal?j=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(j=["front"]),j)return c.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var c=b.find(function(a){return j.some(function(b){return a.label.toLowerCase().indexOf(b)!==-1})});return!c&&b.length&&j.indexOf("back")!==-1&&(c=b[b.length-1]),c&&(a.video.deviceId=h.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=f(a.video),e("chrome: "+JSON.stringify(a)),d(a)})}a.video=f(a.video)}return e("chrome: "+JSON.stringify(a)),d(a)},h=function(a){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(a,b,d){g(a,function(a){c.webkitGetUserMedia(a,b,function(a){d&&d(h(a))})})};c.getUserMedia=i;var j=function(a){return new Promise(function(b,d){c.getUserMedia(a,b,d)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:j,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return g(a,function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}else c.mediaDevices.getUserMedia=function(a){return j(a)};"undefined"==typeof c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(a,b,c){"use strict";var d=a("sdp"),e=a("./utils");b.exports={shimRTCIceCandidate:function(a){if(a.RTCIceCandidate&&!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){var c=new b(a),e=d.parseCandidate(a.candidate),f=Object.assign(c,e);return f.toJSON=function(){return{candidate:f.candidate,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex,usernameFragment:f.usernameFragment}},f}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,e.wrapPeerConnectionEvent(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var c=b.createObjectURL.bind(b),d=b.revokeObjectURL.bind(b),f=new Map,g=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++g;return f.set(b,a),e.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),b}return c(a)},b.revokeObjectURL=function(a){d(a),f["delete"](a)};var h=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(a){return this.srcObject=f.get(a)||null,h.set.apply(this,[a])}});var i=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=f.get(arguments[1])||null),i.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=e.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}});var c=function(a){var b=d.splitSections(a.sdp);return b.shift(),b.some(function(a){var b=d.parseMLine(a);return b&&"application"===b.kind&&b.protocol.indexOf("SCTP")!==-1})},f=function(a){var b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return-1;var c=parseInt(b[1],10);return c!==c?-1:c},g=function(a){var c=65536;return"firefox"===b.browser&&(c=b.version<57?a===-1?16384:2147483637:57===b.version?65535:65536),c},h=function(a,c){var e=65536;"firefox"===b.browser&&57===b.version&&(e=65535);var f=d.matchPrefix(a.sdp,"a=max-message-size:");return f.length>0?e=parseInt(f[0].substr(19),10):"firefox"===b.browser&&c!==-1&&(e=2147483637),e},i=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;if(a._sctp=null,c(arguments[0])){var b,d=f(arguments[0]),e=g(d),j=h(arguments[0],d);b=0===e&&0===j?Number.POSITIVE_INFINITY:0===e||0===j?Math.max(e,j):Math.min(e,j);var k={};Object.defineProperty(k,"maxMessageSize",{get:function(){return b}}),a._sctp=k}return i.apply(a,arguments)}}},shimSendThrowTypeError:function(a){if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var b=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,c=b.apply(a,arguments),d=c.send;return c.send=function(){var b=this,c=arguments[0],e=c.length||c.size||c.byteLength;if(e>a.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)","TypeError");return d.apply(b,arguments)},c}}}}},{"./utils":13,sdp:2}],8:[function(a,b,c){"use strict";var d=a("../utils"),e=a("rtcpeerconnection-shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){var c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){c.set.call(this,a);var b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender),a.RTCPeerConnection=e(a,b.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(a,b,c){"use strict";b.exports=function(a){var b=a&&a.navigator,c=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return d(a)["catch"](function(a){return Promise.reject(c(a))})}}},{}],10:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.transceiver={receiver:c.receiver},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}}),"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=d.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){
a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(b.version<38&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var i={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(i.username=g.username,i.credential=g.credential),e.push(i)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,d){return g.apply(this,[a||null]).then(function(a){if(b.version<48&&(a=e(a)),b.version<53&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(d){if("TypeError"!==d.name)throw d;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:f[b.type]||b.type}))})}return a}).then(c,d)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&a.getTracks().indexOf(c.track)!==-1&&b.removeTrack(c)})})}}},{"../utils":13,"./getusermedia":11}],11:[function(a,b,c){"use strict";var d=a("../utils"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=a&&a.MediaStreamTrack,g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,d,f){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),b.version<38&&(e("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,d,function(a){f(g(a))})},i=function(a){return new Promise(function(b,c){h(a,b,c)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},b.version<41){var j=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return j().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(b.version<49){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(g(a))})}}if(!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var l=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","mozAutoGainControl"),l(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},f&&f.prototype.getSettings){var n=f.prototype.getSettings;f.prototype.getSettings=function(){var a=n.apply(this,arguments);return l(a,"mozAutoGainControl","autoGainControl"),l(a,"mozNoiseSuppression","noiseSuppression"),a}}if(f&&f.prototype.applyConstraints){var o=f.prototype.applyConstraints;f.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),l(a,"autoGainControl","mozAutoGainControl"),l(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}c.getUserMedia=function(a,e,f){return b.version<44?h(a,e,f):(d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void c.mediaDevices.getUserMedia(a).then(e,f))}}},{"../utils":13}],12:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(a)===-1&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(a,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(b!==-1){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){d.indexOf(a.track)!==-1&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){var b=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(a){if(b._remoteStreams||(b._remoteStreams=[]),!(b._remoteStreams.indexOf(a)>=0)){b._remoteStreams.push(a);var c=new Event("addstream");c.stream=a,b.dispatchEvent(c)}})})}}))},shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){var c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};var h=function(a,b,c){var d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){var d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){var d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"==typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){var c=this;if(a){"undefined"!=typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var d=c.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});a.offerToReceiveAudio===!1&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):a.offerToReceiveAudio!==!0||d||c.addTransceiver("audio"),"undefined"!=typeof a.offerToReceiveAudio&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);var e=c.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});a.offerToReceiveVideo===!1&&e?"sendrecv"===e.direction?e.setDirection("sendonly"):"recvonly"===e.direction&&e.setDirection("inactive"):a.offerToReceiveVideo!==!0||e||c.addTransceiver("video")}return b.apply(c,arguments)}}}},{"../utils":13}],13:[function(a,b,c){"use strict";function d(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}function e(a,b,c){if(a.RTCPeerConnection){var d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);var f=function(a){d(c(a))};return this._eventMap=this._eventMap||{},this._eventMap[d]=f,e.apply(this,[a,f])};var f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return f.apply(this,arguments);var d=this._eventMap[c];return delete this._eventMap[c],f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)}})}}var f=!0,g=!0;b.exports={extractVersion:d,wrapPeerConnectionEvent:e,disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(f=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(g=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(a,b){g&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,c={};if(c.browser=null,c.version=null,"undefined"==typeof a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=d(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)c.browser="chrome",c.version=d(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser="edge",c.version=d(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!a.RTCPeerConnection||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=d(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c}}},{}]},{},[3])(3)});
define('core/modal_save_cancel', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events"],function(a,b,c,d,e){var f={SAVE_BUTTON:'[data-action="save"]',CANCEL_BUTTON:'[data-action="cancel"]'},g=function(a){d.call(this,a),this.getFooter().find(f.SAVE_BUTTON).length||b.exception({message:"No save button found"}),this.getFooter().find(f.CANCEL_BUTTON).length||b.exception({message:"No cancel button found"})};return g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.setFooter=function(){b.exception({message:"Can not change the footer of a save cancel modal"})},g.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,f.SAVE_BUTTON,function(b,c){var d=a.Event(e.save);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,f.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g.prototype.setSaveButtonText=function(a){var b=this.getFooter().find(f.SAVE_BUTTON);this.asyncSet(a,b.text.bind(b))},g});
define('core/icon_system_standard', ["core/icon_system","core/url","core/mustache"],function(a,b,c){var d=function(){a.apply(this,arguments)};return d.prototype=Object.create(a.prototype),d.prototype.renderIcon=function(a,d,e,f){var g=b.imageUrl(a,d),h={attributes:[{name:"src",value:g},{name:"alt",value:e},{name:"title",value:e}]},i=c.render(f,h);return i.trim()},d.prototype.getTemplateName=function(){return"core/pix_icon"},d});
define('core/popover_region_controller', ["jquery","core/str","core/custom_interaction_events"],function(a,b,c){var d={CONTENT:".popover-region-content",CONTENT_CONTAINER:".popover-region-content-container",MENU_CONTAINER:".popover-region-container",MENU_TOGGLE:".popover-region-toggle",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},e=function(b){this.root=a(b),this.content=this.root.find(d.CONTENT),this.contentContainer=this.root.find(d.CONTENT_CONTAINER),this.menuContainer=this.root.find(d.MENU_CONTAINER),this.menuToggle=this.root.find(d.MENU_TOGGLE),this.isLoading=!1,this.promises={closeHandlers:a.Deferred(),navigationHandlers:a.Deferred()},this.registerBaseEventListeners()};return e.prototype.events=function(){return{menuOpened:"popoverregion:menuopened",menuClosed:"popoverregion:menuclosed",startLoading:"popoverregion:startLoading",stopLoading:"popoverregion:stopLoading"}},e.prototype.getContentContainer=function(){return this.contentContainer},e.prototype.getContent=function(){return this.content},e.prototype.isMenuOpen=function(){return!this.root.hasClass("collapsed")},e.prototype.toggleMenu=function(){this.isMenuOpen()?this.closeMenu():this.openMenu()},e.prototype.closeMenu=function(){this.isMenuOpen()&&(this.root.addClass("collapsed"),this.menuContainer.attr("aria-expanded","false"),this.menuContainer.attr("aria-hidden","true"),this.updateButtonAriaLabel(),this.root.trigger(this.events().menuClosed))},e.prototype.openMenu=function(){this.isMenuOpen()||(this.root.removeClass("collapsed"),this.menuContainer.attr("aria-expanded","true"),this.menuContainer.attr("aria-hidden","false"),this.updateButtonAriaLabel(),this.promises.closeHandlers.resolve(),this.promises.navigationHandlers.resolve(),this.root.trigger(this.events().menuOpened))},e.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?b.get_string("hidepopoverwindow").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):b.get_string("showpopoverwindow").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this))},e.prototype.startLoading=function(){this.isLoading=!0,this.getContentContainer().addClass("loading"),this.getContentContainer().attr("aria-busy","true"),this.root.trigger(this.events().startLoading)},e.prototype.stopLoading=function(){this.isLoading=!1,this.getContentContainer().removeClass("loading"),this.getContentContainer().attr("aria-busy","false"),this.root.trigger(this.events().stopLoading)},e.prototype.focusMenuToggle=function(){this.menuToggle.focus()},e.prototype.contentItemHasFocus=function(){return this.getContentItemWithFocus().length>0},e.prototype.getContentItemWithFocus=function(){var b=a(document.activeElement),c=this.getContent().children(),d=c.filter(b);return d.length||(d=c.has(b)),d},e.prototype.focusContentItem=function(a){a.is(d.CAN_RECEIVE_FOCUS)?a.focus():a.find(d.CAN_RECEIVE_FOCUS).first().focus()},e.prototype.focusFirstContentItem=function(){this.focusContentItem(this.getContent().children().first())},e.prototype.focusLastContentItem=function(){this.focusContentItem(this.getContent().children().last())},e.prototype.focusNextContentItem=function(){var a=this.getContentItemWithFocus();a.length&&a.next()&&this.focusContentItem(a.next())},e.prototype.focusPreviousContentItem=function(){var a=this.getContentItemWithFocus();a.length&&a.prev()&&this.focusContentItem(a.prev())},e.prototype.registerBaseEventListeners=function(){c.define(this.root,[c.events.activate,c.events.escape]),this.root.on(c.events.activate,d.MENU_TOGGLE,function(){this.toggleMenu()}.bind(this)),this.promises.closeHandlers.done(function(){this.root.on(c.events.escape,function(){this.closeMenu(),this.focusMenuToggle()}.bind(this)),a("html").click(function(b){var c=a(b.target);this.root.is(c)||this.root.has(c).length||this.closeMenu()}.bind(this)),c.define(this.getContentContainer(),[c.events.scrollBottom])}.bind(this))},e.prototype.registerListNavigationEventListeners=function(){c.define(this.root,[c.events.down]),this.root.on(c.events.down,function(a,b){this.isMenuOpen()?this.contentItemHasFocus()?this.focusNextContentItem():this.focusFirstContentItem():(this.openMenu(),this.focusFirstContentItem()),b.originalEvent.preventDefault()}.bind(this)),this.promises.navigationHandlers.done(function(){c.define(this.root,[c.events.up,c.events.home,c.events.end]),this.root.on(c.events.up,function(a,b){this.focusPreviousContentItem(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(c.events.home,function(a,b){this.focusFirstContentItem(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(c.events.end,function(a,b){this.focusLastContentItem(),b.originalEvent.preventDefault()}.bind(this))}.bind(this))},e});
define('core/icon_system', ["jquery"],function(a){var b=function(){};return b.prototype.init=function(){return a.when(this)},b.prototype.renderIcon=function(a,b,c,d){throw new Error("Abstract function not implemented.")},b.prototype.getTemplateName=function(){throw new Error("Abstract function not implemented.")},b});
define('core/paged_content_factory', ["jquery","core/templates","core/notification","core/paged_content_pages"],function(a,b,c,d){var e={PAGED_CONTENT:"core/paged_content"},f=function(a,b){for(var c={itemsperpage:b,previous:{},next:{},pages:[]},d=1;d<=a;d++){var e={number:d,page:""+d};1===d&&(e.active=!0),c.pages.push(e)}return c},g=function(a,b,c){var d={options:[]},e=0,f=0,g=a;c.hasOwnProperty("maxPages")&&(g=c.maxPages);for(var h=1;h<=g;h++){var i=0;h<=2?(i=b,f=b):(f=2*f,i=f),e+=i;var j={itemcount:i,content:e};1===h&&(j.active=!0),d.options.push(j)}return d},h=function(a,b,c){var d={pagingbar:!1,pagingdropdown:!1,skipjs:!0};return c.hasOwnProperty("dropdown")&&c.dropdown?d.pagingdropdown=g(a,b,c):d.pagingbar=f(a,b),d},i=function(a,b){var c=1;if(a>0){var d=a%b;d?(a-=d,c=a/b+1):c=a/b}return c},j=function(f,g,j,k){"undefined"==typeof k&&(k={});var l=a.Deferred(),m=i(f,g),n=h(m,g,k);return b.render(e.PAGED_CONTENT,n).then(function(b,c){b=a(b);var e=b,f=b.find(d.rootSelector);d.init(f,e,j),l.resolve(b,c)}).fail(function(a){l.reject(a)}).fail(c.exception),l},k=function(a,b,c,d){"undefined"==typeof d&&(d={});var e=a.length;return j(e,b,function(b){var d=[];return b.forEach(function(b){var c=b.offset,f=b.limit?c+b.limit:e,g=a.slice(c,f);d.push(g)}),c(d)},d)};return{createFromAjax:j,createFromStaticList:k}});
define('core/paged_content_pages', ["jquery","core/templates","core/notification","core/paged_content_events"],function(a,b,c,d){var e={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},f={PAGING_CONTENT_ITEM:"core/paged_content_page",LOADING:"core/overlay_loading"},g=function(a,b){return a.find('[data-page="'+b+'"]')},h=function(d){var e=a.Deferred();return b.render(f.LOADING,{visible:!0}).then(function(b){var c=a(b),f=setTimeout(function(){d.css("position","relative"),c.appendTo(d)},100);e.always(function(){clearTimeout(f),c.remove(),d.css("position","")})}).fail(c.exception),e},i=function(d,e,h){var i=a.Deferred();return e.then(function(a,e){b.render(f.PAGING_CONTENT_ITEM,{page:h,content:a}).then(function(a){b.appendNodeContents(d,a,e);var c=g(d,h);i.resolve(c)}).fail(function(a){i.reject(a)}).fail(c.exception)}).fail(function(a){i.reject(a)}).fail(c.exception),i},j=function(b,d,f){var j=[],k=[],l=a.Deferred();if(d.forEach(function(a){var c=a.pageNumber,d=g(b,c);d.length?j.push(d):k.push(a)}),k.length&&"function"==typeof f){var m=f(k),n=m.map(function(a,c){return i(b,a,k[c].pageNumber)});a.when.apply(a,n).then(function(){var a=Array.prototype.slice.call(arguments);l.resolve(a)}).fail(function(a){l.reject(a)}).fail(c.exception)}else l.resolve([]);var o=h(b);l.then(function(a){var c=j.concat(a);b.find(e.PAGE_REGION).addClass("hidden"),c.forEach(function(a){a.removeClass("hidden")})}).fail(c.exception).always(function(){o.resolve()})},k=function(b,c,e){b=a(b),c=a(c),c.on(d.SHOW_PAGES,function(a,c){j(b,c,e)})};return{init:k,rootSelector:e.ROOT}});
define('core/paged_content_paging_bar', ["jquery","core/custom_interaction_events","core/paged_content_events"],function(a,b,c){var d={ROOT:'[data-region="paging-bar"]',PAGE:"[data-page]",PAGE_ITEM:'[data-region="page-item"]',ACTIVE_PAGE_ITEM:'[data-region="page-item"].active'},e=function(a,b){return a.find(d.PAGE_ITEM+'[data-page-number="'+b+'"]')},f=function(a){var b=a.find(d.PAGE).last();return b?parseInt(b.attr("data-page-number"),10):null},g=function(a){var b=a.find(d.ACTIVE_PAGE_ITEM);return b.length?h(a,b):null},h=function(a,b){if(void 0!=b.attr("data-page"))return parseInt(b.attr("data-page-number"),10);var c=1,d=null;switch(b.attr("data-control")){case"first":c=1;break;case"last":c=f(a);break;case"next":d=g(a);var e=f(a);c=d&&d<e?d+1:e;break;case"previous":d=g(a),c=d&&d>1?d-1:1;break;default:c=1}return parseInt(c,10)},i=function(a){return parseInt(a.attr("data-items-per-page"),10)},j=function(b){b.each(function(b,c){c=a(c),c.attr("data-page-number",b+1)})},k=function(a,b){var f=b==g(a),h=i(a),j=(b-1)*h;if(!f){a.find(d.PAGE_ITEM).removeClass("active");var k=e(a,b);k.addClass("active")}a.trigger(c.SHOW_PAGES,[[{pageNumber:b,limit:h,offset:j}]])},l=function(c){c=a(c);var e=c.find(d.PAGE);j(e);var f=g(c);f&&k(c,f),b.define(c,[b.events.activate]),c.on(b.events.activate,d.PAGE_ITEM,function(b,e){var f=a(b.target).closest(d.PAGE_ITEM),g=h(c,f);k(c,g),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()})};return{init:l,rootSelector:d.ROOT}});
define('core/paged_content_paging_dropdown', ["jquery","core/custom_interaction_events","core/paged_content_events"],function(a,b,c){var d={ROOT:'[data-region="paging-dropdown-container"]',DROPDOWN_ITEM:'[data-region="dropdown-item"]',DROPDOWN_TOGGLE:'[data-region="dropdown-toggle"]',ACTIVE_DROPDOWN_ITEM:'[data-region="dropdown-item"].active',CARET:'[data-region="caret"]'},e=function(a){return parseInt(a.attr("data-page-number"),10)},f=function(a){return a.find(d.DROPDOWN_ITEM)},g=function(b,c){var d=e(c);return f(b).filter(function(b,c){return e(a(c))<d})},h=function(a){return parseInt(a.attr("data-item-count"),10)},i=function(b,c){if(void 0!=c.attr("data-offset"))return parseInt(c.attr("data-offset"),10);var d=0;return g(b,c).each(function(b,c){c=a(c),d+=h(c)}),c.attr("data-offset",d),d},j=function(a){return a.find(d.ACTIVE_DROPDOWN_ITEM)},k=function(b,c){return c.map(function(c,d){return d=a(d),{pageNumber:e(d),limit:h(d),offset:i(b,d)}}).get()},l=function(b){b.each(function(b,c){c=a(c),c.attr("data-page-number",b+1)})},m=function(a,b){var e=g(a,b),f=e.add(b),h=k(a,f),i=a.find(d.DROPDOWN_TOGGLE),l=i.find(d.CARET);j(a).removeClass("active"),b.addClass("active"),i.html(b.text()),i.append(l),a.trigger(c.SHOW_PAGES,[h])},n=function(c){c=a(c);var e=f(c);l(e);var g=j(c);g.length&&m(c,g),b.define(c,[b.events.activate]),c.on(b.events.activate,d.DROPDOWN_ITEM,function(b,e){var f=a(b.target).closest(d.DROPDOWN_ITEM);m(c,f),e.originalEvent.preventDefault()})};return{init:n,rootSelector:d.ROOT}});
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define('core/popper', b):a.Popper=b()}(this,function(){"use strict";function a(a){var b=!1;return function(){b||(b=!0,Promise.resolve().then(function(){b=!1,a()}))}}function b(a){var b=!1;return function(){b||(b=!0,setTimeout(function(){b=!1,a()},ha))}}function c(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function d(a,b){if(1!==a.nodeType)return[];var c=window.getComputedStyle(a,null);return b?c[b]:c}function e(a){return"HTML"===a.nodeName?a:a.parentNode||a.host}function f(a){if(!a)return window.document.body;switch(a.nodeName){case"HTML":case"BODY":return a.ownerDocument.body;case"#document":return a.body}var b=d(a),c=b.overflow,g=b.overflowX,h=b.overflowY;return/(auto|scroll)/.test(c+h+g)?a:f(e(a))}function g(a){var b=a&&a.offsetParent,c=b&&b.nodeName;return c&&"BODY"!==c&&"HTML"!==c?["TD","TABLE"].indexOf(b.nodeName)!==-1&&"static"===d(b,"position")?g(b):b:a?a.ownerDocument.documentElement:window.document.documentElement}function h(a){var b=a.nodeName;return"BODY"!==b&&("HTML"===b||g(a.firstElementChild)===a)}function i(a){return null!==a.parentNode?i(a.parentNode):a}function j(a,b){if(!(a&&a.nodeType&&b&&b.nodeType))return window.document.documentElement;var c=a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING,d=c?a:b,e=c?b:a,f=document.createRange();f.setStart(d,0),f.setEnd(e,0);var k=f.commonAncestorContainer;if(a!==k&&b!==k||d.contains(e))return h(k)?k:g(k);var l=i(a);return l.host?j(l.host,b):j(a,i(b).host)}function k(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",c="top"===b?"scrollTop":"scrollLeft",d=a.nodeName;if("BODY"===d||"HTML"===d){var e=a.ownerDocument.documentElement,f=a.ownerDocument.scrollingElement||e;return f[c]}return a[c]}function l(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=k(b,"top"),e=k(b,"left"),f=c?-1:1;return a.top+=d*f,a.bottom+=d*f,a.left+=e*f,a.right+=e*f,a}function m(a,b){var c="x"===b?"Left":"Top",d="Left"===c?"Right":"Bottom";return+a["border"+c+"Width"].split("px")[0]+ +a["border"+d+"Width"].split("px")[0]}function n(a,b,c,d){return Math.max(b["offset"+a],b["scroll"+a],c["client"+a],c["offset"+a],c["scroll"+a],ma()?c["offset"+a]+d["margin"+("Height"===a?"Top":"Left")]+d["margin"+("Height"===a?"Bottom":"Right")]:0)}function o(){var a=window.document.body,b=window.document.documentElement,c=ma()&&window.getComputedStyle(b);return{height:n("Height",a,b,c),width:n("Width",a,b,c)}}function p(a){return qa({},a,{right:a.left+a.width,bottom:a.top+a.height})}function q(a){var b={};if(ma())try{b=a.getBoundingClientRect();var c=k(a,"top"),e=k(a,"left");b.top+=c,b.left+=e,b.bottom+=c,b.right+=e}catch(f){}else b=a.getBoundingClientRect();var g={left:b.left,top:b.top,width:b.right-b.left,height:b.bottom-b.top},h="HTML"===a.nodeName?o():{},i=h.width||a.clientWidth||g.right-g.left,j=h.height||a.clientHeight||g.bottom-g.top,l=a.offsetWidth-i,n=a.offsetHeight-j;if(l||n){var q=d(a);l-=m(q,"x"),n-=m(q,"y"),g.width-=l,g.height-=n}return p(g)}function r(a,b){var c=ma(),e="HTML"===b.nodeName,g=q(a),h=q(b),i=f(a),j=d(b),k=+j.borderTopWidth.split("px")[0],m=+j.borderLeftWidth.split("px")[0],n=p({top:g.top-h.top-k,left:g.left-h.left-m,width:g.width,height:g.height});if(n.marginTop=0,n.marginLeft=0,!c&&e){var o=+j.marginTop.split("px")[0],r=+j.marginLeft.split("px")[0];n.top-=k-o,n.bottom-=k-o,n.left-=m-r,n.right-=m-r,n.marginTop=o,n.marginLeft=r}return(c?b.contains(i):b===i&&"BODY"!==i.nodeName)&&(n=l(n,b)),n}function s(a){var b=a.ownerDocument.documentElement,c=r(a,b),d=Math.max(b.clientWidth,window.innerWidth||0),e=Math.max(b.clientHeight,window.innerHeight||0),f=k(b),g=k(b,"left"),h={top:f-c.top+c.marginTop,left:g-c.left+c.marginLeft,width:d,height:e};return p(h)}function t(a){var b=a.nodeName;return"BODY"!==b&&"HTML"!==b&&("fixed"===d(a,"position")||t(e(a)))}function u(a,b,c,d){var g={top:0,left:0},h=j(a,b);if("viewport"===d)g=s(h);else{var i=void 0;"scrollParent"===d?(i=f(e(a)),"BODY"===i.nodeName&&(i=a.ownerDocument.documentElement)):i="window"===d?a.ownerDocument.documentElement:d;var k=r(i,h);if("HTML"!==i.nodeName||t(h))g=k;else{var l=o(),m=l.height,n=l.width;g.top+=k.top-k.marginTop,g.bottom=m+k.top,g.left+=k.left-k.marginLeft,g.right=n+k.left}}return g.left+=c,g.top+=c,g.right-=c,g.bottom-=c,g}function v(a){var b=a.width,c=a.height;return b*c}function w(a,b,c,d,e){var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(a.indexOf("auto")===-1)return a;var g=u(c,d,f,e),h={top:{width:g.width,height:b.top-g.top},right:{width:g.right-b.right,height:g.height},bottom:{width:g.width,height:g.bottom-b.bottom},left:{width:b.left-g.left,height:g.height}},i=Object.keys(h).map(function(a){return qa({key:a},h[a],{area:v(h[a])})}).sort(function(a,b){return b.area-a.area}),j=i.filter(function(a){var b=a.width,d=a.height;return b>=c.clientWidth&&d>=c.clientHeight}),k=j.length>0?j[0].key:i[0].key,l=a.split("-")[1];return k+(l?"-"+l:"")}function x(a,b,c){var d=j(b,c);return r(c,d)}function y(a){var b=window.getComputedStyle(a),c=parseFloat(b.marginTop)+parseFloat(b.marginBottom),d=parseFloat(b.marginLeft)+parseFloat(b.marginRight),e={width:a.offsetWidth+d,height:a.offsetHeight+c};return e}function z(a){var b={left:"right",right:"left",bottom:"top",top:"bottom"};return a.replace(/left|right|bottom|top/g,function(a){return b[a]})}function A(a,b,c){c=c.split("-")[0];var d=y(a),e={width:d.width,height:d.height},f=["right","left"].indexOf(c)!==-1,g=f?"top":"left",h=f?"left":"top",i=f?"height":"width",j=f?"width":"height";return e[g]=b[g]+b[i]/2-d[i]/2,c===h?e[h]=b[h]-d[j]:e[h]=b[z(h)],e}function B(a,b){return Array.prototype.find?a.find(b):a.filter(b)[0]}function C(a,b,c){if(Array.prototype.findIndex)return a.findIndex(function(a){return a[b]===c});var d=B(a,function(a){return a[b]===c});return a.indexOf(d)}function D(a,b,d){var e=void 0===d?a:a.slice(0,C(a,"name",d));return e.forEach(function(a){a["function"]&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var d=a["function"]||a.fn;a.enabled&&c(d)&&(b.offsets.popper=p(b.offsets.popper),b.offsets.reference=p(b.offsets.reference),b=d(b,a))}),b}function E(){if(!this.state.isDestroyed){var a={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};a.offsets.reference=x(this.state,this.popper,this.reference),a.placement=w(this.options.placement,a.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),a.originalPlacement=a.placement,a.offsets.popper=A(this.popper,a.offsets.reference,a.placement),a.offsets.popper.position="absolute",a=D(this.modifiers,a),this.state.isCreated?this.options.onUpdate(a):(this.state.isCreated=!0,this.options.onCreate(a))}}function F(a,b){return a.some(function(a){var c=a.name,d=a.enabled;return d&&c===b})}function G(a){for(var b=[!1,"ms","Webkit","Moz","O"],c=a.charAt(0).toUpperCase()+a.slice(1),d=0;d<b.length-1;d++){var e=b[d],f=e?""+e+c:a;if("undefined"!=typeof window.document.body.style[f])return f}return null}function H(){return this.state.isDestroyed=!0,F(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.left="",this.popper.style.position="",this.popper.style.top="",this.popper.style[G("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function I(a){var b=a.ownerDocument;return b?b.defaultView:window}function J(a,b,c,d){var e="BODY"===a.nodeName,g=e?a.ownerDocument.defaultView:a;g.addEventListener(b,c,{passive:!0}),e||J(f(g.parentNode),b,c,d),d.push(g)}function K(a,b,c,d){c.updateBound=d,I(a).addEventListener("resize",c.updateBound,{passive:!0});var e=f(a);return J(e,"scroll",c.updateBound,c.scrollParents),c.scrollElement=e,c.eventsEnabled=!0,c}function L(){this.state.eventsEnabled||(this.state=K(this.reference,this.options,this.state,this.scheduleUpdate))}function M(a,b){return I(a).removeEventListener("resize",b.updateBound),b.scrollParents.forEach(function(a){a.removeEventListener("scroll",b.updateBound)}),b.updateBound=null,b.scrollParents=[],b.scrollElement=null,b.eventsEnabled=!1,b}function N(){this.state.eventsEnabled&&(window.cancelAnimationFrame(this.scheduleUpdate),this.state=M(this.reference,this.state))}function O(a){return""!==a&&!isNaN(parseFloat(a))&&isFinite(a)}function P(a,b){Object.keys(b).forEach(function(c){var d="";["width","height","top","right","bottom","left"].indexOf(c)!==-1&&O(b[c])&&(d="px"),a.style[c]=b[c]+d})}function Q(a,b){Object.keys(b).forEach(function(c){var d=b[c];d!==!1?a.setAttribute(c,b[c]):a.removeAttribute(c)})}function R(a){return P(a.instance.popper,a.styles),Q(a.instance.popper,a.attributes),a.arrowElement&&Object.keys(a.arrowStyles).length&&P(a.arrowElement,a.arrowStyles),a}function S(a,b,c,d,e){var f=x(e,b,a),g=w(c.placement,f,b,a,c.modifiers.flip.boundariesElement,c.modifiers.flip.padding);return b.setAttribute("x-placement",g),P(b,{position:"absolute"}),c}function T(a,b){var c=b.x,d=b.y,e=a.offsets.popper,f=B(a.instance.modifiers,function(a){return"applyStyle"===a.name}).gpuAcceleration;void 0!==f&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var h=void 0!==f?f:b.gpuAcceleration,i=g(a.instance.popper),j=q(i),k={position:e.position},l={left:Math.floor(e.left),top:Math.floor(e.top),bottom:Math.floor(e.bottom),right:Math.floor(e.right)},m="bottom"===c?"top":"bottom",n="right"===d?"left":"right",o=G("transform"),p=void 0,r=void 0;if(r="bottom"===m?-j.height+l.bottom:l.top,p="right"===n?-j.width+l.right:l.left,h&&o)k[o]="translate3d("+p+"px, "+r+"px, 0)",k[m]=0,k[n]=0,k.willChange="transform";else{var s="bottom"===m?-1:1,t="right"===n?-1:1;k[m]=r*s,k[n]=p*t,k.willChange=m+", "+n}var u={"x-placement":a.placement};return a.attributes=qa({},u,a.attributes),a.styles=qa({},k,a.styles),a.arrowStyles=qa({},a.offsets.arrow,a.arrowStyles),a}function U(a,b,c){var d=B(a,function(a){var c=a.name;return c===b}),e=!!d&&a.some(function(a){return a.name===c&&a.enabled&&a.order<d.order});if(!e){var f="`"+b+"`",g="`"+c+"`";console.warn(g+" modifier is required by "+f+" modifier in order to work, be sure to include it before "+f+"!")}return e}function V(a,b){if(!U(a.instance.modifiers,"arrow","keepTogether"))return a;var c=b.element;if("string"==typeof c){if(c=a.instance.popper.querySelector(c),!c)return a}else if(!a.instance.popper.contains(c))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),a;var e=a.placement.split("-")[0],f=a.offsets,g=f.popper,h=f.reference,i=["left","right"].indexOf(e)!==-1,j=i?"height":"width",k=i?"Top":"Left",l=k.toLowerCase(),m=i?"left":"top",n=i?"bottom":"right",o=y(c)[j];h[n]-o<g[l]&&(a.offsets.popper[l]-=g[l]-(h[n]-o)),h[l]+o>g[n]&&(a.offsets.popper[l]+=h[l]+o-g[n]);var q=h[l]+h[j]/2-o/2,r=d(a.instance.popper,"margin"+k).replace("px",""),s=q-p(a.offsets.popper)[l]-r;return s=Math.max(Math.min(g[j]-o,s),0),a.arrowElement=c,a.offsets.arrow={},a.offsets.arrow[l]=Math.round(s),a.offsets.arrow[m]="",a}function W(a){return"end"===a?"start":"start"===a?"end":a}function X(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=sa.indexOf(a),d=sa.slice(c+1).concat(sa.slice(0,c));return b?d.reverse():d}function Y(a,b){if(F(a.instance.modifiers,"inner"))return a;if(a.flipped&&a.placement===a.originalPlacement)return a;var c=u(a.instance.popper,a.instance.reference,b.padding,b.boundariesElement),d=a.placement.split("-")[0],e=z(d),f=a.placement.split("-")[1]||"",g=[];switch(b.behavior){case ta.FLIP:g=[d,e];break;case ta.CLOCKWISE:g=X(d);break;case ta.COUNTERCLOCKWISE:g=X(d,!0);break;default:g=b.behavior}return g.forEach(function(h,i){if(d!==h||g.length===i+1)return a;d=a.placement.split("-")[0],e=z(d);var j=a.offsets.popper,k=a.offsets.reference,l=Math.floor,m="left"===d&&l(j.right)>l(k.left)||"right"===d&&l(j.left)<l(k.right)||"top"===d&&l(j.bottom)>l(k.top)||"bottom"===d&&l(j.top)<l(k.bottom),n=l(j.left)<l(c.left),o=l(j.right)>l(c.right),p=l(j.top)<l(c.top),q=l(j.bottom)>l(c.bottom),r="left"===d&&n||"right"===d&&o||"top"===d&&p||"bottom"===d&&q,s=["top","bottom"].indexOf(d)!==-1,t=!!b.flipVariations&&(s&&"start"===f&&n||s&&"end"===f&&o||!s&&"start"===f&&p||!s&&"end"===f&&q);(m||r||t)&&(a.flipped=!0,(m||r)&&(d=g[i+1]),t&&(f=W(f)),a.placement=d+(f?"-"+f:""),a.offsets.popper=qa({},a.offsets.popper,A(a.instance.popper,a.offsets.reference,a.placement)),a=D(a.instance.modifiers,a,"flip"))}),a}function Z(a){var b=a.offsets,c=b.popper,d=b.reference,e=a.placement.split("-")[0],f=Math.floor,g=["top","bottom"].indexOf(e)!==-1,h=g?"right":"bottom",i=g?"left":"top",j=g?"width":"height";return c[h]<f(d[i])&&(a.offsets.popper[i]=f(d[i])-c[j]),c[i]>f(d[h])&&(a.offsets.popper[i]=f(d[h])),a}function $(a,b,c,d){var e=a.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),f=+e[1],g=e[2];if(!f)return a;if(0===g.indexOf("%")){var h=void 0;switch(g){case"%p":h=c;break;case"%":case"%r":default:h=d}var i=p(h);return i[b]/100*f}if("vh"===g||"vw"===g){var j=void 0;return j="vh"===g?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),j/100*f}return f}function _(a,b,c,d){var e=[0,0],f=["right","left"].indexOf(d)!==-1,g=a.split(/(\+|\-)/).map(function(a){return a.trim()}),h=g.indexOf(B(g,function(a){return a.search(/,|\s/)!==-1}));g[h]&&g[h].indexOf(",")===-1&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var i=/\s*,\s*|\s+/,j=h!==-1?[g.slice(0,h).concat([g[h].split(i)[0]]),[g[h].split(i)[1]].concat(g.slice(h+1))]:[g];return j=j.map(function(a,d){var e=(1===d?!f:f)?"height":"width",g=!1;return a.reduce(function(a,b){return""===a[a.length-1]&&["+","-"].indexOf(b)!==-1?(a[a.length-1]=b,g=!0,a):g?(a[a.length-1]+=b,g=!1,a):a.concat(b)},[]).map(function(a){return $(a,e,b,c)})}),j.forEach(function(a,b){a.forEach(function(c,d){O(c)&&(e[b]+=c*("-"===a[d-1]?-1:1))})}),e}function aa(a,b){var c=b.offset,d=a.placement,e=a.offsets,f=e.popper,g=e.reference,h=d.split("-")[0],i=void 0;return i=O(+c)?[+c,0]:_(c,f,g,h),"left"===h?(f.top+=i[0],f.left-=i[1]):"right"===h?(f.top+=i[0],f.left+=i[1]):"top"===h?(f.left+=i[0],f.top-=i[1]):"bottom"===h&&(f.left+=i[0],f.top+=i[1]),a.popper=f,a}function ba(a,b){var c=b.boundariesElement||g(a.instance.popper);a.instance.reference===c&&(c=g(c));var d=u(a.instance.popper,a.instance.reference,b.padding,c);b.boundaries=d;var e=b.priority,f=a.offsets.popper,h={primary:function(a){var c=f[a];return f[a]<d[a]&&!b.escapeWithReference&&(c=Math.max(f[a],d[a])),pa({},a,c)},secondary:function(a){var c="right"===a?"left":"top",e=f[c];return f[a]>d[a]&&!b.escapeWithReference&&(e=Math.min(f[c],d[a]-("right"===a?f.width:f.height))),pa({},c,e)}};return e.forEach(function(a){var b=["left","top"].indexOf(a)!==-1?"primary":"secondary";f=qa({},f,h[b](a))}),a.offsets.popper=f,a}function ca(a){var b=a.placement,c=b.split("-")[0],d=b.split("-")[1];if(d){var e=a.offsets,f=e.reference,g=e.popper,h=["bottom","top"].indexOf(c)!==-1,i=h?"left":"top",j=h?"width":"height",k={start:pa({},i,f[i]),end:pa({},i,f[i]+f[j]-g[j])};a.offsets.popper=qa({},g,k[d])}return a}function da(a){if(!U(a.instance.modifiers,"hide","preventOverflow"))return a;var b=a.offsets.reference,c=B(a.instance.modifiers,function(a){return"preventOverflow"===a.name}).boundaries;if(b.bottom<c.top||b.left>c.right||b.top>c.bottom||b.right<c.left){if(a.hide===!0)return a;a.hide=!0,a.attributes["x-out-of-boundaries"]=""}else{if(a.hide===!1)return a;a.hide=!1,a.attributes["x-out-of-boundaries"]=!1}return a}function ea(a){var b=a.placement,c=b.split("-")[0],d=a.offsets,e=d.popper,f=d.reference,g=["left","right"].indexOf(c)!==-1,h=["top","left"].indexOf(c)===-1;return e[g?"left":"top"]=f[c]-(h?e[g?"width":"height"]:0),a.placement=z(b),a.offsets.popper=p(e),a}for(var fa="undefined"!=typeof window&&"undefined"!=typeof window.document,ga=["Edge","Trident","Firefox"],ha=0,ia=0;ia<ga.length;ia+=1)if(fa&&navigator.userAgent.indexOf(ga[ia])>=0){ha=1;break}var ja=fa&&window.Promise,ka=ja?a:b,la=void 0,ma=function(){return void 0===la&&(la=navigator.appVersion.indexOf("MSIE 10")!==-1),la},na=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},oa=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),pa=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},qa=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},ra=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],sa=ra.slice(3),ta={FLIP:"flip",CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise"},ua={shift:{order:100,enabled:!0,fn:ca},offset:{order:200,enabled:!0,fn:aa,offset:0},preventOverflow:{order:300,enabled:!0,fn:ba,priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:Z},arrow:{order:500,enabled:!0,fn:V,element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:Y,behavior:"flip",padding:5,boundariesElement:"viewport"},inner:{order:700,enabled:!1,fn:ea},hide:{order:800,enabled:!0,fn:da},computeStyle:{order:850,enabled:!0,fn:T,gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:R,onLoad:S,gpuAcceleration:void 0}},va={placement:"bottom",eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:ua},wa=function(){function a(b,d){var e=this,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};na(this,a),this.scheduleUpdate=function(){return requestAnimationFrame(e.update)},this.update=ka(this.update.bind(this)),this.options=qa({},a.Defaults,f),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=b&&b.jquery?b[0]:b,this.popper=d&&d.jquery?d[0]:d,this.options.modifiers={},Object.keys(qa({},a.Defaults.modifiers,f.modifiers)).forEach(function(b){e.options.modifiers[b]=qa({},a.Defaults.modifiers[b]||{},f.modifiers?f.modifiers[b]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(a){return qa({name:a},e.options.modifiers[a])}).sort(function(a,b){return a.order-b.order}),this.modifiers.forEach(function(a){a.enabled&&c(a.onLoad)&&a.onLoad(e.reference,e.popper,e.options,a,e.state)}),this.update();var g=this.options.eventsEnabled;g&&this.enableEventListeners(),this.state.eventsEnabled=g}return oa(a,[{key:"update",value:function(){return E.call(this)}},{key:"destroy",value:function(){return H.call(this)}},{key:"enableEventListeners",value:function(){return L.call(this)}},{key:"disableEventListeners",value:function(){return N.call(this)}}]),a}();return wa.Utils=("undefined"!=typeof window?window:global).PopperUtils,wa.placements=ra,wa.Defaults=va,wa});
define('core/pending', ["jquery"],function(a){var b=function(b){var c=a.Deferred();return b=b||{},M.util.js_pending(b),c.then(function(){return M.util.js_complete(b)})["catch"](),c};return b.prototype.constructor=b,b});
define('core_calendar/calendar', ["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={ROOT:"[data-region='calendar']",DAY:"[data-region='day']",NEW_EVENT_BUTTON:"[data-action='new-event-button']",DAY_CONTENT:"[data-region='day-content']",LOADING_ICON:".loading-icon",VIEW_DAY_LINK:"[data-action='view-day-link']",CALENDAR_MONTH_WRAPPER:".calendarwrapper",TODAY:".today"},q=function(b,c,f,g){var h=null,i=g.attr("data-day-timestamp");f&&(h=f.attr("data-day-timestamp")),f&&h==i||d.render("core/loading",{}).then(function(a,b){g.find(p.DAY_CONTENT).addClass("hidden"),d.appendNodeContents(g,a,b),f&&(f.find(p.DAY_CONTENT).addClass("hidden"),d.appendNodeContents(f,a,b))}).then(function(){return k.updateEventStartDay(c,i)}).then(function(){a("body").trigger(l.eventMoved,[c,f,g])}).always(function(){var a=g.find(p.LOADING_ICON);if(g.find(p.DAY_CONTENT).removeClass("hidden"),d.replaceNode(a,"",""),f){var b=f.find(p.LOADING_ICON);f.find(p.DAY_CONTENT).removeClass("hidden"),d.replaceNode(b,"","")}}).fail(e.exception)},r=function(b,c){var d=a("body");d.on(l.created,function(){m.reloadCurrentMonth(b)}),d.on(l.deleted,function(){m.reloadCurrentMonth(b)}),d.on(l.updated,function(){m.reloadCurrentMonth(b)}),d.on(l.editActionEvent,function(a,b){window.location.assign(b)}),d.on(l.moveEvent,q),d.on(l.eventMoved,function(){m.reloadCurrentMonth(b)}),n.registerEditListeners(b,c)},s=function(b){b.on("change",o.elements.courseSelector,function(){var c=a(this),d=c.val();m.reloadCurrentMonth(b,d,null).then(function(){return b.find(o.elements.courseSelector).val(d)}).fail(e.exception)});var c=n.registerEventFormModal(b),d=a(p.CALENDAR_MONTH_WRAPPER).data("context-id");r(b,c),d&&b.on("click",p.DAY,function(b){var d=a(b.target);if(!d.is(p.VIEW_DAY_LINK)){var f=a(this).attr("data-new-event-timestamp");c.then(function(a){var b=d.closest(o.wrapper);a.setCourseId(b.data("courseid"));var c=b.data("categoryid");"undefined"!=typeof c&&a.setCategoryId(c),a.setContextId(b.data("contextId")),a.setStartTime(f),a.show()}).fail(e.exception),b.preventDefault()}})};return{init:function(b){b=a(b),m.init(b),s(b)}}});
define('core_calendar/calendar_filter', ["jquery","core_calendar/selectors","core_calendar/events","core/str","core/templates"],function(a,b,c,d,e){var f=function(d){d.on("click",b.eventFilterItem,function(b){var c=a(b.currentTarget);g(c),b.preventDefault()}),a("body").on(c.viewUpdated,function(){var c=d.find(b.eventFilterItem);c.each(function(b,c){if(c=a(c),c.data("eventtype-hidden")){var d=i(c);h(d)}})})},g=function(a){var b=i(a);return b.hidden=!b.hidden,d.get_string("eventtype"+b.eventtype,"calendar").then(function(a){return b.name=a,b}).then(function(a){return e.render("core_calendar/event_filter_key",a)}).then(function(b,c){return e.replaceNode(a,b,c)}).then(function(){h(b)})},h=function(b){M.util.js_pending("month-mini-filterChanged"),a("body").trigger(c.filterChanged,{type:b.eventtype,hidden:b.hidden}),M.util.js_complete("month-mini-filterChanged")},i=function(a){return{eventtype:a.data("eventtype"),hidden:a.data("eventtype-hidden")}};return{init:function(b){b=a(b),f(b)}}});
define('core_calendar/calendar_mini', ["jquery","core_calendar/selectors","core_calendar/events","core_calendar/view_manager"],function(a,b,c,d){var e=function(b){var d=a("body"),e="."+b.attr("id");d.on(c.created+e,b,f),d.on(c.deleted+e,b,f),d.on(c.updated+e,b,f),d.on(c.eventMoved+e,b,f)},f=function(b){var e=b.data,f=a("body"),g="."+e.attr("id");e.is(":visible")?d.reloadCurrentMonth(e):(f.off(c.created+g),f.off(c.deleted+g),f.off(c.updated+g),f.off(c.eventMoved+g))},g=function(e){a("body").on(c.filterChanged,function(a,c){var d=e.find(b.eventType[c.type]);d.toggleClass("calendar_event_"+c.type,!c.hidden)});var f="."+e.attr("id");a("body").on("change"+f,b.elements.courseSelector,function(){if(e.is(":visible")){var b=a(this),c=b.val(),g=null;d.reloadCurrentMonth(e,c,g)}else a("body").off("change"+f)})};return{init:function(b,c){b=a(b),d.init(b),g(b),e(b),c&&d.reloadCurrentMonth(b)}}});
define('core_calendar/calendar_threemonth', ["jquery","core/notification","core_calendar/selectors","core_calendar/events","core/templates","core_calendar/view_manager"],function(a,b,c,d,e,f){var g=function(e){var g=a("body");g.on(d.monthChanged,function(a,c,d,f,g){e.queue(function(e){return h(a,c,d,f,g).then(function(){return e()}).fail(b.exception)})});var h=function(b,d,g,h,i){var j=e.find('[data-year="'+d+'"][data-month="'+g+'"]'),k=j.closest(c.calendarPeriods.month),l=e.find(c.calendarPeriods.month),m=a(l[0]),n=a(l[2]),o=a("<span>");o.attr("data-template","core_calendar/threemonth_month"),o.attr("data-includenavigation",!1),o.attr("data-mini",!0);var p=a("<div>");p.hide(),p.append(o);var q,r,s;return k.is(m)?(p.insertBefore(m),q=m.data("previousYear"),r=m.data("previousMonth"),s=n):k.is(n)&&(p.insertAfter(n),q=n.data("nextYear"),r=n.data("nextMonth"),s=m),f.refreshMonthContent(o,q,r,h,i,o).then(function(){var b=a.Deferred(),c=a.Deferred();return s.slideUp("fast",function(){a(this).remove(),b.resolve()}),p.slideDown("fast",function(){c.resolve()}),a.when(b,c)})}};return{init:function(b){b=a(b),g(b)}}});
define('core_calendar/calendar_view', ["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/crud"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(b,g){var h=a("body");k.registerRemove(b);var i="reloadCurrent"+g.charAt(0).toUpperCase()+g.slice(1);h.on(e.created,function(){f[i](b)}),h.on(e.deleted,function(){f[i](b)}),h.on(e.updated,function(){f[i](b)}),b.on("change",d.courseSelector,function(){var e=a(this),g=e.val();f[i](b,g,null).then(function(){return b.find(d.courseSelector).val(g)}).then(function(){window.history.pushState({},"","?view=upcoming&course="+g)}).fail(c.exception)}),h.on(e.filterChanged,function(a,c){var e=b.find(d.eventType[c.type]);1==c.hidden?e.addClass("hidden"):e.removeClass("hidden")});var j=k.registerEventFormModal(b);k.registerEditListeners(b,j)};return{init:function(b,c){b=a(b),f.init(b,c),l(b,c)}}});
define('core_calendar/crud', ["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/modal_event_form","core_calendar/repository","core_calendar/events","core_calendar/modal_delete","core_calendar/selectors"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(d,e,f){var i=[{key:"deleteevent",component:"calendar"}];f=parseInt(f,10);var m,n=f>1;n?(i.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:e,count:f}}),m=g.create({type:l.TYPE})):(i.push({key:"confirmeventdelete",component:"calendar",param:e}),m=g.create({type:g.types.SAVE_CANCEL})),m.then(function(a){a.show()}).fail(c.exception);var o=b.get_strings(i),p=a.when(o,m).then(function(b,e){return e.setTitle(b[0]),e.setBody(b[1]),n||e.setSaveButtonText(b[0]),e.getRoot().on(h.save,function(){j.deleteEvent(d,!1).then(function(){a("body").trigger(k.deleted,[d,!1])})["catch"](c.exception)}),e.getRoot().on(k.deleteAll,function(){j.deleteEvent(d,!0).then(function(){a("body").trigger(k.deleted,[d,!0])})["catch"](c.exception)}),e}).fail(c.exception);return p}function o(b){b.on("click",m.actions.remove,function(b){var c=a(this).closest(m.eventItem),d=c.data("eventId"),e=c.data("eventTitle"),f=c.data("eventCount");n(d,e,f),b.preventDefault()})}function p(b,d){return d.then(function(c){a("body").on(k.editEvent,function(a,d){var e=b.find(m.wrapper);c.setEventId(d),c.setContextId(e.data("contextId")),c.show(),a.stopImmediatePropagation()})}).fail(c.exception),d}var q=function(b){var d=g.create({type:i.TYPE,large:!0});return b.on("click",m.actions.create,function(a){d.then(function(a){var c=b.find(m.wrapper),d=c.data("categoryid");"undefined"!=typeof d&&a.setCategoryId(d);var e=b.find(m.today),f=b.find(m.day);!e.length&&f.length&&a.setStartTime(f.data("newEventTimestamp")),a.setContextId(c.data("contextId")),a.setCourseId(c.data("courseid")),a.show()}).fail(c.exception),a.preventDefault()}),b.on("click",m.actions.edit,function(b){b.preventDefault();var e=a(b.currentTarget),f=e.closest(m.wrapper),g=e.closest(m.eventItem);d.then(function(a){a.setEventId(g.data("eventId")),a.setContextId(f.data("contextId")),a.show(),b.stopImmediatePropagation()}).fail(c.exception)}),d};return{registerRemove:o,registerEditListeners:p,registerEventFormModal:q}});
define('core_calendar/drag_drop_data_store', [],function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=function(b){a=b},h=function(){return a},i=function(){return null!==a},j=function(a){b=a},k=function(){return b},l=function(a){c=a},m=function(){return c},n=function(){return null!==c},o=function(a){d=a},p=function(){return d},q=function(){return null!==d},r=function(a){e=a},s=function(){return e},t=function(a){f=a},u=function(){return f},v=function(){g(null),j(null),l(null),o(null),r(null),t(null)};return{setEventId:g,getEventId:h,hasEventId:i,setDurationDays:j,getDurationDays:k,setMinTimestart:l,getMinTimestart:m,hasMinTimestart:n,setMaxTimestart:o,getMaxTimestart:p,hasMaxTimestart:q,setMinError:r,getMinError:s,setMaxError:t,getMaxError:u,clearAll:v}});
define('core_calendar/event_form', ["jquery","core_calendar/repository"],function(a,b){var c={EVENT_GROUP_COURSE_ID:'[name="groupcourseid"]',EVENT_GROUP_ID:'[name="groupid"]',SELECT_OPTION:"option"},d=function(d){var e=d.find(c.EVENT_GROUP_COURSE_ID),f=function(b){var e=d.find(c.EVENT_GROUP_ID),f=e.find(c.SELECT_OPTION),g=a(b);f.remove(),e.prop("disabled",!1),g.each(function(b,c){a(e).append(a("<option></option>").attr("value",c.id).text(c.name))})};e.on("change",function(){var a=d.find(c.EVENT_GROUP_COURSE_ID).val();b.getCourseGroupsData(a).then(function(a){return f(a)})["catch"](Notification.exception)})},e=function(b){var c=a("#"+b);d(c)};return{init:e}});
define('core_calendar/events', [],function(){return{created:"calendar-events:created",deleted:"calendar-events:deleted",deleteAll:"calendar-events:delete_all",updated:"calendar-events:updated",editEvent:"calendar-events:edit_event",editActionEvent:"calendar-events:edit_action_event",eventMoved:"calendar-events:event_moved",dayChanged:"calendar-events:day_changed",monthChanged:"calendar-events:month_changed",moveEvent:"calendar-events:move_event",filterChanged:"calendar-events:filter_changed",viewUpdated:"calendar-events:view_updated"}});
define('core_calendar/modal_delete', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_events","core/modal_registry","core_calendar/events"],function(a,b,c,d,e,f,g){var h=!1,i={DELETE_ONE_BUTTON:'[data-action="deleteone"]',DELETE_ALL_BUTTON:'[data-action="deleteall"]',CANCEL_BUTTON:'[data-action="cancel"]'},j=function(a){d.call(this,a)};return j.TYPE="core_calendar-modal_delete",j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,i.DELETE_ONE_BUTTON,function(b,c){var d=a.Event(e.save);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,i.DELETE_ALL_BUTTON,function(b,c){var d=a.Event(g.deleteAll);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,i.CANCEL_BUTTON,function(b,c){var d=a.Event(e.cancel);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},h||(f.register(j.TYPE,j,"calendar/event_delete_modal"),h=!0),j});
define('core_calendar/modal_event_form', ["jquery","core/event","core/str","core/notification","core/templates","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","core_calendar/events","core_calendar/repository"],function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={SAVE_BUTTON:'[data-action="save"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]'},n=function(a){g.call(this,a),this.eventId=null,this.startTime=null,this.courseId=null,this.categoryId=null,this.contextId=null,this.reloadingBody=!1,this.reloadingTitle=!1,this.saveButton=this.getFooter().find(m.SAVE_BUTTON)};return n.TYPE="core_calendar-modal_event_form",n.prototype=Object.create(g.prototype),n.prototype.constructor=n,n.prototype.setContextId=function(a){this.contextId=a},n.prototype.getContextId=function(){return this.contextId},n.prototype.setCourseId=function(a){this.courseId=a},n.prototype.getCourseId=function(){return this.courseId},n.prototype.setCategoryId=function(a){this.categoryId=a},n.prototype.getCategoryId=function(){return this.categoryId},n.prototype.hasCourseId=function(){return null!==this.courseId},n.prototype.hasCategoryId=function(){return null!==this.categoryId},n.prototype.setEventId=function(a){this.eventId=a},n.prototype.getEventId=function(){return this.eventId},n.prototype.hasEventId=function(){return null!==this.eventId},n.prototype.setStartTime=function(a){this.startTime=a},n.prototype.getStartTime=function(){return this.startTime},n.prototype.hasStartTime=function(){return null!==this.startTime},n.prototype.getForm=function(){return this.getBody().find("form")},n.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)},n.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)},n.prototype.reloadTitleContent=function(){return this.reloadingTitle?this.titlePromise:(this.reloadingTitle=!0,this.hasEventId()?this.titlePromise=c.get_string("editevent","calendar"):this.titlePromise=c.get_string("newevent","calendar"),this.titlePromise.then(function(a){return this.setTitle(a),a}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(d.exception),this.titlePromise)},n.prototype.reloadBodyContent=function(a){if(this.reloadingBody)return this.bodyPromise;this.reloadingBody=!0,this.disableButtons();var b={};return this.hasEventId()&&(b.eventid=this.getEventId()),this.hasStartTime()&&(b.starttime=this.getStartTime()),this.hasCourseId()&&(b.courseid=this.getCourseId()),this.hasCategoryId()&&(b.categoryid=this.getCategoryId()),"undefined"!=typeof a&&(b.formdata=a),this.bodyPromise=i.loadFragment("calendar","event_form",this.getContextId(),b),this.setBody(this.bodyPromise),this.bodyPromise.then(function(){this.enableButtons()}.bind(this)).fail(d.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(d.exception),this.bodyPromise},n.prototype.reloadAllContent=function(){return a.when(this.reloadTitleContent(),this.reloadBodyContent())},n.prototype.show=function(){this.reloadAllContent(),g.prototype.show.call(this)},n.prototype.hide=function(){g.prototype.hide.call(this),this.setEventId(null),this.setStartTime(null),this.setCourseId(null),this.setCategoryId(null)},n.prototype.getFormData=function(){return this.getForm().serialize()},n.prototype.save=function(){var b=this.saveButton.find(m.LOADING_ICON_CONTAINER);b.removeClass("hidden"),this.disableButtons();var c=this.getFormData();return k.submitCreateUpdateForm(c).then(function(b){if(b.validationerror)return void this.reloadBodyContent(c);var d=this.hasEventId();this.hide(),d?a("body").trigger(j.updated,[b.event]):a("body").trigger(j.created,[b.event])}.bind(this)).always(function(){b.addClass("hidden"),this.enableButtons()}.bind(this)).fail(d.exception)},n.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this),this.getModal().on(f.events.activate,m.SAVE_BUTTON,function(a,b){this.getForm().submit(),b.originalEvent.preventDefault(),a.stopPropagation()}.bind(this)),this.getModal().on("submit",function(a){this.save(),a.preventDefault(),a.stopPropagation()}.bind(this))},l||(h.register(n.TYPE,n,"calendar/modal_event_form"),l=!0),n});
define('core_calendar/month_navigation_drag_drop', ["jquery","core_calendar/drag_drop_data_store"],function(a,b){var c={DRAGGABLE:'[draggable="true"][data-region="event-item"]',DROP_ZONE:'[data-drop-zone="nav-link"]'},d="bg-primary text-white",e="drop-target",f=1e3,g=!1,h=null,i=null,j=function(a,b){b?a.addClass(d):a.removeClass(d)},k=function(){i.find(c.DROP_ZONE).addClass(e)},l=function(){i.find(c.DROP_ZONE).removeClass(e)},m=function(b){var d=a(b.target).closest(c.DROP_ZONE);return d.length?d:null},n=function(b){var d=a(b.target).closest(c.DRAGGABLE);d.length&&k()},o=function(a){if(b.hasEventId()){a.preventDefault();var c=m(a);c&&b.hasEventId()&&(h||(h=setTimeout(function(){c.click(),h=null},f)),j(c,!0),l())}},p=function(a){if(b.hasEventId()){var c=m(a);c&&(h&&(clearTimeout(h),h=null),j(c,!1),k(),a.preventDefault())}},q=function(a){if(b.hasEventId()){l();var c=m(a);c&&(j(c,!1),a.preventDefault())}};return{init:function(c){g||(document.addEventListener("dragstart",n,!1),document.addEventListener("dragover",o,!1),document.addEventListener("dragleave",p,!1),document.addEventListener("drop",q,!1),document.addEventListener("dragend",l,!1),g=!0),i=a(c),b.hasEventId()&&k()}}});
define('core_calendar/month_view_drag_drop', ["jquery","core/notification","core/str","core_calendar/events","core_calendar/drag_drop_data_store"],function(a,b,c,d,e){var f={ROOT:"[data-region='calendar']",DRAGGABLE:'[draggable="true"][data-region="event-item"]',DROP_ZONE:'[data-drop-zone="month-view-day"]',WEEK:'[data-region="month-view-week"]'},g="bg-faded",h="bg-danger text-white",i="bg-primary text-white",j=g+" "+h+" "+i,k=!1,l=function(b){var c=a(b.target).closest(f.DROP_ZONE);return c.length?c:null},m=function(a){var b=a.attr("data-day-timestamp"),c=e.getMinTimestart(),d=e.getMaxTimestart();return!(c&&c>b)&&!(d&&d<b)},n=function(a){var b=a.attr("data-day-timestamp"),c=e.getMinTimestart(),d=e.getMaxTimestart();return c&&c>b?e.getMinError():d&&d<b?e.getMaxError():null},o=function(){a(f.ROOT).find(f.DROP_ZONE).each(function(b,c){c=a(c),c.removeClass(j)})},p=function(a,b,c){"undefined"==typeof c&&(c=e.getDurationDays());var d=m(a);if(a.removeClass(j),b?d?a.addClass(i):a.addClass(h):(a.removeClass(i+" "+h),d||a.addClass(g)),c--,c>0){var k=a.next();if(!k.length){var l=a.closest(f.WEEK).next();l.length&&(k=l.children(f.DROP_ZONE).first())}k.length&&p(k,b,c)}},q=function(){a(f.ROOT).find(f.DROP_ZONE).each(function(b,c){c=a(c),m(c)||p(c,!1)})},r=function(b){var c=a(b.target),d=c.closest(f.DRAGGABLE);if(d.length){var g=d.find("[data-event-id]"),h=g.attr("data-event-id"),i=d.attr("data-min-day-timestamp"),j=d.attr("data-max-day-timestamp"),k=d.attr("data-min-day-error"),l=d.attr("data-max-day-error"),m=f.ROOT+' [data-event-id="'+h+'"]',n=a(m).length;e.setEventId(h),e.setDurationDays(n),i&&e.setMinTimestart(i),j&&e.setMaxTimestart(j),k&&e.setMinError(k),l&&e.setMaxError(l),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",b.dataTransfer.setData("text/plain",h),b.dropEffect="move",q()}},s=function(a){if(e.hasEventId()){a.preventDefault();var b=l(a);b&&p(b,!0)}},t=function(a){if(e.hasEventId()){var b=l(a);b&&(p(b,!1),a.preventDefault())}},u=function(g){if(e.hasEventId()){var h=l(g);if(!h)return e.clearAll(),void o();if(m(h)){var i=e.getEventId(),j=f.ROOT+' [data-event-id="'+i+'"]',k=a(j),p=null;k.length&&(p=k.closest(f.DROP_ZONE)),a("body").trigger(d.moveEvent,[i,p,h])}else{var q=n(h);c.get_string("errorinvaliddate","calendar").then(function(a){b.exception({name:a,message:q||a})})}e.clearAll(),o(),g.preventDefault()}},v=function(){e.clearAll(),o()},w=function(){q()};return{init:function(){k||(document.addEventListener("dragstart",r,!1),document.addEventListener("dragover",s,!1),document.addEventListener("dragleave",t,!1),document.addEventListener("drop",u,!1),document.addEventListener("dragend",v,!1),a("body").on(d.monthChanged,w),k=!0)}}});
define('core_calendar/repository', ["jquery","core/ajax"],function(a,b){var c=function(a,c){"undefined"==typeof c&&(c=!1);var d={methodname:"core_calendar_delete_calendar_events",args:{events:[{eventid:a,repeat:c}]}};return b.call([d])[0]},d=function(a){var c={methodname:"core_calendar_get_calendar_event_by_id",args:{eventid:a}};return b.call([c])[0]},e=function(a){var c={methodname:"core_calendar_submit_create_update_form",args:{formdata:a}};return b.call([c])[0]},f=function(a,c,d,e,f,g){var h={methodname:"core_calendar_get_calendar_monthly_view",args:{year:a,month:c,courseid:d,categoryid:e,includenavigation:f,mini:g}};return b.call([h])[0]},g=function(a,c,d,e,f){var g={methodname:"core_calendar_get_calendar_day_view",args:{year:a,month:c,day:d,courseid:e,categoryid:f}};return b.call([g])[0]},h=function(a,c){var d={methodname:"core_calendar_update_event_start_day",args:{eventid:a,daytimestamp:c}};return b.call([d])[0]},i=function(a,c){var d={methodname:"core_calendar_get_calendar_upcoming_view",args:{courseid:a,categoryid:c}};return b.call([d])[0]},j=function(a){var c={methodname:"core_group_get_course_groups",args:{courseid:a}};return b.call([c])[0]};return{getEventById:d,deleteEvent:c,updateEventStartDay:h,submitCreateUpdateForm:e,getCalendarMonthData:f,getCalendarDayData:g,getCalendarUpcomingData:i,getCourseGroupsData:j}});
define('core_calendar/selectors', [],function(){return{eventFilterItem:"[data-action='filter-event-type']",eventType:{site:"[data-eventtype-site]",category:"[data-eventtype-category]",course:"[data-eventtype-course]",group:"[data-eventtype-group]",user:"[data-eventtype-user]"},popoverType:{site:"[data-popover-eventtype-site]",category:"[data-popover-eventtype-category]",course:"[data-popover-eventtype-course]",group:"[data-popover-eventtype-group]",user:"[data-popover-eventtype-user]"},calendarPeriods:{month:"[data-period='month']"},courseSelector:'select[name="course"]',actions:{create:'[data-action="new-event-button"]',edit:'[data-action="edit"]',remove:'[data-action="delete"]',viewEvent:'[data-action="view-event"]'},elements:{courseSelector:'select[name="course"]'},today:".today",day:'[data-region="day"]',wrapper:".calendarwrapper",eventItem:'[data-type="event"]',links:{navLink:".calendarwrapper .arrow_link",eventLink:"[data-region='event-item']"},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}});
define('core_calendar/summary_modal', ["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/repository","core_calendar/events","core_calendar/crud"],function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={ROOT:"[data-region='summary-modal-container']",EDIT_BUTTON:'[data-action="edit"]',DELETE_BUTTON:'[data-action="delete"]'},n=function(a){e.call(this,a)};return n.TYPE="core_calendar-event_summary",n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.getEditButton=function(){return"undefined"==typeof this.editButton&&(this.editButton=this.getFooter().find(m.EDIT_BUTTON)),this.editButton},n.prototype.getDeleteButton=function(){return"undefined"==typeof this.deleteButton&&(this.deleteButton=this.getFooter().find(m.DELETE_BUTTON)),this.deleteButton},n.prototype.getEventId=function(){return this.getBody().find(m.ROOT).attr("data-event-id")},n.prototype.getEventTitle=function(){return this.getBody().find(m.ROOT).attr("data-event-title")},n.prototype.getEventCount=function(){return this.getBody().find(m.ROOT).attr("data-event-count")},n.prototype.getEditUrl=function(){return this.getBody().find(m.ROOT).attr("data-edit-url")},n.prototype.isActionEvent=function(){return"true"==this.getBody().find(m.ROOT).attr("data-action-event")},n.prototype.registerEventListeners=function(){e.prototype.registerEventListeners.call(this),this.getRoot().on(h.bodyRendered,function(){this.getModal().data({eventTitle:this.getEventTitle(),eventId:this.getEventId(),eventCount:this.getEventCount()}).attr("data-type","event"),k.registerRemove(this.getModal())}.bind(this)),a("body").on(j.deleted,function(){this.hide()}.bind(this)),d.define(this.getEditButton(),[d.events.activate]),this.getEditButton().on(d.events.activate,function(b,c){this.isActionEvent()?a("body").trigger(j.editActionEvent,[this.getEditUrl()]):a("body").trigger(j.editEvent,[this.getEventId()]),this.hide(),b.preventDefault(),b.stopPropagation(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()}.bind(this))},l||(f.register(n.TYPE,n,"core_calendar/event_summary_modal"),l=!0),n});
define('core_calendar/view_manager', ["jquery","core/templates","core/str","core/notification","core_calendar/repository","core_calendar/events","core_calendar/selectors","core/modal_factory","core/modal_events","core_calendar/summary_modal"],function(a,b,c,d,e,f,g,h,i,j){var k=function(b){b=a(b),b.on("click",g.links.eventLink,function(b){var c,d=a(b.target),e=null;c=d.is(g.actions.viewEvent)?d:d.closest(g.actions.viewEvent),e=c.length?c.data("eventId"):d.find(g.actions.viewEvent).data("eventId"),e&&(b.preventDefault(),b.stopPropagation(),w(e))}),b.on("click",g.links.navLink,function(c){var d=b.find(g.wrapper),e=d.data("view"),f=d.data("courseid"),h=d.data("categoryid"),i=a(c.currentTarget);"month"===e?(m(b,i.attr("href"),i.data("year"),i.data("month"),f,h),c.preventDefault()):"day"===e&&(q(b,i.attr("href"),i.data("year"),i.data("month"),i.data("day"),f,h),c.preventDefault())})},l=function(c,h,i,j,k,l){r(c),l=l||c.find(g.wrapper),M.util.js_pending([c.get("id"),h,i,j].join("-"));var m=c.data("includenavigation"),n=c.data("mini");return e.getCalendarMonthData(h,i,j,k,m,n).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(l,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return M.util.js_complete([c.get("id"),h,i,j].join("-")),s(c)}).fail(d.exception)},m=function(b,c,d,e,g,h){return l(b,d,e,g,h).then(function(){return c.length&&"#"!==c&&window.history.pushState({},"",c),arguments}).then(function(){return a("body").trigger(f.monthChanged,[d,e,g,h]),arguments})},n=function(a,b,c){var d=a.find(g.wrapper).data("year"),e=a.find(g.wrapper).data("month");return"undefined"==typeof b&&(b=a.find(g.wrapper).data("courseid")),"undefined"==typeof c&&(c=a.find(g.wrapper).data("categoryid")),l(a,d,e,b,c)},o=function(c,h,i,j,k,l,m){r(c),m=m||c.find(g.wrapper),M.util.js_pending([c.get("id"),h,i,j,k,l].join("-"));var n=c.data("includenavigation");return e.getCalendarDayData(h,i,j,k,l,n).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(m,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return M.util.js_complete([c.get("id"),h,i,j,k,l].join("-")),s(c)}).fail(d.exception)},p=function(a,b,c){var d=a.find(g.wrapper),e=d.data("year"),f=d.data("month"),h=d.data("day");return b||(b=a.find(g.wrapper).data("courseid")),"undefined"==typeof c&&(c=a.find(g.wrapper).data("categoryid")),o(a,e,f,h,b,c)},q=function(b,c,d,e,g,h,i){return o(b,d,e,g,h,i).then(function(){return c.length&&"#"!==c&&window.history.pushState({},"",c),arguments}).then(function(){return a("body").trigger(f.dayChanged,[d,e,g,h,i]),arguments})},r=function(a){var b=a.find(g.containers.loadingIcon);b.removeClass("hidden")},s=function(a){var b=a.find(g.containers.loadingIcon);b.addClass("hidden")},t=function(c,h,i){r(c);var j=c.find(g.wrapper);return"undefined"==typeof h&&(h=c.find(g.wrapper).data("courseid")),"undefined"==typeof i&&(i=c.find(g.wrapper).data("categoryid")),e.getCalendarUpcomingData(h,i).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(j,a,c)}).then(function(){a("body").trigger(f.viewUpdated)}).always(function(){return s(c)}).fail(d.exception)},u=function(a){switch(a){case"user":return"user";case"site":return"site";case"group":return"group";case"category":return"category";default:return"course"}},v=function(a){return"calendar_event_"+u(a)},w=function(a){var c="";e.getEventById(a).then(function(b){if(!b.event)throw new Error("Error encountered while trying to fetch calendar event with ID: "+a);var d=b.event;return c=v(d.eventtype),x(d.eventtype).then(function(a){return d.eventtype=a,d})}).then(function(a){var d={title:a.name,type:j.TYPE,body:b.render("core_calendar/event_summary_body",a),templateContext:{canedit:a.canedit,candelete:a.candelete,headerclasses:c,isactionevent:a.isactionevent,url:a.url}};return h.create(d)}).done(function(a){a.getRoot().on(i.hidden,function(){a.destroy()}),a.show()}).fail(d.exception)},x=function(a){var b="type"+u(a);return c.get_string(b,"core_calendar").then(function(a){return a})};return{init:function(a){k(a)},reloadCurrentMonth:n,changeMonth:m,refreshMonthContent:l,reloadCurrentDay:p,changeDay:q,refreshDayContent:o,reloadCurrentUpcoming:t}});
define('core_course/actions', ["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui","core/modal_factory","core/modal_events","core/key_codes"],function(a,b,c,d,e,f,g,h,i,j){var k={EDITINPROGRESS:"editinprogress",SECTIONDRAGGABLE:"sectiondraggable",EDITINGMOVE:"editing_move"},l={ACTIVITYLI:"li.activity",ACTIONAREA:".actions",ACTIVITYACTION:"a.cm-edit-action",MENU:".moodle-actionmenu[data-enhance=moodle-core-actionmenu]",TOGGLE:".toggle-display,.dropdown-toggle",SECTIONLI:"li.section",SECTIONACTIONMENU:".section_action_menu",ADDSECTIONS:"#changenumsections [data-add-sections]"};g.use("moodle-course-coursebase",function(){var a=M.course.format.get_section_selector();a&&(l.SECTIONLI=a)});var m=function(a){var b;return g.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getId(c.Node(a.get(0)))}),b},n=function(a){var b;return g.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getName(c.Node(a.get(0)))}),b},o=function(a){a.addClass(k.EDITINPROGRESS);var b=a.find(l.ACTIONAREA).get(0);if(b){var c=M.util.add_spinner(g,g.Node(b));return c.show(),c}return null},p=function(a){a.addClass(k.EDITINPROGRESS);var b=a.find(l.SECTIONACTIONMENU).get(0);if(b){var c=M.util.add_spinner(g,g.Node(b));return c.show(),c}return null},q=function(a){var b=M.util.add_lightbox(g,g.Node(a.get(0)));return b.show(),b},r=function(a,b,c){window.setTimeout(function(){a.removeClass(k.EDITINPROGRESS),b&&b.hide()},c)},s=function(a,b){a&&window.setTimeout(function(){a.hide()},b)},t=function(a,b){if(g.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource","#"+a)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(g.one("#"+a)),b){var c=g.one("#"+a+" "+l.MENU).one(l.TOGGLE);c&&c.simulate&&c.simulate("click")}},u=function(b,c){var d=a("#"+b),e="[data-action="+c+"]";"groupsseparate"!==c&&"groupsvisible"!==c&&"groupsnone"!==c||(e="[data-action=groupsseparate],[data-action=groupsvisible],[data-action=groupsnone]"),d.find(e).is(":visible")?d.find(e).focus():d.find(l.MENU).find(l.TOGGLE).focus()},v=function(b){var c=a("a:visible"),d=!1,e=null;return c.each(function(){if(a.contains(b[0],this))d=!0;else if(d)return e=this,!1}),e},w=function(c,e,f){var g,h=f.attr("data-keepopen"),i=f.attr("data-action"),j=o(c),k=b.call([{methodname:"core_course_edit_module",args:{id:e,action:i,sectionreturn:f.attr("data-sectionreturn")?f.attr("data-sectionreturn"):0}}],!0);"duplicate"===i&&(g=q(f.closest(l.SECTIONLI))),a.when.apply(a,k).done(function(b){var d=v(c);c.replaceWith(b),a("<div>"+b+"</div>").find(l.ACTIVITYLI).each(function(b){t(a(this).attr("id"),h),0===b&&(u(a(this).attr("id"),i),d=null)}),d&&d.focus(),r(c,j,400),s(g,400),c.trigger(a.Event("coursemoduleedited",{ajaxreturn:b,action:i}))}).fail(function(b){r(c,j),s(g);var e=a.Event("coursemoduleeditfailed",{exception:b,action:i});c.trigger(e),e.isDefaultPrevented()||d.exception(b)})},x=function(c,d,e){var f=o(c),g=b.call([{methodname:"core_course_get_module",args:{id:d,sectionreturn:e}}],!0);a.when.apply(a,g).done(function(a){r(c,f,400),C(a)}).fail(function(){r(c,f)})},y=function(a,b){var c=a.attr("class").match(/modtype_([^\s]*)/)[1],f=n(a);e.get_string("pluginname",c).done(function(a){var c={type:a,name:f};e.get_strings([{key:"confirm"},{key:null===f?"deletechecktype":"deletechecktypename",param:c},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],b)})})},z=function(a,b){e.get_strings([{key:"confirm"},{key:"yes"},{key:"no"}]).done(function(c){d.confirm(c[0],a,c[1],c[2],b)})},A=function(a,b,f,g,h,i,j){var k=[{key:f,component:g}];return h&&k.push({key:h,component:i}),e.get_strings(k).then(function(d){a.find("span.menu-action-text").html(d[0]),a.attr("title",d[0]);var e="";return h&&(e=d[1],a.attr("title",e)),c.renderPix(b,"core",e)}).then(function(b){a.find(".icon").replaceWith(b),a.attr("data-action",j)})["catch"](d.exception)},B=function(b,c,d,e){var f=c.attr("data-action");if("hide"===f||"show"===f){if("hide"===f?(b.addClass("hidden"),A(c,"i/show","showfromothers","format_"+e,null,null,"show")):(b.removeClass("hidden"),A(c,"i/hide","hidefromothers","format_"+e,null,null,"hide")),void 0!==d.modules)for(var g in d.modules)C(d.modules[g]);void 0!==d.section_availability&&b.find(".section_availability").first().replaceWith(d.section_availability)}else if("setmarker"===f){var h=a(l.SECTIONLI+".current"),i=h.find(l.SECTIONACTIONMENU+" a[data-action=removemarker]");h.removeClass("current"),A(i,"i/marker","highlight","core","markthistopic","core","setmarker"),b.addClass("current"),A(c,"i/marked","highlightoff","core","markedthistopic","core","removemarker")}else"removemarker"===f&&(b.removeClass("current"),A(c,"i/marker","highlight","core","markthistopic","core","setmarker"))},C=function(b){a("<div>"+b+"</div>").find(l.ACTIVITYLI).each(function(){var c=a(this).attr("id");a(l.ACTIVITYLI+"#"+c).replaceWith(b),t(c,!1)})},D=function(c,e,f,g){var h=f.attr("data-action"),i=f.attr("data-sectionreturn")?f.attr("data-sectionreturn"):0,j=p(c),k=b.call([{methodname:"core_course_edit_section",args:{id:e,action:h,sectionreturn:i}}],!0),m=q(c);a.when.apply(a,k).done(function(b){var d=a.parseJSON(b);r(c,j),s(m),c.find(l.SECTIONACTIONMENU).find(l.TOGGLE).focus();var e=a.Event("coursesectionedited",{ajaxreturn:d,action:h});c.trigger(e),e.isDefaultPrevented()||B(c,f,d,g)}).fail(function(b){r(c,j),s(m);var e=a.Event("coursesectioneditfailed",{exception:b,action:h});c.trigger(e),e.isDefaultPrevented()||d.exception(b)})};return g.use("moodle-course-coursebase",function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(b){var c=a(b.element.getDOMNode()),d=m(c);if(d){var e=c.find("."+k.EDITINGMOVE).attr("data-sectionreturn");x(c,d,e)}}})}),{initCoursePage:function(b){a("body").on("click keypress",l.ACTIVITYLI+" "+l.ACTIVITYACTION+"[data-action]",function(b){if("keypress"!==b.type||13===b.keyCode){var c=a(this),d=c.closest(l.ACTIVITYLI),e=c.attr("data-action"),f=m(d);switch(e){case"moveleft":case"moveright":case"delete":case"duplicate":case"hide":case"stealth":case"show":case"groupsseparate":case"groupsvisible":case"groupsnone":break;default:return}f&&(b.preventDefault(),"delete"===e?y(d,function(){w(d,f,c)}):w(d,f,c))}}),a("body").on("click keypress",l.SECTIONLI+" "+l.SECTIONACTIONMENU+"[data-sectionid] a[data-action]",function(c){if("keypress"!==c.type||13===c.keyCode){var d=a(this),e=d.closest(l.SECTIONLI),f=d.closest(l.SECTIONACTIONMENU).attr("data-sectionid");c.preventDefault(),d.attr("data-confirm")?z(d.attr("data-confirm"),function(){D(e,f,d,b)}):D(e,f,d,b)}}),e.get_string("numberweeks").done(function(b){var c=a(l.ADDSECTIONS),d=c.attr("data-add-sections"),e=c.attr("new-sections"),f=a('<div><label for="add_section_numsections"></label> <input id="add_section_numsections" type="number" min="1" max="'+e+'" value="1"></div>');f.find("label").html(b),h.create({title:d,type:h.types.SAVE_CANCEL,body:f.html()},c).done(function(b){var e=a(b.getBody()).find("#add_section_numsections"),f=function(){""+parseInt(e.val())===e.val()&&parseInt(e.val())>=1&&(document.location=c.attr("href")+"&numsections="+parseInt(e.val()))};b.setSaveButtonText(d),b.getRoot().on(i.shown,function(){e.focus().select().on("keydown",function(a){a.keyCode===j.enter&&f()})}),b.getRoot().on(i.save,function(a){a.preventDefault(),f()})})})},replaceSectionActionItem:function(a,b,c,d,e,f,g,h){var i=a.find(l.SECTIONACTIONMENU+" "+b);A(i,c,d,e,f,g,h)}}});
define('core_form/passwordunmask', ["jquery","core/templates"],function(a,b){var c=function(b){this.wrapperSelector='[data-passwordunmask="wrapper"][data-passwordunmaskid="'+b+'"]',this.wrapper=a(this.wrapperSelector),this.editorSpace=this.wrapper.find('[data-passwordunmask="editor"]'),this.editLink=this.wrapper.find('a[data-passwordunmask="edit"]'),this.editInstructions=this.wrapper.find('[data-passwordunmask="instructions"]'),this.displayValue=this.wrapper.find('[data-passwordunmask="displayvalue"]'),this.inputFieldLabel=a('label[for="'+b+'"]'),this.inputField=this.editorSpace.find(document.getElementById(b)),this.inputField.attr("type","hidden"),this.inputField.removeClass("hiddenifjs"),this.editInstructions.attr("id")||this.editInstructions.attr("id",b+"_instructions"),this.editInstructions.hide(),this.setDisplayValue(),this.addListeners()};return c.prototype.addListeners=function(){return this.wrapper.on("click keypress",'[data-passwordunmask="edit"]',a.proxy(function(b){"keypress"===b.type&&13!==b.keyCode||(b.stopImmediatePropagation(),b.preventDefault(),"hidden"!==this.inputField.attr("type")?"click"===b.type||a(b.relatedTarget).is(":input")?this.turnEditingOff(!1):this.turnEditingOff(!0):this.turnEditingOn())},this)),this.wrapper.on("click keypress",'[data-passwordunmask="unmask"]',a.proxy(function(a){"keypress"===a.type&&13!==a.keyCode||(a.stopImmediatePropagation(),a.preventDefault(),this.wrapper.data("unmasked",!this.wrapper.data("unmasked")),this.setDisplayValue())},this)),this.wrapper.on("keydown","input",a.proxy(function(a){"keydown"===a.type&&13!==a.keyCode||(a.stopImmediatePropagation(),a.preventDefault(),this.turnEditingOff(!0))},this)),this.inputFieldLabel.on("click",a.proxy(function(a){a.preventDefault(),this.turnEditingOn()},this)),this},c.prototype.checkFocusOut=function(b){this.isEditing()&&window.setTimeout(a.proxy(function(){var c=b.relatedTarget||document.activeElement;this.wrapper.has(a(c)).length||this.turnEditingOff(!a(c).is(":input,a"))},this),100)},c.prototype.passwordVisible=function(){return!!this.wrapper.data("unmasked")},c.prototype.isEditing=function(){return"hidden"!==this.inputField.attr("type")},c.prototype.turnEditingOn=function(){var b=this.getDisplayValue();return this.passwordVisible()?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(b),this.inputField.attr("size",this.inputField.attr("data-size")),this.editInstructions.length&&(this.inputField.attr("aria-describedby",this.editInstructions.attr("id")),this.editInstructions.show()),this.wrapper.attr("data-passwordunmask-visible",1),this.editLink.hide(),this.inputField.focus().select(),a("body").on("focusout",this.wrapperSelector,a.proxy(this.checkFocusOut,this)),this},c.prototype.turnEditingOff=function(b){a("body").off("focusout",this.wrapperSelector,this.checkFocusOut);var c=this.getDisplayValue();return this.inputField.attr("type","hidden").attr("aria-describedby",null),this.inputField.val(c),this.editInstructions.hide(),this.wrapper.removeAttr("data-passwordunmask-visible"),this.inputField.removeAttr("size"),this.editLink.show(),this.setDisplayValue(),b&&this.editLink.focus(),this},c.prototype.getDisplayValue=function(){return this.inputField.val()},c.prototype.setDisplayValue=function(){var c=this.getDisplayValue();return this.isEditing()&&(this.wrapper.data("unmasked")?this.inputField.attr("type","text"):this.inputField.attr("type","password"),this.inputField.val(c)),c&&this.wrapper.data("unmasked")?this.displayValue.text(c):(c||(c=""),b.render("core_form/element-passwordunmask-fill",{element:{frozen:this.inputField.is("[readonly]"),value:c,valuechars:c.split("")}}).done(a.proxy(function(a,c){this.displayValue.html(a),b.runTemplateJS(c)},this))),this},c});
define('core_form/defaultcustom', ["jquery"],function(a){var b=function(b){var c=a(b.target),d=JSON.parse(c.attr("data-defaultvalue")),e=JSON.parse(c.attr("data-customvalue")),f=c.attr("data-type"),g=c.closest("form"),h=c.attr("name").replace(/\[customize\]$/,"[value]"),i=c.prop("checked")?e:d;"text"===f?g.find('[name="'+h+'"]').val(i):"date_selector"===f?(g.find('[name="'+h+'[day]"]').val(i.day),g.find('[name="'+h+'[month]"]').val(i.month),g.find('[name="'+h+'[year]"]').val(i.year)):"date_time_selector"===f&&(g.find('[name="'+h+'[day]"]').val(i.day),g.find('[name="'+h+'[month]"]').val(i.month),g.find('[name="'+h+'[year]"]').val(i.year),g.find('[name="'+h+'[hour]"]').val(i.hour),g.find('[name="'+h+'[minute]"]').val(i.minute))},c="input[data-defaultcustom=true]";a("body").on("change",c,b)});
define('core_form/filetypes', ["jquery","core/log","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/tree"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(c,d,e,f){if(this.elementId=c,this.elementLabel=d,this.onlyTypes=e,this.allowAll=f,this.inputField=a("#"+c),this.wrapperBrowserTrigger=a('[data-filetypesbrowser="'+c+'"]'),this.wrapperDescriptions=a('[data-filetypesdescriptions="'+c+'"]'),this.wrapperBrowserTrigger.length)return this.inputField.length&&this.wrapperDescriptions.length?void this.prepareBrowserTrigger().then(function(){return this.prepareBrowserModal()}.bind(this)).then(function(){return this.prepareBrowserTree()}.bind(this)):void b.error("core_form/filetypes: Unexpected DOM structure, unable to enhance filetypes field "+c)};return i.prototype.prepareBrowserTrigger=function(){return g.render("core_form/filetypes-trigger",{}).then(function(a){this.wrapperBrowserTrigger.html(a),this.browserTrigger=this.wrapperBrowserTrigger.find('[data-filetypeswidget="browsertrigger"]')}.bind(this))},i.prototype.prepareBrowserModal=function(){return d.create({type:d.types.SAVE_CANCEL,title:this.elementLabel}).then(function(a){this.browserModal=a}.bind(this)).then(function(){this.browserModal.getRoot().on(e.hidden,function(){this.browserTrigger.focus()}.bind(this)),this.browserModal.getRoot().on(e.save,function(){this.saveBrowserModal()}.bind(this))}.bind(this))},i.prototype.prepareBrowserTree=function(){return this.browserTrigger.on("click",function(b){if(b.preventDefault(),!this.inputField.is("[disabled]")){var c=this.loadBrowserModalBody();c.then(function(){this.browserTree=new h(this.browserModal.getBody()),this.browserTree.handleKeyDown=function(a,b){b.keyCode==this.browserTree.keys.enter||b.keyCode==this.browserTree.keys.space?(b.preventDefault(),b.stopPropagation(),this.toggleCheckbox(a.attr("data-filetypesbrowserkey"))):h.prototype.handleKeyDown.call(this.browserTree,a,b)}.bind(this),this.allowAll&&(this.hideOrShowItemsDependingOnAllowAll(this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]:first')),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey="*"]',function(b){this.hideOrShowItemsDependingOnAllowAll(a(b.currentTarget))}.bind(this))),this.browserModal.getRoot().on("change",'input[type="checkbox"][data-filetypesbrowserkey]',function(b){var c=a(b.currentTarget),d=c.attr("data-filetypesbrowserkey");this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+d+'"]').prop("checked",c.prop("checked"))}.bind(this))}.bind(this)).then(function(){this.browserModal.show()}.bind(this)),this.browserModal.setBody(c)}}.bind(this)),a.when()},i.prototype.loadBrowserModalBody=function(){var a={onlytypes:this.onlyTypes.join(),allowall:this.allowAll,current:this.inputField.val()};return f.call([{methodname:"core_form_get_filetypes_browser_data",args:a}])[0].then(function(a){return g.render("core_form/filetypes-browser",{elementid:this.elementId,groups:a.groups})}.bind(this))},i.prototype.toggleCheckbox=function(a){var b=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="'+a+'"]:first');b.prop("checked",!b.prop("checked"))},i.prototype.saveBrowserModal=function(){if(this.allowAll){var b=this.browserModal.getRoot().find('input[type="checkbox"][data-filetypesbrowserkey="*"]');if(b.length&&b.prop("checked"))return this.inputField.val("*"),void this.updateDescriptions(["*"])}var c=[];this.browserModal.getRoot().find('input[type="checkbox"]').each(function(){var b=a(this),d=b.attr("data-filetypesbrowserkey");b.prop("checked")&&c.push(d)}),c=c.filter(function(a,b,c){return c.indexOf(a)==b}),this.inputField.val(c.join(" ")),this.updateDescriptions(c)},i.prototype.updateDescriptions=function(a){var b=[];a.forEach(function(a){b.push({description:this.browserModal.getRoot().find('[data-filetypesname="'+a+'"]:first').text().trim(),extensions:this.browserModal.getRoot().find('[data-filetypesextensions="'+a+'"]:first').text().trim()})}.bind(this));var c={hasdescriptions:b.length>0,descriptions:b};return g.render("core_form/filetypes-descriptions",c).then(function(a){this.wrapperDescriptions.html(a)}.bind(this))},i.prototype.hideOrShowItemsDependingOnAllowAll=function(a){var b=this.browserModal.getRoot().find('[role="treeitem"][data-filetypesbrowserkey!="*"]');a.prop("checked")?b.hide():b.show()},{init:function(a,b,c,d){new i(a,b,c,d)}}});
define('core_grades/edittree_index', ["jquery"],function(a){var b=function(){a("body").on("change",".itemselect.ignoredirty",b.checkMoveMenuState),a("body").on("click",'[data-action="grade_edittree-index-bulkselect"]',b.toggleAllSelectItems),a("body").on("change",".weightoverride",b.toggleWeightInput),a("#menumoveafter").on("change",function(){var b=a(this).closest("form"),c=b.find("#bulkmoveinput");c.val(1),b.submit()}),b.checkMoveMenuState()};return b.toggleWeightInput=function(b){b.preventDefault();var c=a(this),d=c.closest("tr");a('input[name="weight_'+d.data("itemid")+'"]').prop("disabled",!c.prop("checked"))},b.toggleAllSelectItems=function(c){c.preventDefault();var d=a(this),e=d.closest("tr");a("."+e.data("category")+" .itemselect").prop("checked",d.data("checked")),b.checkMoveMenuState()},b.getMoveMenu=function(){return a("#menumoveafter")},b.checkMoveMenuState=function(){var c=b.getMoveMenu();if(!c.length)return!1;var d;return a(".itemselect").each(function(){return d=a(this).prop("checked"),!d}),c.prop("disabled",!d),d},{enhance:b}});
define('core_message/message_area', ["jquery","core_message/message_area_contacts","core_message/message_area_messages","core_message/message_area_profile","core_message/message_area_tabs","core_message/message_area_search"],function(a,b,c,d,e,f){function g(b,c,d,e){this.node=a(b),this.pollmin=c,this.pollmax=d,this.polltimeout=e,this._init()}return g.prototype.node=null,g.prototype.pollmin=null,g.prototype.pollmax=null,g.prototype.polltimeout=null,g.prototype._init=function(){new b(this),new c(this),new d(this),new e(this),new f(this)},g.prototype.onDelegateEvent=function(a,b,c){this.node.on(a,b,c)},g.prototype.onCustomEvent=function(a,b){this.node.on(a,b)},g.prototype.trigger=function(a,b){"undefined"==typeof b&&(b=""),this.node.trigger(a,b)},g.prototype.find=function(a){return this.node.find(a)},g.prototype.getCurrentUserId=function(){return this.node.data("userid")},g.prototype.showContactsFirst=function(){return!!this.node.data("displaycontacts")},g});
define('core_message/message_area_actions', ["core_message/message_area_events"],function(a){function b(a){this.messageArea=a}var c={MESSAGES:"[data-region='messages']"};return b.prototype.messageArea=null,b.prototype.chooseMessagesToDelete=function(){0!==this.messageArea.find(c.MESSAGES).length&&this.messageArea.trigger(a.CHOOSEMESSAGESTODELETE)},b});
define('core_message/message_area_contacts', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events","core/str","core_message/message_area_events"],function(a,b,c,d,e,f,g){function h(a){this.messageArea=a,this._init()}var i={CONTACT:"[data-region='contact']",CONTACTICONBLOCKED:"[data-region='contact-icon-blocked']",CONTACTS:"[data-region='contacts'][data-region-content='contacts']",CONTACTSAREA:"[data-region='contacts-area']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",COURSE:"[data-region='course']",LASTMESSAGETEXT:"[data-region='last-message-text']",LASTMESSAGEUSER:"[data-region='last-message-user']",LOADINGICON:".loading-icon",MESSAGETEXT:"[data-region='message-text']",MESSAGINGAREA:"[data-region='messaging-area']",NOCONTACTS:"[data-region=no-contacts]",SEARCHBOX:"[data-region='search-box']",SEARCHRESULTSAREA:"[data-region='search-results-area']",SEARCHTEXTAREA:"[data-region='search-text-area']",SELECTEDVIEWCONVERSATION:"[data-action='view-contact-msg'].selected",SELECTEDVIEWPROFILE:"[data-action='view-contact-profile'].selected",SHOWMESSAGES:"[data-action='show-messages']",VIEWCONVERSATION:"[data-action='view-contact-msg']",VIEWPROFILE:"[data-action='view-contact-profile']"};return h.prototype._isLoadingConversations=!1,h.prototype._isLoadingContacts=!1,h.prototype._numContactsDisplayed=0,h.prototype._numContactsToRetrieve=20,h.prototype._numConversationsDisplayed=0,h.prototype._numConversationsToRetrieve=20,h.prototype._messageLength=60,h.prototype.messageArea=null,h.prototype._init=function(){e.define(this.messageArea.node,[e.events.activate,e.events.down,e.events.up]),this.messageArea.onCustomEvent(g.MESSAGESEARCHCANCELED,this._viewConversations.bind(this)),this.messageArea.onCustomEvent(g.USERSSEARCHCANCELED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONDELETED,this._deleteConversation.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONSSELECTED,this._viewConversations.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,this._viewContacts.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESDELETED,this._updateLastMessage.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESENT,this._handleMessageSent.bind(this)),this.messageArea.onCustomEvent(g.CONTACTREMOVED,function(a,b){this._removeContact(i.CONTACTS,b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTADDED,function(a,b){this._addContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTBLOCKED,function(a,b){this._blockContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTUNBLOCKED,function(a,b){this._unblockContact(b)}.bind(this)),this.messageArea.onCustomEvent(g.CHOOSEMESSAGESTODELETE,this._startDeleting.bind(this)),this.messageArea.onCustomEvent(g.CANCELDELETEMESSAGES,this._stopDeleting.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.VIEWCONVERSATION,this._viewConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.VIEWPROFILE,this._viewContact.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,i.SHOWMESSAGES,this._showMessagingArea.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.CONTACT,this._selectPreviousContact.bind(this)),this.messageArea.onDelegateEvent(e.events.down,i.CONTACT,this._selectNextContact.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.VIEWCONVERSATION,this._selectPreviousConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.down,i.VIEWCONVERSATION,this._selectNextConversation.bind(this)),this.messageArea.onDelegateEvent(e.events.up,i.COURSE,this._selectPreviousCourse.bind()),this.messageArea.onDelegateEvent(e.events.down,i.COURSE,this._selectNextCourse.bind()),this.messageArea.onDelegateEvent("focus",i.SEARCHBOX,this._setSearching.bind(this)),this.messageArea.onDelegateEvent("blur",i.SEARCHBOX,this._clearSearching.bind(this)),e.define(this.messageArea.find(i.CONVERSATIONS),[e.events.scrollBottom]),e.define(this.messageArea.find(i.CONTACTS),[e.events.scrollBottom]),this.messageArea.onDelegateEvent(e.events.scrollBottom,i.CONVERSATIONS,this._loadConversations.bind(this)),this.messageArea.onDelegateEvent(e.events.scrollBottom,i.CONTACTS,this._loadContacts.bind(this)),this.messageArea.showContactsFirst()||(this._numConversationsDisplayed=20)},h.prototype._startDeleting=function(){this.messageArea.find(i.CONTACTSAREA).addClass("editing")},h.prototype._stopDeleting=function(){this.messageArea.find(i.CONTACTSAREA).removeClass("editing")},h.prototype._viewConversations=function(){0===this._numConversationsDisplayed&&this._loadConversations(),this.messageArea.find(i.CONTACTS).hide(),this.messageArea.find(i.CONVERSATIONS).show()},h.prototype._viewContacts=function(){0===this._numContactsDisplayed&&this._loadContacts(),this.messageArea.find(i.CONVERSATIONS).hide(),this.messageArea.find(i.CONTACTS).show()},h.prototype._handleMessageSent=function(a,b,c){this._viewConversations();var d=this._getUserNode(i.CONVERSATIONS,b);if(0===d.length){var e=this._getUserNode(i.CONTACTS,b);if(0===e.length&&(e=this._getUserNode(i.SEARCHRESULTSAREA,b)),0==e.length)return;d=e.clone(),d.attr("data-action","view-contact-msg"),this.messageArea.find(i.CONVERSATIONS+" "+i.NOCONTACTS).remove(),this._numConversationsDisplayed++}d.prependTo(this.messageArea.find(i.CONVERSATIONS)),this.messageArea.find(i.CONVERSATIONS).scrollTop(0),this._updateContactText(d,c,!0),this._setSelectedUser("[data-userid='"+b+"']")},h.prototype._loadConversations=function(){if(this._isLoadingConversations)return!1;this._isLoadingConversations=!0;var a=0;return c.render("core/loading",{}).then(function(a,b){return this._numConversationsDisplayed?c.appendNodeContents(this.messageArea.find(i.CONVERSATIONS),"<div style='text-align:center'>"+a+"</div>",b):c.replaceNodeContents(this.messageArea.find(i.CONVERSATIONS),"<div style='text-align:center'>"+a+"</div>",b),this._getItems("core_message_data_for_messagearea_conversations",this._numConversationsDisplayed,this._numConversationsToRetrieve)}.bind(this)).then(function(b){return a=b.contacts.length,b.isconversation=!0,c.render("core_message/message_area_contacts",b)}).then(function(b,d){this.messageArea.find(i.CONVERSATIONS+" "+i.LOADINGICON).remove(),a>0?(c.appendNodeContents(this.messageArea.find(i.CONVERSATIONS),b,d),this._numConversationsDisplayed+=this._numConversationsToRetrieve):this._numConversationsDisplayed||c.replaceNodeContents(this.messageArea.find(i.CONVERSATIONS),b,d),this._isLoadingConversations=!1}.bind(this)).fail(d.exception)},h.prototype._loadContacts=function(){if(this._isLoadingContacts)return!1;this._isLoadingContacts=!0;var a=0;return c.render("core/loading",{}).then(function(a,b){return this._numContactsDisplayed?c.appendNodeContents(this.messageArea.find(i.CONTACTS),"<div style='text-align:center'>"+a+"</div>",b):c.replaceNodeContents(this.messageArea.find(i.CONTACTS),"<div style='text-align:center'>"+a+"</div>",b),this._getItems("core_message_data_for_messagearea_contacts",this._numContactsDisplayed,this._numContactsToRetrieve)}.bind(this)).then(function(b){return a=b.contacts.length,b.isconversation=!1,c.render("core_message/message_area_contacts",b)}).then(function(b,d){this.messageArea.find(i.CONTACTS+" "+i.LOADINGICON).remove(),a>0?(c.appendNodeContents(this.messageArea.find(i.CONTACTS),b,d),this._numContactsDisplayed+=a):this._numContactsDisplayed||c.replaceNodeContents(this.messageArea.find(i.CONTACTS),b,d),this._isLoadingContacts=!1}.bind(this)).fail(d.exception)},h.prototype._viewConversation=function(b){this.messageArea.trigger(g.CANCELDELETEMESSAGES);var c=a(b.currentTarget).data("userid"),d=a(b.currentTarget).data("messageid"),e="[data-userid='"+c+"']";d&&(e="[data-messageid='"+d+"']"),this._setSelectedUser(e),this.messageArea.trigger(g.CONVERSATIONSELECTED,c),this.messageArea.find(i.SELECTEDVIEWPROFILE).removeClass("selected"),this._showMessagingArea()},h.prototype._viewContact=function(b){this.messageArea.trigger(g.CANCELDELETEMESSAGES);var c=a(b.currentTarget).data("userid");this._setSelectedUser("[data-userid='"+c+"']"),this.messageArea.trigger(g.CONTACTSELECTED,c),this.messageArea.find(i.SELECTEDVIEWCONVERSATION).removeClass("selected"),this._showMessagingArea()},h.prototype._getItems=function(a,c,d){var e=b.call([{methodname:a,args:{userid:this.messageArea.getCurrentUserId(),limitfrom:c,limitnum:d}}]);return e[0]},h.prototype._deleteConversation=function(a,b){this._removeContact(i.CONVERSATIONS,b),this._numConversationsDisplayed--,this._hideMessagingArea(),this._stopDeleting()},h.prototype._updateLastMessage=function(a,b,c){if(c){var d=this._getUserNode(i.CONVERSATIONS,b),e=c.find(i.MESSAGETEXT).text().trim(),f=!1;c.data("useridto")==b&&(f=!0),this._updateContactText(d,e,f)}this._stopDeleting()},h.prototype._addContact=function(){this.messageArea.find(i.CONTACTS).empty(),this._numContactsDisplayed=0,this._loadContacts()},h.prototype._removeContact=function(a,b){this._getUserNode(a,b).remove(),this._numContactsDisplayed--},h.prototype._blockContact=function(a){var b=this._getUserNode(i.CONTACTS,a);b.find(i.CONTACTICONBLOCKED).removeClass("hidden"),b=this._getUserNode(i.CONVERSATIONS,a),b.find(i.CONTACTICONBLOCKED).removeClass("hidden"),b=this._getUserNode(i.SEARCHRESULTSAREA,a),b.find(i.CONTACTICONBLOCKED).removeClass("hidden")},h.prototype._unblockContact=function(a){var b=this._getUserNode(i.CONTACTS,a);b.find(i.CONTACTICONBLOCKED).addClass("hidden"),b=this._getUserNode(i.CONVERSATIONS,a),b.find(i.CONTACTICONBLOCKED).addClass("hidden"),b=this._getUserNode(i.SEARCHRESULTSAREA,a),b.find(i.CONTACTICONBLOCKED).addClass("hidden")},h.prototype._getUserNode=function(a,b){return this.messageArea.find(a+" "+i.CONTACT+"[data-userid='"+b+"']")},h.prototype._setSelectedUser=function(a){this.messageArea.find(i.CONTACT).removeClass("selected"),this.messageArea.find(i.CONTACT).attr("aria-pressed",!1),this.messageArea.find(i.CONTACT+a).addClass("selected"),this.messageArea.find(i.CONTACT+a).attr("aria-pressed",!0)},h.prototype._getContactText=function(a){return a.length>this._messageLength&&(a=a.substr(0,this._messageLength-3),a+="..."),document.createTextNode(a)},h.prototype._updateContactText=function(a,b,c){b=this._getContactText(b),c?f.get_string("you","message").done(function(b){a.find(i.LASTMESSAGEUSER).empty().append(b)}).always(function(){a.find(i.LASTMESSAGETEXT).empty().append(b)}):(a.find(i.LASTMESSAGEUSER).empty(),a.find(i.LASTMESSAGETEXT).empty().append(b))},h.prototype._selectNextContact=function(b,c){var d=a(b.target).closest(i.CONTACT),e=d.next();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousContact=function(b,c){var d=a(b.target).closest(i.CONTACT),e=d.prev();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectNextCourse=function(b,c){var d=a(b.target).closest(i.COURSE);d.next().focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousCourse=function(b,c){var d=a(b.target).closest(i.COURSE);d.prev().focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectNextConversation=function(b,c){var d=a(b.target).closest(i.VIEWCONVERSATION),e=d.next();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._selectPreviousConversation=function(b,c){var d=a(b.target).closest(i.VIEWCONVERSATION),e=d.prev();e.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},h.prototype._setSearching=function(){a(i.SEARCHTEXTAREA).addClass("searching")},h.prototype._clearSearching=function(){a(i.SEARCHTEXTAREA).removeClass("searching")},h.prototype._showMessagingArea=function(){this.messageArea.find(i.MESSAGINGAREA).removeClass("hide-messages").addClass("show-messages")},h.prototype._hideMessagingArea=function(){this.messageArea.find(i.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},h});
define('core_message/message_area_events', [],function(){return{CANCELDELETEMESSAGES:"cancel-delete-messages",CHOOSEMESSAGESTODELETE:"choose-messages-to-delete",CONTACTADDED:"contact-added",CONTACTBLOCKED:"contact-blocked",CONTACTREMOVED:"contact-removed",CONTACTSELECTED:"contact-selected",CONTACTSSELECTED:"contacts-selected",CONTACTUNBLOCKED:"contact-unblocked",CONVERSATIONDELETED:"conversation-deleted",CONVERSATIONSELECTED:"conversation-selected",CONVERSATIONSSELECTED:"conversations-selected",MESSAGESDELETED:"messages-deleted",MESSAGESEARCHCANCELED:"message-search-canceled",MESSAGESENT:"message-sent",SENDMESSAGE:"message-send",USERSSEARCHCANCELED:"users-search-canceled"}});
define('core_message/message_area_messages', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events","core/auto_rows","core_message/message_area_actions","core/modal_factory","core/modal_events","core/str","core_message/message_area_events","core/backoff_timer"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){this.messageArea=a,this._init()}var n=500,o=50,p={BLOCKTIME:"[data-region='blocktime']",CANCELDELETEMESSAGES:"[data-action='cancel-delete-messages']",CONTACT:"[data-region='contact']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",DELETEALLMESSAGES:"[data-action='delete-all-messages']",DELETEMESSAGES:"[data-action='delete-messages']",LOADINGICON:".loading-icon",MESSAGE:"[data-region='message']",MESSAGERESPONSE:"[data-region='response']",MESSAGES:"[data-region='messages']",MESSAGESAREA:"[data-region='messages-area']",MESSAGINGAREA:"[data-region='messaging-area']",SENDMESSAGE:"[data-action='send-message']",SENDMESSAGETEXT:"[data-region='send-message-txt']",SHOWCONTACTS:"[data-action='show-contacts']",STARTDELETEMESSAGES:"[data-action='start-delete-messages']"},q=1e3;return m.prototype._isSendingMessage=!1,m.prototype._isLoadingMessages=!1,m.prototype._numMessagesDisplayed=0,m.prototype._messageQueue=[],m.prototype._numMessagesToRetrieve=20,m.prototype._confirmationModal=null,m.prototype._latestMessageTimestamp=0,m.prototype._backoffTimer=null,m.prototype.messageArea=null,m.prototype._init=function(){e.define(this.messageArea.node,[e.events.activate,e.events.up,e.events.down,e.events.enter]),a(window).height()<=670&&(n=400),f.init(this.messageArea.node),this.messageArea.onCustomEvent(k.CONVERSATIONSELECTED,this._viewMessages.bind(this)),this.messageArea.onCustomEvent(k.SENDMESSAGE,this._viewMessages.bind(this)),this.messageArea.onCustomEvent(k.CHOOSEMESSAGESTODELETE,this._chooseMessagesToDelete.bind(this)),this.messageArea.onCustomEvent(k.CANCELDELETEMESSAGES,this._hideDeleteAction.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.SENDMESSAGE,this._sendMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.STARTDELETEMESSAGES,this._startDeleting.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.DELETEMESSAGES,this._deleteMessages.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.DELETEALLMESSAGES,this._deleteAllMessages.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.CANCELDELETEMESSAGES,this._triggerCancelMessagesToDelete.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.MESSAGE,this._toggleMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.activate,p.SHOWCONTACTS,this._hideMessagingArea.bind(this)),this.messageArea.onDelegateEvent(e.events.up,p.MESSAGE,this._selectPreviousMessage.bind(this)),this.messageArea.onDelegateEvent(e.events.down,p.MESSAGE,this._selectNextMessage.bind(this)),this.messageArea.onDelegateEvent("focus",p.SENDMESSAGETEXT,this._setMessaging.bind(this)),this.messageArea.onDelegateEvent("blur",p.SENDMESSAGETEXT,this._clearMessaging.bind(this)),a(document).on(f.events.ROW_CHANGE,this._adjustMessagesAreaHeight.bind(this));var b=this.messageArea.find(p.MESSAGES);b.length&&(this._addScrollEventListener(b.find(p.MESSAGE).length),this._latestMessageTimestamp=b.find(p.MESSAGE+":last").data("timecreated")),this._backoffTimer=new l(this._loadNewMessages.bind(this),l.getIncrementalCallback(this.messageArea.pollmin*q,q,this.messageArea.pollmax*q,this.messageArea.polltimeout*q)),this._backoffTimer.start()},m.prototype._viewMessages=function(e,f){this._numMessagesDisplayed=0,this._backoffTimer.stop(),this._latestMessageTimestamp=0;var g=b.call([{methodname:"core_message_mark_all_messages_as_read",args:{useridto:this.messageArea.getCurrentUserId(),useridfrom:f}}]),h=0;return c.render("core/loading",{}).then(function(a,b){return c.replaceNodeContents(this.messageArea.find(p.MESSAGESAREA),a,b),g[0]}.bind(this)).then(function(){var b=this.messageArea.find(p.CONVERSATIONS+" "+p.CONTACT+"[data-userid='"+f+"']");return b.hasClass("unread")&&(b.removeClass("unread"),a(document).trigger("messagearea:conversationselected",f)),this._getMessages(f)}.bind(this)).then(function(a){return h=a.messages.length,c.render("core_message/message_area_messages_area",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(p.MESSAGESAREA),a,b),this._addScrollEventListener(h),this._backoffTimer.restart(),this.messageArea.find(p.SENDMESSAGETEXT).focus()}.bind(this)).fail(d.exception)},m.prototype._loadMessages=function(){if(this._isLoadingMessages)return!1;this._isLoadingMessages=!0;var b=0;return c.render("core/loading",{}).then(function(a,b){return c.prependNodeContents(this.messageArea.find(p.MESSAGES),"<div style='text-align:center'>"+a+"</div>",b),this._getMessages(this._getUserId())}.bind(this)).then(function(a){return b=a.messages.length,c.render("core_message/message_area_messages",a)}).then(function(d,e){if(this.messageArea.find(p.MESSAGES+" "+p.LOADINGICON).remove(),b>0){var f=a("<div>"+d+"</div>");this._hasMatchingBlockTime(this.messageArea.node,f,!0)&&this.messageArea.node.find(p.BLOCKTIME+":first").remove();var g=this.messageArea.find(p.MESSAGES)[0].scrollHeight;c.prependNodeContents(this.messageArea.find(p.MESSAGES),d,e);var h=this.messageArea.find(p.MESSAGES)[0].scrollHeight;this.messageArea.find(p.MESSAGES).scrollTop(h-g),this._numMessagesDisplayed+=b}this._isLoadingMessages=!1}.bind(this)).fail(d.exception)},m.prototype._loadNewMessages=function(){if(this._isLoadingMessages)return!1;if(!this._getUserId())return!1;this._isLoadingMessages=!0;var a=!1,b=this.messageArea.find(p.MESSAGES);if(0!==b.length){var c=b.scrollTop(),e=b.innerHeight(),f=b[0].scrollHeight;c+e>=f&&(a=!0)}return this._getMessages(this._getUserId(),!0).then(function(b){return this._addMessagesToDom(b.messages,a)}.bind(this)).always(function(){this._isLoadingMessages=!1}.bind(this)).fail(d.exception)},m.prototype._getMessages=function(a,c){var e={currentuserid:this.messageArea.getCurrentUserId(),otheruserid:a,limitfrom:this._numMessagesDisplayed,limitnum:this._numMessagesToRetrieve,newest:!0};c&&(e.timefrom=this._latestMessageTimestamp,e.limitfrom=0,e.limitnum=0);var f=b.call([{methodname:"core_message_data_for_messagearea_messages",args:e}]);return f[0].then(function(a){var b=a.messages;if(b&&b.length){var c=b[b.length-1];c.timecreated>this._latestMessageTimestamp&&(this._latestMessageTimestamp=c.timecreated+1)}return a}.bind(this)).fail(function(a){this._backoffTimer.stop(),d.exception(a)}.bind(this))},m.prototype._sendMessage=function(){var a=this.messageArea.find(p.SENDMESSAGETEXT),c=a.val().trim();if(""===c)return!1;if(this._isSendingMessage)return!1;this._isSendingMessage=!0;var e=b.call([{methodname:"core_message_send_instant_messages",args:{messages:[{touserid:this._getUserId(),text:c}]}}]);return a.prop("disabled",!0),e[0].then(function(a){if(a.length<0)throw new Error("Invalid response");if(a[0].errormessage)throw new Error(a[0].errormessage);return this.messageArea.trigger(k.MESSAGESENT,[this._getUserId(),c]),this._addLastMessageToDom()}.bind(this)).then(function(){this._isSendingMessage=!1}.bind(this)).always(function(){a.prop("disabled",!1),a.focus()}).fail(d.exception)},m.prototype._chooseMessagesToDelete=function(){this.messageArea.find(p.MESSAGESAREA).addClass("editing"),this.messageArea.find(p.MESSAGE).attr("role","checkbox").attr("aria-checked","false")},m.prototype._deleteMessages=function(){var c=this.messageArea.getCurrentUserId(),e=this.messageArea.find(p.MESSAGE+"[aria-checked='true']"),f=[],g=[];e.each(function(b,d){var e=a(d),h=e.data("messageid"),i=e.data("messageread")?1:0;g.push(e),f.push({methodname:"core_message_delete_message",args:{messageid:h,userid:c,read:i}})}),f.length>0?a.when(b.call(f)).then(function(){var b=null,c=this.messageArea.find(p.MESSAGE),d=c.last(),e=g[g.length-1];a.each(g,function(a,b){b.remove()}),d.data("id")===e.data("id")&&(b=this.messageArea.find(p.MESSAGE).last()),a.each(g,function(a,b){var c=b.data("blocktime");0===this.messageArea.find(p.MESSAGE+"[data-blocktime='"+c+"']").length&&this.messageArea.find(p.BLOCKTIME+"[data-blocktime='"+c+"']").remove()}.bind(this)),0===this.messageArea.find(p.MESSAGE).length&&this.messageArea.find(p.CONVERSATIONS+" "+p.CONTACT+"[data-userid='"+this._getUserId()+"']").remove(),this.messageArea.trigger(k.MESSAGESDELETED,[this._getUserId(),b])}.bind(this))["catch"](d.exception):this.messageArea.trigger(k.MESSAGESDELETED,this._getUserId()),this._hideDeleteAction()},m.prototype._addScrollEventListener=function(a){this._scrollBottom(),this._numMessagesDisplayed=a,e.define(this.messageArea.find(p.MESSAGES),[e.events.scrollTop]),this.messageArea.onCustomEvent(e.events.scrollTop,this._loadMessages.bind(this))},m.prototype._deleteAllMessages=function(){if(this._confirmationModal)return void this._confirmationModal.show();var c=j.get_strings([{key:"confirm"},{key:"deleteallconfirm",component:"message"},{key:"delete"}]),e=h.create({type:h.types.SAVE_CANCEL},this.messageArea.find(p.DELETEALLMESSAGES));a.when(c,e).then(function(a,c){c.setTitle(a[0]),c.setBody(a[1]),c.setSaveButtonText(a[2]),this._confirmationModal=c,c.getRoot().on(i.save,function(){var a=this._getUserId(),c={methodname:"core_message_delete_conversation",args:{userid:this.messageArea.getCurrentUserId(),otheruserid:a}};b.call([c])[0].then(function(){this.messageArea.find(p.MESSAGESAREA).empty(),this.messageArea.trigger(k.CONVERSATIONDELETED,a),this._hideDeleteAction()}.bind(this))["catch"](d.exception)}.bind(this)),c.show()}.bind(this))["catch"](d.exception)},m.prototype._hideDeleteAction=function(){this.messageArea.find(p.MESSAGE).removeAttr("role").removeAttr("aria-checked"),this.messageArea.find(p.MESSAGESAREA).removeClass("editing")},m.prototype._triggerCancelMessagesToDelete=function(){this.messageArea.trigger(k.CANCELDELETEMESSAGES)},m.prototype._addMessagesToDom=function(b,d){var e=0,f=this.messageArea.find(p.MESSAGES);return b=b.filter(function(a){var b=""+a.id+a.isread;if(this._messageQueue[b])return!1;var c=f.find(p.MESSAGE+'[data-id="'+b+'"]');return c.length||(this._messageQueue[b]=!0),!c.length}.bind(this)),e=b.length,c.render("core_message/message_area_messages",{messages:b}).then(function(b,f){if(e>0){var g=a("<div>"+b+"</div>");this._hasMatchingBlockTime(this.messageArea.node,g,!1)&&g.find(p.BLOCKTIME+":first").remove(),c.appendNodeContents(this.messageArea.find(p.MESSAGES),g,f),d&&this._scrollBottom(),this._numMessagesDisplayed+=e,this._backoffTimer.restart()}}.bind(this))},m.prototype._addLastMessageToDom=function(){var a=b.call([{methodname:"core_message_data_for_messagearea_get_most_recent_message",args:{currentuserid:this.messageArea.getCurrentUserId(),otheruserid:this._getUserId()}}]);return a[0].then(function(a){return this._addMessagesToDom([a],!0)}.bind(this)).always(function(){this.messageArea.find(p.SENDMESSAGETEXT).val("").trigger("input")}.bind(this)).fail(d.exception)},m.prototype._getUserId=function(){return this.messageArea.find(p.MESSAGES).data("userid")},m.prototype._scrollBottom=function(){var a=this.messageArea.find(p.MESSAGES);0!==a.length&&a.scrollTop(a[0].scrollHeight)},m.prototype._selectPreviousMessage=function(b,c){var d=a(b.target).closest(p.MESSAGE);do d=d.prev();while(d.length&&!d.is(p.MESSAGE));d.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},m.prototype._selectNextMessage=function(b,c){var d=a(b.target).closest(p.MESSAGE);do d=d.next();while(d.length&&!d.is(p.MESSAGE));d.focus(),c.originalEvent.preventDefault(),c.originalEvent.stopPropagation()},m.prototype._setMessaging=function(b){a(b.target).closest(p.MESSAGERESPONSE).addClass("messaging")},m.prototype._clearMessaging=function(b){a(b.target).closest(p.MESSAGERESPONSE).removeClass("messaging")},m.prototype._startDeleting=function(a){var b=new g(this.messageArea);b.chooseMessagesToDelete(),a.preventDefault()},m.prototype._isEditing=function(){return this.messageArea.find(p.MESSAGESAREA).hasClass("editing")},m.prototype._toggleMessage=function(b){if(this._isEditing()){var c=a(b.target).closest(p.MESSAGE);"true"===c.attr("aria-checked")?c.attr("aria-checked","false"):c.attr("aria-checked","true")}},m.prototype._adjustMessagesAreaHeight=function(){var a=this.messageArea.find(p.MESSAGES),b=this.messageArea.find(p.MESSAGERESPONSE),c=b.outerHeight(),d=c-o,e=n-d;a.outerHeight(e)},m.prototype._sendMessageHandler=function(a,b){b.originalEvent.preventDefault(),this._sendMessage()},m.prototype._hideMessagingArea=function(){this.messageArea.find(p.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},m.prototype._hasMatchingBlockTime=function(a,b,c){var d,e,f,g;return c?(e=":first",g=":last"):(e=":last",g=":first"),d=a.find(p.BLOCKTIME+e),f=b.find(p.BLOCKTIME+g),!(!d.length||!f.length)&&d.data("blocktime")==f.data("blocktime")},m});
define('core_message/message_area_profile', ["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/custom_interaction_events","core_message/message_area_events"],function(a,b,c,d,e,f,g,h){function i(a){this.messageArea=a,this._init()}var j={PROFILE:"[data-region='profile']",PROFILEADDCONTACT:"[data-action='profile-add-contact']",PROFILEBLOCKCONTACT:"[data-action='profile-block-contact']",PROFILEREMOVECONTACT:"[data-action='profile-remove-contact']",PROFILESENDMESSAGE:"[data-action='profile-send-message']",PROFILEUNBLOCKCONTACT:"[data-action='profile-unblock-contact']",PROFILEVIEW:"[data-action='profile-view']",SHOWCONTACTS:"[data-action='show-contacts']",MESSAGESAREA:"[data-region='messages-area']",MESSAGINGAREA:"[data-region='messaging-area']"};return i.prototype.messageArea=null,i.prototype._init=function(){g.define(this.messageArea.node,[g.events.activate]),this.messageArea.onCustomEvent(h.CONTACTSELECTED,this._viewProfile.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEVIEW,function(a,b){this._viewFullProfile(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILESENDMESSAGE,function(a,b){this._sendMessage(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEUNBLOCKCONTACT,function(a,b){this._unblockContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEBLOCKCONTACT,function(a,b){this._blockContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEADDCONTACT,function(a,b){this._addContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.PROFILEREMOVECONTACT,function(a,b){this._removeContact(),b.originalEvent.preventDefault()}.bind(this)),this.messageArea.onDelegateEvent(g.events.activate,j.SHOWCONTACTS,this._hideMessagingArea.bind(this))},i.prototype._viewProfile=function(a,e){c.render("core/loading",{}).done(function(a,b){c.replaceNodeContents(this.messageArea.find(j.MESSAGESAREA),a,b)}.bind(this));var f=b.call([{methodname:"core_message_data_for_messagearea_get_profile",args:{currentuserid:this.messageArea.getCurrentUserId(),otheruserid:e}}]);return f[0].then(function(a){return c.render("core_message/message_area_profile",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(j.MESSAGESAREA),a,b)}.bind(this)).fail(d.exception)},i.prototype._viewFullProfile=function(){window.location.href=f.wwwroot+"/user/profile.php?id="+this._getUserId()},i.prototype._sendMessage=function(){this.messageArea.trigger(h.SENDMESSAGE,this._getUserId())},i.prototype._blockContact=function(){var a=this._performAction("core_message_block_contacts","unblockcontact","profile-block-contact","profile-unblock-contact","");return a.then(function(){this.messageArea.trigger(h.CONTACTBLOCKED,this._getUserId())}.bind(this))},i.prototype._unblockContact=function(){var a=this._performAction("core_message_unblock_contacts","blockcontact","profile-unblock-contact","profile-block-contact","danger");return a.then(function(){this.messageArea.trigger(h.CONTACTUNBLOCKED,this._getUserId())}.bind(this))},i.prototype._addContact=function(){var a=this._performAction("core_message_create_contacts","removecontact","profile-add-contact","profile-remove-contact","danger");return a.then(function(){this.messageArea.trigger(h.CONTACTADDED,this._getUserId())}.bind(this))},i.prototype._removeContact=function(){var a=this._performAction("core_message_delete_contacts","addcontact","profile-remove-contact","profile-add-contact","");return a.then(function(){this.messageArea.trigger(h.CONTACTREMOVED,this._getUserId())}.bind(this))},i.prototype._performAction=function(a,c,f,g,h){var i=b.call([{methodname:a,args:{userid:this.messageArea.getCurrentUserId(),userids:[this._getUserId()]}}]);return i[0].then(function(){return e.get_string(c,"message")}).then(function(a){this._changeText(a,f,g,h)}.bind(this)).fail(d.exception)},i.prototype._changeText=function(a,b,c,d){var e=this.messageArea.find("[data-action='"+b+"']");e.text(a),e.removeClass(),d&&e.addClass(d),e.attr("data-action",c)},i.prototype._getUserId=function(){return this.messageArea.find(j.PROFILE).data("userid")},i.prototype._hideMessagingArea=function(){this.messageArea.find(j.MESSAGINGAREA).removeClass("show-messages").addClass("hide-messages")},i});
define('core_message/message_area_search', ["jquery","core/ajax","core/templates","core/notification","core/str","core/custom_interaction_events","core_message/message_area_events"],function(a,b,c,d,e,f,g){function h(a){this.messageArea=a,this._init()}var i={CONTACTS:"[data-region='contacts'][data-region-content='contacts']",CONTACTSAREA:"[data-region='contacts-area']",CONVERSATIONS:"[data-region='contacts'][data-region-content='conversations']",DELETESEARCHFILTER:"[data-region='search-filter-area']",LOADINGICON:".loading-icon",SEARCHBOX:"[data-region='search-box']",SEARCHFILTER:"[data-region='search-filter']",SEARCHFILTERAREA:"[data-region='search-filter-area']",SEARCHRESULTSAREA:"[data-region='search-results-area']",SEARCHTEXTAREA:"[data-region='search-text-area']",SEARCHUSERSINCOURSE:"[data-action='search-users-in-course']"};return h.prototype.messageArea=null,h.prototype._searchArea=null,h.prototype._courseid=null,h.prototype._isLoading=!1,h.prototype._numMessagesDisplayed=0,h.prototype._numMessagesToRetrieve=20,h.prototype._numUsersDisplayed=0,h.prototype._numUsersToRetrieve=20,h.prototype._searchAreas={MESSAGES:"messages",USERS:"users",USERSINCOURSE:"usersincourse"},h.prototype._requestTimeout=null,h.prototype._init=function(){this.messageArea.find(i.SEARCHTEXTAREA).on("input",this._searchRequest.bind(this)),this.messageArea.onDelegateEvent(f.events.activate,i.SEARCHUSERSINCOURSE,function(b){this._setFilter(a(b.currentTarget).html()),this._setPlaceholderText("searchforuser"),this._clearSearchArea(),this._searchArea=this._searchAreas.USERSINCOURSE,this._courseid=a(b.currentTarget).data("courseid"),this._searchUsersInCourse(),this.messageArea.find(i.SEARCHBOX).focus()}.bind(this)),this.messageArea.onDelegateEvent(f.events.activate,i.DELETESEARCHFILTER,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.USERS,this._setPlaceholderText("searchforuserorcourse"),this.messageArea.trigger(g.USERSSEARCHCANCELED),this.messageArea.find(i.SEARCHBOX).focus()}.bind(this)),this.messageArea.onCustomEvent(g.CONVERSATIONSSELECTED,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.MESSAGES,this._setPlaceholderText("searchmessages")}.bind(this)),this.messageArea.onCustomEvent(g.CONTACTSSELECTED,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.USERS,this._setPlaceholderText("searchforuserorcourse")}.bind(this)),this.messageArea.onCustomEvent(g.MESSAGESENT,function(){this._hideSearchResults(),this._searchArea=this._searchAreas.MESSAGES,this._setPlaceholderText("searchmessages")}.bind(this)),f.define(this.messageArea.find(i.SEARCHRESULTSAREA),[f.events.scrollBottom]),this.messageArea.onDelegateEvent(f.events.scrollBottom,i.SEARCHRESULTSAREA,function(){this._searchArea==this._searchAreas.MESSAGES?this._searchMessages():this._searchArea==this._searchAreas.USERSINCOURSE&&this._searchUsersInCourse()}.bind(this)),this._searchArea=this.messageArea.showContactsFirst()?this._searchAreas.USERS:this._searchAreas.MESSAGES},h.prototype._searchRequest=function(){var a=this.messageArea.find(i.SEARCHTEXTAREA+" input").val();return this._requestTimeout&&clearTimeout(this._requestTimeout),""===a.trim()?void(this._searchArea==this._searchAreas.MESSAGES?(this._hideSearchResults(),this.messageArea.trigger(g.MESSAGESEARCHCANCELED)):this._searchArea==this._searchAreas.USERS?(this._hideSearchResults(),this.messageArea.trigger(g.USERSSEARCHCANCELED)):this._searchArea==this._searchAreas.USERSINCOURSE&&(this._clearSearchArea(),this._searchUsersInCourse())):(this.messageArea.find(i.CONVERSATIONS).hide(),this.messageArea.find(i.CONTACTS).hide(),this.messageArea.find(i.SEARCHRESULTSAREA).show(),void(this._searchArea==this._searchAreas.MESSAGES?this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numMessagesDisplayed=0,this._searchMessages()}.bind(this),300):this._searchArea==this._searchAreas.USERSINCOURSE?this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numUsersDisplayed=0,this._searchUsersInCourse()}.bind(this),300):this._requestTimeout=setTimeout(function(){this._clearSearchArea(),this._numUsersDisplayed=0,this._searchUsers()}.bind(this),300)))},h.prototype._searchMessages=function(){if(this._isLoading)return!1;var a=this.messageArea.find(i.SEARCHBOX).val();this._isLoading=!0;var e=b.call([{methodname:"core_message_data_for_messagearea_search_messages",args:{userid:this.messageArea.getCurrentUserId(),search:a,limitfrom:this._numMessagesDisplayed,limitnum:this._numMessagesToRetrieve}}]),f=0;return c.render("core/loading",{}).then(function(a,b){return c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return f=a.contacts.length,c.render("core_message/message_area_message_search_results",a)}).then(function(a,b){this.messageArea.find(i.SEARCHRESULTSAREA+" "+i.LOADINGICON).remove(),f>0?(c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._numMessagesDisplayed+=f):0==this._numMessagesDisplayed&&c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._isLoading=!1}.bind(this)).fail(d.exception)},h.prototype._searchUsers=function(){var a=this.messageArea.find(i.SEARCHBOX).val(),e=b.call([{methodname:"core_message_data_for_messagearea_search_users",args:{userid:this.messageArea.getCurrentUserId(),search:a,limitnum:this._numUsersToRetrieve}}]);return c.render("core/loading",{}).then(function(a,b){return c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return a.contacts.length>0&&(a.hascontacts=!0),a.courses.length>0&&(a.hascourses=!0),a.noncontacts.length>0&&(a.hasnoncontacts=!0),c.render("core_message/message_area_user_search_results",a)}).then(function(a,b){c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b)}.bind(this)).fail(d.exception)},h.prototype._searchUsersInCourse=function(){if(this._isLoading)return!1;var a=this.messageArea.find(i.SEARCHBOX).val();this._isLoading=!0;var e=b.call([{methodname:"core_message_data_for_messagearea_search_users_in_course",args:{userid:this.messageArea.getCurrentUserId(),courseid:this._courseid,search:a,limitfrom:this._numUsersDisplayed,limitnum:this._numUsersToRetrieve}}]),f=0;return c.render("core/loading",{}).then(function(a,b){return c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),"<div style='text-align:center'>"+a+"</div>",b),e[0]}.bind(this)).then(function(a){return f=a.contacts.length,f>0&&(a.hascontacts=!0),c.render("core_message/message_area_user_search_results",a)}).then(function(a,b){this.messageArea.find(i.SEARCHRESULTSAREA+" "+i.LOADINGICON).remove(),f>0?(c.appendNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._numUsersDisplayed+=f):0==this._numUsersDisplayed&&c.replaceNodeContents(this.messageArea.find(i.SEARCHRESULTSAREA),a,b),this._isLoading=!1}.bind(this)).fail(d.exception)},h.prototype._setPlaceholderText=function(a){return e.get_string(a,"message").then(function(a){this.messageArea.find(i.SEARCHTEXTAREA+" input").attr("placeholder",a)}.bind(this))},h.prototype._setFilter=function(a){this.messageArea.find(i.SEARCHBOX).val(""),this.messageArea.find(i.CONTACTSAREA).addClass("searchfilter"),this.messageArea.find(i.SEARCHFILTERAREA).show(),this.messageArea.find(i.SEARCHFILTER).html(a),e.get_string("removecoursefilter","message",a).then(function(a){this.messageArea.find(i.SEARCHFILTERAREA).attr("aria-label",a)}.bind(this))["catch"](d.exception)},h.prototype._clearFilters=function(){this.messageArea.find(i.CONTACTSAREA).removeClass("searchfilter"),this.messageArea.find(i.SEARCHFILTER).empty(),this.messageArea.find(i.SEARCHFILTERAREA).hide(),this.messageArea.find(i.SEARCHFILTERAREA).removeAttr("aria-label")},h.prototype._clearSearchArea=function(){this.messageArea.find(i.SEARCHRESULTSAREA).empty()},h.prototype._hideSearchResults=function(){this._clearFilters(),this.messageArea.find(i.SEARCHTEXTAREA+" input").val(""),this._clearSearchArea(),this.messageArea.find(i.SEARCHRESULTSAREA).hide()},h});
define('core_message/message_area_tabs', ["core/custom_interaction_events","core_message/message_area_events"],function(a,b){function c(a){this.messageArea=a,this._init()}var d={ACTIVECONTACTSTAB:"[data-region='contacts-area'] [role='tab'][aria-selected='true']",CONTACTSPANELS:"[data-region='contacts']",VIEWCONTACTS:"[data-action='contacts-view']",VIEWCONVERSATIONS:"[data-action='conversations-view']"};return c.prototype.messageArea=null,c.prototype._init=function(){a.define(this.messageArea.node,[a.events.activate,a.events.up,a.events.down,a.events.next,a.events.previous,a.events.ctrlPageUp,a.events.ctrlPageDown]),this.messageArea.onDelegateEvent(a.events.activate,d.VIEWCONVERSATIONS,this._viewConversations.bind(this)),this.messageArea.onDelegateEvent(a.events.activate,d.VIEWCONTACTS,this._viewContacts.bind(this)),this.messageArea.onDelegateEvent(a.events.up,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.down,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.next,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.previous,d.VIEWCONVERSATIONS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.up,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.down,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.next,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.previous,d.VIEWCONTACTS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.ctrlPageUp,d.CONTACTSPANELS,this._toggleTabs.bind(this)),this.messageArea.onDelegateEvent(a.events.ctrlPageDown,d.CONTACTSPANELS,this._toggleTabs.bind(this)),this.messageArea.onCustomEvent(b.MESSAGESENT,function(){this._selectTab(d.VIEWCONVERSATIONS,d.VIEWCONTACTS)}.bind(this))},c.prototype._viewConversations=function(){this.messageArea.trigger(b.CONVERSATIONSSELECTED),this._selectTab(d.VIEWCONVERSATIONS,d.VIEWCONTACTS)},c.prototype._viewContacts=function(){this.messageArea.trigger(b.CONTACTSSELECTED),this._selectTab(d.VIEWCONTACTS,d.VIEWCONVERSATIONS)},c.prototype._selectTab=function(a,b){b=this.messageArea.find(b),b.removeClass("selected"),b.attr("aria-selected","false"),b.attr("tabindex","-1"),a=this.messageArea.find(a),a.addClass("selected"),a.attr("aria-selected","true"),a.attr("tabindex","0")},c.prototype._toggleTabs=function(a,b){var c=this.messageArea.find(d.ACTIVECONTACTSTAB);c.is(d.VIEWCONVERSATIONS)?this._viewContacts():this._viewConversations(),this.messageArea.find(d.ACTIVECONTACTSTAB).focus(),a.preventDefault(),a.stopPropagation(),b.originalEvent.preventDefault(),b.originalEvent.stopPropagation()},c});
define('core_message/message_notification_preference', ["jquery","core_message/notification_preference"],function(a,b){var c={PREFERENCE_KEY:"[data-preference-key]"},d=function(a,c){b.call(this,a,c)};return d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.getPreferenceKey=function(){return this.root.find(c.PREFERENCE_KEY).attr("data-preference-key")},d});
define('core_message/message_preferences', ["jquery","core/ajax","core/notification","core_message/message_notification_preference","core/custom_interaction_events"],function(a,b,c,d,e){var f={PREFERENCE:"[data-state]",PREFERENCES_CONTAINER:'[data-region="preferences-container"]',BLOCK_NON_CONTACTS:'[data-region="block-non-contacts-container"] [data-block-non-contacts]',BLOCK_NON_CONTACTS_CONTAINER:'[data-region="block-non-contacts-container"]'},g=function(b){this.root=a(b),this.userId=this.root.find(f.PREFERENCES_CONTAINER).attr("data-user-id"),this.registerEventListeners()};return g.prototype.preferencesDisabled=function(){return this.root.find(f.PREFERENCES_CONTAINER).hasClass("disabled")},g.prototype.saveBlockNonContactsStatus=function(){var d=this.root.find(f.BLOCK_NON_CONTACTS),e=this.root.find(f.BLOCK_NON_CONTACTS_CONTAINER),g=d.prop("checked");if(e.hasClass("loading"))return a.Deferred().resolve();e.addClass("loading");var h={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:d.attr("data-preference-key"),value:g?1:0}]}};return b.call([h])[0].fail(c.exception).always(function(){e.removeClass("loading")})},g.prototype.registerEventListeners=function(){e.define(this.root,[e.events.activate]),this.root.on(e.events.activate,f.BLOCK_NON_CONTACTS,function(){this.saveBlockNonContactsStatus()}.bind(this)),this.root.on("change",function(b){if(!this.preferencesDisabled()){var c=a(b.target).closest(f.PREFERENCES_CONTAINER),e=a(b.target).closest(f.PREFERENCE),g=new d(c,this.userId);e.addClass("loading"),g.save().always(function(){e.removeClass("loading")})}}.bind(this))},g});
define('core_message/message_repository', ["jquery","core/ajax","core/notification"],function(a,b,c){var d=function(a){"undefined"==typeof a.limit&&(a.limit=0),"undefined"==typeof a.offset&&(a.offset=0),a.limitfrom=a.offset,a.limitnum=a.limit,delete a.limit,delete a.offset;var d={methodname:"core_message_data_for_messagearea_conversations",args:a},e=b.call([d])[0];return e.fail(c.exception),e},e=function(a){var d={methodname:"core_message_get_unread_conversations_count",args:a},e=b.call([d])[0];return e.fail(c.exception),e},f=function(a){var d={methodname:"core_message_mark_all_messages_as_read",args:a},e=b.call([d])[0];return e.fail(c.exception),e};return{query:d,countUnreadConversations:e,markAllAsRead:f}});
define('core_message/notification_preference', ["jquery","core/ajax","core/notification","core_message/notification_processor"],function(a,b,c,d){var e={PROCESSOR:"[data-processor-name]",STATE_INPUTS:"[data-state] input"},f=function(b,c){this.root=a(b),this.userId=c};return f.prototype.getPreferenceKey=function(){return this.root.attr("data-preference-key")},f.prototype.getLoggedInPreferenceKey=function(){return this.getPreferenceKey()+"_loggedin"},f.prototype.getLoggedOffPreferenceKey=function(){return this.getPreferenceKey()+"_loggedoff"},f.prototype.getProcessors=function(){return this.root.find(e.PROCESSOR).map(function(b,c){return new d(a(c))})},f.prototype.startLoading=function(){this.root.addClass("loading"),this.root.find(e.STATE_INPUTS).prop("disabled",!0)},f.prototype.stopLoading=function(){this.root.removeClass("loading"),this.root.find(e.STATE_INPUTS).prop("disabled",!1)},f.prototype.isLoading=function(){return this.root.hasClass("loading")},f.prototype.save=function(){if(this.isLoading())return a.Deferred().resolve();this.startLoading();var d="",e="";this.getProcessors().each(function(a,b){b.isLoggedInEnabled()&&(""===d?d=b.getName():d+=","+b.getName()),b.isLoggedOffEnabled()&&(""===e?e=b.getName():e+=","+b.getName())}),""===d&&(d="none"),""===e&&(e="none");var f={userid:this.userId,preferences:[{type:this.getLoggedInPreferenceKey(),value:d},{type:this.getLoggedOffPreferenceKey(),value:e}]},g={methodname:"core_user_update_user_preferences",args:f};return b.call([g])[0].fail(c.exception).always(function(){this.stopLoading()}.bind(this))},f});
define('core_message/notification_processor', ["jquery"],function(a){var b={STATE_NONE:'[data-state="none"]',STATE_BOTH:'[data-state="both"]',STATE_LOGGED_IN:'[data-state="loggedin"]',STATE_LOGGED_OFF:'[data-state="loggedoff"]'},c=function(b){this.root=a(b)};return c.prototype.getName=function(){return this.root.attr("data-processor-name")},c.prototype.isLoggedInEnabled=function(){var a=this.root.find(b.STATE_NONE).find("input");if(a.prop("checked"))return!1;var c=this.root.find(b.STATE_BOTH).find("input"),d=this.root.find(b.STATE_LOGGED_IN).find("input");return d.prop("checked")||c.prop("checked")},c.prototype.isLoggedOffEnabled=function(){var a=this.root.find(b.STATE_NONE).find("input");if(a.prop("checked"))return!1;var c=this.root.find(b.STATE_BOTH).find("input"),d=this.root.find(b.STATE_LOGGED_OFF).find("input");return d.prop("checked")||c.prop("checked")},c});
define('core_message/notification_processor_settings', ["jquery","core/ajax","core/notification","core/fragment","core/templates","core/str","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h={PROCESSOR:"[data-processor-name]",PREFERENCE_ROW:'[data-region="preference-row"]'},i=function(b){this.root=a(b),this.name=this.root.attr("data-name"),this.userId=this.root.attr("data-user-id"),this.contextId=this.root.attr("data-context-id")};return i.prototype.show=function(){d.loadFragment("message","processor_settings",this.contextId,{userid:this.userId,type:this.name}).done(function(b,c){f.get_string("processorsettings","message").done(function(d){var f=new g(d,b,function(){e.runTemplateJS(c)},function(){f.close()});a(document).on("mpp:formsubmitted",function(){f.close(),this.updateConfiguredStatus()}.bind(this)),a(document).on("mpp:formcancelled",function(){f.close()})}.bind(this))}.bind(this))},i.prototype.updateConfiguredStatus=function(){var d=this.root.closest(h.PROCESSOR);if(!d.hasClass("unconfigured"))return!1;var e=d.attr("data-processor-name"),f={methodname:"core_message_get_message_processor",args:{name:e,userid:this.userId}};return b.call([f])[0].fail(c.exception).done(function(b){if(b.userconfigured){var c=a(h.PREFERENCE_ROW+' [data-processor-name="'+e+'"]');d.removeClass("unconfigured"),c.removeClass("disabled")}})},i});
define('core_message/preferences_notifications_list_controller', ["jquery","core/ajax","core/notification","core/custom_interaction_events","core_message/notification_preference","core_message/notification_processor_settings"],function(a,b,c,d,e,f){var g={DISABLE_NOTIFICATIONS:'[data-region="disable-notification-container"] [data-disable-notifications]',DISABLE_NOTIFICATIONS_CONTAINER:'[data-region="disable-notification-container"]',PREFERENCE:"[data-state]",PREFERENCE_ROW:'[data-region="preference-row"]',PREFERENCE_INPUT:"[data-state] input",PROCESSOR_SETTING:"[data-processor-setting]"},h=function(b){this.root=a(b),this.userId=this.root.attr("data-user-id"),this.registerEventListeners()};return h.prototype.isDisabled=function(){return this.root.hasClass("disabled")},h.prototype.setDisabled=function(){this.root.addClass("disabled"),this.root.find(g.PREFERENCE_INPUT).prop("disabled",!0)},h.prototype.setEnabled=function(){this.root.removeClass("disabled"),this.root.find(g.PREFERENCE_INPUT).prop("disabled",!1)},h.prototype.toggleDisableAllStatus=function(){var d=a(g.DISABLE_NOTIFICATIONS),e=a(g.DISABLE_NOTIFICATIONS_CONTAINER),f=d.prop("checked");if(e.hasClass("loading"))return a.Deferred().resolve();e.addClass("loading");var h={methodname:"core_user_update_user_preferences",args:{userid:this.userId,emailstop:f?1:0}};return b.call([h])[0].done(function(){f?this.setDisabled():this.setEnabled()}.bind(this)).always(function(){e.removeClass("loading")}).fail(c.exception)},h.prototype.registerEventListeners=function(){var b=a(g.DISABLE_NOTIFICATIONS);d.define(this.root,[d.events.activate]),this.root.on("change",function(b){if(!this.isDisabled()){var c=a(b.target).closest(g.PREFERENCE),d=a(b.target).closest(g.PREFERENCE_ROW),f=new e(d,this.userId);c.addClass("loading"),f.save().always(function(){c.removeClass("loading")})}}.bind(this)),this.root.on(d.events.activate,g.PROCESSOR_SETTING,function(b,c){var d=a(b.target).closest(g.PROCESSOR_SETTING),e=new f(d);e.show(),c.originalEvent.preventDefault()}),d.define(b,[d.events.activate]),b.on(d.events.activate,function(){this.toggleDisableAllStatus()}.bind(this))},h});
define('core_message/preferences_processor_form', ["jquery","core/ajax","core/notification","core/custom_interaction_events"],function(a,b,c,d){var e=function(b){this.root=a(b),this.userId=this.root.attr("data-user-id"),this.name=this.root.attr("data-processor-name"),this.root.find("form").on("submit",function(b){b.preventDefault(),this.save().done(function(){a(document).trigger("mpp:formsubmitted")})}.bind(this));var c=this.root.find("[data-cancel-button]");d.define(c,[d.events.activate]),c.on(d.events.activate,function(){a(document).trigger("mpp:formcancelled")})};return e.prototype.startLoading=function(){this.root.addClass("loading")},e.prototype.stopLoading=function(){this.root.removeClass("loading")},e.prototype.isLoading=function(){return this.root.hasClass("loading")},e.prototype.save=function(){if(this.isLoading())return a.Deferred();this.startLoading();var d=this.root.find("form").serializeArray(),e={methodname:"core_message_message_processor_config_form",args:{userid:this.userId,name:this.name,formvalues:d}};return b.call([e])[0].fail(c.exception).always(function(){this.stopLoading()}.bind(this))},e});
define('core_message/toggle_contact_button', ["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events"],function(a,b,c,d,e){var f=function(a){return"1"==a.attr("data-is-contact")},g=function(a){a.attr("data-is-contact","1")},h=function(a){a.attr("data-is-contact","0")},i=function(a){return a.attr("data-userid")},j=function(a){return a.hasClass("loading")||a.attr("disabled")},k=function(c,e){return j(c)?a.Deferred():(c.addClass("loading"),c.attr("disabled","disabled"),b.call([e])[0].fail(d.exception).always(function(){c.removeClass("loading"),c.removeAttr("disabled")}))},l=function(a){if(!j(a)){var b={methodname:"core_message_create_contacts",args:{userids:[i(a)]}};k(a,b).done(function(){g(a),c.render("message/remove_contact_button",{}).done(function(b,d){c.replaceNodeContents(a,b,d)})})}},m=function(a){if(!j(a)){var b={methodname:"core_message_delete_contacts",args:{userids:[i(a)]}};k(a,b).done(function(){h(a),c.render("message/add_contact_button",{}).done(function(b,d){c.replaceNodeContents(a,b,d)})})}},n=function(b){b=a(b),b.children(".loading-icon").length||c.render("core/loading",{}).done(function(a,c){b.append(a,c)}),e.define(b,[e.events.activate]),b.on(e.events.activate,function(a,c){f(b)?m(b):l(b),a.preventDefault(),c.originalEvent.preventDefault()})};return{enhance:n}});
define('core_question/edit_tags', ["jquery","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/custom_interaction_events","core_question/repository","core_question/selectors"],function(a,b,c,d,e,f,g,h,i){var j=function(a){a.find(i.actions.save).prop("disabled",!1)},k=function(a){a.find(i.actions.save).prop("disabled",!0)},l=function(a){return a.getBody().find("form").serialize()},m=function(a){var b=a.find(i.containers.loadingIcon);b.removeClass("hidden")},n=function(a){var b=a.find(i.containers.loadingIcon);b.addClass("hidden")},o=function(a,b){a.getBody().attr("data-contextid",b)},p=function(a){return a.getBody().data("contextid")},q=function(a,b){a.getBody().attr("data-questionid",b)},r=function(a){return a.getBody().data("questionid")},s=function(h){var l=e.create({type:e.types.SAVE_CANCEL,large:!1},[h,i.actions.edittags]).then(function(a){return c.get_string("questiontags","question").then(function(b){return a.setTitle(b),b}).fail(f.exception),a.getRoot().on(d.save,function(b){var c=a.getBody().find("form");c.submit(),b.preventDefault()}),a.getRoot().on("submit","form",function(b){t(a,h).then(function(){a.hide(),location.reload()}).fail(f.exception),b.preventDefault(),b.stopPropagation()}),a});h.on(g.events.activate,i.actions.edittags,function(c){var d=a(c.currentTarget),e=d.data("questionid"),g=!!d.data("cantag"),p=d.data("contextid");l.then(function(a){k(h),m(h);var c={id:e},d=b.loadFragment("question","tags_form",p,c);return a.setBody(d),d.then(function(){j(h)}).always(function(){n(h)}).fail(f.exception),g?a.getRoot().find(i.actions.save).show():a.getRoot().find(i.actions.save).hide(),q(a,e),o(a,p),a}).fail(f.exception),c.preventDefault()})},t=function(a,b){k(b),m(b);var c=l(a),d=r(a),e=p(a);return h.submitTagCreateUpdateForm(d,e,c).always(function(){n(b),j(b)}).fail(f.exception)};return{init:function(b){b=a(b),s(b)}}});
define('core_question/repository', ["jquery","core/ajax"],function(a,b){var c=function(a,c,d){var e={methodname:"core_question_submit_tags_form",args:{questionid:a,contextid:c,formdata:d}};return b.call([e])[0]};return{submitTagCreateUpdateForm:c}});
define('core_question/selectors', [],function(){return{actions:{save:'[data-action="save"]',edittags:'[data-action="edittags"]'},containers:{loadingIcon:'[data-region="overlay-icon-container"]'}}});
define('core_search/form-search-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i={query:e},j=a(d).attr("withincourseid");"undefined"!=typeof j&&""!==a("#id_searchwithin").val()?i.courseid=j:i.courseid=0,h=b.call([{methodname:"core_search_get_relevant_users",args:i}]),h[0].then(function(b){var d=[];return a.each(b,function(a,b){d.push(c.render("core_search/form-user-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments,d=0;a.each(b,function(a,b){b._label=c[d++]}),f(b)})}).fail(g)}}});
define('core_user/participants', ["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){var h={BULKACTIONSELECT:"#formactionid",BULKUSERCHECKBOXES:"input.usercheckbox",BULKUSERNOSCHECKBOXES:"input.usercheckbox[value='0']",BULKUSERSELECTEDCHECKBOXES:"input.usercheckbox:checked",BULKACTIONFORM:"#participantsform",CHECKALLBUTTON:"#checkall",CHECKALLNOSBUTTON:"#checkallnos",CHECKALLONPAGEBUTTON:"#checkallonpage",CHECKNONEBUTTON:"#checknone"},i=function(a){this.courseId=a.courseid,this.noteStateNames=a.noteStateNames,this.stateHelpIcon=a.stateHelpIcon,this.attachEventListeners()};return i.prototype.modal=null,i.prototype.courseId=-1,i.prototype.noteStateNames={},i.prototype.stateHelpIcon="",i.prototype.attachEventListeners=function(){a(h.BULKACTIONSELECT).on("change",function(b){var c=a(b.target).val();if(c.indexOf("#")!==-1){b.preventDefault();var d=[];a(h.BULKUSERSELECTEDCHECKBOXES).each(function(b,c){var e=a(c).attr("name"),f=e.replace("user","");d.push(f)}),"#messageselect"==c?this.showSendMessage(d).fail(f.exception):"#addgroupnote"==c&&this.showAddNote(d).fail(f.exception),a(h.BULKACTIONSELECT+' option[value=""]').prop("selected","selected")}else""!==c&&(a(h.BULKUSERSELECTEDCHECKBOXES).length>0?a(h.BULKACTIONFORM).submit():a(h.BULKACTIONSELECT+' option[value=""]').prop("selected","selected"))}.bind(this)),a(h.CHECKALLBUTTON).on("click",function(){var b=a(this).data("showallink");b&&(window.location=b)}),a(h.CHECKALLNOSBUTTON).on("click",function(){a(h.BULKUSERNOSCHECKBOXES).prop("checked",!0)}),a(h.CHECKALLONPAGEBUTTON).on("click",function(){a(h.BULKUSERCHECKBOXES).prop("checked",!0)}),a(h.CHECKNONEBUTTON).on("click",function(){a(h.BULKUSERCHECKBOXES).prop("checked",!1)})},i.prototype.showAddNote=function(f){if(0==f.length)return a.Deferred().resolve().promise();var g=[];for(var i in this.noteStateNames)switch(i){case"draft":g.push({value:"personal",label:this.noteStateNames[i]});break;case"public":g.push({value:"course",label:this.noteStateNames[i],selected:1});break;case"site":g.push({value:i,label:this.noteStateNames[i]})}var j={stateNames:g,stateHelpIcon:this.stateHelpIcon},k=null;return k=1==f.length?b.get_string("addbulknotesingle","core_notes"):b.get_string("addbulknote","core_notes",f.length),a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("core_user/add_bulk_note",j)}),k).then(function(b,c){return this.modal=b,this.modal.setTitle(c),this.modal.setSaveButtonText(c),this.modal.getRoot().on(d.hidden,function(){var b=a("#user-notifications [role=alert]");b.length?b.focus():a(h.BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(d.save,this.submitAddNote.bind(this,f)),this.modal.show(),this.modal}.bind(this))},i.prototype.submitAddNote=function(a){var c=this.modal.getRoot().find("form textarea").val(),d=this.modal.getRoot().find("form select").val(),e=[],h=0;for(h=0;h<a.length;h++)e.push({userid:a[h],text:c,courseid:this.courseId,publishstate:d});return g.call([{methodname:"core_notes_create_notes",args:{notes:e}}])[0].then(function(a){return 1==a.length?b.get_string("addbulknotedonesingle","core_notes"):b.get_string("addbulknotedone","core_notes",a.length)}).then(function(a){return f.addNotification({message:a,type:"success"}),!0})["catch"](f.exception)},i.prototype.showSendMessage=function(f){if(0==f.length)return a.Deferred().resolve().promise();var g=null;return g=1==f.length?b.get_string("sendbulkmessagesingle","core_message"):b.get_string("sendbulkmessage","core_message",f.length),a.when(c.create({type:c.types.SAVE_CANCEL,body:e.render("core_user/send_bulk_message",{})}),g).then(function(b,c){return this.modal=b,this.modal.setTitle(c),this.modal.setSaveButtonText(c),this.modal.getRoot().on(d.hidden,function(){a(h.BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(d.save,this.submitSendMessage.bind(this,f)),this.modal.show(),this.modal}.bind(this))},i.prototype.submitSendMessage=function(a){var c=this.modal.getRoot().find("form textarea").val(),d=[],e=0;for(e=0;e<a.length;e++)d.push({touserid:a[e],text:c});return g.call([{methodname:"core_message_send_instant_messages",args:{messages:d}}])[0].then(function(a){return 1==a.length?b.get_string("sendbulkmessagesentsingle","core_message"):b.get_string("sendbulkmessagesent","core_message",a.length)}).then(function(a){return f.addNotification({message:a,type:"success"}),!0})["catch"](f.exception)},{init:function(a){return new i(a)}}});
define('core_user/status_field', ["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment","core/ajax"],function(a,b,c,d,e,f,g,h,i){var j={EDIT_ENROLMENT:'[data-action="editenrolment"]',SHOW_DETAILS:'[data-action="showdetails"]',UNENROL:'[data-action="unenrol"]'},k=function(a){this.contextid=a.contextid,this.courseid=a.courseid,this.bindEditEnrol(),this.bindUnenrol(),this.bindStatusDetails()};return k.prototype.courseid=0,k.prototype.bindEditEnrol=function(){var a=this;b(j.EDIT_ENROLMENT).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),j=i.data("fullname"),k=h.attr("rel");b.when(c.get_string("edituserenrolment","enrol",j)).then(function(a){return f.create({large:!0,title:a,type:f.types.SAVE_CANCEL})}).done(function(b){b.getRoot().on(g.save,function(c){c.preventDefault(),a.submitEditFormAjax(b)}),b.getRoot().on(g.hidden,function(){b.destroy()}),b.setBody(a.getBody(k)),b.show()}).fail(e.exception)})},k.prototype.bindUnenrol=function(){var a=this;b(j.UNENROL).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),j=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:i.data("fullname"),course:i.data("coursename"),enrolinstancename:i.data("enrolinstancename")}}],k=f.create({type:f.types.SAVE_CANCEL});b.when(c.get_strings(j),k).done(function(c,e){var f=c[0],i=c[1];e.setTitle(f),e.setBody(i),e.setSaveButtonText(f),e.getRoot().on(g.save,function(){var c={ueid:b(h).attr("rel")};d.preventDefault(),a.submitUnenrolFormAjax(e,c)}),e.getRoot().on(g.hidden,function(){e.destroy()}),e.show()}).fail(e.exception)})},k.prototype.bindStatusDetails=function(){b(j.SHOW_DETAILS).click(function(d){d.preventDefault();var h=b(this),i=h.parent(),k={fullname:i.data("fullname"),coursename:i.data("coursename"),enrolinstancename:i.data("enrolinstancename"),status:i.data("status"),statusclass:i.find("span").attr("class"),timestart:i.data("timestart"),timeend:i.data("timeend")},l=[{key:"enroldetails",component:"enrol"}],m=h.next(j.EDIT_ENROLMENT);m.length&&(k.editenrollink=b("<div>").append(m.clone()).html());var n=c.get_strings(l),o=f.create({large:!0,type:f.types.CANCEL});b.when(n,o).done(function(c,d){var e=a.render("core_user/status_details",k);d.setTitle(c[0]),d.setBody(e),m.length&&d.getRoot().on("click",j.EDIT_ENROLMENT,function(a){a.preventDefault(),d.hide(),b(m).trigger("click")}),d.show(),d.getRoot().on(g.hidden,function(){d.destroy()})}).fail(e.exception)})},k.prototype.submitEditFormAjax=function(a){var c=this,d=a.getRoot().find("form"),f=b(d).find('[name="ue"]').val(),g=b(d).find('[name="status"]').val(),h={courseid:this.courseid,ueid:f,status:g},j=b(d).find('[name="timestart[enabled]"]');if(j.is(":checked")){var k=b(d).find('[name="timestart[year]"]').val(),l=b(d).find('[name="timestart[month]"]').val()-1,m=b(d).find('[name="timestart[day]"]').val(),n=b(d).find('[name="timestart[hour]"]').val(),o=b(d).find('[name="timestart[minute]"]').val(),p=new Date(k,l,m,n,o);h.timestart=p.getTime()/1e3}var q=b(d).find('[name="timeend[enabled]"]');if(q.is(":checked")){var r=b(d).find('[name="timeend[year]"]').val(),s=b(d).find('[name="timeend[month]"]').val()-1,t=b(d).find('[name="timeend[day]"]').val(),u=b(d).find('[name="timeend[hour]"]').val(),v=b(d).find('[name="timeend[minute]"]').val(),w=new Date(r,s,t,u,v);h.timeend=w.getTime()/1e3}var x={methodname:"core_enrol_edit_user_enrolment",args:h};i.call([x])[0].done(function(b){if(b.result)a.hide(),"undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload();else{var e=JSON.stringify(d.serialize());a.setBody(c.getBody(f,e))}}).fail(e.exception)},k.prototype.submitUnenrolFormAjax=function(a,b){var c={methodname:"core_enrol_unenrol_user_enrolment",args:b};i.call([c])[0].done(function(b){b.result?(a.hide(),"undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload()):e.alert(b.errors[0].key,b.errors[0].message)}).fail(e.exception)},k.prototype.getBody=function(a,b){var c={ueid:a};return"undefined"!=typeof b&&(c.formdata=b),h.loadFragment("enrol","user_enrolment_form",this.contextid,c).fail(e.exception)},{init:function(a){new k(a)}}});
define('core_user/unified_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={UNIFIED_FILTERS:"#unified-filters"},f=function(){var f=[{key:"userfilterplaceholder",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}];M.util.js_pending("unified_filter_datasource"),c.get_strings(f).done(function(a){var c=a[0],f=a[1];b.enhance(e.UNIFIED_FILTERS,!0,"core_user/unified_filter_datasource",c,!1,!0,f,!0).then(function(){M.util.js_complete("unified_filter_datasource")}).fail(d.exception)}).fail(d.exception);var g=a(e.UNIFIED_FILTERS).val();a(e.UNIFIED_FILTERS).on("change",function(){var b=a(this).val(),c=[],d=[],e=!1;if(a.each(b,function(a,b){var f=b.split(":",2);if(2!==f.length)return d.push(b),!0;var g=f[0],h=f[1];return"undefined"!=typeof c[g]&&(e=!0),c[g]=h,!0}),e){var f=[];for(var h in c)f.push(h+":"+c[h]);f=f.concat(d),a(this).val(f)}g.join(",")!=b.join(",")&&this.form.submit()})},g=function(){return a(e.UNIFIED_FILTERS).closest("form")};return{init:function(){f()},getForm:function(){return g()}}});
define('core_user/unified_filter_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(b,c){var d=[],e=a(b),f=a(b).data("originaloptionsjson"),g=e.val();a.each(f,function(b,e){return""!==a.trim(c)&&e.label.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())===-1||(a.inArray(e.value,g)>-1||(d.push(e),!0))});var h=new a.Deferred;return h.resolve(d),h.promise()},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.value,label:b.label})}),d},transport:function(a,b,d){this.list(a,b).then(d)["catch"](c.exception)}}});
define('qtype_coderunner/authorform', ["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(c,e){function f(c,d){var f,g,h,i=a(document.getElementById(c));d=d.toLowerCase(),"none"===d&&(d=""),f=i.data("current-ui-wrapper");try{g=window.JSON.parse(e)}catch(j){g={}}"ace"===d&&("id_templateparams"==c?h="":(h=w.prop("value"),"id_template"!==c&&x.prop("value")&&(h=n(x.prop("value")))),g.lang=h),f&&f.uiname===d&&f.params===g||(f?f.loadUi(d,g):f=new b.InterfaceWrapper(d,c,g))}function g(){var a=O.val();a&&(f("id_answer",a),f("id_answerpreload",a))}function h(a){var b=a?"block":"none";C.css("display",b),D.css("display",b),a&&v.prop("checked")&&f("id_template","ace")}function i(){var a=z.prop("checked");A.prop("disabled",!a),B.prop("disabled",!a)}function j(b,c){var e,f,g;for(var j in d)e=d[j],f=c[j]?c[j]:e[2],e.length>3&&(g=e[3],f=g(f)),a(e[0]).prop(e[1],f);H.prop("value",b),y.prop("checked",!1),J.html(l(b,c.questiontext)),h(!1),i()}function k(a,b){var c;window.alert(m("prototype_load_failure")+b),c=m("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+I+", qtype: "+a,u.prop("value",c)}function l(a,b){var c='<p class="question-type-details-header">';return c+=m("coderunner_question_type"),c+=a+"</p>\n"+b}function m(a){return c[a]}function n(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function o(){var b=t.children("option:selected").text();""!==b&&"Undefined"!==b&&(t.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:I,sesskey:M.cfg.sesskey},function(a){a.success?(j(b,a),g()):k(b,a.error)}).fail(function(){window.alert(m("error_loading_prototype")),u.prop("value",m("ajax_error"))}))}function p(){"3"===K.val()?L.show():L.hide()}function q(){"ace"===O.val()&&g()}function r(){v.prop("checked")&&f("id_template","ace")}function s(){var b=N.prop("value"),c=null;""!==b&&(c=a("<p>"+N.prop("value")+"</p>"),a("#id_qtype_coderunner_error_div").append(c))}var t=a("#id_coderunnertype"),u=a("#id_template"),v=a("#id_useace"),w=a("#id_language"),x=a("#id_acelang"),y=a("#id_customise"),z=a("#id_iscombinatortemplate"),A=a("#id_testsplitterre"),B=a("#id_allowmultiplestdins"),C=a("#id_customisationheader"),D=a("#id_advancedcustomisationheader"),E=y.prop("checked"),F=a("#id_prototypetype"),G=a("#id_answerpreloadhdr"),H=a("#id_typename"),I=a('input[name="courseid"]').prop("value"),J=a("#qtype-help"),K=a("select#id_precheck"),L=a("div.testtype"),N=a("#id_missing_prototype"),O=a("#id_uiplugin");1==F.prop("value")&&(window.alert(m("proceed_at_own_risk")),F.prop("disabled",!0),t.prop("disabled",!0),y.prop("disabled",!0)),s(),h(E),E?(g(),J.html("<p>"+m("info_unavailable")+"</p>")):o(),p(),v.prop("checked")&&f("id_templateparams","ace"),y.on("change",function(){var a=y.prop("checked");a?h(!0):window.confirm(m("confirm_proceed"))?h(!1):y.prop("checked",!0)}),x.on("change",q),w.on("change",function(){r(),q()}),t.on("change",function(){y.prop("checked")&&!window.confirm(m("question_type_changed"))||o()}),v.on("change",function(){var a=v.prop("checked");a?(f("id_template","ace"),f("id_templateparams","ace")):(f("id_template",""),f("id_templateparams",""))}),O.on("change",g),K.on("change",p);var P=new MutationObserver(function(){g()});P.observe(G.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});
define('qtype_coderunner/showdiff', ["jquery"],function(a){function b(a,b){var c,d,e,f=a.length,g=b.length,h="function"==typeof[1].fill;for(c=[],d=0;d<=f;d+=1)if(c[d]=new Array(g+1),h)c[d].fill(0);else for(e=0;e<g+1;e++)c[d][e]=0;for(d=0;d<f;d+=1)for(e=0;e<g;e+=1)a[d]==b[e]?c[d+1][e+1]=1+c[d][e]:c[d+1][e+1]=Math.max(c[d][e+1],c[d+1][e]);return c}function c(a,c){var d,e,f,g,h,i;for(d=b(a,c),i=d[a.length][c.length],h=[],e=a.length,f=c.length,g=i-1;g>=0;)a[e-1]==c[f-1]?(h[g]=a[e-1],g-=1,e-=1,f-=1):d[e-1][f]==d[e][f]?e-=1:f-=1;return h}function d(a,b,c,d){var e,f="",g=!1,h=0;for(void 0===c&&(c="<del>"),void 0===d&&(d="</del>"),e=0;e<a.length;e+=1)h<b.length&&a[e]==b[h]?(g&&(f+=d,g=!1),h+=1):g||(f+=c,g=!0),f+=a[e];return g&&(f+=d),f}function e(a){return a.tagName.toLowerCase()}function f(a){function b(){var a,b;return"&"!=f[g]?(a=f[g],g+=1):(b=f.substring(g,f.length).match(/(^&[a-zA-Z]+;)|(^&#[0-9]+;)|(^&#[xX][0-9a-fA-F]+;)/),null===b?(a=f[g],g+=1):(a=b[0],g+=a.length)),a}var c,d="pre"===e(a),f=a.innerHTML,g=0;for(d&&(f=f.replace(/\n/g,k+"\n")),f=f.replace(/(<br ?.*?>)/g,k+"$1"),c=[],g=0;g<f.length;)c.push(b());return c}function g(a,b){var e,g,h,i="<del>",j="</del>";e=f(a),g=f(b),h=c(e,g),a.innerHTML=d(e,h,i,j),b.innerHTML=d(g,h,i,j)}function h(a,b){var c=new RegExp("(</?del[^>]*>)|("+k+")","g");a.innerHTML=a.innerHTML.replace(c,""),b.innerHTML=b.innerHTML.replace(c,"")}function i(a,b,c,d){for(var e,f,g,h,i=0;i<a.length;i++)e=a[i],f=e.getElementsByTagName("td"),g=f[c].children[0],h=f[b].children[0],d(g,h)}function j(b,c,d,e,f){var j,k,l,m,n,o=a('[id="'+b+'"]'),p=0;j=o.closest("div.coderunner-test-results"),l=j.find("th"),k=j.find("tbody tr"),l.each(function(){a(this).html()===f?m=p:a(this).html()===e&&(n=p),p+=1}),m&&n?o.on("click",function(){o.prop("value")===c?(i(k.toArray(),m,n,g),o.prop("value",d)):(i(k.toArray(),m,n,h),o.prop("value",c))}):(o.enabled=!1,o.hide())}var k="↩";return{initDiffButton:j}});
define('qtype_coderunner/textareas', ["jquery"],function(a){function b(){a("textarea.edit_code").each(d)}function c(b){a(document.getElementById(b)).each(d)}function d(){var b=9,c=13,d=27,f=77;a(this).data("clickInProgress",!1),a(this).data("capturingTab",!0),a(this).on("mousedown",function(){a(this).data("clickInProgress",!0)}),a(this).on("focusin",function(){a(this).data("capturingTab",a(this).data("clickInProgress"))}),a(this).on("click",function(){a(this).data("clickInProgress",!1)}),a(this).on("keydown",function(g){if(!(window.hasOwnProperty("behattesting")&&window.behattesting||void 0!==g.which&&0===g.which))if(g.keyCode==b&&a(this).data("capturingTab"))(g.shiftKey||e(this,"    "))&&g.preventDefault();else if(g.keyCode===c&&void 0!==this.selectionStart){for(var h=this.value.substring(0,this.selectionStart),i=h.lastIndexOf("\n"),j=h.substring(i+1),k="",l=0;l<j.length&&" "===j.charAt(l);l++)k+=" ";e(this,"\n"+k)&&g.preventDefault(),a(this).data("capturingTab",!0)}else g.keyCode===f&&g.ctrlKey&&!g.altKey?(a(this).data("capturingTab",!a(this).data("capturingTab")),g.preventDefault()):g.keyCode===d?a(this).data("capturingTab",!1):g.ctrlKey||g.altKey||a(this).data("capturingTab",!0)})}function e(a,b){if(void 0!==a.selectionStart){var c=a.value.substring(0,a.selectionStart),d=a.selectionEnd,e=a.value.substring(a.selectionEnd,a.value.length),f=a.scrollTop;a.value=c+b+e;var g=d+b.length;return a.selectionStart=g,a.selectionEnd=g,a.scrollTop=f,!0}if(document.selection&&document.selection.createRange){var h=document.selection.createRange(),i=h.duplicate();return i.moveToElementText(a),i.setEndPoint("EndToEnd",h),h.text=b,!0}return!1}return{setupAllTAs:b,initQuestionTA:c}});
define('qtype_coderunner/graphelements', ["qtype_coderunner/graphutil","jquery"],function(a,b){function c(a,b,c){this.parent=a,this.x=b,this.y=c,this.mouseOffsetX=0,this.mouseOffsetY=0,this.isAcceptState=!1,this.text=""}function d(a,b,c){this.parent=a,this.nodeA=b,this.nodeB=c,this.text="",this.lineAngleAdjust=0,this.parallelPart=.5,this.perpendicularPart=0}function e(a,b,c){this.parent=a,this.node=b,this.anchorAngle=0,this.mouseOffsetAngle=0,this.text="",c&&this.setAnchorPoint(c.x,c.y)}function f(a,b,c){this.parent=a,this.node=b,this.deltaX=0,this.deltaY=0,c&&this.setAnchorPoint(c.x,c.y)}function g(a,b,c){this.parent=a,this.from=b,this.to=c}function h(a,b,c){this.BUTTON_WIDTH=50,this.BUTTON_HEIGHT=25,this.TEXT_OFFSET_X=25,this.TEXT_OFFSET_Y=17,this.LINE_HEIGHT=18,this.HELP_INDENT=5,this.topX=b,this.topY=c,this.parent=a}return c.prototype.setMouseStart=function(a,b){this.mouseOffsetX=this.x-a,this.mouseOffsetY=this.y-b},c.prototype.setAnchorPoint=function(a,b){this.x=a+this.mouseOffsetX,this.y=b+this.mouseOffsetY},c.prototype.draw=function(a){a.beginPath(),a.arc(this.x,this.y,this.parent.nodeRadius(),0,2*Math.PI,!1),a.stroke(),this.parent.drawText(this.text,this.x,this.y,null,this),this.isAcceptState&&(a.beginPath(),a.arc(this.x,this.y,this.parent.nodeRadius()-6,0,2*Math.PI,!1),a.stroke())},c.prototype.closestPointOnCircle=function(a,b){var c=a-this.x,d=b-this.y,e=Math.sqrt(c*c+d*d);return{x:this.x+c*this.parent.nodeRadius()/e,y:this.y+d*this.parent.nodeRadius()/e}},c.prototype.containsPoint=function(a,b){return(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y)<this.parent.nodeRadius()*this.parent.nodeRadius()},d.prototype.getAnchorPoint=function(){var a=this.nodeB.x-this.nodeA.x,b=this.nodeB.y-this.nodeA.y,c=Math.sqrt(a*a+b*b);return{x:this.nodeA.x+a*this.parallelPart-b*this.perpendicularPart/c,y:this.nodeA.y+b*this.parallelPart+a*this.perpendicularPart/c}},d.prototype.setAnchorPoint=function(a,b){var c=this.nodeB.x-this.nodeA.x,d=this.nodeB.y-this.nodeA.y,e=Math.sqrt(c*c+d*d);this.parallelPart=(c*(a-this.nodeA.x)+d*(b-this.nodeA.y))/(e*e),this.perpendicularPart=(c*(b-this.nodeA.y)-d*(a-this.nodeA.x))/e,this.parallelPart>0&&this.parallelPart<1&&Math.abs(this.perpendicularPart)<this.parent.SNAP_TO_PADDING&&(this.lineAngleAdjust=(this.perpendicularPart<0)*Math.PI,this.perpendicularPart=0)},d.prototype.getEndPointsAndCircle=function(){if(0===this.perpendicularPart){var b=(this.nodeA.x+this.nodeB.x)/2,c=(this.nodeA.y+this.nodeB.y)/2,d=this.nodeA.closestPointOnCircle(b,c),e=this.nodeB.closestPointOnCircle(b,c);return{hasCircle:!1,startX:d.x,startY:d.y,endX:e.x,endY:e.y}}var f=this.getAnchorPoint(),g=a.circleFromThreePoints(this.nodeA.x,this.nodeA.y,this.nodeB.x,this.nodeB.y,f.x,f.y),h=this.perpendicularPart>0,i=h?1:-1,j=i*this.parent.nodeRadius()/g.radius,k=Math.atan2(this.nodeA.y-g.y,this.nodeA.x-g.x)-j,l=Math.atan2(this.nodeB.y-g.y,this.nodeB.x-g.x)+j,m=g.x+g.radius*Math.cos(k),n=g.y+g.radius*Math.sin(k),o=g.x+g.radius*Math.cos(l),p=g.y+g.radius*Math.sin(l);return{hasCircle:!0,startX:m,startY:n,endX:o,endY:p,startAngle:k,endAngle:l,circleX:g.x,circleY:g.y,circleRadius:g.radius,reverseScale:i,isReversed:h}},d.prototype.draw=function(a){var b=this.getEndPointsAndCircle();if(a.beginPath(),b.hasCircle?a.arc(b.circleX,b.circleY,b.circleRadius,b.startAngle,b.endAngle,b.isReversed):(a.moveTo(b.startX,b.startY),a.lineTo(b.endX,b.endY)),a.stroke(),b.hasCircle?this.parent.arrowIfReqd(a,b.endX,b.endY,b.endAngle-b.reverseScale*(Math.PI/2)):this.parent.arrowIfReqd(a,b.endX,b.endY,Math.atan2(b.endY-b.startY,b.endX-b.startX)),b.hasCircle){var c=b.startAngle,d=b.endAngle;d<c&&(d+=2*Math.PI);var e=(c+d)/2+b.isReversed*Math.PI,f=b.circleX+b.circleRadius*Math.cos(e),g=b.circleY+b.circleRadius*Math.sin(e);this.parent.drawText(this.text,f,g,e,this)}else{var f=(b.startX+b.endX)/2,g=(b.startY+b.endY)/2,e=Math.atan2(b.endX-b.startX,b.startY-b.endY);this.parent.drawText(this.text,f,g,e+this.lineAngleAdjust,this)}},d.prototype.containsPoint=function(a,b){var c=this.getEndPointsAndCircle();if(!c.hasCircle){var d=c.endX-c.startX,e=c.endY-c.startY,f=Math.sqrt(d*d+e*e),g=(d*(a-c.startX)+e*(b-c.startY))/(f*f),h=(d*(b-c.startY)-e*(a-c.startX))/f;return g>0&&g<1&&Math.abs(h)<this.parent.HIT_TARGET_PADDING}var d=a-c.circleX,e=b-c.circleY,h=Math.sqrt(d*d+e*e)-c.circleRadius;if(Math.abs(h)<this.parent.HIT_TARGET_PADDING){var i=Math.atan2(e,d),j=c.startAngle,k=c.endAngle;if(c.isReversed){var l=j;j=k,k=l}return k<j&&(k+=2*Math.PI),i<j?i+=2*Math.PI:i>k&&(i-=2*Math.PI),i>j&&i<k}return!1},e.prototype.setMouseStart=function(a,b){this.mouseOffsetAngle=this.anchorAngle-Math.atan2(b-this.node.y,a-this.node.x)},e.prototype.setAnchorPoint=function(a,b){this.anchorAngle=Math.atan2(b-this.node.y,a-this.node.x)+this.mouseOffsetAngle;var c=Math.round(this.anchorAngle/(Math.PI/2))*(Math.PI/2);Math.abs(this.anchorAngle-c)<.1&&(this.anchorAngle=c),this.anchorAngle<-Math.PI&&(this.anchorAngle+=2*Math.PI),this.anchorAngle>Math.PI&&(this.anchorAngle-=2*Math.PI)},e.prototype.getEndPointsAndCircle=function(){var a=this.node.x+1.5*this.parent.nodeRadius()*Math.cos(this.anchorAngle),b=this.node.y+1.5*this.parent.nodeRadius()*Math.sin(this.anchorAngle),c=.75*this.parent.nodeRadius(),d=this.anchorAngle-.8*Math.PI,e=this.anchorAngle+.8*Math.PI,f=a+c*Math.cos(d),g=b+c*Math.sin(d),h=a+c*Math.cos(e),i=b+c*Math.sin(e);return{hasCircle:!0,startX:f,startY:g,endX:h,endY:i,startAngle:d,endAngle:e,circleX:a,circleY:b,circleRadius:c}},e.prototype.draw=function(a){var b=this.getEndPointsAndCircle();a.beginPath(),a.arc(b.circleX,b.circleY,b.circleRadius,b.startAngle,b.endAngle,!1),a.stroke();var c=b.circleX+b.circleRadius*Math.cos(this.anchorAngle),d=b.circleY+b.circleRadius*Math.sin(this.anchorAngle);this.parent.drawText(this.text,c,d,this.anchorAngle,this),this.parent.arrowIfReqd(a,b.endX,b.endY,b.endAngle+.4*Math.PI)},e.prototype.containsPoint=function(a,b){var c=this.getEndPointsAndCircle(),d=a-c.circleX,e=b-c.circleY,f=Math.sqrt(d*d+e*e)-c.circleRadius;return Math.abs(f)<this.parent.HIT_TARGET_PADDING},f.prototype.setAnchorPoint=function(a,b){this.deltaX=a-this.node.x,this.deltaY=b-this.node.y,Math.abs(this.deltaX)<this.parent.SNAP_TO_PADDING&&(this.deltaX=0),Math.abs(this.deltaY)<this.parent.SNAP_TO_PADDING&&(this.deltaY=0)},f.prototype.getEndPoints=function(){var a=this.node.x+this.deltaX,b=this.node.y+this.deltaY,c=this.node.closestPointOnCircle(a,b);return{startX:a,startY:b,endX:c.x,endY:c.y}},f.prototype.draw=function(a){var b=this.getEndPoints();a.beginPath(),a.moveTo(b.startX,b.startY),a.lineTo(b.endX,b.endY),a.stroke(),this.parent.arrowIfReqd(a,b.endX,b.endY,Math.atan2(-this.deltaY,-this.deltaX))},f.prototype.containsPoint=function(a,b){var c=this.getEndPoints(),d=c.endX-c.startX,e=c.endY-c.startY,f=Math.sqrt(d*d+e*e),g=(d*(a-c.startX)+e*(b-c.startY))/(f*f),h=(d*(b-c.startY)-e*(a-c.startX))/f;return g>0&&g<1&&Math.abs(h)<this.parent.HIT_TARGET_PADDING},g.prototype.draw=function(a){a.beginPath(),a.moveTo(this.to.x,this.to.y),a.lineTo(this.from.x,this.from.y),a.stroke(),this.parent.arrowIfReqd(a,this.to.x,this.to.y,Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x))},h.prototype.containsPoint=function(a,b){return a>=this.topX&&b>=this.topY&&a<=this.topX+this.BUTTON_WIDTH&&b<=this.topY+this.BUTTON_HEIGHT},h.prototype.draw=function(a,c,d){var e,f,g,h;d?a.fillStyle="#FFFFFF":a.fillStyle="#F0F0F0",a.fillRect(this.topX,this.topY,this.topX+this.BUTTON_WIDTH,this.topY+this.BUTTON_HEIGHT),a.lineWidth=.5,a.strokeStyle="#000000",a.strokeRect(this.topX,this.topY,this.topX+this.BUTTON_WIDTH,this.topY+this.BUTTON_HEIGHT),a.font="12pt Arial",a.fillStyle="#000000",a.textAlign="center",a.fillText("Help",this.topX+this.TEXT_OFFSET_X,this.topY+this.TEXT_OFFSET_Y),a.textAlign="left",c&&(h=this,require(["core/str"],function(c){var d=c.get_string("graphhelp","qtype_coderunner");b.when(d).done(function(b){for(a.font="12pt Arial",e=b.split("\n"),g=h.topY+h.BUTTON_HEIGHT,f=0;f<e.length;f+=1)g+=h.LINE_HEIGHT,a.fillText(e[f],h.topX+h.HELP_INDENT,g)})}))},{Node:c,Link:d,SelfLink:e,TemporaryLink:g,StartLink:f,HelpBox:h}});
define('qtype_coderunner/graphutil', function(){function a(){this.greekLetterNames=["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"]}return a.prototype.convertLatexShortcuts=function(a){for(var b=0;b<this.greekLetterNames.length;b++){var c=this.greekLetterNames[b];a=a.replace(new RegExp("\\\\"+c,"g"),String.fromCharCode(913+b+(b>16))),a=a.replace(new RegExp("\\\\"+c.toLowerCase(),"g"),String.fromCharCode(945+b+(b>16)))}for(var b=0;b<10;b++)a=a.replace(new RegExp("_"+b,"g"),String.fromCharCode(8320+b));return a=a.replace(new RegExp("_a","g"),String.fromCharCode(8336))},a.prototype.drawArrow=function(a,b,c,d){var e=Math.cos(d),f=Math.sin(d);a.beginPath(),a.moveTo(b,c),a.lineTo(b-8*e+5*f,c-8*f-5*e),a.lineTo(b-8*e-5*f,c-8*f+5*e),a.fill()},a.prototype.det=function(a,b,c,d,e,f,g,h,i){return a*e*i+b*f*g+c*d*h-a*f*h-b*d*i-c*e*g},a.prototype.circleFromThreePoints=function(a,b,c,d,e,f){var g=this.det(a,b,1,c,d,1,e,f,1),h=-this.det(a*a+b*b,b,1,c*c+d*d,d,1,e*e+f*f,f,1),i=this.det(a*a+b*b,a,1,c*c+d*d,c,1,e*e+f*f,e,1),j=-this.det(a*a+b*b,a,b,c*c+d*d,c,d,e*e+f*f,e,f);return{x:-h/(2*g),y:-i/(2*g),radius:Math.sqrt(h*h+i*i-4*g*j)/(2*Math.abs(g))}},a.prototype.isInside=function(a,b){return a.x>b.x&&a.x<b.x+b.width&&a.y<b.y+b.height&&a.y>b.y},a.prototype.crossBrowserKey=function(a){return a=a||window.event,a.which||a.keyCode},a.prototype.crossBrowserElementPos=function(a){a=a||window.event;for(var b=a.target||a.srcElement,c=0,d=0;b.offsetParent;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;return{x:c,y:d}},a.prototype.crossBrowserMousePos=function(a){return a=a||window.event,{x:a.pageX||a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.pageY||a.clientY+document.body.scrollTop+document.documentElement.scrollTop}},a.prototype.crossBrowserRelativeMousePos=function(a){var b=this.crossBrowserElementPos(a),c=this.crossBrowserMousePos(a);return{x:c.x-b.x,y:c.y-b.y}},new a});
define('qtype_coderunner/multilanguagequestion', ["jquery"],function(a){function b(b){a().ready(function(){c(b)})}function c(b){function c(){var a=e.val(),b=d.data("current-ui-wrapper");b&&b.uiInstance&&"function"==typeof b.uiInstance.setLanguage&&b.uiInstance.setLanguage(a)}var d=a(document.getElementById(b)),e=a(".coderunner-lang-select");e.on("change",c)}return{initLangSelector:b}});
define('qtype_coderunner/ui_ace', ["jquery"],function(a){function b(b,c,d,e){var f,g=a(document.getElementById(b)),h=g[0]===document.activeElement,i=e.lang;try{window.ace.require("ace/ext/language_tools"),this.modelist=window.ace.require("ace/ext/modelist"),this.textarea=g,this.enabled=!1,this.contents_changed=!1,this.capturingTab=!1,this.clickInProgress=!1,this.editNode=a("<div></div>"),this.editNode.css({resize:"none",height:d,width:"100%"}),this.editor=window.ace.edit(this.editNode.get(0)),g.prop("readonly")&&this.editor.setReadOnly(!0),this.editor.setOptions({enableBasicAutocompletion:!0,newLineMode:"unix"}),this.editor.$blockScrolling=1/0,f=this.editor.getSession(),f.setValue(this.textarea.val()),this.setLanguage(i),this.setEventHandlers(g),this.captureTab(),a(".ace_gutter").addClass("moodle-has-zindex"),g.hide(),h&&(this.editor.focus(),this.editor.navigateFileEnd()),this.aceLabel=a(".answerprompt"),this.aceLabel.attr("for","ace_"+b),this.aceTextarea=a(".ace_text-input"),this.aceTextarea.attr("id","ace_"+b),this.fail=!1}catch(j){this.fail=!0}}return b.prototype.failed=function(){return this.fail},b.prototype.failMessage=function(){return"ace_ui_notready"},b.prototype.sync=function(){},b.prototype.setLanguage=function(a){var b=this.editor.getSession(),c=this.findMode(a);c&&b.setMode(c.mode)},b.prototype.getElement=function(){return this.editNode},b.prototype.captureTab=function(){this.capturingTab=!0,this.editor.commands.bindKeys({Tab:"indent","Shift-Tab":"outdent"})},b.prototype.releaseTab=function(){this.capturingTab=!1,this.editor.commands.bindKeys({Tab:null,"Shift-Tab":null})},b.prototype.setEventHandlers=function(){var a=9,b=27,c=77,d=this;this.editor.getSession().on("change",function(){d.textarea.val(d.editor.getSession().getValue()),d.contents_changed=!0}),this.editor.on("blur",function(){d.contents_changed&&d.textarea.trigger("change")}),this.editor.on("mousedown",function(){d.clickInProgress=!0}),this.editor.on("focus",function(){d.clickInProgress?d.captureTab():d.releaseTab()}),this.editor.on("click",function(){d.clickInProgress=!1}),this.editor.container.addEventListener("keydown",function(e){void 0!==e.which&&0===e.which||(e.keyCode===c&&e.ctrlKey&&!e.altKey?(d.capturingTab?d.releaseTab():d.captureTab(),e.preventDefault()):e.keyCode===b?d.releaseTab():e.shiftKey||e.ctrlKey||e.altKey||e.keyCode==a||d.captureTab())},!0)},b.prototype.destroy=function(){var b;this.fail||(b=this.editor.isFocused(),this.textarea.val(this.editor.getSession().getValue()),this.editor.destroy(),a(this.editNode).remove(),b&&(this.textarea.focus(),this.textarea[0].selectionStart=this.textarea[0].value.length))},b.prototype.hasFocus=function(){return this.editor.isFocused()},b.prototype.findMode=function(a){var b,c,d,e=[],f={octave:"matlab",nodejs:"javascript","c#":"cs"};if("string"==typeof a){a.toLowerCase()in f&&(a=f[a.toLowerCase()]),e=[a,a.replace(/\d+$/,"")];for(var g=0;g<e.length;g++)if(b=e[g],c="input."+b,d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase()),d&&"text"!==d.name)return d}},b.prototype.resize=function(a,b){this.editNode.outerHeight(b),this.editNode.outerWidth(a),this.editor.resize()},{Constructor:b}});
define('qtype_coderunner/ui_graph', ["jquery","qtype_coderunner/graphutil","qtype_coderunner/graphelements"],function(a,b,c){function d(b,c,d,e){this.HANDLE_SIZE=10,this.parent=b,this.canvas=a(document.createElement("canvas")),this.canvas.attr({id:c,"class":"coderunner_graphcanvas",tabindex:1}),this.canvas.css({"background-color":"white"}),this.canvas.on("mousedown",function(a){return b.mousedown(a)}),this.canvas.on("mouseup",function(a){return b.mouseup(a)}),this.canvas.on("dblclick",function(a){return b.dblclick(a)}),this.canvas.on("keydown",function(a){return b.keydown(a)}),this.canvas.on("mousemove",function(a){return b.mousemove(a)}),this.canvas.on("keypress",function(a){return b.keypress(a)}),this.resize=function(a,b){this.canvas.attr("width",a),this.canvas.attr("height",b)},this.resize(d,e)}function e(b,e,f,g){this.SNAP_TO_PADDING=6,this.DUPLICATE_LINK_OFFSET=16,this.HIT_TARGET_PADDING=6,this.DEFAULT_NODE_RADIUS=26,this.DEFAULT_FONT_SIZE=20,this.canvasId="graphcanvas_"+b,this.textArea=a(document.getElementById(b)),this.readOnly=this.textArea.prop("readonly"),this.templateParams=g,this.graphCanvas=new d(this,this.canvasId,e,f),this.caretVisible=!0,this.caretTimer=0,this.originalClick=null,this.nodes=[],this.links=[],this.helpBox=new c.HelpBox(this,0,0),this.helpBoxHighlighted=!1,this.selectedObject=null,this.currentLink=null,this.movingObject=!1,this.fail=!1,this.failString=null,this.reload(),this.fail||this.draw()}return e.prototype.failed=function(){return this.fail},e.prototype.failMessage=function(){return this.failString},e.prototype.getElement=function(){return this.getCanvas()},e.prototype.hasFocus=function(){return document.activeElement==this.getCanvas()},e.prototype.getCanvas=function(){var a=this.graphCanvas.canvas[0];return a},e.prototype.nodeRadius=function(){return this.templateParams.noderadius?this.templateParams.noderadius:this.DEFAULT_NODE_RADIUS},e.prototype.fontSize=function(){return this.templateParams.fontsize?this.templateParams.fontsize:this.DEFAULT_FONT_SIZE},e.prototype.isFsm=function(){return void 0===this.templateParams.isfsm||this.templateParams.isfsm},e.prototype.arrowIfReqd=function(a,c,d,e){(void 0===this.templateParams.isdirected||this.templateParams.isdirected)&&b.drawArrow(a,c,d,e)},e.prototype.sync=function(){},e.prototype.keypress=function(a){var c=b.crossBrowserKey(a);if(!this.readOnly)return c>=32&&c<=126&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&null!==this.selectedObject&&"text"in this.selectedObject?(this.selectedObject.text+=String.fromCharCode(c),this.resetCaret(),this.draw(),!1):8!==c&&32!==c&&9!==c&&void 0},e.prototype.mousedown=function(a){var d=b.crossBrowserRelativeMousePos(a);if(!this.readOnly)return this.selectedObject=this.selectObject(d.x,d.y),this.movingObject=!1,this.originalClick=d,null!==this.selectedObject?(a.shiftKey&&this.selectedObject instanceof c.Node?this.currentLink=new c.SelfLink(this,this.selectedObject,d):(this.movingObject=!0,this.selectedObject.setMouseStart&&this.selectedObject.setMouseStart(d.x,d.y)),this.resetCaret()):a.shiftKey&&this.isFsm()&&(this.currentLink=new c.TemporaryLink(this,d,d)),this.draw(),!this.hasFocus()&&(this.resetCaret(),!0)},e.prototype.keydown=function(a){var c=b.crossBrowserKey(a);if(!this.readOnly){if(8===c)return null!==this.selectedObject&&"text"in this.selectedObject&&(this.selectedObject.text=this.selectedObject.text.substr(0,this.selectedObject.text.length-1),this.resetCaret(),this.draw()),!1;if(46===c){if(null!==this.selectedObject){for(var d=0;d<this.nodes.length;d++)this.nodes[d]===this.selectedObject&&this.nodes.splice(d--,1);for(var d=0;d<this.links.length;d++)this.links[d]!==this.selectedObject&&this.links[d].node!==this.selectedObject&&this.links[d].nodeA!==this.selectedObject&&this.links[d].nodeB!==this.selectedObject||this.links.splice(d--,1);this.selectedObject=null,this.draw()}}else 13===c&&null!==this.selectedObject&&(this.selectedObject=null,this.draw())}},e.prototype.dblclick=function(a){var d=b.crossBrowserRelativeMousePos(a);this.readOnly||(this.selectedObject=this.selectObject(d.x,d.y),null===this.selectedObject?(this.selectedObject=new c.Node(this,d.x,d.y),this.nodes.push(this.selectedObject),this.resetCaret(),this.draw()):this.selectedObject instanceof c.Node&&(this.selectedObject.isAcceptState=!this.selectedObject.isAcceptState,this.draw()))},e.prototype.resize=function(a,b){this.graphCanvas.resize(a,b),this.draw()},e.prototype.mousemove=function(a){var d,e=b.crossBrowserRelativeMousePos(a),f=this.helpBox.containsPoint(e.x,e.y);if(!this.readOnly){if(f!=this.helpBoxHighlighted&&(this.helpBoxHighlighted=f,this.draw()),null!==this.currentLink){var g=this.selectObject(e.x,e.y);g instanceof c.Node||(g=null),null===this.selectedObject?null!==g?this.currentLink=new c.StartLink(this,g,this.originalClick):this.currentLink=new c.TemporaryLink(this,this.originalClick,e):g===this.selectedObject?this.currentLink=new c.SelfLink(this,this.selectedObject,e):null!==g?this.currentLink=new c.Link(this,this.selectedObject,g):(d=this.selectedObject.closestPointOnCircle(e.x,e.y),this.currentLink=new c.TemporaryLink(this,d,e)),this.draw()}this.movingObject&&(this.selectedObject.setAnchorPoint(e.x,e.y),this.selectedObject instanceof c.Node&&this.snapNode(this.selectedObject),this.draw())}},e.prototype.mouseup=function(){this.readOnly||(this.movingObject=!1,null!==this.currentLink&&(this.currentLink instanceof c.TemporaryLink||(this.selectedObject=this.currentLink,this.addLink(this.currentLink),this.resetCaret()),this.currentLink=null,this.draw()))},e.prototype.selectObject=function(a,b){if(this.helpBox.containsPoint(a,b)&&this.selectedObject!=this.helpBox)return this.helpBox;for(var c=0;c<this.nodes.length;c++)if(this.nodes[c].containsPoint(a,b))return this.nodes[c];for(var c=0;c<this.links.length;c++)if(this.links[c].containsPoint(a,b))return this.links[c];return null},e.prototype.snapNode=function(a){for(var b=0;b<this.nodes.length;b++)this.nodes[b]!==a&&(Math.abs(a.x-this.nodes[b].x)<this.SNAP_TO_PADDING&&(a.x=this.nodes[b].x),Math.abs(a.y-this.nodes[b].y)<this.SNAP_TO_PADDING&&(a.y=this.nodes[b].y))},e.prototype.addLink=function(a){for(var b=null,c=0;c<this.links.length;c++){var d=this.links[c];d.nodeA===a.nodeA&&d.nodeB===a.nodeB&&(null===b||d.perpendicularPart>b)&&(b=d.perpendicularPart),d.nodeA===a.nodeB&&d.nodeB===a.nodeA&&(null===b||-d.perpendicularPart>b)&&(b=-d.perpendicularPart)}null!==b&&(a.perpendicularPart=b+this.DUPLICATE_LINK_OFFSET),this.links.push(a)},e.prototype.reload=function(){var b=a(this.textArea).val();if(b)try{for(var d=JSON.parse(b),e=0;e<d.nodes.length;e++){var f=d.nodes[e],g=d.nodeGeometry[e],h=new c.Node(this,g[0],g[1]);h.isAcceptState=f[1],h.text=f[0].toString(),this.nodes.push(h)}for(var e=0;e<d.edges.length;e++){var i=d.edges[e],j=d.edgeGeometry[e],k=null;i[0]===i[1]?(k=new c.SelfLink(this,this.nodes[i[0]]),k.anchorAngle=j.anchorAngle,k.text=i[2].toString()):i[0]===-1?(k=new c.StartLink(this,this.nodes[i[1]]),k.deltaX=j.deltaX,k.deltaY=j.deltaY):(k=new c.Link(this,this.nodes[i[0]],this.nodes[i[1]]),k.parallelPart=j.parallelPart,k.perpendicularPart=j.perpendicularPart,k.text=i[2].toString(),k.lineAngleAdjust=j.lineAngleAdjust),null!==k&&this.links.push(k)}}catch(l){this.fail=!0,this.failString="graph_ui_invalidserialisation"}},e.prototype.save=function(){var a={edgeGeometry:[],nodeGeometry:[],nodes:[],edges:[]};if(JSON&&(""!==this.textArea.val().trim()||0!==this.nodes.length)){for(var b=0;b<this.nodes.length;b++){var d=this.nodes[b],e=[d.text,d.isAcceptState],f=[d.x,d.y];a.nodeGeometry.push(f),a.nodes.push(e)}for(var b=0;b<this.links.length;b++){var g=this.links[b],h=null,i=null;g instanceof c.SelfLink?(i={anchorAngle:g.anchorAngle},h=[this.nodes.indexOf(g.node),this.nodes.indexOf(g.node),g.text]):g instanceof c.StartLink?(i={deltaX:g.deltaX,deltaY:g.deltaY},h=[-1,this.nodes.indexOf(g.node),""]):g instanceof c.Link&&(i={lineAngleAdjust:g.lineAngleAdjust,parallelPart:g.parallelPart,perpendicularPart:g.perpendicularPart},h=[this.nodes.indexOf(g.nodeA),this.nodes.indexOf(g.nodeB),g.text]),null!==h&&null!==i&&(a.edges.push(h),a.edgeGeometry.push(i))}this.textArea.val(JSON.stringify(a))}},e.prototype.destroy=function(){clearInterval(this.caretTimer),this.graphCanvas.canvas.off(),this.graphCanvas.canvas.remove()},e.prototype.resetCaret=function(){var a=this;clearInterval(this.caretTimer),this.caretTimer=setInterval(function(){a.caretVisible=!a.caretVisible,a.draw()},500),this.caretVisible=!0},e.prototype.draw=function(){var a=this.getCanvas(),b=a.getContext("2d");if(b.clearRect(0,0,this.getCanvas().width,this.getCanvas().height),b.save(),b.translate(.5,.5),this.helpBox.draw(b,this.selectedObject==this.helpBox,this.helpBoxHighlighted),this.selectedObject!=this.helpBox){for(var c=0;c<this.nodes.length;c++)b.lineWidth=1,b.fillStyle=b.strokeStyle=this.nodes[c]===this.selectedObject?"blue":"black",this.nodes[c].draw(b);for(var c=0;c<this.links.length;c++)b.lineWidth=1,b.fillStyle=b.strokeStyle=this.links[c]===this.selectedObject?"blue":"black",this.links[c].draw(b);null!==this.currentLink&&(b.lineWidth=1,b.fillStyle=b.strokeStyle="black",this.currentLink.draw(b))}b.restore(),this.save()},e.prototype.drawText=function(a,c,d,e,f){var g,h,i=this.getCanvas().getContext("2d"),j=b.convertLatexShortcuts(a);if(i.font=this.fontSize()+"px Arial",g=i.measureText(j).width,c-=g/2,null!==e){var k=Math.cos(e),l=Math.sin(e),m=(g/2+5)*(k>0?1:-1),n=15*(l>0?1:-1),o=l*Math.pow(Math.abs(l),40)*m-k*Math.pow(Math.abs(k),10)*n;c+=m-l*o,d+=n+k*o}"advancedFillText"in i?i.advancedFillText(j,a,c+g/2,d,e):(c=Math.round(c),d=Math.round(d),h=Math.round(this.fontSize()/3),i.fillText(j,c,d+h),f==this.selectedObject&&this.caretVisible&&this.hasFocus()&&document.hasFocus()&&(c+=g,h=Math.round(this.fontSize()/2),i.beginPath(),i.moveTo(c,d-h),i.lineTo(c,d+h),i.stroke()))},{Constructor:e}});
define('qtype_coderunner/userinterfacewrapper', ["jquery"],function(a){function b(b,c,d){var e,f=this;this.GUTTER=14,this.MIN_WRAPPER_HEIGHT=100,this.taId=c,this.loadFailId=c+"_loadfailerr",this.textArea=a(document.getElementById(c)),this.readOnly=this.textArea.prop("readonly"),this.isLoading=!1,this.loadFailed=!1,this.retries=0,e=Math.max(parseInt(this.textArea.css("height")),this.MIN_WRAPPER_HEIGHT),this.wrapperNode=a("<div id='"+this.taId+"_wrapper' class='ui_wrapper'></div>"),this.textArea.after(this.wrapperNode),this.wrapperNode.hide(),this.wrapperNode.css({resize:"vertical",overflow:"hidden",minHeight:e,width:"100%",border:"1px solid darkgrey"}),this.textArea.data("current-ui-wrapper",this),this.uiInstance=null,this.loadUi(b,d),a(document).mousemove(function(){f.checkForResize()}),a(window).resize(function(){f.checkForResize()}),this.textArea.closest("form").submit(function(){null!==f.uiInstance&&f.uiInstance.sync()}),a(document.body).on("keydown",function(a){var b=77;a.keyCode===b&&a.ctrlKey&&a.altKey&&(null!==f.uiInstance||f.loadFailed?f.stop():f.restart())})}function c(a,c,d,e){var f;if(a){try{f=window.JSON.parse(d)}catch(g){f={}}return e&&(f.lang=e),new b(a,c,f)}return null}return b.prototype.loadUi=function(b,c){function d(b,c){require(["core/str"],function(d){var e=d.get_string(b,"qtype_coderunner"),f=d.get_string("ui_fallback","qtype_coderunner");a.when(e,f).done(function(a,b){c.html(a+"<br>"+b)})})}var e=this,f="Failed to load ",g=" UI component. If this error persists, please report it to the forum on coderunner.org.nz";return this.isLoading?(this.retries+=1,void(this.retries>20?(alert(f+b+g),this.retries=0,this.loading=0):setTimeout(function(){e.loadUi(b,c)},200))):(this.retries=0,this.params=c,this.stop(),this.uiname=b,void(""===this.uiname||"none"===this.uiname||sessionStorage.getItem("disableUis")?this.uiInstance=null:(this.isLoading=!0,require(["qtype_coderunner/ui_"+this.uiname],function(b){var f,g,h,i,j;i=e.wrapperNode.innerHeight()-e.GUTTER,j=e.wrapperNode.innerWidth(),f=new b.Constructor(e.taId,j,i,c),f.failed()?(e.loadFailed=!0,e.wrapperNode.hide(),f.destroy(),e.uiInstance=null,e.textArea.addClass("uiloadfailed"),g='<div id="'+e.loadFailId+'"class="uiloadfailed"></div>',h=a(g),h.insertBefore(e.textArea),d(f.failMessage(),h)):(e.hLast=0,e.wLast=0,e.textArea.hide(),e.wrapperNode.show(),e.wrapperNode.append(f.getElement()),e.uiInstance=f,e.loadFailed=!1,e.checkForResize()),e.isLoading=!1}))))},b.prototype.stop=function(){null!==this.uiInstance&&(this.textArea.show(),this.uiInstance.hasFocus()&&(this.textArea.focus(),this.textArea[0].selectionStart=this.textArea[0].value.length),this.uiInstance.destroy(),this.uiInstance=null,this.wrapperNode.hide()),this.loadFailed=!1,this.textArea.removeClass("uiloadfailed"),a(document.getElementById(this.loadFailId)).remove()},b.prototype.restart=function(){null===this.uiInstance&&this.loadUi(this.uiname,this.params)},b.prototype.checkForResize=function(){var b,c,d,e,f,g,h=25;this.uiInstance&&(b=this.wrapperNode.innerHeight(),d=this.wrapperNode.innerWidth(),b==this.hLast&&d==this.wLast||(f=this.wrapperNode.offset().left,g=a(window).innerWidth()-f-h,c=b-this.GUTTER,e=Math.min(g,d),this.uiInstance.resize(e,c),this.hLast=this.wrapperNode.innerHeight(),this.wLast=this.wrapperNode.innerWidth()))},{newUiWrapper:c,InterfaceWrapper:b}});
define('qtype_coderunner/resetbutton', ["jquery"],function(a){function b(b,c,d){var e,f=a('[id="'+b+'"]'),g=a('[id="'+c+'"]');f.on("click",function(){if(window.behattesting||window.confirm(d)){var a=f.data("reload-text");e=g.data("current-ui-wrapper"),e&&e.uiInstance?(e.stop(),g.val(a),e.restart()):g.val(a)}})}return{initResetButton:b}});
define('qtype_coderunner/ui_html', ["jquery"],function(a){function b(b,c,d,e){this.html=e.html,this.textArea=a(document.getElementById(b)),this.readOnly=this.textArea.prop("readonly"),this.templateParams=e,this.fail=!1,this.htmlDiv=null,this.reload()}return b.prototype.failed=function(){return this.fail},b.prototype.sync=function(){var b,c={},d=!0;this.getFields().each(function(){var e,f;f=a(this).attr("type"),b=a(this).attr("name"),e="checkbox"!==f&&"radio"!==f||a(this).is(":checked")?a(this).val():"",c.hasOwnProperty(b)?c[b].push(e):c[b]=[e],""!==e&&(d=!1)}),d?this.textArea.val(""):this.textArea.val(JSON.stringify(c))},b.prototype.getElement=function(){return this.htmlDiv},b.prototype.getFields=function(){return a(this.htmlDiv).find(".coderunner-ui-element")},b.prototype.setField=function(a,b){"checkbox"===a.attr("type")||"radio"===a.attr("type")?a.prop("checked",a.val()===b):a.val(b)},b.prototype.reload=function(){var b,c,d,e,f,g=a(this.textArea).val(),h="<div style='height:fit-content' class='qtype-coderunner-html-outer-div'>";if(this.htmlDiv=a(h+this.html+"</div>"),this.htmlDiv.data("templateparams",this.templateParams),g)try{b=JSON.parse(g),f={};for(var i in b){for(c=b[i],e=this.getFields().filter("[name='"+i+"']"),f[i]=[],d=0;d<c.length;d++)d<e.length?this.setField(a(e[d]),c[d]):f[i].push(c[d]);0===f[i].length&&delete f[i]}a.isEmptyObject(f)||this.htmlDiv.data("leftovers",f)}catch(j){alert("Failed to initialise HTML UI"),this.fail=!0}},b.prototype.resize=function(){},b.prototype.hasFocus=function(){var a=!1;return this.getFields().each(function(){this===document.activeElement&&(a=!0)}),a},b.prototype.destroy=function(){this.sync(),a(this.htmlDiv).remove(),this.htmlDiv=null},{Constructor:b}});
define('qtype_coderunner/ui_table', ["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b)),this.readOnly=this.textArea.prop("readonly"),this.templateParams=e,this.tableDiv=null,this.fail=!1,e.table_num_columns&&e.table_num_rows&&e.table_column_headers?this.reload():(this.fail=!0,this.failString="table_ui_missingparams")}return b.prototype.getElement=function(){return this.tableDiv},b.prototype.failed=function(){return this.fail},b.prototype.failMessage=function(){return this.failString},b.prototype.sync=function(){var b=[],c=!0,d=a(this.tableDiv).find("table tbody tr");d.each(function(){var d=[];a(this).find("textarea").each(function(){var b=a(this).val();d.push(b),b&&(c=!1)}),b.push(d)}),c?this.textArea.val(""):this.textArea.val(JSON.stringify(b))},b.prototype.reload=function(){var b,c,d=a(this.textArea).val(),e=[],f="<div style='height:fit-content' class='qtype-coderunner-table-outer-div'>\n<table class='table table-bordered qtype-coderunner_table'>\n",g=this.templateParams.table_column_width_percents,h=Math.trunc(100/this.templateParams.table_num_columns);if(d)try{e=JSON.parse(d)}catch(i){return this.fail=!0,void(this.failString="table_ui_invalidjson")}try{f+="<thead>\n<tr>";for(var j=0;j<this.templateParams.table_num_columns;j++)c=g?g[j]:h,b="<th style='width:"+c.toString()+"%'>",f+=b+this.templateParams.table_column_headers[j]+"</th>";f+="</tr>\n</thead>\n",f+="<tbody>\n";for(var k=Math.max(this.templateParams.table_num_rows,e.length),l=0;l<k;l++){for(f+="<tr>",j=0;j<this.templateParams.table_num_columns;j++)f+="<td style='padding:2px;margin:0'>",f+='<textarea rows="2" style="width:100%;padding:0;resize:vertical;font-family: monospace">',l<e.length&&(f+=e[l][j]),f+="</textarea></td>";f+="</tr>"}f+="</tbody>\n</table>\n</div>",this.tableDiv=a(f),this.templateParams.table_dynamic_rows&&this.addButtons()}catch(i){this.fail=!0,this.failString="table_ui_invalidserialisation"}},b.prototype.addButtons=function(){var b='<button type="button"style="float:right;margin-right:6px" disabled>Delete row</button>',c=a(b),d=this;this.tableDiv.append(c),c.click(function(){var b=d.tableDiv.find("table tbody tr").length,c=d.tableDiv.find("tr:last");b>d.templateParams.table_num_rows&&c.remove(),c=d.tableDiv.find("tr:last"),b==d.templateParams.table_num_rows+1&&a(this).prop("disabled",!0)});var e='<button type="button"style="float:right;margin-right:6px">Add row</button>',f=a(e);d.tableDiv.append(f),f.click(function(){var b,c;b=d.tableDiv.find("table tbody tr:last"),c=b.clone(),c.find("textarea").each(function(){a(this).val("")}),b.after(c),a(this).prev().prop("disabled",!1)})},b.prototype.resize=function(){},b.prototype.hasFocus=function(){var b=!1;return a(this.tableDiv).find("textarea").each(function(){this===document.activeElement&&(b=!0)}),b},b.prototype.destroy=function(){this.sync(),a(this.tableDiv).remove(),this.tableDiv=null},{Constructor:b}});
define('qtype_opaque/changefocus', ["jquery"],function(a){var b={init:function(){a(document).ready(function(){var c=a('input[id*="_omact_gen_"]'),d=a('input[id*="omact_ok"]'),e=localStorage.getItem("last_question_index");localStorage.removeItem("last_question_index"),null!==e&&setTimeout(function(){a("html, body").animate({scrollTop:a("#q"+e).offset().top},100);var b=a('input[id*=":'+e+'_omact_ok"]');a(b).length>0?a(b).focus():a('input[id*="_omact_ok"]').blur()},350),d.on("keydown",function(c){var d=c.keyCode||c.which;if(c.preventDefault(),9==d&&!c.shiftKey){var e=b.getQuestionIndex(c);a("#q"+e+" input.questionflagimage").focus(),a(this).attr("tabindex",-1)}}),a(c).click(function(a){localStorage.setItem("last_question_index",b.getQuestionIndex(a))}),a(d).click(function(a){localStorage.setItem("last_question_index",b.getQuestionIndex(a))})})},getQuestionIndex:function(a){var b=a.target.id,c=b.substr(b.indexOf(":")+1);return c=c.substr(0,c.indexOf("_"))}};return b});
define('qtype_ordering/autoscroll', ["jquery"],function(a){var b={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(c){a(window).on("mousemove",b.mouseMove),a(window).on("touchmove",b.touchMove),b.callback=c},stop:function(){a(window).off("mousemove",b.mouseMove),a(window).off("touchmove",b.touchMove),null!==b.scrollingId&&b.stopScrolling()},touchMove:function(a){for(var c=0;c<a.changedTouches.length;c++)b.handleMove(a.changedTouches[c].clientX,a.changedTouches[c].clientY)},mouseMove:function(a){b.handleMove(a.clientX,a.clientY)},handleMove:function(c,d){d<b.SCROLL_THRESHOLD?b.scrollAmount=-Math.min(b.SCROLL_THRESHOLD-d,b.SCROLL_THRESHOLD):d>a(window).height()-b.SCROLL_THRESHOLD?b.scrollAmount=Math.min(d-(a(window).height()-b.SCROLL_THRESHOLD),b.SCROLL_THRESHOLD):b.scrollAmount=0,b.scrollAmount&&null===b.scrollingId?b.startScrolling():b.scrollAmount||null===b.scrollingId||b.stopScrolling()},startScrolling:function(){var c=a(document).height()-a(window).height();b.scrollingId=window.setInterval(function(){var d=a(window).scrollTop(),e=Math.round(b.scrollAmount*b.SCROLL_SPEED);if(d+e<0&&(e=-d),d+e>c&&(e=c-d),0!==e){a(window).scrollTop(d+e);var f=a(window).scrollTop()-d;0!==f&&b.callback&&b.callback(f)}},b.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(b.scrollingId),b.scrollingId=null}};return{start:b.start,stop:b.stop}});
define('qtype_ordering/drag_reorder', ["jquery",require.specified("core/dragdrop")?"core/dragdrop":"qtype_ordering/dragdrop",require.specified("core/key_codes")?"core/key_codes":"qtype_ordering/key_codes"],function(a,b,c){return function(d){var e=null,f=null,g=null,h=null,i=null,j=function(c,h){e={time:(new Date).getTime(),x:h.x,y:h.y},g=a(c.currentTarget).closest(d.itemInPage),"undefined"!=typeof d.reorderStart&&d.reorderStart(g.closest(d.list),g),f=r(),i=a(d.proxyHtml.replace("%%ITEM_HTML%%",g.html()).replace("%%ITEM_CLASS_NAME%%",g.attr("class"))),a(document.body).append(i),i.css("position","absolute"),i.css(g.offset()),i.width(g.outerWidth()),i.height(g.outerHeight()),g.addClass(d.itemMovingClass),b.start(c,i,k,m)},k=function(){var b=g.closest(d.list),c=null,e=null;b.find(d.item).each(function(b,d){var f=q(d,i);(null===c||f<e)&&(c=a(d),e=f)}),c[0]!==g[0]&&(p(i)<p(c)?g.insertBefore(c):g.insertAfter(c))},l=function(a,b){var c=[];return a.split(",").forEach(function(a){b.split(",").forEach(function(b){c.push(a.trim()+" "+b.trim())})}),c.join(", ")},m=function(a,b){"undefined"!=typeof d.reorderEnd&&d.reorderEnd(g.closest(d.list),g);var c=r();s(f,c)?(new Date).getTime()-e.time<500&&Math.abs(e.x-a)<10&&Math.abs(e.y-b)<10&&g[0].focus():d.reorderDone(g.closest(d.list),g,c),i.remove(),i=null,g.removeClass(d.itemMovingClass),g=null,e=null},n=function(a,b){var d;switch(a.keyCode){case c.space:case c.arrowRight:case c.arrowDown:a.preventDefault(),a.stopPropagation(),d=document.getElementById(b.attr("id"));var e=d.nextSibling;null!==e&&e.parentNode.insertBefore(e,e.previousSibling);break;case c.arrowLeft:case c.arrowUp:a.preventDefault(),a.stopPropagation(),d=document.getElementById(b.attr("id"));var f=d.previousSibling;null!==f&&f.parentNode.insertBefore(f,f.nextSibling.nextSibling)}},o=function(a){return a.offset().left+a.outerWidth()/2},p=function(a){return a.offset().top+a.outerHeight()/2},q=function(b,c){var d=a(b),e=a(c),f=o(d)-o(e),g=p(d)-p(e);return Math.sqrt(f*f+g*g)},r=function(){return(g||h).closest(d.list).find(d.item).map(function(a,b){return d.idGetter(b)}).get()},s=function(a,b){return a.length===b.length&&a.every(function(a,c){return a===b[c]})};d.itemInPage=l(d.list,d.item),a(d.list).on("mousedown touchstart",d.item,function(a){var c=b.prepare(a);c.start&&j(a,c)}),a(d.list).on("keydown",d.item,function(b){h=a(b.currentTarget).closest(d.itemInPage),f=r(),n(b,h);var c=r();s(f,c)||d.reorderDone(h.closest(d.list),h,c)}),a(d.itemInPage).attr("tabindex","0")}});
define('qtype_ordering/dragdrop', ["jquery","qtype_ordering/autoscroll"],function(a,b){var c={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(a){a.preventDefault();var b;if(b="touchstart"===a.type?null===c.touching&&a.changedTouches.length>0:1===a.which){var d=c.getEventXY(a);return d.start=!0,d}return{start:!1}},start:function(a,d,e,f){var g=c.getEventXY(a);switch(c.initialX=g.x,c.initialY=g.y,c.initialPosition=d.offset(),c.dragProxy=d,c.onMove=e,c.onDrop=f,a.type){case"mousedown":c.addEventSpecial("mousemove",c.mouseMove),c.addEventSpecial("mouseup",c.mouseUp);break;case"touchstart":c.addEventSpecial("touchend",c.touchEnd),c.addEventSpecial("touchcancel",c.touchEnd),c.addEventSpecial("touchmove",c.touchMove),c.touching=a.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+a.type)}b.start(c.scroll)},addEventSpecial:function(a,b){try{window.addEventListener(a,b,c.eventCaptureOptions)}catch(d){c.eventCaptureOptions=!0,window.addEventListener(a,b,c.eventCaptureOptions)}},getEventXY:function(a){switch(a.type){case"touchstart":return{x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};case"mousedown":return{x:a.pageX,y:a.pageY};default:throw new Error("Unexpected event type: "+a.type)}},touchMove:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleMove(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseMove:function(a){c.handleMove(a.pageX,a.pageY)},handleMove:function(b,d){var e=c.dragProxy.offset(),f=e.top-parseInt(c.dragProxy.css("top")),g=e.left-parseInt(c.dragProxy.css("left")),h=a(document).height()-c.dragProxy.outerHeight()-f,i=a(document).width()-c.dragProxy.outerWidth()-g,j=-f,k=-g,l=c.initialPosition,m={top:Math.max(j,Math.min(h,l.top+(d-c.initialY)-f)),left:Math.max(k,Math.min(i,l.left+(b-c.initialX)-g))};c.dragProxy.css(m),c.onMove(b,d,c.dragProxy)},touchEnd:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleEnd(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseUp:function(a){c.handleEnd(a.pageX,a.pageY)},handleEnd:function(a,d){null!==c.touching?(window.removeEventListener("touchend",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchcancel",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchmove",c.touchMove,c.eventCaptureOptions),c.touching=null):(window.removeEventListener("mousemove",c.mouseMove,c.eventCaptureOptions),window.removeEventListener("mouseup",c.mouseUp,c.eventCaptureOptions)),b.stop(),c.onDrop(a,d,c.dragProxy)},scroll:function(b){var d=a(document).height()-c.dragProxy.outerHeight(),e=c.dragProxy.offset();e.top=Math.min(d,e.top+b),c.dragProxy.css(e)}};return{prepare:c.prepare,start:c.start}});
define('qtype_ordering/key_codes', function(){return{tab:9,enter:13,escape:27,space:32,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,8:56,asterix:106,pageUp:33,pageDown:34}});
define('qtype_ordering/reorder', ["jquery","qtype_ordering/drag_reorder"],function(a,b){return{init:function(c,d){new b({list:"ul#"+c,item:"li.sortableitem",proxyHtml:'<div class="que ordering dragproxy"><ul class="sortablelist"><li class="%%ITEM_CLASS_NAME%% item-moving">%%ITEM_HTML%%</li></ul></div>',itemMovingClass:"current-drop",idGetter:function(b){return a(b).attr("id")},nameGetter:function(b){return a(b).text},reorderStart:function(){},reorderEnd:function(){},reorderDone:function(b,c,e){a("input#"+d)[0].value=e.join(",")}})}}});
define('qtype_pmatch/rulecreator', ["jquery"],function(a){var b={store:{},init:function(){a('textarea[name^="answer"]').each(function(){var c=a(this).attr("id").replace("id_answer_",""),d="id_"+c;b.store[d]=[],""!==a(this).val()?a(this).parent().parent().next().addClass("rc-hidden"):a(this).parent().parent().next().addClass("rcw");var e=a(this).parent().parent().next().find("div.rule-creator");e.attr("id","rc_"+c),a(this).parent().parent().next().find("a.rule-creator-btn").attr("id","rc_btn_"+c),e.find('div[class="rc-notice"]').attr("id","rc_notice_"+c),e.find('label[for="term"]').attr("for","rc_term_"+c),e.find('input[name="term"]').attr("id","rc_term_"+c),e.find('input[name="termadd"]').attr("id","rc_termadd_"+c).click(function(){return b.termAdd(c),!1}),e.find('input[name="termexclude"]').attr("id","rc_termexclude_"+c).click(function(){return b.termExclude(c),!1}),e.find('input[name="termor"]').attr("id","rc_termor_"+c).click(function(){return b.termOr(c),!1}),e.find('label[for="template"]').attr("for","rc_template_"+c),e.find('input[name="template"]').attr("id","rc_template_"+c),e.find('input[name="templateadd"]').attr("id","rc_templateadd_"+c).click(function(){return b.templateAdd(c),!1}),e.find('input[name="templateexclude"]').attr("id","rc_templateexclude_"+c).click(function(){return b.templateExclude(c),!1}),e.find('label[for="precedesadd"]').attr("for","rc_precedes1_"+c),e.find('select[name="precedes1"]').attr("id","rc_precedes1_"+c),e.find('select[name="precedes2"]').attr("id","rc_precedes2_"+c),e.find('input[name="precedesadd"]').attr("id","rc_precedesadd_"+c).click(function(){return b.precedesAdd(c),!1}),e.find('label[for="cprecedesadd"]').attr("for","rc_cprecedes1_"+c),e.find('select[name="cprecedes1"]').attr("id","rc_cprecedes1_"+c),e.find('select[name="cprecedes2"]').attr("id","rc_cprecedes2_"+c),e.find('input[name="cprecedesadd"]').attr("id","rc_cprecedesadd_"+c).click(function(){return b.cprecedesAdd(c),!1}),e.find("div.rc-result").attr("id","rc_result_"+c),e.find('input[name="add"]').attr("id","rc_add_"+c).click(function(){return b.addToAnswer(c),!1}),e.find('input[name="clear"]').attr("id","rc_clear_"+c).click(function(){return b.clear(c),!1})}),a(".rule-creator-btn").click(function(b){var c=a(b.target).closest(".fitem.rcw"),d=a(b.target).closest(".rule-creator-btn").find("img.icon"),e=d.attr("src");return c.find(".rule-creator").slideToggle(),void 0!==e&&(e=e.indexOf("collapsed")>0?e.slice(0,-9)+"expanded":e.slice(0,-8)+"collapsed",d.attr("src",e),!1)})},termAdd:function(b){var c=this.getTerm(b,"term");if(!c)return void a("#rc_term_"+b).focus();var d=this.addToStore(b,c,"and","term");this.addToPrecedes(b,d,c),this.displayResult(b),a("#rc_term_"+b).val("")},termExclude:function(b){var c=this.getTerm(b,"term");return c?(this.addToStore(b,c,"not","term"),this.disablePrecedes(b,!0),this.displayResult(b),void a("#rc_term_"+b).val("")):void a("#rc_term_"+b).focus()},termOr:function(b){var c=this.getTerm(b,"term");if(!c)return void a("#rc_term_"+b).focus();var d=this.addToStore(b,c,"or","term");this.addToPrecedes(b,d,c),this.displayResult(b),a("#rc_term_"+b).val("")},templateAdd:function(b){var c=this.getTerm(b,"template");if(!c)return void a("#rc_template_"+b).focus();var d=this.addToStore(b,c,"and","template");this.addToPrecedes(b,d,c),this.displayResult(b),a("#rc_template_"+b).val("")},templateExclude:function(b){var c=this.getTerm(b,"template");return c?(this.addToStore(b,c,"not","template"),this.disablePrecedes(b,!0),this.displayResult(b),void a("#rc_template_"+b).val("")):void a("#rc_template_"+b).focus()},precedesAdd:function(a){var b=this.getPrecedesChoices(a,"precedes");b&&(this.addToStore(a,b,"and","precedes"),this.removeFromPrecedes(a,b),this.displayResult(a))},cprecedesAdd:function(a){var b=this.getPrecedesChoices(a,"cprecedes");b&&(this.addToStore(a,b,"and","cprecedes"),this.removeFromPrecedes(a,b),this.displayResult(a))},addToAnswer:function(b){var c=a("#rc_result_"+b).text();null!==c&&""!==c&&(a("#id_answer_"+b).val(c),this.clear(),a("#rc_btn_"+b).click(),a("#id_fraction_"+b).val("1.0").change(),a("#id_answer_"+b).focus())},clear:function(b){var c="id_"+b;this.store[c]=[],a("#rc_term_"+b).val(""),a("#rc_template_"+b).val(""),a("#rc_result_"+b).text(""),this.resetPrecedes(b)},getTerm:function(b,c){if(this.getStoreLength(b)>4)return a("#rc_notice_"+b).text(M.util.get_string("rulecreationtoomanyterms","qtype_pmatch")),!1;var d=a("#rc_"+c+"_"+b).val();return void 0!==d&&null!==d&&""!==d&&(d=d.trim(),""!==d&&(!(d.indexOf(" ")>-1)&&(d.indexOf("_")>-1&&(d=d.replace(/_/g,"\\_")),"term"===c?d:"*"===d.slice(-1)?d:d+"*")))},getPrecedesChoices:function(b,c){var d=a("#rc_"+c+"1_"+b).val();if("0"===d)return a("#rc_"+c+"1_"+b).focus(),!1;var e=a("#rc_"+c+"2_"+b).val();return"0"===e?(a("#rc_"+c+"2_"+b).focus(),!1):d===e?(a("#rc_"+c+"2_"+b).focus(),!1):[d,e]},addToPrecedes:function(b,c,d){a("#rc_precedes1_"+b).append(a("<option>",{value:c}).text(d)),a("#rc_precedes2_"+b).append(a("<option>",{value:c}).text(d)),a("#rc_cprecedes1_"+b).append(a("<option>",{value:c}).text(d)),a("#rc_cprecedes2_"+b).append(a("<option>",{value:c}).text(d))},disablePrecedes:function(b,c){a("#rc_precedes1_"+b).prop("disabled",c),a("#rc_precedes2_"+b).prop("disabled",c),a("#rc_cprecedes1_"+b).prop("disabled",c),a("#rc_cprecedes2_"+b).prop("disabled",c)},resetPrecedes:function(b){this.disablePrecedes(b,!1),a("#rc_precedes1_"+b).find('option[value!="0"]').remove(),a("#rc_precedes2_"+b).find('option[value!="0"]').remove(),a("#rc_cprecedes1_"+b).find('option[value!="0"]').remove(),a("#rc_cprecedes2_"+b).find('option[value!="0"]').remove()},removeFromPrecedes:function(b,c){var d;for(d=0;d<2;d++)a("#rc_precedes1_"+b+' option[value="'+c[d]+'"]').remove(),a("#rc_precedes2_"+b+' option[value="'+c[d]+'"]').remove(),a("#rc_cprecedes1_"+b+' option[value="'+c[d]+'"]').remove(),a("#rc_cprecedes2_"+b+' option[value="'+c[d]+'"]').remove()},addToStore:function(a,b,c,d){var e="id_"+a,f=this.store[e].length+1;return this.store[e].push({termid:f,term:b,op:c,type:d}),f},getStoreLength:function(a){var b="id_"+a;return this.store[b].length},getStoredResult:function(b){var c="id_"+b,d="",e=[],f=this.store[c].slice(0),g=f.length,h=0,i=0,j=0,k=[],l=0;if(0===g)return d;for(h=0;h<g;h++){var m="";"term"===f[h].type&&("and"===f[h].op&&(m="match_w("+f[h].term+")"),"or"===f[h].op&&(m="match_w("+f[h].term+")",h>0&&k.push(h)),"not"===f[h].op&&(m="not(match_w("+f[h].term+"))")),"template"===f[h].type&&("and"===f[h].op&&(m="match_wm("+f[h].term+")"),"not"===f[h].op&&(m="match_wm("+f[h].term+")")),"precedes"===f[h].type&&(i=f[h].term[0]-1,j=f[h].term[1]-1,m=" match_w("+f[i].term+" "+f[j].term+")"),"cprecedes"===f[h].type&&(i=f[h].term[0]-1,j=f[h].term[1]-1,m=" match_w("+f[i].term+"_"+f[j].term+")"),e.push(m)}if(g=e.length,0===g)return"";if(1===g)return e[0];if(l=k.length,0===l){for(d="match_all(\n  "+e[0],h=1;h<g;h++)d=d+" "+e[h];return d+="\n)"}if(g===l+1){for(d="match_any(\n  "+e[0],h=1;h<g;h++)d=d+" "+e[h];return d+="\n)"}if(1===l)if(1===k[0])if(2===g)d="match_any(\n  "+e[0]+" "+e[1]+"\n)";else{for(d="match_all(\n  match_any(\n    "+e[0]+" "+e[1]+"\n  )\n ",h=2;h<g;h++)d=d+" "+e[h];d+="\n)"}else{for(d="match_all(\n    "+e[0],h=1;h<k[0];h++)d=d+" "+e[h];if(d="match_any(\n  "+d+"\n  )\n  "+e[k[0]]+"\n)",g>k[0]+1){for(d="match_all(\n"+d+"\n",h=k[0]+1;h<g;h++)d=d+" "+e[h];d+="\n)"}}else{if(2!==l)return a("#rc_notice_"+b).text(M.util.get_string("rulecreationtoomanyors","qtype_pmatch")),"";if(1===k[0])if(d="match_any(\n  "+e[0]+" "+e[1],2===k[1]){for(d="match_all(\n"+d+" "+e[2]+"\n)\n",h=3;h<g;h++)d=d+" "+e[h];d+="\n)"}else{for(d="match_all(\n"+d+"\n)\n",h=2;h<k[1];h++)d=d+" "+e[h];if(d="match_any(\n"+d+"\n)\n "+e[k[1]],g>k[1]+1){for(d="\nmatch_all(\n"+d,h=k[1]+1;h<g;h++)d=d+" "+e[h];d+="\n)"}d+="\n)"}else{for(d="match_all(\n"+e[0],h=1;h<k[0];h++)d=d+" "+e[h];if(d="match_any(\n"+d+"\n)\n  "+e[k[0]],k[1]===k[0]+1){if(d=d+" "+e[k[1]]+"\n)\n",g>k[1]+1){for(d="match_all(\n"+d,h=k[1]+1;h<g;h++)d=d+" "+e[h];d+="\n)"}}else{for(d="match_all(\n"+d+"\n)\n",h=k[0]+1;h<k[1];h++)d=d+" "+e[h];if(d="match_any(\n"+d+"\n)\n"+e[k[1]]+"\n)\n",g>k[1]+1){for(d="match_all(\n"+d,h=k[1]+1;h<g;h++)d=d+" "+e[h];d+="\n)\n"}}}}return d.trim()},displayResult:function(b){var c=this.getStoredResult(b);a("#rc_result_"+b).text(c)}};return b});
define('qtype_pmatch/tryrule', ["jquery"],function(a){var b={baseUrl:"",sessKey:"",qid:"",pendingid:"",init:function(){b.pendingid="tryrule_"+Math.random().toString(36).slice(2);var c=window.location;b.baseUrl=c.protocol+"//"+c.host+c.pathname.replace("question.php","type/pmatch/api/api.php"),b.sessKey=a('#mform1 input[name="sesskey"]').val(),b.qid=a('#mform1 input[name="id"]').val(),a('textarea[name^="answer"]').each(function(){var b=a(this).attr("id").replace("id_answer_","");a(this).parent().parent().next().next().find("input").attr("id","id_tryrule_"+b)}),a('input[name="tryrule"]').on("click",function(c){c.preventDefault();var d=a(this).attr("id").replace("id_tryrule_","");b.tryrule(d)})},tryrule:function(c){M.util.js_pending(b.pendingid);var d=a("#id_answer_"+c).val();if(void 0!==d&&null!==d&&""!==d&&(d=d.trim(),""!==d)){var e=a("#id_tryrule_"+c).next(),f=a("#id_fraction_"+c).val(),g={type:"tryrule",qid:b.qid,ruletxt:d,sesskey:b.sessKey,fraction:f};a.post(b.baseUrl,g,function(a){e.html(a),M.util.js_complete(b.pendingid)},"json")}}};return b});
define('qtype_pmatch/updater', ["jquery","core/notification"],function(a,b){var c={baseUrl:"",sessKey:"",qid:"",headerCheckboxChecked:!0,REPLACESTRING:/qtype-pmatch-testquestion_r/g,init:function(){var d=a("#attemptsform").attr("action"),e=a("body");c.baseUrl=d.replace("testquestion.php","api/updater.php"),c.sessKey=a('#attemptsform input[name="sesskey"]').val(),c.qid=a('#attemptsform input[name="id"]').val(),a(document).on("click",".updater-ef",function(){var b=a(this).data("id");return c.update(b),!1}),a(document).on("keypress","#tablecontainer :checkbox",function(b){13==(b.keyCode?b.keyCode:b.which)&&(b.preventDefault(),a(this).trigger("click"))}),a("#tqheadercheckbox").click(function(){c.headerCheckboxChecked?(a(this).attr("title",M.util.get_string("deselectall","moodle")),c.headerCheckboxChecked=!1):(a(this).attr("title",M.util.get_string("selectall","moodle")),c.headerCheckboxChecked=!0),a("#tablecontainer :checkbox").each(function(){this.checked=!c.headerCheckboxChecked}),a(this).prop("checked",!1)}),e.on("updatefailed","[data-inplaceeditable]",function(a){var c=a.exception;a.preventDefault(),b.alert(M.util.get_string("error:title","qtype_pmatch"),c.message,M.util.get_string("ok","moodle"))}),e.on("updated","[data-inplaceeditable]",function(a){c.handleUpdated(a,this)}),c.bindInplaceEditEvent()},bindInplaceEditEvent:function(){a("#qtype-pmatch-testquestion_r0").hasClass("emptyrow")&&require(["core/inplace_editable"])},handleUpdated:function(b,d){var e=b.ajaxreturn;if(e.value!==b.oldvalue){var f=a.parseJSON(e.value),g=a(d).parent().parent(),h=g.attr("id"),i=f.html;a(g).replaceWith(i.replace(c.REPLACESTRING,h)),a("#testquestion_gradesummary").html(f.summary)}},update:function(b){var d=a("#updater-ef_"+b).text(),e=0;e="1"===d?0:1;var f={qid:c.qid,rid:b,expectedfraction:e,sesskey:c.sessKey};a.post(c.baseUrl,f,function(c){if("success"===c.status){a("#updater-ef_"+b).text(c.ef),a("#updater-ef_"+b).parent().prev().text(c.gf);var d=a("#updater-ef_"+b).parent().parent();d.removeClass(),d.addClass(c.rowclass),d.find('td[class="c3"]').text(c.gf);var e=M.util.get_string("testquestionresultssummary","qtype_pmatch",c.counts);a("#testquestion_gradesummary").html(e)}else window.console.log("Testquestion response updater has experienced an issue.\n"+c.data)})}};return c});
define('qtype_pmatch/creator', ["jquery","core/str","core/ajax","core/templates","core/key_codes"],function(a,b,c,d,e){var f={newRowId:"",idxLastRow:0,questionId:"",init:function(){f.questionId=a('#attemptsform input[name="id"]').val(),f.table=a("#responses"),f.idxLastRow=f.table.find("tbody tr").length-1,f.disableControlButtonAndSelectionBox(),a("#newresponsebutton").click(function(b){b.preventDefault(),f.idxLastRow++,f.newRowId="qtype-pmatch-new-response_"+f.idxLastRow,d.render("qtype_pmatch/newresponse",{newrowid:f.newRowId}).done(function(b){f.table.append(b),a("html, body").animate({scrollTop:a("#"+f.newRowId).offset().top},800),a(".new-expectedfraction").focus(),M.core_formchangechecker.set_form_changed()}),f.disableControlButtons(!0)});var b=null;a(document).on("keyup paste",".new-response",function(){var c=a(this).val().trim();b&&(M.util.js_complete("checkresponse"),clearTimeout(b)),M.util.js_pending("checkresponse"),b=setTimeout(function(){""===c?f.handleSaveNewResponseButton(!1,""):f.checkResponse(c),M.util.js_complete("checkresponse")},500)}),a(document).on("keydown",".new-response",function(a){if(a.keyCode==e.enter)return f.saveNewResponse(),!1}),a(document).on("keydown",".new-expectedfraction, .new-response, .savenewresponse, .cancelnewresponse",function(a){a.keyCode==e.escape&&f.cancelNewResponse()}),a(document).on("click",".savenewresponse",function(){return f.saveNewResponse()}),a(document).on("click",".cancelnewresponse",function(){f.cancelNewResponse()})},saveNewResponse:function(){var b=a(".new-response").val().trim();if(""!==b){var d=a(".new-expectedfraction").is(":checked")?1:0,e=c.call([{methodname:"qtype_pmatch_create_response",args:{questionid:f.questionId,expectedfraction:d,response:b,curentrow:f.idxLastRow}}],!0);e[0].done(function(b){if("error"===b.status)f.handleSaveNewResponseButton(!1,b.message);else{f.disableControlButtons(!1),a("#"+f.newRowId).detach(),f.table.append(a(b.html));var c=M.util.get_string("testquestionresultssummary","qtype_pmatch",b.counts);a("#testquestion_gradesummary").html(c)}}).fail(function(a){f.handleSaveNewResponseButton(!1,a.message)}),f.disableControlButtonAndSelectionBox(),f.resetFormState()}},cancelNewResponse:function(){a("#"+f.newRowId).remove(),f.disableControlButtons(!1),f.disableControlButtonAndSelectionBox(),f.resetFormState(),f.idxLastRow--},checkResponse:function(a){var b=c.call([{methodname:"qtype_pmatch_check_response",args:{questionid:f.questionId,response:a}}],!0);b[0].done(function(a){var b=!1;"success"==a.status&&(a.message="",b=!0),f.handleSaveNewResponseButton(b,a.message)}).fail(function(a){f.handleSaveNewResponseButton(!1,a.message)})},handleSaveNewResponseButton:function(b,c){b?a(".savenewresponse").removeAttr("disabled"):a(".savenewresponse").attr("disabled","true"),a(".response.error").html(c)},disableControlButtons:function(b){b?(a("#newresponsebutton").attr("disabled","true"),a("#deleteresponsesbutton").attr("disabled","true"),a("#testresponsesbutton").attr("disabled","true")):(a("#newresponsebutton").removeAttr("disabled"),a("#deleteresponsesbutton").removeAttr("disabled"),a("#testresponsesbutton").removeAttr("disabled"))},resetFormState:function(){M.core_formchangechecker.get_form_dirty_state()&&M.core_formchangechecker.reset_form_dirty_state()},disableControlButtonAndSelectionBox:function(){var b=a("#tqheadercheckbox"),c=a("#responses");c.find("tbody tr:not(.emptyrow)").length<=0?(b.attr("disabled",!0),a("#deleteresponsesbutton").attr("disabled","true"),a("#testresponsesbutton").attr("disabled","true")):(b.removeAttr("disabled"),a("#deleteresponsesbutton").removeAttr("disabled"),a("#testresponsesbutton").removeAttr("disabled"))}};return f});
define('qtype_pmatchjme/jsme', ["jquery"],function(a){"use strict";var b={max_loading_waits:10,insert_applet:function(a,c,d,e,f,g){var h=[];f&&h.push("nostereo"),g&&h.push("autoez"),e&&h.push("depict"),b.show_jsme(c,a,h,b.max_loading_waits)},show_jsme:function(c,d,e,f){var g=a(c),h=!1,i=!1;return"object"!=typeof JSApplet&&f>0?void setTimeout(function(){b.show_jsme(c,d,e,f-1)},100):(a("#"+d).html(""),a("#"+d).removeClass("qtype_pmatchjme-applet-warning"),i=new JSApplet.JSME(d,"368px","312px",{options:e.join(",")}),i.name=d,h=g.find("input.jme").val(),h&&i.readMolecule(h),void g.parents("form").on("submit",function(){g.find("input.answer").val(i.smiles()),g.find("input.jme").val(i.jmeFile()),g.find("input.mol").val(i.molFile())}))}};return b});
define('qtype_stack/jsxgraph', ["qtype_stack/jsxgraphcore-lazy"],function(a){return{find_input_id:function(a,b){for(var c=document.getElementById(a);(c=c.parentElement)&&(!c.classList.contains("formulation")||!c.parentElement.classList.contains("content")););return c=c.querySelector('input[id$="_'+b+'"]'),c.addEventListener("change",function(a){M.core_formchangechecker.set_form_changed()}),c.id},bind_point:function(b,c){var d=document.getElementById(b);if(d.value&&""!=d.value){var e=JSON.parse(d.value);try{c.setPosition(a.COORDS_BY_USER,e)}catch(f){}c.board.update(),c.update()}var g=c.X(),h=c.Y();c.board.on("update",function(){if(g!=c.X()||h!=c.Y()){var a=JSON.stringify([c.X(),c.Y()]);if(g=!1,h=!1,d.value!=a){d.value=a;var b=new Event("change");d.dispatchEvent(b)}}});var i=JSON.stringify([c.X(),c.Y()]);d.addEventListener("input",function(b){if(d.value!=i){try{var e=JSON.parse(d.value);"number"==typeof e[0]&&"number"==typeof e[1]&&(c.setPosition(a.COORDS_BY_USER,e),c.board.update(),c.update())}catch(f){}i=d.value}}),d.addEventListener("change",function(b){if(d.value!=i){try{var e=JSON.parse(d.value);"number"==typeof e[0]&&"number"==typeof e[1]&&(c.setPosition(a.COORDS_BY_USER,e),c.board.update(),c.update())}catch(f){}i=d.value}})},bind_slider:function(a,b){var c=document.getElementById(a);if(c.value&&""!=c.value){try{b.setValue(JSON.parse(c.value))}catch(d){}b.board.update(),b.update()}var e=b.Value();b.board.on("update",function(){if(e!=b.Value()){var a=JSON.stringify(b.Value());if(e=!1,c.value!=a){c.value=a;var d=new Event("change");c.dispatchEvent(d)}}});var f=JSON.stringify(b.Value());c.addEventListener("input",function(a){if(c.value!=f){try{var d=JSON.parse(c.value);"number"==typeof d&&(b.setValue(d),b.board.update(),b.update())}catch(e){}f=c.value}}),c.addEventListener("change",function(a){if(c.value!=f){try{var d=JSON.parse(c.value);"number"==typeof d&&(b.setValue(d),b.board.update(),b.update())}catch(e){}f=c.value}})}}});
define('mod_assign/grading_actions', ["jquery","mod_assign/grading_events"],function(a,b){var c=function(b){this._regionSelector=b,this._region=a(b),this.registerEventListeners()};return c.prototype._regionSelector=null,c.prototype._lastUserId=0,c.prototype._region=null,c.prototype._showActionsForm=function(a,b){var c=this._region.find("[data-region=grading-actions-form]");b!=this._lastUserId&&b>0&&(this._lastUserId=b),b>0?c.removeClass("hide"):c.addClass("hide")},c.prototype._trigger=function(b){a(document).trigger(b)},c.prototype.getReviewPanelElement=function(){return a('[data-region="review-panel"]')},c.prototype.hasReviewPanelElement=function(){return this.getReviewPanelElement().length>0},c.prototype.getCollapseGradePanelButton=function(){return a('[data-region="grade-actions"] .collapse-grade-panel')},c.prototype.getCollapseReviewPanelButton=function(){return a('[data-region="grade-actions"] .collapse-review-panel')},c.prototype.getExpandAllPanelsButton=function(){return a('[data-region="grade-actions"] .collapse-none')},c.prototype.resetLayoutButtons=function(){this.getCollapseGradePanelButton().removeClass("active"),this.getCollapseReviewPanelButton().removeClass("active"),this.getExpandAllPanelsButton().removeClass("active")},c.prototype.collapseReviewPanel=function(){a(document).trigger(b.COLLAPSE_REVIEW_PANEL),a(document).trigger(b.EXPAND_GRADE_PANEL),this.resetLayoutButtons(),this.getCollapseReviewPanelButton().addClass("active")},c.prototype.collapseGradePanel=function(){a(document).trigger(b.COLLAPSE_GRADE_PANEL),a(document).trigger(b.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getCollapseGradePanelButton().addClass("active")},c.prototype.expandAllPanels=function(){a(document).trigger(b.EXPAND_GRADE_PANEL),a(document).trigger(b.EXPAND_REVIEW_PANEL),this.resetLayoutButtons(),this.getExpandAllPanelsButton().addClass("active")},c.prototype.registerEventListeners=function(){if(this.hasReviewPanelElement()){var b=this.getCollapseReviewPanelButton();b.click(function(a){this.collapseReviewPanel(),a.preventDefault()}.bind(this)),b.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.collapseReviewPanel(),a.preventDefault())}.bind(this));var c=this.getCollapseGradePanelButton();c.click(function(a){this.collapseGradePanel(),a.preventDefault()}.bind(this)),c.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.collapseGradePanel(),a.preventDefault())}.bind(this));var d=this.getExpandAllPanelsButton();d.click(function(a){this.expandAllPanels(),a.preventDefault()}.bind(this)),d.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.expandAllPanels(),a.preventDefault())}.bind(this))}a(document).on("user-changed",this._showActionsForm.bind(this)),this._region.find('[name="savechanges"]').on("click",this._trigger.bind(this,"save-changes")),this._region.find('[name="saveandshownext"]').on("click",this._trigger.bind(this,"save-and-show-next")),this._region.find('[name="resetbutton"]').on("click",this._trigger.bind(this,"reset")),this._region.find("form").on("submit",function(a){a.preventDefault()})},c});
define('mod_assign/grading_events', function(){return{COLLAPSE_REVIEW_PANEL:"grading:collapse-review-panel",EXPAND_REVIEW_PANEL:"grading:expand-review-panel",COLLAPSE_GRADE_PANEL:"grading:collapse-grade-panel",EXPAND_GRADE_PANEL:"grading:expand-grade-panel"}});
define('mod_assign/grading_form_change_checker', ["jquery"],function(a){return{saveFormState:function(b){a(b).trigger("save-form-state");var c=a(b).serialize();a(b).data("saved-form-state",c)},checkFormForChanges:function(b){a(b).trigger("save-form-state");var c=a(b).serialize(),d=a(b).data("saved-form-state");return"undefined"!=typeof d&&d!=c}}});
define('mod_assign/grading_navigation', ["jquery","core/notification","core/str","core/form-autocomplete","core/ajax","mod_assign/grading_form_change_checker"],function(a,b,c,d,e,f){var g=function(e){this._regionSelector=e,this._region=a(e),this._filters=[],this._users=[],this._filteredUsers=[],this._loadAllUsers(),this._region.find('[data-action="previous-user"]').on("click",this._handlePreviousUser.bind(this)),this._region.find('[data-action="next-user"]').on("click",this._handleNextUser.bind(this)),this._region.find('[data-action="change-user"]').on("change",this._handleChangeUser.bind(this)),this._region.find('[data-region="user-filters"]').on("click",this._toggleExpandFilters.bind(this)),a(document).on("user-changed",this._refreshSelector.bind(this)),a(document).on("done-saving-show-next",this._handleNextUser.bind(this));var f=this._region.find('[data-region="user-filters"]'),g=a(document.getElementById(f.attr("aria-controls")));g.on("change",'[type="checkbox"]',this._filterChanged.bind(this));var h=a('[data-region="grading-navigation-panel"]').data("first-userid");h&&this._selectUserById(h),c.get_string("changeuser","mod_assign").done(function(a){d.enhance("[data-action=change-user]",!1,"mod_assign/participant_selector",a)}).fail(b.exception),a(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this)),a(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};return g.prototype._isLoading=!1,g.prototype._regionSelector=null,g.prototype._filters=null,g.prototype._users=null,g.prototype._region=null,g.prototype._loadAllUsers=function(){var a=this._region.find("[data-action=change-user]"),c=a.attr("data-assignmentid"),d=a.attr("data-groupid");e.call([{methodname:"mod_assign_list_participants",args:{assignid:c,groupid:d,filter:"",onlyids:!0},done:this._usersLoaded.bind(this),fail:b.exception}])},g.prototype._usersLoaded=function(b){if(this._filteredUsers=this._users=b,this._users.length){var c=this._region.find('[data-region="user-filters"]'),d=a(document.getElementById(c.attr("aria-controls")));d.find('[type="checkbox"]').trigger("change")}else this._selectNoUser();this._triggerNextUserEvent()},g.prototype._checkClickOutsideConfigureFilters=function(b){var c=this._region.find('[data-region="configure-filters"]');if(!c.is(b.target)&&0===c.has(b.target).length){var d=this._region.find('[data-region="user-filters"]');c.hide(),c.attr("aria-hidden","true"),d.attr("aria-expanded","false"),a(document).unbind("click.mod_assign_grading_navigation")}},g.prototype._filterChanged=function(d){var e=a(d.target).attr("name"),f=e.split("_").pop(),g=a(d.target).prop("checked");if(g)this._filters.indexOf(f)==-1&&(this._filters[this._filters.length]=f);else{var h=this._filters.indexOf(f);h!=-1&&this._filters.splice(h,1)}var i=[];this._region.find('[data-region="configure-filters"]').find('[type="checkbox"]').each(function(b,c){a(c).prop("checked")&&(i[i.length]=a(c).closest("label").text())}),i.length?this._region.find('[data-region="user-filters"] span').text(i.join(", ")):c.get_string("nofilters","mod_assign").done(function(a){this._region.find('[data-region="user-filters"] span').text(a)}.bind(this)).fail(b.exception);var j=this._region.find("[data-action=change-user]"),k=j.attr("data-selected"),l=0;this._filteredUsers=[],a.each(this._users,function(b,c){var d=!0;a.each(this._filters,function(a,b){"submitted"==b?"0"==c.submitted&&(d=!1):"notsubmitted"==b?"1"==c.submitted&&(d=!1):"requiregrading"==b?"0"==c.requiregrading&&(d=!1):"grantedextension"==b&&"0"==c.grantedextension&&(d=!1)}),d&&(this._filteredUsers[this._filteredUsers.length]=c,k==c.id&&(l=this._filteredUsers.length-1))}.bind(this)),this._filteredUsers.length?this._selectUserById(this._filteredUsers[l].id):this._selectNoUser(),this._triggerNextUserEvent()},g.prototype._selectNoUser=function(){this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",-1)})}):a(document).trigger("user-changed",-1))},g.prototype._selectUserById=function(d){var e=this._region.find("[data-action=change-user]"),g=parseInt(d,10);this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",g)})}):(e.attr("data-selected",d),!isNaN(g)&&g>0&&a(document).trigger("user-changed",d)))},g.prototype._toggleExpandFilters=function(b){b.preventDefault();var c=a(b.target).closest('[data-region="user-filters"]'),d="true"==c.attr("aria-expanded"),e=a(document.getElementById(c.attr("aria-controls")));d?(e.hide(),e.attr("aria-hidden","true"),c.attr("aria-expanded","false"),a(document).unbind("click.mod_assign_grading_navigation")):(e.css("display","inline-block"),e.attr("aria-hidden","false"),c.attr("aria-expanded","true"),b.stopPropagation(),a(document).on("click.mod_assign_grading_navigation",this._checkClickOutsideConfigureFilters.bind(this)))},g.prototype._handlePreviousUser=function(a){a.preventDefault();var b=this._region.find("[data-action=change-user]"),c=b.attr("data-selected"),d=0,e=0;for(d=0;d<this._filteredUsers.length;d++)if(this._filteredUsers[d].id==c){e=d;break}var f=this._filteredUsers.length,g=e-1;g<0&&(g=f-1),f&&this._selectUserById(this._filteredUsers[g].id)},g.prototype._handleNextUser=function(b,c){b.preventDefault();var d=this._region.find("[data-action=change-user]"),e=d.attr("data-selected"),f=0,g=0;for(f=0;f<this._filteredUsers.length;f++)if(this._filteredUsers[f].id==e){g=f;break}var h=this._filteredUsers.length,i=(g+1)%h;if(c&&h){var j=this._filteredUsers[i].id,k=parseInt(j,10);d.attr("data-selected",j),!isNaN(k)&&k>0&&a(document).trigger("user-changed",j)}else h&&this._selectUserById(this._filteredUsers[i].id)},g.prototype._refreshCount=function(){var a=this._region.find("[data-action=change-user]"),d=a.attr("data-selected"),e=0,f=0;if(isNaN(d)||d<=0)this._region.find('[data-region="user-count"]').hide();else{for(this._region.find('[data-region="user-count"]').show(),e=0;e<this._filteredUsers.length;e++)if(this._filteredUsers[e].id==d){f=e;break}var g=this._filteredUsers.length;g&&(f+=1);var h={x:f,y:g};c.get_string("xofy","mod_assign",h).done(function(a){this._region.find('[data-region="user-count-summary"]').text(a)}.bind(this)).fail(b.exception)}},g.prototype._refreshSelector=function(a,b){var c=this._region.find("[data-action=change-user]");b=parseInt(b,10),!isNaN(b)&&b>0&&c.attr("data-selected",b),this._refreshCount()},g.prototype._triggerNextUserEvent=function(){this._filteredUsers.length>1?a(document).trigger("next-user",{nextUserId:null,nextUser:!0}):a(document).trigger("next-user",{nextUser:!1})},g.prototype._handleChangeUser=function(){var d=this._region.find("[data-action=change-user]"),e=parseInt(d.val(),10);this._isLoading||(f.checkFormForChanges('[data-region="grade-panel"] .gradeform')?c.get_strings([{key:"unsavedchanges",component:"mod_assign"},{key:"unsavedchangesquestion",component:"mod_assign"},{key:"saveandcontinue",component:"mod_assign"},{key:"cancel",component:"core"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){a(document).trigger("save-changes",e)})}):!isNaN(e)&&e>0&&(d.attr("data-selected",e),a(document).trigger("user-changed",e)))},g});
define('mod_assign/grading_navigation_user_info', ["jquery","core/notification","core/ajax","core/templates"],function(a,b,c,d){var e=function(b){this._regionSelector=b,this._region=a(b),this._userCache={},a(document).on("user-changed",this._refreshUserInfo.bind(this))};return e.prototype._regionSelector=null,e.prototype._userCache=null,e.prototype._region=null,e.prototype._lastUserId=0,e.prototype._getAssignmentId=function(){return this._region.attr("data-assignmentid")},e.prototype._refreshUserInfo=function(e,f){var g=a.Deferred();this._lastUserId!=f&&(this._lastUserId=f,d.render("mod_assign/loading",{}).done(function(e,h){if(this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,h),this._region.fadeIn("fast")}.bind(this)),f<0)return void d.render("mod_assign/grading_navigation_no_users",{}).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception);if("undefined"!=typeof this._userCache[f])g.resolve(this._userCache[f]);else{var i=this._getAssignmentId(),j=c.call([{methodname:"mod_assign_get_participant",args:{userid:f,assignid:i,embeduser:!0}}]);j[0].done(function(a){a.hasOwnProperty("id")?(this._userCache[f]=a,g.resolve(this._userCache[f])):g.reject("No users")}.bind(this)).fail(b.exception)}g.done(function(c){var e=a("[data-showuseridentity]").data("showuseridentity").split(","),f=[];c.courseid=a('[data-region="grading-navigation-panel"]').attr("data-courseid"),c.user&&(a.each(e,function(a,b){"undefined"!=typeof c.user[b]&&""!==c.user[b]&&(c.hasidentity=!0,f.push(c.user[b]))}),c.identity=f.join(", "),c.user.profileimageurl&&(c.profileimageurl=c.user.profileimageurl)),d.render("mod_assign/grading_navigation_user_summary",c).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception)}.bind(this)).fail(function(){d.render("mod_assign/grading_navigation_no_users",{}).done(function(a,b){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,a,b),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(b.exception)}.bind(this))}.bind(this)).fail(b.exception))},e});
define('mod_assign/grading_panel', ["jquery","core/yui","core/notification","core/templates","core/fragment","core/ajax","core/str","mod_assign/grading_form_change_checker","mod_assign/grading_events"],function(a,b,c,d,e,f,g,h,i){var j=function(b){this._regionSelector=b,this._region=a(b),this._userCache=[],this.registerEventListeners()};return j.prototype._regionSelector=null,j.prototype._lastUserId=0,j.prototype._lastAttemptNumber=-1,j.prototype._region=null,j.prototype.nextUserId=null,j.prototype.nextUser=!1,j.prototype._niceReplaceNodeContents=function(b,c,e){var f=a.Deferred();return b.fadeOut("fast",function(){d.replaceNodeContents(b,c,e),b.fadeIn("fast",function(){f.resolve()})}),f.promise()},j.prototype._saveFormState=function(){"undefined"!=typeof window.tinyMCE&&window.tinyMCE.triggerSave();var b=a('[data-region="grading-actions-form"] [name="sendstudentnotifications"]').prop("checked");a('.gradeform [name="sendstudentnotifications"]').val(b)},j.prototype._submitForm=function(b,d,e){var g=a(this._region.find("form.gradeform"));a('[data-region="overlay"]').show(),g.trigger("save-form-state");var h=g.serialize(),i=this._region.attr("data-assignmentid");f.call([{methodname:"mod_assign_submit_grading_form",args:{assignmentid:i,userid:this._lastUserId,jsonformdata:JSON.stringify(h)},done:this._handleFormSubmissionResponse.bind(this,h,d,e),fail:c.exception}])},j.prototype._handleFormSubmissionResponse=function(d,e,f,h){"undefined"==typeof e&&(e=this._lastUserId),h.length?a(document).trigger("reset",[this._lastUserId,d]):(g.get_strings([{key:"changessaved",component:"core"},{key:"gradechangessaveddetail",component:"mod_assign"}]).done(function(a){c.alert(a[0],a[1])}).fail(c.exception),b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),e==this._lastUserId?a(document).trigger("reset",e):f?a(document).trigger("done-saving-show-next",!0):a(document).trigger("user-changed",e)),a('[data-region="overlay"]').hide()},j.prototype._resetForm=function(b,c,d){var e=a.Event("custom");"undefined"==typeof c&&(c=this._lastUserId),this._lastUserId=0,this._refreshGradingPanel(e,c,d)},j.prototype._chooseAttempt=function(b){var d=a(b.target),e=d.data("submissions"),f=a(document.getElementById(e)),h=f.clone(),i=h.wrap(a("<form/>")).html();g.get_strings([{key:"viewadifferentattempt",component:"mod_assign"},{key:"view",component:"core"},{key:"cancel",component:"core"}]).done(function(b){c.confirm(b[0],i,b[1],b[2],function(){var b=a("input:radio[name='select-attemptnumber']:checked").val();this._refreshGradingPanel(null,this._lastUserId,"",b)}.bind(this))}.bind(this)).fail(c.exception)},j.prototype._addPopoutButtons=function(b){var e=a(b);d.render("mod_assign/popout_button",{}).done(function(a){var b=e.find('[data-fieldtype="filemanager"],[data-fieldtype="editor"],[data-fieldtype="grading"]').closest(".fitem");b.addClass("has-popout").find("label").parent().append(a),e.on("click",'[data-region="popout-button"]',this._togglePopout.bind(this))}.bind(this)).fail(c.exception)},j.prototype._togglePopout=function(b){b.preventDefault();var c=a(b.target).closest(".fitem");c.hasClass("popout")?a(".popout").removeClass("popout"):(a(".popout").removeClass("popout"),c.addClass("popout"),c.addClass("moodle-has-zindex"))},j.prototype._refreshGradingPanel=function(b,f,g,i){var j=this._region.attr("data-contextid");"undefined"==typeof g&&(g=""),"undefined"==typeof i&&(i=-1),this._lastUserId==f&&this._lastAttemptNumber==i&&""===g||(this._lastUserId=f,this._lastAttemptNumber=i,a(document).trigger("start-loading-user"),window.M.util.js_pending("mod-assign-loading-user"),d.render("mod_assign/loading",{}).done(function(b,d){this._niceReplaceNodeContents(this._region,b,d).done(function(){if(f>0){this._region.show();var b={userid:f,attemptnumber:i,jsonformdata:JSON.stringify(g)};e.loadFragment("mod_assign","gradingpanel",j,b).done(function(b,d){this._niceReplaceNodeContents(this._region,b,d).done(function(){h.saveFormState('[data-region="grade-panel"] .gradeform'),a(document).on("editor-content-restored",function(){h.saveFormState('[data-region="grade-panel"] .gradeform')}),a('[data-region="attempt-chooser"]').on("click",this._chooseAttempt.bind(this)),this._addPopoutButtons('[data-region="grade-panel"] .gradeform'),a(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this)).fail(c.exception)}.bind(this)).fail(c.exception),a('[data-region="review-panel"]').show()}else this._region.hide(),a('[data-region="review-panel"]').hide(),a(document).trigger("finish-loading-user"),window.M.util.js_complete("mod-assign-loading-user")}.bind(this))}.bind(this)).fail(c.exception))},j.prototype._getNextUser=function(a,b){this.nextUserId=b.nextUserId,this.nextUser=b.nextUser},j.prototype._handleSaveAndShowNext=function(){this._submitForm(null,this.nextUserId,this.nextUser)},j.prototype.getPanelElement=function(){return a('[data-region="grade-panel"]')},j.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed")},j.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed")},j.prototype.registerEventListeners=function(){var b=a(document),c=a(this._region);c.on("submit","form",function(a){a.preventDefault()}),b.on("next-user",this._getNextUser.bind(this)),b.on("user-changed",this._refreshGradingPanel.bind(this)),b.on("save-changes",this._submitForm.bind(this)),b.on("save-and-show-next",this._handleSaveAndShowNext.bind(this)),b.on("reset",this._resetForm.bind(this)),b.on("save-form-state",this._saveFormState.bind(this)),b.on(i.COLLAPSE_GRADE_PANEL,function(){this.collapsePanel()}.bind(this)),b.on(i.COLLAPSE_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),b.on(i.EXPAND_GRADE_PANEL,function(){this.expandPanel()}.bind(this))},j});
define('mod_assign/grading_review_panel', ["jquery","mod_assign/grading_events"],function(a,b){var c=function(){this._region=a('[data-region="review-panel-content"]'),this.registerEventListeners()};return c.prototype._region=null,c.prototype.getReviewPanel=function(a){var b=this._region.data("panel-owner");return"undefined"==typeof b&&this._region.data("review-panel-plugin",a),this._region.data("review-panel-plugin")==a&&this._region[0]},c.prototype.getTogglePanelButton=function(){return this.getPanelElement().find('[data-region="review-panel-toggle"]')},c.prototype.getPanelElement=function(){return a('[data-region="review-panel"]')},c.prototype.getPanelContentElement=function(){return a('[data-region="review-panel-content"]')},c.prototype.togglePanel=function(){this.getPanelElement().hasClass("collapsed")?a(document).trigger(b.EXPAND_REVIEW_PANEL):a(document).trigger(b.COLLAPSE_REVIEW_PANEL)},c.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed").removeClass("grade-panel-collapsed"),this.getPanelContentElement().attr("aria-hidden",!0)},c.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed"),this.getPanelContentElement().removeAttr("aria-hidden")},c.prototype.registerEventListeners=function(){var c=this.getTogglePanelButton();c.click(function(a){this.togglePanel(),a.preventDefault()}.bind(this)),c.keydown(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||13!==a.keyCode&&32!==a.keyCode||(this.togglePanel(),a.preventDefault())}.bind(this));var d=a(document);d.on(b.COLLAPSE_REVIEW_PANEL,function(){this.collapsePanel()}.bind(this)),d.on(b.COLLAPSE_GRADE_PANEL,function(){this.expandPanel(),this.getPanelElement().addClass("grade-panel-collapsed")}.bind(this)),d.on(b.EXPAND_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),d.on(b.EXPAND_GRADE_PANEL,function(){this.getPanelElement().removeClass("grade-panel-collapsed")}.bind(this))},c});
define('mod_assign/participant_selector', ["core/ajax","jquery","core/templates"],function(a,b,c){return{processResults:function(a,b){return b},transport:function(d,e,f,g){var h=b(d).attr("data-assignmentid"),i=b(d).attr("data-groupid"),j=b('[data-region="configure-filters"] input[type="checkbox"]'),k=[];j.each(function(a,c){k[b(c).attr("name")]=b(c).prop("checked")}),a.call([{methodname:"mod_assign_list_participants",args:{assignid:h,groupid:i,filter:e,limit:30,includeenrolments:!1}}])[0].then(function(a){var d=[],e=b("[data-showuseridentity]").data("showuseridentity").split(",");return b.each(a,function(a,f){var g=f,h=[],i=!0;k.filter_submitted&&!f.submitted&&(i=!1),k.filter_notsubmitted&&f.submitted&&(i=!1),k.filter_requiregrading&&!f.requiregrading&&(i=!1),k.filter_grantedextension&&!f.grantedextension&&(i=!1),i&&(b.each(e,function(a,b){"undefined"!=typeof f[b]&&""!==f[b]&&(g.hasidentity=!0,h.push(f[b]))}),g.identity=h.join(", "),d.push(c.render("mod_assign/list_participant_user_summary",g).then(function(a){return{value:f.id,label:a}})))}),b.when.apply(b,d)}).then(function(){var a=[];arguments[0]&&(a=Array.prototype.slice.call(arguments)),f(a)})["catch"](g)}}});
define('mod_bookingsystem/trafficlightcalendar', ["jquery"],function(a){var b,c,d,e,f,g,h,i=0,j={init:function(i,j,k){f=i,b=a("#trafficlight-calendar"),e=a(".trafficlight-calendar-detail"),c=a("#trafficlight-calendar-previousmonth"),d=a("#trafficlight-calendar-nextmonth"),h=a(".calendar-day.visible-day"),a(c).click(this.previousMonth),a(d).click(this.nextMonth),k?(a("td").click(function(){var b=a(this).find("input:checkbox").get(0);b.checked=!b.checked}),a("td input:checkbox").click(function(){this.checked=!this.checked})):a(h).click(function(){var b=a.inArray(this,h)+1;location.href="#day"+b}),g=j.split(",").filter(String).length,this.switchMonth(),this.initHeaderNavigation(),this.initCalendarBodyArrowNavigate(),a(b).show()},nextMonth:function(){i++,j.switchMonth()},previousMonth:function(){i--,j.switchMonth()},switchMonth:function(){a(e).hide(),a(e[i]).show(),a(c).show(),a(d).show(),1===f?(a(c).hide(),a(d).hide()):0===i?a(c).hide():i===f-1&&a(d).hide()},initCalendarBodyArrowNavigate:function(){a(h).keydown(function(b){var e=b.keyCode,f=a.inArray(this,h);if(9===e&&f+1>=h.length)return!0;if(9===e&&b.shiftKey&&0===f)return!0;b.preventDefault();var i;if(13===e)this.click();else if(37===e||9===e&&b.shiftKey){if(f--,f<0)return;i=a(h[f]),a(i).is(":visible")||a(c).trigger("click"),a(i).focus()}else if(38===e)f-=g,f<0&&(f=0),i=a(h[f]),a(i).is(":visible")||a(c).trigger("click"),a(i).focus();else if(39===e||9===e&&!b.shiftKey){if(f++,f>=h.length)return;i=a(h[f]),a(i).is(":visible")||a(d).trigger("click"),a(i).focus()}else 40===e&&(f+=g,f>=h.length&&(f=h.length-1),i=a(h[f]),a(i).is(":visible")||a(d).trigger("click"),a(i).focus())})},initHeaderNavigation:function(){a(d).keyup(function(b){b.preventDefault();var d=b.keyCode;13===d&&(a(this).trigger("click"),a(this).is(":visible")||a(c).focus())}),a(c).keyup(function(b){b.preventDefault();var c=b.keyCode;13===c&&(a(this).trigger("click"),a(this).is(":visible")||a(d).focus())})}};return j});
define('mod_bookingsystem/experimentinnewwindow', ["jquery"],function(a){var b={init:function(b){if(!window.opener){var c=window.open(window.location+"&inpopup=1","experiment","width=*,height=*");c||a("#popup-message").html(b)}}};return b});
define('mod_bookingsystem/managerlockreason', ["jquery","core/str","core/modal_factory","core/config"],function(a,b,c){var d={dialogue:"",isChangeFormId:!1,init:function(){b.get_strings([{key:"lockreasondialogtitle",component:"mod_bookingsystem"}]).done(function(a){d.lockDialogTitle=a[0]}),d.lockDialog=a("#lockreason_dialog"),a(".action-lock").on("click",function(b){b.preventDefault();var c=a(this).attr("data-timestart"),e=d.lockDialogTitle.replace("%s",c+" slot"),f=a(this).data("url");""!==f&&(d.changeLockFormData(f),d.renderDialog(e,d.lockDialog.html(),!0))}),a(".lockall").on("click",function(b){b.preventDefault();var c=d.lockDialogTitle.replace("%s","all slots"),e=a(this).data("url");""!==e&&(d.changeLockFormData(e),d.renderDialog(c,d.lockDialog.html(),!0))}),a(document).on("click",".modal-body .lockreason-form .btn-cancel",function(a){a.preventDefault(),d.dialogue.hide()}),a(".more-reason").on("click",function(b){b.preventDefault();var c=a(this).attr("data-timestart"),e=d.lockDialogTitle.replace("%s",c+" slot"),f=a(this).attr("data-reason");d.renderDialog(e,f)})},renderDialog:function(a,b,e){d.dialogue?(d.dialogue.title.html(a),d.dialogue.body.html(b),d.dialogue.show(),d.changeLockFormId(e)):c.create({type:c.types.DEFAULT,title:a,body:b}).done(function(a){d.dialogue=a,d.dialogue.show(),d.changeLockFormId(e)})},getParamUrlByName:function(a,b){b=b.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+b+"(=([^&#]*)|&|#|$)"),d=c.exec(a);return d?d[2]?d[2].replace(/\+/g," "):"":null},changeLockFormData:function(a){d.lockDialog.find(".lock-period").val(d.getParamUrlByName(a,"period")),d.lockDialog.find(".lock-day").val(d.getParamUrlByName(a,"day")),d.lockDialog.find(".lock-start").val(d.getParamUrlByName(a,"start")),d.lockDialog.find(".lock-stop").val(d.getParamUrlByName(a,"stop")),d.lockDialog.find(".lock-action").val(d.getParamUrlByName(a,"action")),d.lockDialog.find(".lock-bookingid").val(d.getParamUrlByName(a,"bookingid"))},changeLockFormId:function(b){!d.isChangeFormId&&b&&(a(".modal-body .lockreason-form").find("*").each(function(a,b){b.id&&(b.id+="_modal")}),d.lockDialog=a(".modal-body"),d.isChangeFormId=!0)}};return d});
define('mod_bookingsystem/warningaddnotesmessage', ["jquery"],function(a){var b={init:function(){a("#id_displayaddnotes").change(this.showAddNotesMessage)},showAddNotesMessage:function(){var b=a(".disableaddnotesmessage");a("#id_displayaddnotes").is(":checked")?a(b).addClass("hidden"):a(b).removeClass("hidden")}};return b});
define('mod_bookingsystem/bookingsystem_form_helper', ["jquery"],function(a){var b={init:function(c){b.mconfig=c;var d=b.mconfig.duplicate,e='button[name= "'+d+'" ], input[name = "'+d+'"]';a("#id_activityurlselector").change(this.urlSelectorShowHide),a(e).click(this.duplicateUrl)},urlSelectorShowHide:function(){for(var c=a("#id_activityurlselector").val(),d=a("#id_simusers").val(),e=c==b.mconfig.uploadmode?"hide":"show",f=c==b.mconfig.uploadmode?0:1,g=1;g<=d;g++)a("div[data-groupname = expurlgroup"+g+"]")[e](),a("div[data-groupname = expurlgroup"+g+"]").css("opacity",f),a("#fitem_id_activity"+g)[e](),a("#fitem_id_activity"+g).css("opacity",f)},duplicateUrl:function(){var b=a(this).data("id"),c="id_expurl"+b,d=a("input#"+c).val();if(d){var e=b,f=a("#id_simusers").val();for(e;e<=f;e++)a("input#id_expurl"+e).val(d)}}};return b});
define('mod_choice/select_all_choices', ["jquery"],function(a){return{init:function(){a(".selectallnone a").on("click",function(b){b.preventDefault(),a("#attemptsform").find("input:checkbox").prop("checked",a(this).data("selectInfo"))})}}});
define('mod_connecthosted/connecthosted', ["core/ajax","jquery","core/modal_factory"],function(t,e,s){return{recordingsDisableLinksMobile:function(){e(function(){var t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()}};t.any()&&e("a.chosted-recording-link").contents().unwrap()})},recordingsVisibility:function(s,r,i){function c(t,s){s?(e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img.chosted-mp4-img').addClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img#chosted-loading').removeClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-edit').hide(),e('tr[class*="scoid-'+t+'"] .chosted-rec-export').hide(),e('tr[class*="scoid-'+t+'"] .chosted-rec-delete').hide(),e('tr[class*="scoid-'+t+'"] .quickediticon').hide()):(e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img.chosted-mp4-img').removeClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img#chosted-loading').addClass("hidden"))}e(".chosted-rec-showhide").each(function(){e(this).click(function(){var d=e(this).attr("data-scoid"),o=1,a=0;"1"==e('a[data-scoid="'+d+'"]').attr("data-visibility")?o=0:i&&(e('tr[class*="scoid-'+d+'"] img.chosted-mp4-img').hasClass("chosted-mp4-pending")||e('tr[class*="scoid-'+d+'"] img.chosted-mp4-img').hasClass("chosted-mp4-converted")||e('tr[class*="scoid-'+d+'"] img.chosted-mp4-img').hasClass("chosted-mp4-error")||"1"==e('a[data-scoid="'+d+'"]').attr("data-convert")&&(c(d,!0),a=1));var n={methodname:"mod_connecthosted_recording_visibility",args:{cmid:s,scoid:d,visibility:o,ownerid:r,conversion:a}},l=t.call([n])[0];return l.done(function(t){if(t)e.each(t,function(t,s){if(1==s.visibility){"1"==e('a[data-scoid="'+d+'"]').attr("data-visibility")?(e('tr[class*="scoid-'+d+'"]').addClass("dimmed_text"),e('a[data-scoid="'+d+'"]').attr("data-visibility","0")):(e('tr[class*="scoid-'+d+'"]').removeClass("dimmed_text"),e('a[data-scoid="'+d+'"]').attr("data-visibility","1"));var r=e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-img").attr("src"),i=e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-other").attr("src");e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-img").attr("src",i),e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-other").attr("src",r);var o=e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-img").attr("title"),n=e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-other").attr("title");e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-img").attr("title",n),e('tr[class*="scoid-'+d+'"]').find(".chosted-rec-other").attr("title",o)}else{var l=e('a[data-scoid="'+d+'"]').attr("data-error");alert(l)}if(1==a)if(1==s.converting){r=e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-img").attr("src"),i=e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-other").attr("src");e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-img").attr("src",i),e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-other").attr("src",r);o=e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-img").attr("title"),n=e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-other").attr("title");e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-img").attr("title",n),e('tr[class*="scoid-'+d+'"]').find(".chosted-mp4-other").attr("title",o),e('a.chosted-rec-convert[data-scoid="'+d+'"]').addClass("converted"),e('tr[class*="scoid-'+d+'"] img.chosted-mp4-img').addClass("chosted-mp4-pending"),c(d,!1)}else{c(d,!1),e('tr[class*="scoid-'+d+'"] img.chosted-mp4-error').removeClass("hidden");l=s.error;alert(l)}});else{c(d,!1),e('tr[class*="scoid-'+d+'"] img.chosted-mp4-error').removeClass("hidden");var s=e('a.chosted-rec-convert[data-scoid="'+d+'"]').attr("data-error");alert(s)}}).fail(function(t){c(d,!1),e('tr[class*="scoid-'+d+'"] img.chosted-mp4-error').removeClass("hidden");var s=e('a.chosted-rec-convert[data-scoid="'+d+'"]').attr("data-error");alert(s)}),l})})},recordingsDelete:function(s,r){e(".chosted-rec-delete").each(function(){e(this).click(function(){var i=e(this).attr("data-scoid"),c=e(this).attr("data-confirm");if(confirm(c)){var d={methodname:"mod_connecthosted_recording_delete",args:{cmid:s,scoid:i,ownerid:r}},o=t.call([d])[0];return o.done(function(t){if(t)e('tr[class*="scoid-'+i+'"]').remove();else{var s=e('span[data-scoid="'+i+'"]').attr("data-error");alert(s)}}).fail(function(t){alert("Error")}),o}})})},recordingsConvert:function(s,r){function i(t,s){s?(e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img.chosted-mp4-img').addClass("hidden"),e('tr[class*="scoid-'+t+'"] img.chosted-mp4-error').addClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img#chosted-loading').removeClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-edit').hide(),e('tr[class*="scoid-'+t+'"] .chosted-rec-export').hide(),e('tr[class*="scoid-'+t+'"] .chosted-rec-delete').hide(),e('tr[class*="scoid-'+t+'"] .quickediticon').hide()):(e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img.chosted-mp4-img').removeClass("hidden"),e('tr[class*="scoid-'+t+'"] .chosted-rec-convert img#chosted-loading').addClass("hidden"))}e("a.chosted-rec-convert").each(function(){e(this).click(function(){if(!e(this).hasClass("converted")){var c=e(this).attr("data-scoid"),d=e(this).attr("data-confirm");if(confirm(d)){i(c,!0),e('tr[class*="scoid-'+c+'"] a.chosted-rec-mp4 img.chosted-mp4-converted').addClass("hidden");var o={methodname:"mod_connecthosted_recording_convert",args:{cmid:s,scoid:c,ownerid:r}},a=t.call([o])[0];return a.done(function(t){if(t)e.each(t,function(t,s){if(1==s.converting){var r=e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-img").attr("src"),d=e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-other").attr("src");e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-img").attr("src",d),e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-other").attr("src",r);var o=e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-img").attr("title"),a=e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-other").attr("title");e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-img").attr("title",a),e('tr[class*="scoid-'+c+'"]').find(".chosted-mp4-other").attr("title",o),e('a.chosted-rec-convert[data-scoid="'+c+'"]').addClass("converted"),i(c,!1)}else{var n=s.error;alert(n),i(c,!1),e('tr[class*="scoid-'+c+'"] img.chosted-mp4-error').removeClass("hidden")}});else{var s=e('a.chosted-rec-convert[data-scoid="'+c+'"]').attr("data-error");alert(s),i(c,!1),e('tr[class*="scoid-'+c+'"] img.chosted-mp4-error').removeClass("hidden")}}).fail(function(t){alert("Error"),i(c,!1),e('tr[class*="scoid-'+c+'"] img.chosted-mp4-error').removeClass("hidden")}),a}}})})},recordingsFilter:function(t,s,r){function i(i,c){switch(void 0===c&&(c=!1),c||(e(i).hasClass("chosted-rec-filter-visible")&&0!=r?(r=0,e(i).attr("style","opacity:1"),e(".chosted-rec-filter-hidden").attr("style","opacity:0.5"),e(".chosted-rec-filter-all").attr("style","opacity:0.5")):e(i).hasClass("chosted-rec-filter-hidden")&&1!=r?(r=1,e(i).attr("style","opacity:1"),e(".chosted-rec-filter-visible").attr("style","opacity:0.5"),e(".chosted-rec-filter-all").attr("style","opacity:0.5")):e(i).hasClass("chosted-rec-filter-all")&&2!=r&&(r=2,e(i).attr("style","opacity:1"),e(".chosted-rec-filter-visible").attr("style","opacity:0.5"),e(".chosted-rec-filter-hidden").attr("style","opacity:0.5"))),r){case 0:e("table#recordings > tbody > tr").each(function(){e(this).hasClass("dimmed_text")?e(this).addClass("hidden"):e(this).removeClass("hidden")});break;case 1:e("table#recordings > tbody > tr").each(function(){e(this).hasClass("dimmed_text")?e(this).removeClass("hidden"):e(this).addClass("hidden")});break;case 2:e("table#recordings > tbody > tr").each(function(){e(this).removeClass("hidden")})}e("table#recordings > thead > tr > th.header a").each(function(){e(this).attr("href",e(this).attr("href").replace("filter=0","filter="+r)),e(this).attr("href",e(this).attr("href").replace("filter=1","filter="+r)),e(this).attr("href",e(this).attr("href").replace("filter=2","filter="+r))}),window.history.replaceState({},"",window.location.pathname+"?id="+t+"&group="+s+"&filter="+r)}e(function(){e(".chosted-rec-filter").each(function(){i(e(this),!0)})}),e(".chosted-rec-filter").each(function(){e(this).click(function(){i(e(this))})})},recordingOwners:function(r){s.create({title:e("table#recordings").find(".ownerstooltip").find("a").attr("title"),body:'<div class="chosted-recording-owners"></div>'},e("table#recordings").find(".ownerstooltip").find("a")).done(function(s){e("table#recordings").find(".ownerstooltip").find("a").click(function(){var s,i=e(this);if(e(".chosted-recording-owners").empty(),setTimeout(function(){e(i).find("img#chosted-loading").clone().appendTo(".chosted-recording-owners"),e(".chosted-recording-owners img#chosted-loading").removeClass("hidden")},10),i=e(this),e(i).attr("data-o")){var c={methodname:"mod_connecthosted_recording_owners_known",args:{cmid:r,owners:e(i).attr("data-o")}};return(s=t.call([c])[0]).done(function(t){t&&setTimeout(function(){e(".chosted-recording-owners img#chosted-loading").addClass("hidden"),e.each(t,function(t,s){e(".chosted-recording-owners").append(s.html)})},20)}).fail(function(t){alert("Error")}),s}return c={methodname:"mod_connecthosted_recording_owners",args:{cmid:r,scoid:e(i).attr("data-s"),meetingscoid:e(i).attr("data-m"),recdate:e(i).attr("data-r"),ownerid:e(i).attr("data-i"),visibility:e(i).attr("data-v")}},(s=t.call([c])[0]).done(function(t){t&&setTimeout(function(){var s="";e(".chosted-recording-owners img#chosted-loading").addClass("hidden"),e.each(t,function(t,r){e(".chosted-recording-owners").append(r.html),-1!=r.id&&(s+="o"+r.id)}),e(i).attr("data-o",s)},20)}).fail(function(t){alert("Error")}),s})})}}});

define('mod_customcert/dialogue', ["core/yui"],function(a){var b=function(b,c,d,e,f){this.yuiDialogue=null;var g=this;"undefined"==typeof f&&(f=!1),a.use("moodle-core-notification","timers",function(){var h="480px";f&&(h="800px"),g.yuiDialogue=new M.core.dialogue({headerContent:b,bodyContent:c,draggable:!0,visible:!1,center:!0,modal:!0,width:h}),g.yuiDialogue.after("visibleChange",function(b){b.newVal?"undefined"!=typeof d&&a.soon(function(){d(g),g.yuiDialogue.centerDialogue()}):"undefined"!=typeof e&&a.soon(function(){e(g)})}),g.yuiDialogue.show()})};return b.prototype.close=function(){this.yuiDialogue.hide(),this.yuiDialogue.destroy()},b.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()},b});
define('mod_customcert/rearrange-area', ["jquery","core/yui","core/fragment","mod_customcert/dialogue","core/notification","core/str","core/templates","core/ajax"],function(a,b,c,d,e,f,g,h){var i=function(b){this._node=a(b),this._setEvents()};return i.prototype.CUSTOMCERT_REF_POINT_TOPLEFT=0,i.prototype.CUSTOMCERT_REF_POINT_TOPCENTER=1,i.prototype.CUSTOMCERT_REF_POINT_TOPRIGHT=2,i.prototype.PIXELSINMM=3.779527559055,i.prototype._setEvents=function(){this._node.on("click",".element",this._editElement.bind(this))},i.prototype._editElement=function(a){var g=a.currentTarget.id.substr(8),h=this._node.attr("data-contextid"),i={elementid:g};c.loadFragment("mod_customcert","editelement",h,i).done(function(a,c){f.get_string("editelement","mod_customcert").done(function(e){b.use("moodle-core-formchangechecker",function(){new d(e,"<div id='elementcontent'></div>",this._editElementDialogueConfig.bind(this,g,a,c),(void 0),(!0))}.bind(this))}.bind(this))}.bind(this)).fail(e.exception)},i.prototype._editElementDialogueConfig=function(b,c,d,f){g.replaceNode("#elementcontent",c,d),this._setPositionInForm(b);var h=a(f.getContent());h.on("click","#id_submitbutton",function(c){M.core_formchangechecker.reset_form_dirty_state(),this._saveElement(b).then(function(){this._getElementHTML(b).done(function(c){var d=this._node.find("#element-"+b),e=parseInt(a("#id_refpoint").val()),g="";e==this.CUSTOMCERT_REF_POINT_TOPLEFT?g="refpoint-left":e==this.CUSTOMCERT_REF_POINT_TOPCENTER?g="refpoint-center":e==this.CUSTOMCERT_REF_POINT_TOPRIGHT&&(g="refpoint-right"),d.empty().append(c),d.removeClass(),d.addClass("element "+g),d.attr("data-refpoint",e);var h=a("#editelementform #id_posx").val(),i=a("#editelementform #id_posy").val();this._setPosition(b,e,h,i),f.close()}.bind(this))}.bind(this)).fail(e.exception),c.preventDefault()}.bind(this)),h.on("click","#id_cancel",function(a){f.close(),a.preventDefault()})},i.prototype._setPosition=function(a,c,d,e){var f=b.one("#element-"+a);d=b.one("#pdf").getX()+d*this.PIXELSINMM,e=b.one("#pdf").getY()+e*this.PIXELSINMM;var g=parseFloat(f.getComputedStyle("width")),h=f.width*this.PIXELSINMM;switch(h&&g>h&&(g=h),c){case this.CUSTOMCERT_REF_POINT_TOPCENTER:d-=g/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:d=d-g+2}f.setX(d),f.setY(e)},i.prototype._setPositionInForm=function(c){var d=a("#editelementform #id_posx"),e=a("#editelementform #id_posy");if(d.length&&e.length){var f=b.one("#element-"+c),g=f.getX()-b.one("#pdf").getX(),h=f.getY()-b.one("#pdf").getY(),i=parseInt(f.getData("refpoint")),j=parseFloat(f.getComputedStyle("width"));switch(i){case this.CUSTOMCERT_REF_POINT_TOPCENTER:g+=j/2;break;case this.CUSTOMCERT_REF_POINT_TOPRIGHT:g+=j}g=Math.round(parseFloat(g/this.PIXELSINMM)),h=Math.round(parseFloat(h/this.PIXELSINMM)),d.val(g),e.val(h)}},i.prototype._getElementHTML=function(a){var b=this._node.attr("data-templateid"),c=h.call([{methodname:"mod_customcert_get_element_html",args:{templateid:b,elementid:a}}]);return c[0]},i.prototype._saveElement=function(b){var c=this._node.attr("data-templateid"),d=a("#editelementform").serializeArray(),e=h.call([{methodname:"mod_customcert_save_element",args:{templateid:c,elementid:b,values:d}}]);return e[0]},{init:function(a){new i(a)}}});
define('mod_externalquiz/idnumber', ["jquery","core/templates"],function(a,b){var c={checkbox:null,warning:null,extquizid:null,idnumber:null,displayWarning:function(){this.warning.is(":visible")||this.warning.show()},hideWarning:function(){this.warning.is(":visible")&&this.warning.hide()},compareValues:function(){return this.extquizid.val()===this.idnumber.val()},checkValues:function(a){if(c.checkbox.find("input").is(":checked")){var b,d;a.target===c.extquizid[0]?(b=c.extquizid,d=c.idnumber):(b=c.idnumber,d=c.extquizid),d.val(b.val()),c.hideWarning()}else c.compareValues()?c.hideWarning():c.displayWarning()}},d={init:function(){M.util.js_pending("mod_externalquiz/idnumber"),c.extquizid=a("#id_extquizid"),c.idnumber=a("#id_cmidnumber");var d=c.extquizid.add(c.idnumber);d.prop("disabled",!0),b.render("mod_externalquiz/idnumbercheckbox",{}).then(function(d){return c.checkbox=a(d),c.extquizid.after(c.checkbox),b.render("mod_externalquiz/idnumberwarning",{})}).then(function(b){c.warning=a(b),c.extquizid.before(c.warning),c.compareValues()?c.checkbox.find("input").prop("checked",!0):c.displayWarning(),d.prop("disabled",!1).on("keyup paste change",c.checkValues),M.util.js_complete("mod_externalquiz/idnumber")})}};return d});
define('mod_feedback/edit', ["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){var e={deleteItem:function(b){b.preventDefault(),c.get_strings([{key:"confirmation",component:"admin"},{key:"confirmdeleteitem",component:"mod_feedback"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],a.proxy(function(){window.location=a(this).attr("href")},b.currentTarget))})},setup:function(){a("body").delegate('[data-action="delete"]',"click",e.deleteItem)}};return{setup:e.setup}});
define('mod_forumng/featurebtns', ["jquery","core/str"],function(a,b){var c=!0,d={initMobileHide:function(){var b=a(window);b.width()<768&&d.mobileHide(),a(window).on("resize",function(){b.width()<768&&c?d.mobileHide():b.width()>768&&c&&d.mobileShow()})},mobileHide:function(){if(c){var e=!1;if(a("#forumng-features:first > div form:not(.fng-mobile-on)").each(function(b,c){var d=a(c);"none"!==d.css("display")&&(d.css("display","none"),e=!0)}),e)if(a("#forumng-features:first div.mobileshow").length)a("#forumng-features:first > div.mobileshow").css("display","");else{var f="",g=b.get_strings([{key:"tooltip_show_features",component:"mod_forumng"}]),h=a.when(g);h.done(function(a){f=a[0]});var i='<div class="mobileshow"><form method="get" action="#" class="fng-mobile-on"><input type="submit" value="..." title="'+f+'"></form></div>';a("#forumng-features:first > div form.fng-mobile-on").last().parents("div[class^=forumngfeature_]").after(i),a("#forumng-features:first div.mobileshow form input:first").on("click",function(a){a.preventDefault(),d.mobileShow(),c=!1})}}},mobileShow:function(){a("#forumng-features:first > div:not(.fng-mobile-on) form").css("display",""),a("#forumng-features:first > div.mobileshow").css("display","none")}};return d});
define('mod_lti/cartridge_registration_form', ["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g){var h={CARTRIDGE_URL:"#cartridge-url",CONSUMER_KEY:"#registration-key",SHARED_SECRET:"#registration-secret",REGISTRATION_FORM:"#cartridge-registration-form",REGISTRATION_SUBMIT_BUTTON:"#cartridge-registration-submit",REGISTRATION_CANCEL_BUTTON:"#cartridge-registration-cancel"},i=function(){return a(h.REGISTRATION_FORM).attr("data-cartridge-url")},j=function(){return a(h.REGISTRATION_SUBMIT_BUTTON)},k=function(){return a(h.REGISTRATION_CANCEL_BUTTON)},l=function(){return a(h.CONSUMER_KEY).val()},m=function(){return a(h.SHARED_SECRET).val()},n=function(){j().addClass("loading")},o=function(){j().removeClass("loading")},p=function(){return j().hasClass("loading")},q=function(){if(p())return!1;var b=i();if(""===b)return!1;n();var f=l(),h=m(),j=d.create({cartridgeurl:b,key:f,secret:h});return j.done(function(){g.get_string("successfullycreatedtooltype","mod_lti").done(function(b){a(document).trigger(e.NEW_TOOL_TYPE),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION),a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b})}).fail(c.exception)}).fail(function(){g.get_string("failedtocreatetooltype","mod_lti").done(function(b){a(document).trigger(e.NEW_TOOL_TYPE),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION),a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b,error:!0})}).fail(c.exception)}).always(function(){o()}),j},r=function(){var b=a(h.REGISTRATION_FORM);b.submit(function(a){a.preventDefault(),q()});var c=k();c.click(function(b){b.preventDefault(),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=f.ENTER&&a.keyCode!=f.SPACE||(a.preventDefault(),c.click())})};return{init:function(){r()}}});
define('mod_lti/events', [],function(){return{NEW_TOOL_TYPE:"lti.tool.type.new",START_EXTERNAL_REGISTRATION:"lti.registration.external.start",STOP_EXTERNAL_REGISTRATION:"lti.registration.external.stop",START_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.start",STOP_CARTRIDGE_REGISTRATION:"lti.registration.cartridge.stop",REGISTRATION_FEEDBACK:"lti.registration.feedback",CAPABILITIES_AGREE:"lti.tool.type.capabilities.agree",CAPABILITIES_DECLINE:"lti.tool.type.capabilities.decline"}});
define('mod_lti/external_registration', ["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/tool_proxy","mod_lti/tool_type","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h,i){var j={EXTERNAL_REGISTRATION_CONTAINER:"#external-registration-page-container",EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER:"#external-registration-template-container",EXTERNAL_REGISTRATION_CANCEL_BUTTON:"#cancel-external-registration",TOOL_TYPE_CAPABILITIES_CONTAINER:"#tool-type-capabilities-container",TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER:"#tool-type-capabilities-template-container",CAPABILITIES_AGREE_CONTAINER:".capabilities-container"},k=function(){return a(j.EXTERNAL_REGISTRATION_CANCEL_BUTTON)},l=function(){return a(j.EXTERNAL_REGISTRATION_CONTAINER)},m=function(){return a(j.EXTERNAL_REGISTRATION_TEMPLATE_CONTAINER)},n=function(){return a(j.TOOL_TYPE_CAPABILITIES_CONTAINER)},o=function(){return a(j.TOOL_TYPE_CAPABILITIES_TEMPLATE_CONTAINER)},p=function(){n().addClass("loading")},q=function(){n().removeClass("loading")},r=function(){k().addClass("loading")},s=function(){k().removeClass("loading")},t=function(){n().addClass("hidden")},u=function(){n().removeClass("hidden")},v=function(){l().addClass("hidden")},w=function(){l().removeClass("hidden")},x=function(a){var b=k();b.attr("data-tool-proxy-id",a)},y=function(){var a=k();return a.attr("data-tool-proxy-id")},z=function(){var a=k();a.removeAttr("data-tool-proxy-id")},A=function(){return!!y()},B=function(){var a=k();return a.attr("data-tool-proxy-new")&&A()},C=function(){var a=k();return a.attr("data-tool-proxy-new","new")},D=function(){var a=k();return a.removeAttr("data-tool-proxy-new")},E=function(a){var c={methodname:"mod_lti_get_tool_proxy_registration_request",args:{id:a}};return b.call([c])[0]},F=function(){r();var b=a.Deferred();if(B()){var d=y();f["delete"](d).done(function(){b.resolve()}).fail(function(a){b.reject(a)})}else b.resolve();return b.done(function(){L(),s()}).fail(function(b){c.exception(b),L(),s(),i.get_string("failedtodeletetoolproxy","mod_lti").done(function(b){var c={message:b,error:!0};a(document).trigger(e.REGISTRATION_FEEDBACK,c)}).fail(c.exception)}),b},G=function(a){var b=d.render("mod_lti/tool_proxy_registration_form",a);return b.done(function(a,b){var c=m();c.append(a),d.runTemplateJS(b),c.find("form").submit(),w()}).fail(c.exception),b},H=function(a){return g.update({id:a.id,state:g.constants.state.configured})},I=function(b){var f=a.Deferred();return d.render("mod_lti/tool_type_capabilities_agree",b).done(function(a,c){var g=o();v(),u(),d.replaceNodeContents(g,a,c);var h=g.find(j.CAPABILITIES_AGREE_CONTAINER);h.on(e.CAPABILITIES_AGREE,function(){p(),H(b).always(function(){q(),g.empty(),f.resolve()})}),h.on(e.CAPABILITIES_DECLINE,function(){g.empty(),f.resolve()})}).fail(f.reject),f.done(function(){t()}).fail(c.exception),f},J=function(b){var c=a.Deferred();return b&&""!==b?f.create({regurl:b}).done(function(a){C(),c=K(a.id)}).fail(function(b){F();var d={message:b.message,error:!0};a(document).trigger(e.REGISTRATION_FEEDBACK,d),c.reject(b)}):c.resolve(),c},K=function(b){var c=a.Deferred();return x(b),E(b).done(function(a){G(a).done(function(){c.resolve()}).fail(c.fail)}).fail(c.fail),c},L=function(){A()&&z(),D(!1),v();var b=m();b.empty(),a(document).trigger(e.STOP_EXTERNAL_REGISTRATION)},M=function(){a(document).on(e.START_EXTERNAL_REGISTRATION,function(a,b){b&&(b.url&&J(b.url),b.proxyid&&K(b.proxyid))});var b=k();b.click(function(a){a.preventDefault(),F()}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=h.ENTER&&a.keyCode!=h.SPACE||(a.preventDefault(),F())}),window.triggerExternalRegistrationComplete=function(b){var d=a.Deferred(),f={message:"",error:!1};if("success"==b.status){if(i.get_string("successfullycreatedtooltype","mod_lti").done(function(a){f.message=a}).fail(c.exception),d.done(function(){L(),a(document).trigger(e.REGISTRATION_FEEDBACK,f),a(document).trigger(e.NEW_TOOL_TYPE)}).fail(c.exception),B()){var h=y();g.getFromToolProxyId(h).done(function(a){if(a&&a.length){var b=a[0];b.hascapabilitygroups?I(b).always(function(){d.resolve()}):d.resolve()}else d.resolve()}).fail(function(){d.resolve()})}}else f.message=b.error,f.error=!0,d.done(function(){F().always(function(){a(document).trigger(e.REGISTRATION_FEEDBACK,f)})}).fail(c.exception),d.resolve();return d}};return{init:function(){M()}}});
define('mod_lti/external_registration_return', [],function(){return{init:function(a,b,c,d){window.parent&&window.parent.triggerExternalRegistrationComplete({message:a,error:b,id:c,status:d})}}});
define('mod_lti/keys', [],function(){return{ENTER:13,SPACE:32}});
define('mod_lti/tool_card_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h){var i={DELETE_BUTTON:".delete",NAME_ELEMENT:".name",DESCRIPTION_ELEMENT:".description",CAPABILITIES_CONTAINER:".capabilities-container",ACTIVATE_BUTTON:".tool-card-footer a.activate"},j=2e3,k=function(a){return a.find(i.DELETE_BUTTON)},l=function(a){return a.find(i.NAME_ELEMENT)},m=function(a){return a.find(i.DESCRIPTION_ELEMENT)},n=function(a){return a.find(i.ACTIVATE_BUTTON)},o=function(a){return!!n(a).length},p=function(a){return a.find(i.CAPABILITIES_CONTAINER)},q=function(a){return!!p(a).length},r=function(a){return a.attr("data-type-id")},s=function(a){a.removeClass("announcement loading success fail capabilities")},t=function(a){s(a),a.addClass("announcement loading")},u=function(a){a.removeClass("announcement loading")},v=function(b){var c=a.Deferred();return s(b),b.addClass("announcement success"),setTimeout(function(){b.removeClass("announcement success"),c.resolve()},j),c},w=function(b){var c=a.Deferred();return s(b),b.addClass("announcement fail"),setTimeout(function(){b.removeClass("announcement fail"),c.resolve()},j),c},x=function(b){var d=a.Deferred(),f=r(b);return t(b),""===f?a.Deferred().resolve():(h.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){e["delete"](f).done(function(){u(b),v(b).done(function(){b.remove()}).fail(c.exception).always(function(){d.resolve()})}).fail(function(a){w(b),d.reject(a)})},function(){u(b),d.resolve()})}).fail(function(a){u(b),c.exception(a),d.reject(a)}),d)},y=function(a,b){a.attr("data-val-snapshot",b)},z=function(a){return a.attr("data-val-snapshot")},A=function(a){var b=m(a);if(!b.hasClass("loading")){var c=b.text().trim();y(b,c)}},B=function(b){var d=r(b);if(""===d)return a.Deferred().resolve();var f=m(b);if(f.hasClass("loading"))return a.Deferred().resolve();var g=f.text().trim(),h=z(f);if(h==g)return a.Deferred().resolve();f.addClass("loading");var i=e.update({id:d,description:g});return i.done(function(a){f.removeClass("loading"),f.text(a.description)}).fail(c.exception),i.fail(function(){f.removeClass("loading")}),i},C=function(a){var b=l(a);if(!b.hasClass("loading")){var c=b.text().trim();y(b,c)}},D=function(b){var c=r(b);if(""===c)return a.Deferred().resolve();var d=l(b);if(d.hasClass("loading"))return a.Deferred().resolve();var f=d.text().trim(),g=z(d);if(g==f)return a.Deferred().resolve();d.addClass("loading");var h=e.update({id:c,name:f});return h.done(function(a){d.removeClass("loading"),d.text(a.name)}),h.fail(function(){d.removeClass("loading")}),h},E=function(b){var c=r(b);if(""===c)return a.Deferred().resolve();t(b);var f=e.update({id:c,state:e.constants.state.configured});return f.then(function(a){return u(b),v(b),a}).then(function(a){return d.render("mod_lti/tool_card",a)}).then(function(a){var c=a[0],e=a[1];d.replaceNode(b,c,e)})["catch"](function(){u(b),w(b)}),f},F=function(a){a.addClass("announcement capabilities")},G=function(a){a.removeClass("announcement capabilities")},H=function(a){q(a)?F(a):E(a)},I=function(a){var b=k(a);b.click(function(b){b.preventDefault(),x(a)}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),b.click())});var c=m(a);c.focus(function(b){b.preventDefault(),A(a)}),c.blur(function(b){b.preventDefault(),B(a)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode==g.ENTER&&(a.preventDefault(),c.blur())});var d=l(a);if(d.focus(function(b){b.preventDefault(),C(a)}),d.blur(function(b){b.preventDefault(),D(a)}),d.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode==g.ENTER&&(a.preventDefault(),d.blur())}),o(a)){var e=n(a);e.click(function(b){b.preventDefault(),H(a)}),e.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),e.click())})}if(q(a)){var h=p(a);h.on(f.CAPABILITIES_AGREE,function(){E(a)}),h.on(f.CAPABILITIES_DECLINE,function(){G(a)})}};return{init:function(a){I(a)}}});
define('mod_lti/tool_configure_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/events","mod_lti/keys","mod_lti/tool_type","mod_lti/tool_proxy","core/str"],function(a,b,c,d,e,f,g,h,i){var j={EXTERNAL_REGISTRATION_CONTAINER:"#external-registration-container",EXTERNAL_REGISTRATION_PAGE_CONTAINER:"#external-registration-page-container",CARTRIDGE_REGISTRATION_CONTAINER:"#cartridge-registration-container",CARTRIDGE_REGISTRATION_FORM:"#cartridge-registration-form",ADD_TOOL_FORM:"#add-tool-form",TOOL_LIST_CONTAINER:"#tool-list-container",TOOL_CREATE_BUTTON:"#tool-create-button",REGISTRATION_CHOICE_CONTAINER:"#registration-choice-container",TOOL_URL:"#tool-url"},k=function(){return a(j.TOOL_CREATE_BUTTON)},l=function(){return a(j.TOOL_LIST_CONTAINER)},m=function(){return a(j.EXTERNAL_REGISTRATION_CONTAINER)},n=function(){return a(j.CARTRIDGE_REGISTRATION_CONTAINER)},o=function(){return a(j.REGISTRATION_CHOICE_CONTAINER)},p=function(){return a(j.TOOL_URL).val()},q=function(){m().addClass("hidden")},r=function(){n().addClass("hidden")},s=function(){o().addClass("hidden")},t=function(){r(),s(),m().removeClass("hidden"),w(m())},u=function(a){q(),s(),n().removeClass("hidden"),n().find(j.CARTRIDGE_REGISTRATION_FORM).attr("data-cartridge-url",a),w(n())},v=function(){q(),r(),o().removeClass("hidden"),w(o())},w=function(a){var b=a.children().detach();b.appendTo(a)},x=function(){l().addClass("hidden")},y=function(){l().removeClass("hidden")},z=function(a){var b=a.error?"error":"success";c.addNotification({message:a.message,type:b})},A=function(a){a.addClass("loading")},B=function(a){a.removeClass("loading")},C=function(){var b=a.Deferred(),e=l();A(e),a.when(g.query(),h.query({orphanedonly:!0})).done(function(a,c){d.render("mod_lti/tool_list",{tools:a,proxies:c}).done(function(a,c){e.empty(),e.append(a),d.runTemplateJS(c),b.resolve()}).fail(b.reject)}).fail(b.reject),b.fail(c.exception).always(function(){B(e)})},D=function(){var b=a.trim(p());if(""===b)return a.Deferred().resolve();var d=k();A(d);var f=g.isCartridge(b);return f.always(function(){B(d)}),f.done(function(c){c.iscartridge?(a(j.TOOL_URL).val(""),a(document).trigger(e.START_CARTRIDGE_REGISTRATION,b)):a(document).trigger(e.START_EXTERNAL_REGISTRATION,{url:b})}),f.fail(function(){i.get_string("errorbadurl","mod_lti").done(function(b){a(document).trigger(e.REGISTRATION_FEEDBACK,{message:b,error:!0})}).fail(c.exception)}),f},E=function(){a(document).on(e.NEW_TOOL_TYPE,function(){C()}),a(document).on(e.START_EXTERNAL_REGISTRATION,function(){t(),a(j.TOOL_URL).val(""),x()}),a(document).on(e.STOP_EXTERNAL_REGISTRATION,function(){y(),v()}),a(document).on(e.START_CARTRIDGE_REGISTRATION,function(a,b){u(b)}),a(document).on(e.STOP_CARTRIDGE_REGISTRATION,function(){n().find(j.CARTRIDGE_REGISTRATION_FORM).removeAttr("data-cartridge-url"),v()}),a(document).on(e.REGISTRATION_FEEDBACK,function(a,b){z(b)});var b=a(j.ADD_TOOL_FORM);b.submit(function(a){a.preventDefault(),D()})};return{init:function(){E(),C()}}});
define('mod_lti/tool_proxy', ["core/ajax","core/notification"],function(a,b){return{query:function(c){var d={methodname:"mod_lti_get_tool_proxies",args:c||{}},e=a.call([d])[0];return e.fail(b.exception),e},"delete":function(c){var d={methodname:"mod_lti_delete_tool_proxy",args:{id:c}},e=a.call([d])[0];return e.fail(b.exception),e},create:function(b){var c={methodname:"mod_lti_create_tool_proxy",args:b},d=a.call([c])[0];return d}}});
define('mod_lti/tool_proxy_card_controller', ["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_proxy","mod_lti/events","mod_lti/keys","core/str"],function(a,b,c,d,e,f,g,h){var i={DELETE_BUTTON:".delete",CAPABILITIES_CONTAINER:".capabilities-container",ACTIVATE_BUTTON:".tool-card-footer a.activate"},j=2e3,k=function(a){return a.find(i.DELETE_BUTTON)},l=function(a){return a.find(i.ACTIVATE_BUTTON)},m=function(a){return a.attr("data-proxy-id")},n=function(a){a.removeClass("announcement loading success fail capabilities")},o=function(a){n(a),a.addClass("announcement loading")},p=function(a){a.removeClass("announcement loading")},q=function(b){var c=a.Deferred();return n(b),b.addClass("announcement success"),setTimeout(function(){b.removeClass("announcement success"),c.resolve()},j),c},r=function(b){var c=a.Deferred();return n(b),b.addClass("announcement fail"),setTimeout(function(){b.removeClass("announcement fail"),c.resolve()},j),c},s=function(b){var d=a.Deferred(),f=m(b);return o(b),""===f?a.Deferred().resolve():(h.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){e["delete"](f).done(function(){p(b),q(b).done(function(){b.remove(),d.resolve()}).fail(c.exception)}).fail(function(a){r(b),d.reject(a)})},function(){p(b),d.resolve()})}).fail(function(a){p(b),c.exception(a),d.reject(a)}),d)},t=function(b){var c={proxyid:m(b)};a(document).trigger(f.START_EXTERNAL_REGISTRATION,c)},u=function(a){var b=k(a);b.click(function(b){b.preventDefault(),s(a)}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),b.click())});var c=l(a);c.click(function(b){b.preventDefault(),t(a)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||a.keyCode!=g.ENTER&&a.keyCode!=g.SPACE||(a.preventDefault(),c.click())})};return{init:function(a){u(a)}}});
define('mod_lti/tool_type', ["core/ajax","core/notification"],function(a,b){return{query:function(c){var d={methodname:"mod_lti_get_tool_types",args:c||{}},e=a.call([d])[0];return e.fail(b.exception),e},create:function(b){var c={methodname:"mod_lti_create_tool_type",args:b},d=a.call([c])[0];return d},update:function(c){var d={methodname:"mod_lti_update_tool_type",args:c},e=a.call([d])[0];return e.fail(b.exception),e},"delete":function(c){var d={methodname:"mod_lti_delete_tool_type",args:{id:c}},e=a.call([d])[0];return e.fail(b.exception),e},getFromToolProxyId:function(a){return this.query({toolproxyid:a})},isCartridge:function(b){var c={methodname:"mod_lti_is_cartridge",args:{url:b}},d=a.call([c])[0];return d},constants:{state:{configured:1,pending:2,rejected:3}}}});
define('mod_lti/contentitem', ["jquery","core/notification","core/str","core/templates","mod_lti/form-field","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var h,i,j={init:function(a,e,j){i=j;var k={url:a,postData:e},l=d.render("mod_lti/contentitem",k);return h?(h.setBody(l),void h.show()):void c.get_string("selectcontent","lti").then(function(a){return f.create({title:a,body:l,large:!0})}).then(function(a){h=a,a.getRoot().on(g.hidden,function(){a.setBody(""),b.fetchNotifications()}),a.show()})["catch"](b.exception)}},k=[new e("name",e.TYPES.TEXT,(!1),""),new e("introeditor",e.TYPES.EDITOR,(!1),""),new e("toolurl",e.TYPES.TEXT,(!0),""),new e("securetoolurl",e.TYPES.TEXT,(!0),""),new e("instructorchoiceacceptgrades",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorchoicesendname",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorchoicesendemailaddr",e.TYPES.CHECKBOX,(!0),(!0)),new e("instructorcustomparameters",e.TYPES.TEXT,(!0),""),new e("icon",e.TYPES.TEXT,(!0),""),new e("secureicon",e.TYPES.TEXT,(!0),""),new e("launchcontainer",e.TYPES.SELECT,(!0),0),new e("grade_modgrade_point",e.TYPES.TEXT,(!1),""),new e("cmidnumber",e.TYPES.TEXT,(!0),"")];return window.processContentItemReturnData=function(b){h&&h.hide();var c;for(c in k){var d=k[c],e=null;"undefined"!==a.type(b[d.name])&&(e=b[d.name]),d.setFieldValue(e)}i&&i()},j});
define('mod_lti/contentitem_return', ["jquery"],function(a){return{init:function(b){a(window).ready(function(){window!=top?parent.processContentItemReturnData(b):window.processContentItemReturnData(b)})}}});
define('mod_lti/form-field', ["jquery"],function(a){var b=function(a,b,c,d){this.name=a,this.id="id_"+this.name,this.selector="#"+this.id,this.type=b,this.resetIfUndefined=c,this.defaultValue=d};return b.TYPES={TEXT:1,SELECT:2,CHECKBOX:3,EDITOR:4},b.prototype.setFieldValue=function(c){if(null===c){if(!this.resetIfUndefined)return;c=this.defaultValue}switch(this.type){case b.TYPES.CHECKBOX:c?a(this.selector).prop("checked",!0):a(this.selector).prop("checked",!1);break;case b.TYPES.EDITOR:if("undefined"!==a.type(c.text)){var d=a(this.selector+"editable");d.length?d.html(c.text):"undefined"!=typeof tinyMCE&&tinyMCE.execInstanceCommand(this.id,"mceInsertContent",!1,c.text),a(this.selector).val(c.text)}break;default:a(this.selector).val(c)}},b});
define('mod_openstudio/accessibility', ["jquery"],function(a){var b;return b={init:function(){a('a[href=""]').on("click",function(a){a.preventDefault()})}}});
define('mod_openstudio/comment', ["jquery","core/ajax","core/str","mod_openstudio/scrollto","require"],function(a,b,c,d,e){var f;return f={mconfig:null,HEIGHT_TO_TOP:100,CSS:{ADD_NEW_BUTTON:"#id_addcomment",REPLY_BUTTON:'input[name="replycommentbutton"]',LIKE_BUTTON:".openstudio-comment-flag-link",DELETE_BUTTON:".openstudio-comment-delete-link",DELETE_CONFIRM_BUTTON:".openstudio-comment-delete-btn",COMMENT_FORM_CONTENT:".openstudio-comment-form-content",COMMENT_FORM:".openstudio-comment-form",COMMENT_REPLY_FORM:".openstudio-comment-reply-form",COMMENT_ATTACHMENT:".openstudio-comment-form-content .filepicker-filename > a",COMMENT_THREAD:".openstudio-comment-thread",COMMENT_THREAD_BODY:".openstudio-comment-thread-body",REPLY_THREAD:".openstudio-comment-thread-replied-items",COMMENT_ITEM:".openstudio-comment-thread-item",FLAG_COUNT:".openstudio-comment-flag-count",FLAG_STATUS:".openstudio-comment-flag-status",DIALOG_HEADER:".openstudio-comment-delete-header",BOUNDING_BOX:".openstudio-comment-dialogue-container"},init:function(b){f.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){e(["mod_openstudio/osdialogue"],function(a){f.dialogue=f.createDeleteCommentDialogue(a)})}),a(f.CSS.ADD_NEW_BUTTON).on("click",f.showCommentForm.bind(f)),a("body").delegate(f.CSS.REPLY_BUTTON,"click",f.showReplyForm).delegate(f.CSS.LIKE_BUTTON,"click",f.likeComment).delegate(f.CSS.DELETE_BUTTON,"click",f.deleteConfirm).delegate(f.CSS.DELETE_CONFIRM_BUTTON,"click",f.deleteComment),a(f.CSS.COMMENT_FORM).find("form").on("submit",f.postComment),a(window).resize(f.resize)},showCommentForm:function(){a(f.CSS.COMMENT_FORM_CONTENT).appendTo(f.CSS.COMMENT_FORM),a(f.CSS.COMMENT_FORM_CONTENT).show(),f.resetForm(),a(f.CSS.ADD_NEW_BUTTON).hide(),a(f.CSS.COMMENT_REPLY_FORM).hide(),d.scrollToEl(a(f.CSS.COMMENT_FORM_CONTENT),f.HEIGHT_TO_TOP),a("#openstudio_comment_form").focus()},showReplyForm:function(){var b=a(this).data("comment-parent").trim(),c=a(f.CSS.COMMENT_THREAD).filter(function(){return a(this).data("thread-items")==b}).find(f.CSS.COMMENT_REPLY_FORM);a(f.CSS.COMMENT_FORM_CONTENT).appendTo(c),c.show(),a(f.CSS.COMMENT_FORM_CONTENT).show(),f.resetForm(),a(f.CSS.ADD_NEW_BUTTON).show(),a(f.CSS.COMMENT_FORM_CONTENT).find('form input[name="inreplyto"]').val(parseInt(b)),d.scrollToEl(c,f.HEIGHT_TO_TOP)},resetForm:function(){a(f.CSS.COMMENT_FORM_CONTENT).find(".editor_atto_content").html(""),a(f.CSS.COMMENT_FORM_CONTENT).find('form input[name="inreplyto"]').val(0),a(f.CSS.COMMENT_FORM_CONTENT).find("form").get(0).reset(),a(f.CSS.COMMENT_ATTACHMENT).remove()},postComment:function(c){c.preventDefault(),c.stopImmediatePropagation();var e={};a.each(a(this).serializeArray(),function(a,b){e[b.name]=b.value});var g=a(f.CSS.COMMENT_ATTACHMENT).length>0;if(g||0!=e["commentext[text]"].length){M.util.js_pending("openstudioPostComment");var h=b.call([{methodname:"mod_openstudio_external_add_comment",args:{cmid:e.cmid,cid:e.cid,inreplyto:parseInt(e.inreplyto.trim()),commenttext:e["commentext[text]"],commentattachment:g?e.commentattachment:0}}]);h[0].done(function(b){a(f.CSS.ADD_NEW_BUTTON).show(),a(f.CSS.COMMENT_FORM_CONTENT).hide(),a(f.CSS.COMMENT_REPLY_FORM).hide();var c=parseInt(e.inreplyto.trim());c?(a(f.CSS.COMMENT_THREAD).filter(function(){return a(this).data("thread-items")==c}).find(f.CSS.REPLY_THREAD).find(f.CSS.COMMENT_ITEM).last().before(b.commenthtml),d.scrollToEl(a('[data-thread-item="'+b.commentid+'"]'),f.HEIGHT_TO_TOP)):(a(f.CSS.COMMENT_THREAD_BODY).append(b.commenthtml),d.scrollToEl(a('[data-thread-items="'+b.commentid+'"]'),f.HEIGHT_TO_TOP)),f.resize(),a(f.CSS.COMMENT_THREAD).show(),a("#openstudio_comment_form").focus(),window.oump&&window.oump.harvest()}).always(function(){M.util.js_complete("openstudioPostComment")}).fail(function(a){window.console.error("Log request failed "+a.message)})}},likeComment:function(c){c.preventDefault();var d=a(this);M.util.js_pending("openstudioLikeComment");var e=b.call([{methodname:"mod_openstudio_external_flag_comment",args:{cmid:f.mconfig.cmid,cid:f.mconfig.cid,commentid:d.data("comment-id")}}]);e[0].done(function(a){d.hide().siblings(f.CSS.FLAG_COUNT).addClass("flagged").text(a.count).siblings(f.CSS.FLAG_STATUS+".flagged").removeClass("openstudio-hidden").siblings(f.CSS.FLAG_STATUS+".unflagged").addClass("openstudio-hidden")}).always(function(){M.util.js_complete("openstudioLikeComment")}).fail(function(a){window.console.error("Log request failed "+a.message)})},deleteComment:function(){var c=parseInt(a(this).attr("data-comment-id"));M.util.js_pending("openstudioDeleteComment");var d=b.call([{methodname:"mod_openstudio_external_delete_comment",args:{cmid:f.mconfig.cmid,commentid:c}}]);d[0].done(function(){a(f.CSS.COMMENT_FORM_CONTENT).appendTo(f.CSS.COMMENT_FORM);var b=a('[data-thread-items="'+c+'"]'),d=a('[data-thread-item="'+c+'"]');b.length>0?b.remove():d.remove(),0==a("div[data-thread-items]").length&&a(f.CSS.COMMENT_THREAD).hide(),f.dialogue.hide(),f.dialogue.after("visibleChange",function(){a("#openstudio_comment_form").focus()},f.dialogue)}).always(function(){M.util.js_complete("openstudioDeleteComment")}).fail(function(a){window.console.error("Log request failed "+a.message)})},createDeleteCommentDialogue:function(a){var b=new a({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521,extraClasses:[f.CSS.BOUNDING_BOX.replace(".","")]}),d={name:"cancel",classNames:"openstudio-cancel-btn",action:"hide"},e={name:"delete",classNames:f.CSS.DELETE_CONFIRM_BUTTON.replace(".","")};return c.get_strings([{key:"contentcommentsdelete",component:"mod_openstudio"},{key:"modulejsdialogcommentdeleteconfirm",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"modulejsdialogdelete",component:"mod_openstudio"}]).done(function(a){d.label=a[2],e.label=a[3],b.set("headerContent",'<span class="openstudio-dialogue-common-header '+f.CSS.DIALOG_HEADER.replace(".","")+'">'+a[0]+"</span>"),b.set("bodyContent",a[1]),b.addButton(e,["footer"]),b.addButton(d,["footer"])}),b},deleteConfirm:function(b){b.preventDefault(),f.dialogue&&(a(f.CSS.DELETE_CONFIRM_BUTTON).attr("data-comment-id",a(this).data("comment-id")),f.dialogue.show())},resize:function(){f.dialogue&&f.dialogue.get("visible")&&(Y.one("body").get("winWidth")<=f.dialogue.get("responsiveWidth")?f.dialogue.makeResponsive():f.dialogue.centerDialogue())}}});
define('mod_openstudio/contentedit', ["jquery","mod_openstudio/scrollto"],function(a,b){var c;return c={init:function(){a.fx.off=!0,a("#id_openstudio_upload_content_buttons_addfilebutton").on("click",c.toogleAddFile),a("#id_openstudio_upload_content_buttons_addlinkbutton").on("click",c.toogleAddLink)},HEIGHT_TO_TOP:38,toogleAddFile:function(d){d.preventDefault(),a("#openstudio_upload_content_add_link").hide(),a("#openstudio_upload_content_add_file").toggle(function(){a(this).is(":visible")?(a("#contentformoptionalmetadata").show(),a('input[name="contentuploadtype"]').val("addfile"),a("#id_openstudio_upload_content_buttons_addlinkbutton").removeClass("openstudio-button-active"),a("#id_openstudio_upload_content_buttons_addfilebutton").addClass("openstudio-button-active"),b.scrollToEl(a("#id_openstudio_upload_content_buttons_addfilebutton"),c.HEIGHT_TO_TOP)):(a("#contentformoptionalmetadata").hide(),a('input[name="contentuploadtype"]').val(""),a("#id_openstudio_upload_content_buttons_addfilebutton").removeClass("openstudio-button-active"))})},toogleAddLink:function(d){d.preventDefault(),a("#openstudio_upload_content_add_file").hide(),a("#openstudio_upload_content_add_link").toggle(function(){a(this).is(":visible")?(a("#contentformoptionalmetadata").show(),a('input[name="contentuploadtype"]').val("addlink"),a("#id_openstudio_upload_content_buttons_addfilebutton").removeClass("openstudio-button-active"),a("#id_openstudio_upload_content_buttons_addlinkbutton").addClass("openstudio-button-active"),b.scrollToEl(a("#id_openstudio_upload_content_buttons_addlinkbutton"),c.HEIGHT_TO_TOP)):(a("#contentformoptionalmetadata").hide(),a('input[name="contentuploadtype"]').val(""),a("#id_openstudio_upload_content_buttons_addlinkbutton").removeClass("openstudio-button-active"))})}}});
define('mod_openstudio/contentpage', ["jquery","core/ajax","core/str","core/modal","core/modal_events","core/templates","core/config","require"],function(a,b,c,d,e,f,g,h){var i;return i={dialogue:null,delete_item:null,mconfig:null,init:function(b){a.fx.off=!0,i.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){h(["mod_openstudio/osdialogue"],function(a){i.archiveDialogue=i.createArchiveDialogue(a),i.deleteContentDialogue=i.createDeleteContentDialogue(a)})}),i.createMaximizeModal(),a("#openstudio_content_view_maximize").on("click",i.toogleContentModal),a("body").delegate("#openstudio_content_view_minimize","click",i.toogleContentModal),a("body").delegate(".openstudio-modal-content-close","click",i.toogleContentModal);var c=a("#openstudio_content_view_map_canvas");c.length&&i.showGoogleMap(c),a("#id_archivebutton").on("click",function(a){a.preventDefault(),i.archiveDialogue.show()}),a(".openstudio-delete-content-version").on("click",function(b){b.preventDefault(),i.delete_item=a(this),i.deleteContentDialogue.show()}),a(".openstudio-content-view-flag-icon").bind("click",function(){i.doFlagContent(a(this))}),a(".openstudio-request-feedback-button").bind("click",function(){i.doFlagContent(a(this))})},createMaximizeModal:function(){f.render("mod_openstudio/content_modal",{title:a(".openstudio-content-view-title").text(),body:a(".openstudio-content-view-file").html(),date:a(".openstudio-content-view-date").html(),isiframecontent:a(".openstudio-content-view-file").find("iframe").length>0}).done(function(a){i.modal=new d(a),i.modal.setLarge()})},toogleContentModal:function(){i.modal&&(i.modal.isVisible()?i.modal.hide():(i.modal.show(),i.modal.getRoot().on(e.shown,function(){a(".openstudio-modal-content-close").get(0).focus(),a(".openstudio-modal-content-close, #openstudio_content_view_minimize").keydown(function(b){if(13==b.keyCode)return i.modal.hide(),a("#openstudio_content_view_maximize").focus(),!1}),a("#openstudio_content_view_minimize").keydown(function(b){b.preventDefault(),9==b.keyCode&&a(".openstudio-modal-content-close").get(0).focus()})})),a("body").toggleClass("openstudio-lockscroll"))},showGoogleMap:function(a){var b=a.attr("data-gpslat"),c=a.attr("data-gpslng");if(b&&c){var d={lat:parseFloat(b),lng:parseFloat(c)},e=new google.maps.Map(document.getElementById("openstudio_content_view_map_canvas"),{center:d,zoom:14});new google.maps.Marker({position:d,map:e})}},doFlagContent:function(c){var d=b.call([{methodname:"mod_openstudio_external_flag_content",args:{cmid:c.attr("data-cmid"),cid:c.attr("data-cid"),fid:c.attr("data-fid"),mode:c.attr("data-mode")}}]);d[0].done(function(b){if(b.success){var c=a("#content_view_icon_"+b.fid);c.attr("data-mode",b.mode),b.iscontentflagrequestfeedback?(c.html(b.flagtext),a("#openstudio_item_request_feedback").removeClass(b.flagremoveclass).addClass(b.flagaddclass)):(c.find(".openstudio-content-view-icon-text").text(b.flagtext),c.toggleClass("openstudio-content-view-icon-active","off"==b.mode),c.attr("title",b.accessiblemessage))}}).fail(function(a){window.console.error("Error saving social flag "+a.message)})},setHeader:function(a,b){c.get_string(b,"mod_openstudio").done(function(b){a.set("headerContent",'<span class="openstudio-dialogue-common-header">'+b+"</span>")})},setBody:function(a,b){c.get_string(b,"mod_openstudio").done(function(b){a.set("bodyContent","<span>"+b+"</span>")})},createArchiveDialogue:function(b){var d=new b({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521});i.setHeader(d,"archivedialogheader"),i.setBody(d,"modulejsdialogcontentarchiveconfirm");var e={name:"archive",classNames:"openstudio-archive-yes-btn",events:{click:function(){i.redirectPostRequest({url:a("#contentversionlink").val(),data:{archiveversion:1}})}}},f={name:"cancel",classNames:"openstudio-archive-no-btn",action:"hide"};return c.get_strings([{key:"contentactionarchivepost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){e.label=a[0],f.label=a[1],d.addButton(e,["footer"]),d.addButton(f,["footer"])}),d},createDeleteContentDialogue:function(d){var e=new d({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521});i.setHeader(e,"deletearchiveversionheader"),i.setBody(e,"deletearchiveversionheaderconfirm");var f={name:"delete",classNames:"openstudio-delete-btn",events:{click:function(){var c=i.delete_item,d=b.call([{methodname:"mod_openstudio_external_delete_version",args:{cmid:c.attr("data-cmid"),cid:c.attr("data-cid"),cvid:c.attr("data-cvid")}}]);d[0].done(function(){a(".openstudio-cancel-btn").trigger("click"),a("#contentcurrenteversionurl").length>0?window.location.href=a("#contentcurrenteversionurl").val():(a("#content_version_id_"+c.attr("data-cvid")).remove(),0==a(".openstudio-content-view-version-detail").length&&a("#openstudio_content_view_post_archive_panel").remove())}).fail(function(a){window.console.error("Error delete content version"+a.message)})}}},g={name:"cancel",classNames:"openstudio-cancel-btn",action:"hide"};return c.get_strings([{key:"modulejsdialogdelete",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){f.label=a[0],g.label=a[1],e.addButton(f,["footer"]),e.addButton(g,["footer"])}),e},redirectPostRequest:function(b){var c=a("<form></form>");c.attr({method:"POST",action:b.url,style:"display: none;"}),a.each(b.data,function(b,d){var e=a("<input/>");e.attr("type","hidden"),e.attr("name",b),e.attr("value",d),c.append(e)}),a(c).appendTo("body").submit()}}});
define('mod_openstudio/delete', ["jquery","core/ajax","core/str","core/config","require"],function(a,b,c,d,e){var f;return f={mconfig:null,CSS:{DELETEBUTTON:"#id_deletebutton",DIALOGHEADER:".openstudio-dialogue-common-header",DELETEDIALOGUECONTAINER:".openstudio-delete-dialogue"},init:function(b){f.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){e(["mod_openstudio/osdialogue"],function(a){f.dialogue=f.createDeleteDialogue(a)})}),a(f.CSS.DELETEBUTTON).on("click",function(){f.dialogue&&f.dialogue.show()}),a(window).resize(f.resize.bind(f))},createDeleteDialogue:function(a){function b(){var a=f.mconfig.isfolder?"folderdeletedfolder":"contentdeledialogueteheader";c.get_string(a,"mod_openstudio").done(function(a){g.set("headerContent",'<span class="'+f.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}function d(){var a=f.mconfig.isfolder?"deleteconfirmfolder":"deleteconfirmcontent";c.get_string(a,"mod_openstudio").done(function(a){g.set("bodyContent",a)})}function e(){var a={name:"cancel",classNames:"openstudio-delete-cancel-btn",action:"hide"},b={name:"delete",classNames:"openstudio-delete-ok-btn",events:{click:f.deleteContent.bind(f)}};c.get_strings([{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"deletelevel",component:"mod_openstudio"}]).done(function(c){a.label=c[0],b.label=c[1],g.addButton(b,["footer"]),g.addButton(a,["footer"])})}var g=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0,extraClasses:[f.CSS.DELETEDIALOGUECONTAINER.replace(".","")]});return b(),d(),e(),g},deleteContent:function(){M.util.js_pending("openstudioDeleteContent");var a=b.call([{methodname:"mod_openstudio_external_delete_content",args:{id:f.mconfig.id,cid:f.mconfig.cid,containingfolder:f.mconfig.folderid}}]);a[0].done(function(a){var b="";b=f.mconfig.folderid?d.wwwroot+"/mod/openstudio/folder.php?sid="+f.mconfig.folderid:f.mconfig.isactivitycontent?window.location.href:d.wwwroot+"/mod/openstudio/view.php?vid="+a.vid,b+="&id="+f.mconfig.id,window.location.href=b}).always(function(){M.util.js_complete("openstudioDeleteContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})},resize:function(){f.dialogue&&f.dialogue.get("visible")&&(Y.one("body").get("winWidth")<=f.dialogue.get("responsiveWidth")?f.dialogue.makeResponsive():f.dialogue.centerDialogue())}}});
define('mod_openstudio/export', ["jquery","core/yui","core/str","core/config","mod_openstudio/osdialogue"],function(a,b,c,d,e){var f;return f={dialogue:null,mconfig:null,CSS:{DIALOGHEADER:".openstudio-export-header",BOUNDINGBOX:".openstudio-export-dialog-container",EXPORTBUTTON:"#osep-bottombutton-export",EXPORTMESSAGE:".openstudio-export-message",SELECTALLPOST:'button[name="openstudio-export-select-all"]',SELECTNONE:'button[name="openstudio-export-select-none"]',EXPORTSELECTED:'button[name="openstudio-export-selected"]',CHECKBOXS:'.openstudio-export-items input[type="checkbox"][data-contentid]'},init:function(b){f.mconfig=b,f.dialogue=f.createExportDialogue(),a(f.CSS.EXPORTBUTTON).on("click",function(a){a.preventDefault(),f.dialogue.show()}),a(f.CSS.SELECTALLPOST).on("click",f.selectAll.bind(f)),a(f.CSS.SELECTNONE).on("click",f.selectNone.bind(f)),a(f.CSS.EXPORTSELECTED).on("click",f.exportSelected.bind(f)),a(f.CSS.CHECKBOXS).on("click",f.selectPost.bind(f)),a(window).resize(f.resize.bind(f))},createExportDialogue:function(){function b(){var a;c.get_string("exportdialogheader","mod_openstudio").done(function(b){a=b}).always(function(){i.set("headerContent",'<span class="'+f.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}function g(){var b,d;c.get_strings([{key:"exportdialogcontent",component:"mod_openstudio"},{key:"export:emptycontent",component:"mod_openstudio"}]).done(function(a){b=a[0],d=a[1]}).always(function(){b+='<div class="'+f.CSS.EXPORTMESSAGE.replace(".","")+'"></div>',i.set("bodyContent",b),a(f.CSS.EXPORTMESSAGE).text(d)})}function h(){var b={name:"exportall",classNames:"openstudio-exportall-btn",events:{click:f.exportAll.bind(f)}},e={name:"exportselected",classNames:"openstudio-exportselected-btn",events:{click:function(){var b=f.mconfig.contentids.join();b?f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/exportposts.php",data:{id:f.mconfig.id,vid:f.mconfig.vid,contentids:b}}):a(f.CSS.EXPORTMESSAGE).show()}}},g={name:"cancel",classNames:"openstudio-cancelexport-btn",action:"hide"};c.get_strings([{key:"exportall",component:"mod_openstudio"},{key:"exportselectedpost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){b.label=a[0],e.label=a[1],g.label=a[2]}).always(function(){i.addButton(b,["footer"]),i.addButton(e,["footer"]),i.addButton(g,["footer"])})}var i=new e({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521,extraClasses:[f.CSS.BOUNDINGBOX.replace(".","")]});return b(),g(),h(),i},exportAll:function(){var b=f.mconfig.contentids.join();b?f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:f.mconfig.id,contentids:b}}):a(f.CSS.EXPORTMESSAGE).show()},exportSelected:function(){var b=[];a(f.CSS.CHECKBOXS).each(function(){1==a(this).prop("checked")&&b.push(a(this).data("contentid"))}),b.length>0&&f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:f.mconfig.id,contentids:b.join()}})},resize:function(){f.dialogue.get("visible")&&(b.one("body").get("winWidth")<=767?f.dialogue.makeResponsive():f.dialogue.centerDialogue())},redirectPostRequest:function(b){var c=a("<form></form>");c.attr({method:"POST",action:b.url,style:"display: none;"}),a.each(b.data,function(b,d){var e=a("<input/>");e.attr("type","hidden"),e.attr("name",b),e.attr("value",d),c.append(e)}),a(c).appendTo("body").submit()},selectAll:function(){a(f.CSS.CHECKBOXS).prop("checked",!0),a(f.CSS.SELECTALLPOST).addClass("disabled"),a(f.CSS.EXPORTSELECTED).removeClass("disabled"),a(f.CSS.SELECTNONE).removeClass("disabled")},selectNone:function(){a(f.CSS.CHECKBOXS).prop("checked",!1),a(f.CSS.SELECTALLPOST).removeClass("disabled"),a(f.CSS.EXPORTSELECTED).addClass("disabled"),a(f.CSS.SELECTNONE).addClass("disabled")},selectPost:function(){var b=0,c=0;a(f.CSS.CHECKBOXS).each(function(){0==a(this).prop("checked")&&b++,c++}),a(f.CSS.SELECTALLPOST).toggleClass("disabled",0==b),a(f.CSS.SELECTNONE).toggleClass("disabled",b==c),a(f.CSS.EXPORTSELECTED).toggleClass("disabled",b==c)}}});
define('mod_openstudio/folderbrowseposts', ["jquery","amd/build/isotope.pkgd.min.js","core/str","core/templates","core/ajax"],function(a,b,c,d,e){var f;return f={mconfig:null,selectedposts:[],totalavailablepost:0,CSS:{BROWSEPOSTLINK:".openstudio-select-content",BROWSEPOSTSSELECTEDIDS:"#browse_posts_selected_ids",BROWSEPOSTSSELECTEDITEMS:"#browse_posts_selected_items",SELECTPOSTBTN:".openstudio-folder-select-post-btn",BROWSEPOSTSSELECTED:"#browse_posts_selected",BROWSEPOSTSCOUNTSELECTED:"#openstudio-browseposts-countcurrent",REMOVELASTSELECTED:".folder-browse-post-remove-last-selection",SAVECHANGEBUTTON:".folder-browse-post-save-change",DIALOGHEADER:".openstudio-dialogue-common-header",BROWSEPOSTDIALOGUECONTAINER:".openstudio-folder-posts-dialogue"},init:function(b){f.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){require(["mod_openstudio/osdialogue"],function(a){f.dialogue=f.createBrowseDialogue(a)})}),a(f.CSS.BROWSEPOSTLINK).on("click",function(){f.dialogue.show(),d.render("mod_openstudio/folder_browse_posts_header",{}).done(function(b){return f.selectedposts=[],f.dialogue.set("bodyContent",b),setTimeout(function(){f.resize()},200),a("#openstudio_search_post").keypress(function(a){var b=a.which;return 13!=b||(f.doBrowsePosts(),!1)}),a(".browse-search-icon").on("click",function(){f.doBrowsePosts()}),f.doBrowsePosts(),a(f.CSS.REMOVELASTSELECTED).on("click",function(){f.removeLastPostSelected()}),!1})}),a(window).resize(f.resize.bind(f))},doBrowsePosts:function(){var b=e.call([{methodname:"mod_openstudio_external_browse_posts",args:{cmid:f.mconfig.cmid,folderid:f.mconfig.folderid,selectedposts:a(f.CSS.BROWSEPOSTSSELECTEDIDS).val(),search:a("#openstudio_search_post").val()}}]);b[0].done(function(b){f.totalavailablepost=b.total,a("#folder_total_browse_posts").html(b.foundnumberpostlabel),a("#openstudio-browseposts-total").html(b.total),a("#openstudio-browseposts-helpicon").html(b.helpicon),a("#browse_posts_searched").html(b.html),a(f.CSS.SELECTPOSTBTN).on("click",function(){f.selectPostToFolder(this)}),a(f.CSS.SAVECHANGEBUTTON).on("click",function(){f.selectedposts.length&&a("#browse_posts_selected_from").submit()}),f.hideSaveButtons(),f.showHideSelectButton(),f.resize(),f.updateBackgroundRow()}).fail(function(a){window.console.error("Browse posts failed "+a.message)})},createBrowseDialogue:function(a){function b(){var a="folderbrowseposts";c.get_string(a,"mod_openstudio").done(function(a){d.set("headerContent",'<span class="'+f.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}var d=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0,extraClasses:[f.CSS.BROWSEPOSTDIALOGUECONTAINER.replace(".","")]});return b(),d},selectPostToFolder:function(b){var c=a(b).attr("value"),e=a("#browse_post_item_img_"+c).attr("src"),g=M.util.image_url("close_button_whitecross_rgb_32px","mod_openstudio"),h=a("#browse_post_item_name_"+c).val(),i="deselect-"+c;d.render("mod_openstudio/folder_browse_selected_post",{buttonid:i,postid:c,image:e,closeicon:g,title:h}).done(function(b){a(f.CSS.BROWSEPOSTSSELECTEDITEMS).append(b),a("#deselect-"+c).on("click",function(){var b=a(this).attr("value");f.deSelectPostToFolder(b)}),f.showHideSelectButton()}),a("#browse_post_item_"+c).hide(),f.selectedposts.push(c),a(f.CSS.BROWSEPOSTSSELECTEDIDS).val(f.selectedposts),a(f.CSS.BROWSEPOSTSSELECTED).show();var j=f.selectedposts.length;a(f.CSS.BROWSEPOSTSCOUNTSELECTED).html(j),f.showSaveButtons(),f.updateBackgroundRow()},deSelectPostToFolder:function(b){a("#browse_post_item_"+b).show(),a("#deselect-"+b).remove(),f.selectedposts.splice(a.inArray(b,f.selectedposts),1),a(f.CSS.BROWSEPOSTSSELECTEDIDS).val(f.selectedposts);var c=f.selectedposts.length;a(f.CSS.BROWSEPOSTSCOUNTSELECTED).html(c),0==c&&a(f.CSS.BROWSEPOSTSSELECTED).hide(),f.hideSaveButtons(),f.showHideSelectButton(),f.updateBackgroundRow()},removeLastPostSelected:function(){var a=f.selectedposts[f.selectedposts.length-1];f.deSelectPostToFolder(a)},hideSaveButtons:function(){var b=f.selectedposts.length;0==b&&(a(".openstudio-folder-browse-posts-header-result-buttons").hide(),a(".openstudio-folder-browse-posts-header-result-buttons-bottom").hide())},showSaveButtons:function(){a(".openstudio-folder-browse-posts-header-result-buttons").show(),a(".openstudio-folder-browse-posts-header-result-buttons-bottom").show()},resize:function(){f.dialogue&&f.dialogue.get("visible")&&(Y.one("body").get("winWidth")<f.dialogue.get("responsiveWidth")?(f.dialogue.makeResponsive(),a(f.CSS.SAVE_ORDER_BUTTON).removeClass("osep-smallbutton")):(a(f.CSS.SAVE_ORDER_BUTTON).addClass("osep-smallbutton"),Y.one("body").get("winWidth")>=767?f.dialogue.set("width",640):f.dialogue.set("width",500),f.dialogue.centerDialogue()))},showHideSelectButton:function(){0==f.totalavailablepost||f.selectedposts.length>0&&f.totalavailablepost<=f.selectedposts.length?a(".openstudio-folder-select-post-btn").prop("disabled",!0):a(".openstudio-folder-select-post-btn").prop("disabled",!1)},updateBackgroundRow:function(){a(".openstudio-browse-post-item").removeClass("browse-post-item-even").removeClass("browse-post-item-odd"),a(".openstudio-browse-post-item:visible:even").addClass("browse-post-item-even"),a(".openstudio-browse-post-item:visible:odd").addClass("browse-post-item-odd")}}});
define('mod_openstudio/folderhelper', ["jquery","amd/build/isotope.pkgd.min.js"],function(a,b){var c;return c={init:function(){c.handleIsotope()},isoTope:null,handleIsotope:function(){var d=".openstudio-folder-items",e=243,f=20;a(window).width()<=1024&&(e=175,f=15),c.isoTope=new b(d,{layoutMode:"masonry",itemSelector:".openstudio-folder-item",masonry:{columnWidth:e,gutter:f,horizontalOrder:!0}});var g=a(d).find("img").not(function(){return this.complete}),h=g.length;h?g.on("load",function(){h--,h||c.reArrangeItems()}):c.reArrangeItems()},reArrangeItems:function(){setTimeout(function(){c.isoTope.layout()},1e3)}}});
/*!
 * Isotope PACKAGED v3.0.4
 *
 * Licensed GPLv3 for open source use
 * or Isotope Commercial License for commercial use
 *
 * http://isotope.metafizzy.co
 * Copyright 2017 Metafizzy
 */

!function(t,e){"function"==typeof define&&define.amd?define('mod_openstudio/isotope.pkgd', "jquery-bridget/jquery-bridget",["jquery"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("jquery")):t.jQueryBridget=e(t,t.jQuery)}(window,function(t,e){"use strict";function i(i,s,a){function u(t,e,o){var n,s="$()."+i+'("'+e+'")';return t.each(function(t,u){var h=a.data(u,i);if(!h)return void r(i+" not initialized. Cannot call methods, i.e. "+s);var d=h[e];if(!d||"_"==e.charAt(0))return void r(s+" is not a valid method");var l=d.apply(h,o);n=void 0===n?l:n}),void 0!==n?n:t}function h(t,e){t.each(function(t,o){var n=a.data(o,i);n?(n.option(e),n._init()):(n=new s(o,e),a.data(o,i,n))})}a=a||e||t.jQuery,a&&(s.prototype.option||(s.prototype.option=function(t){a.isPlainObject(t)&&(this.options=a.extend(!0,this.options,t))}),a.fn[i]=function(t){if("string"==typeof t){var e=n.call(arguments,1);return u(this,t,e)}return h(this,t),this},o(a))}function o(t){!t||t&&t.bridget||(t.bridget=i)}var n=Array.prototype.slice,s=t.console,r="undefined"==typeof s?function(){}:function(t){s.error(t)};return o(e||t.jQuery),i}),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},o=i[t]=i[t]||[];return o.indexOf(e)==-1&&o.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},o=i[t]=i[t]||{};return o[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var o=i.indexOf(e);return o!=-1&&i.splice(o,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var o=0,n=i[o];e=e||[];for(var s=this._onceEvents&&this._onceEvents[t];n;){var r=s&&s[n];r&&(this.off(t,n),delete s[n]),n.apply(this,e),o+=r?0:1,n=i[o]}return this}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return e()}):"object"==typeof module&&module.exports?module.exports=e():t.getSize=e()}(window,function(){"use strict";function t(t){var e=parseFloat(t),i=t.indexOf("%")==-1&&!isNaN(e);return i&&e}function e(){}function i(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<h;e++){var i=u[e];t[i]=0}return t}function o(t){var e=getComputedStyle(t);return e||a("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),e}function n(){if(!d){d=!0;var e=document.createElement("div");e.style.width="200px",e.style.padding="1px 2px 3px 4px",e.style.borderStyle="solid",e.style.borderWidth="1px 2px 3px 4px",e.style.boxSizing="border-box";var i=document.body||document.documentElement;i.appendChild(e);var n=o(e);s.isBoxSizeOuter=r=200==t(n.width),i.removeChild(e)}}function s(e){if(n(),"string"==typeof e&&(e=document.querySelector(e)),e&&"object"==typeof e&&e.nodeType){var s=o(e);if("none"==s.display)return i();var a={};a.width=e.offsetWidth,a.height=e.offsetHeight;for(var d=a.isBorderBox="border-box"==s.boxSizing,l=0;l<h;l++){var f=u[l],c=s[f],m=parseFloat(c);a[f]=isNaN(m)?0:m}var p=a.paddingLeft+a.paddingRight,y=a.paddingTop+a.paddingBottom,g=a.marginLeft+a.marginRight,v=a.marginTop+a.marginBottom,_=a.borderLeftWidth+a.borderRightWidth,I=a.borderTopWidth+a.borderBottomWidth,z=d&&r,x=t(s.width);x!==!1&&(a.width=x+(z?0:p+_));var S=t(s.height);return S!==!1&&(a.height=S+(z?0:y+I)),a.innerWidth=a.width-(p+_),a.innerHeight=a.height-(y+I),a.outerWidth=a.width+g,a.outerHeight=a.height+v,a}}var r,a="undefined"==typeof console?e:function(t){console.error(t)},u=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],h=u.length,d=!1;return s}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",e):"object"==typeof module&&module.exports?module.exports=e():t.matchesSelector=e()}(window,function(){"use strict";var t=function(){var t=window.Element.prototype;if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0;i<e.length;i++){var o=e[i],n=o+"MatchesSelector";if(t[n])return n}}();return function(e,i){return e[t](i)}}),function(t,e){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("desandro-matches-selector")):t.fizzyUIUtils=e(t,t.matchesSelector)}(window,function(t,e){var i={};i.extend=function(t,e){for(var i in e)t[i]=e[i];return t},i.modulo=function(t,e){return(t%e+e)%e},i.makeArray=function(t){var e=[];if(Array.isArray(t))e=t;else if(t&&"object"==typeof t&&"number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e},i.removeFrom=function(t,e){var i=t.indexOf(e);i!=-1&&t.splice(i,1)},i.getParent=function(t,i){for(;t.parentNode&&t!=document.body;)if(t=t.parentNode,e(t,i))return t},i.getQueryElement=function(t){return"string"==typeof t?document.querySelector(t):t},i.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},i.filterFindElements=function(t,o){t=i.makeArray(t);var n=[];return t.forEach(function(t){if(t instanceof HTMLElement){if(!o)return void n.push(t);e(t,o)&&n.push(t);for(var i=t.querySelectorAll(o),s=0;s<i.length;s++)n.push(i[s])}}),n},i.debounceMethod=function(t,e,i){var o=t.prototype[e],n=e+"Timeout";t.prototype[e]=function(){var t=this[n];t&&clearTimeout(t);var e=arguments,s=this;this[n]=setTimeout(function(){o.apply(s,e),delete s[n]},i||100)}},i.docReady=function(t){var e=document.readyState;"complete"==e||"interactive"==e?setTimeout(t):document.addEventListener("DOMContentLoaded",t)},i.toDashed=function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()};var o=t.console;return i.htmlInit=function(e,n){i.docReady(function(){var s=i.toDashed(n),r="data-"+s,a=document.querySelectorAll("["+r+"]"),u=document.querySelectorAll(".js-"+s),h=i.makeArray(a).concat(i.makeArray(u)),d=r+"-options",l=t.jQuery;h.forEach(function(t){var i,s=t.getAttribute(r)||t.getAttribute(d);try{i=s&&JSON.parse(s)}catch(a){return void(o&&o.error("Error parsing "+r+" on "+t.className+": "+a))}var u=new e(t,i);l&&l.data(t,n,u)})})},i}),function(t,e){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("ev-emitter"),require("get-size")):(t.Outlayer={},t.Outlayer.Item=e(t.EvEmitter,t.getSize))}(window,function(t,e){"use strict";function i(t){for(var e in t)return!1;return e=null,!0}function o(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}function n(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}var s=document.documentElement.style,r="string"==typeof s.transition?"transition":"WebkitTransition",a="string"==typeof s.transform?"transform":"WebkitTransform",u={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],h={transform:a,transition:r,transitionDuration:r+"Duration",transitionProperty:r+"Property",transitionDelay:r+"Delay"},d=o.prototype=Object.create(t.prototype);d.constructor=o,d._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},d.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},d.getSize=function(){this.size=e(this.element)},d.css=function(t){var e=this.element.style;for(var i in t){var o=h[i]||i;e[o]=t[i]}},d.getPosition=function(){var t=getComputedStyle(this.element),e=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),o=t[e?"left":"right"],n=t[i?"top":"bottom"],s=this.layout.size,r=o.indexOf("%")!=-1?parseFloat(o)/100*s.width:parseInt(o,10),a=n.indexOf("%")!=-1?parseFloat(n)/100*s.height:parseInt(n,10);r=isNaN(r)?0:r,a=isNaN(a)?0:a,r-=e?s.paddingLeft:s.paddingRight,a-=i?s.paddingTop:s.paddingBottom,this.position.x=r,this.position.y=a},d.layoutPosition=function(){var t=this.layout.size,e={},i=this.layout._getOption("originLeft"),o=this.layout._getOption("originTop"),n=i?"paddingLeft":"paddingRight",s=i?"left":"right",r=i?"right":"left",a=this.position.x+t[n];e[s]=this.getXValue(a),e[r]="";var u=o?"paddingTop":"paddingBottom",h=o?"top":"bottom",d=o?"bottom":"top",l=this.position.y+t[u];e[h]=this.getYValue(l),e[d]="",this.css(e),this.emitEvent("layout",[this])},d.getXValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!e?t/this.layout.size.width*100+"%":t+"px"},d.getYValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&e?t/this.layout.size.height*100+"%":t+"px"},d._transitionTo=function(t,e){this.getPosition();var i=this.position.x,o=this.position.y,n=parseInt(t,10),s=parseInt(e,10),r=n===this.position.x&&s===this.position.y;if(this.setPosition(t,e),r&&!this.isTransitioning)return void this.layoutPosition();var a=t-i,u=e-o,h={};h.transform=this.getTranslate(a,u),this.transition({to:h,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},d.getTranslate=function(t,e){var i=this.layout._getOption("originLeft"),o=this.layout._getOption("originTop");return t=i?t:-t,e=o?e:-e,"translate3d("+t+"px, "+e+"px, 0)"},d.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},d.moveTo=d._transitionTo,d.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},d._nonTransition=function(t){this.css(t.to),t.isCleaning&&this._removeStyles(t.to);for(var e in t.onTransitionEnd)t.onTransitionEnd[e].call(this)},d.transition=function(t){if(!parseFloat(this.layout.options.transitionDuration))return void this._nonTransition(t);var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);var o=this.element.offsetHeight;o=null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0};var l="opacity,"+n(a);d.enableTransition=function(){if(!this.isTransitioning){var t=this.layout.options.transitionDuration;t="number"==typeof t?t+"ms":t,this.css({transitionProperty:l,transitionDuration:t,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(u,this,!1)}},d.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},d.onotransitionend=function(t){this.ontransitionend(t)};var f={"-webkit-transform":"transform"};d.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,o=f[t.propertyName]||t.propertyName;if(delete e.ingProperties[o],i(e.ingProperties)&&this.disableTransition(),o in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[o]),o in e.onEnd){var n=e.onEnd[o];n.call(this),delete e.onEnd[o]}this.emitEvent("transitionEnd",[this])}},d.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(u,this,!1),this.isTransitioning=!1},d._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var c={transitionProperty:"",transitionDuration:"",transitionDelay:""};return d.removeTransitionStyles=function(){this.css(c)},d.stagger=function(t){t=isNaN(t)?0:t,this.staggerDelay=t+"ms"},d.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},d.remove=function(){return r&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},d.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("visibleStyle");e[i]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},d.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},d.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},d.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("hiddenStyle");e[i]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},d.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},d.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},o}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,o,n,s){return e(t,i,o,n,s)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):t.Outlayer=e(t,t.EvEmitter,t.getSize,t.fizzyUIUtils,t.Outlayer.Item)}(window,function(t,e,i,o,n){"use strict";function s(t,e){var i=o.getQueryElement(t);if(!i)return void(u&&u.error("Bad element for "+this.constructor.namespace+": "+(i||t)));this.element=i,h&&(this.$element=h(this.element)),this.options=o.extend({},this.constructor.defaults),this.option(e);var n=++l;this.element.outlayerGUID=n,f[n]=this,this._create();var s=this._getOption("initLayout");s&&this.layout()}function r(t){function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}function a(t){if("number"==typeof t)return t;var e=t.match(/(^\d*\.?\d*)(\w*)/),i=e&&e[1],o=e&&e[2];if(!i.length)return 0;i=parseFloat(i);var n=m[o]||1;return i*n}var u=t.console,h=t.jQuery,d=function(){},l=0,f={};s.namespace="outlayer",s.Item=n,s.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var c=s.prototype;o.extend(c,e.prototype),c.option=function(t){o.extend(this.options,t)},c._getOption=function(t){var e=this.constructor.compatOptions[t];return e&&void 0!==this.options[e]?this.options[e]:this.options[t]},s.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},c._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),o.extend(this.element.style,this.options.containerStyle);var t=this._getOption("resize");t&&this.bindResize()},c.reloadItems=function(){this.items=this._itemize(this.element.children)},c._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,o=[],n=0;n<e.length;n++){var s=e[n],r=new i(s,this);o.push(r)}return o},c._filterFindItemElements=function(t){return o.filterFindElements(t,this.options.itemSelector)},c.getItemElements=function(){return this.items.map(function(t){return t.element})},c.layout=function(){this._resetLayout(),this._manageStamps();var t=this._getOption("layoutInstant"),e=void 0!==t?t:!this._isLayoutInited;this.layoutItems(this.items,e),this._isLayoutInited=!0},c._init=c.layout,c._resetLayout=function(){this.getSize()},c.getSize=function(){this.size=i(this.element)},c._getMeasurement=function(t,e){var o,n=this.options[t];n?("string"==typeof n?o=this.element.querySelector(n):n instanceof HTMLElement&&(o=n),this[t]=o?i(o)[e]:n):this[t]=0},c.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},c._getItemsForLayout=function(t){return t.filter(function(t){return!t.isIgnored})},c._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){var i=[];t.forEach(function(t){var o=this._getItemLayoutPosition(t);o.item=t,o.isInstant=e||t.isLayoutInstant,i.push(o)},this),this._processLayoutQueue(i)}},c._getItemLayoutPosition=function(){return{x:0,y:0}},c._processLayoutQueue=function(t){this.updateStagger(),t.forEach(function(t,e){this._positionItem(t.item,t.x,t.y,t.isInstant,e)},this)},c.updateStagger=function(){var t=this.options.stagger;return null===t||void 0===t?void(this.stagger=0):(this.stagger=a(t),this.stagger)},c._positionItem=function(t,e,i,o,n){o?t.goTo(e,i):(t.stagger(n*this.stagger),t.moveTo(e,i))},c._postLayout=function(){this.resizeContainer()},c.resizeContainer=function(){var t=this._getOption("resizeContainer");if(t){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},c._getContainerSize=d,c._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},c._emitCompleteOnItems=function(t,e){function i(){n.dispatchEvent(t+"Complete",null,[e])}function o(){r++,r==s&&i()}var n=this,s=e.length;if(!e||!s)return void i();var r=0;e.forEach(function(e){e.once(t,o)})},c.dispatchEvent=function(t,e,i){var o=e?[e].concat(i):i;if(this.emitEvent(t,o),h)if(this.$element=this.$element||h(this.element),e){var n=h.Event(e);n.type=t,this.$element.trigger(n,i)}else this.$element.trigger(t,i)},c.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},c.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},c.stamp=function(t){t=this._find(t),t&&(this.stamps=this.stamps.concat(t),t.forEach(this.ignore,this))},c.unstamp=function(t){t=this._find(t),t&&t.forEach(function(t){o.removeFrom(this.stamps,t),this.unignore(t)},this)},c._find=function(t){if(t)return"string"==typeof t&&(t=this.element.querySelectorAll(t)),t=o.makeArray(t)},c._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},c._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},c._manageStamp=d,c._getElementOffset=function(t){var e=t.getBoundingClientRect(),o=this._boundingRect,n=i(t),s={left:e.left-o.left-n.marginLeft,top:e.top-o.top-n.marginTop,right:o.right-e.right-n.marginRight,bottom:o.bottom-e.bottom-n.marginBottom};return s},c.handleEvent=o.handleEvent,c.bindResize=function(){t.addEventListener("resize",this),this.isResizeBound=!0},c.unbindResize=function(){t.removeEventListener("resize",this),this.isResizeBound=!1},c.onresize=function(){this.resize()},o.debounceMethod(s,"onresize",100),c.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},c.needsResizeLayout=function(){var t=i(this.element),e=this.size&&t;return e&&t.innerWidth!==this.size.innerWidth},c.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},c.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},c.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},c.reveal=function(t){if(this._emitCompleteOnItems("reveal",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.reveal()})}},c.hide=function(t){if(this._emitCompleteOnItems("hide",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.hide()})}},c.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},c.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},c.getItem=function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];if(i.element==t)return i}},c.getItems=function(t){t=o.makeArray(t);var e=[];return t.forEach(function(t){var i=this.getItem(t);i&&e.push(i)},this),e},c.remove=function(t){var e=this.getItems(t);this._emitCompleteOnItems("remove",e),e&&e.length&&e.forEach(function(t){t.remove(),o.removeFrom(this.items,t)},this)},c.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="",this.items.forEach(function(t){t.destroy()}),this.unbindResize();var e=this.element.outlayerGUID;delete f[e],delete this.element.outlayerGUID,h&&h.removeData(this.element,this.constructor.namespace)},s.data=function(t){t=o.getQueryElement(t);var e=t&&t.outlayerGUID;return e&&f[e]},s.create=function(t,e){var i=r(s);return i.defaults=o.extend({},s.defaults),o.extend(i.defaults,e),i.compatOptions=o.extend({},s.compatOptions),i.namespace=t,i.data=s.data,i.Item=r(n),o.htmlInit(i,t),h&&h.bridget&&h.bridget(t,i),i};var m={ms:1,s:1e3};return s.Item=n,s}),function(t,e){"function"==typeof define&&define.amd?define("isotope/js/item",["outlayer/outlayer"],e):"object"==typeof module&&module.exports?module.exports=e(require("outlayer")):(t.Isotope=t.Isotope||{},t.Isotope.Item=e(t.Outlayer))}(window,function(t){"use strict";function e(){t.Item.apply(this,arguments)}var i=e.prototype=Object.create(t.Item.prototype),o=i._create;i._create=function(){this.id=this.layout.itemGUID++,o.call(this),this.sortData={}},i.updateSortData=function(){if(!this.isIgnored){this.sortData.id=this.id,this.sortData["original-order"]=this.id,this.sortData.random=Math.random();var t=this.layout.options.getSortData,e=this.layout._sorters;for(var i in t){var o=e[i];this.sortData[i]=o(this.element,this)}}};var n=i.destroy;return i.destroy=function(){n.apply(this,arguments),this.css({display:""})},e}),function(t,e){"function"==typeof define&&define.amd?define("isotope/js/layout-mode",["get-size/get-size","outlayer/outlayer"],e):"object"==typeof module&&module.exports?module.exports=e(require("get-size"),require("outlayer")):(t.Isotope=t.Isotope||{},t.Isotope.LayoutMode=e(t.getSize,t.Outlayer))}(window,function(t,e){"use strict";function i(t){this.isotope=t,t&&(this.options=t.options[this.namespace],this.element=t.element,this.items=t.filteredItems,this.size=t.size)}var o=i.prototype,n=["_resetLayout","_getItemLayoutPosition","_manageStamp","_getContainerSize","_getElementOffset","needsResizeLayout","_getOption"];return n.forEach(function(t){o[t]=function(){return e.prototype[t].apply(this.isotope,arguments)}}),o.needsVerticalResizeLayout=function(){var e=t(this.isotope.element),i=this.isotope.size&&e;return i&&e.innerHeight!=this.isotope.size.innerHeight},o._getMeasurement=function(){this.isotope._getMeasurement.apply(this,arguments)},o.getColumnWidth=function(){this.getSegmentSize("column","Width")},o.getRowHeight=function(){this.getSegmentSize("row","Height")},o.getSegmentSize=function(t,e){var i=t+e,o="outer"+e;if(this._getMeasurement(i,o),!this[i]){var n=this.getFirstItemSize();this[i]=n&&n[o]||this.isotope.size["inner"+e]}},o.getFirstItemSize=function(){var e=this.isotope.filteredItems[0];return e&&e.element&&t(e.element)},o.layout=function(){this.isotope.layout.apply(this.isotope,arguments)},o.getSize=function(){this.isotope.getSize(),this.size=this.isotope.size},i.modes={},i.create=function(t,e){function n(){i.apply(this,arguments)}return n.prototype=Object.create(o),n.prototype.constructor=n,e&&(n.options=e),n.prototype.namespace=t,i.modes[t]=n,n},i}),function(t,e){"function"==typeof define&&define.amd?define("masonry/masonry",["outlayer/outlayer","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("outlayer"),require("get-size")):t.Masonry=e(t.Outlayer,t.getSize)}(window,function(t,e){var i=t.create("masonry");i.compatOptions.fitWidth="isFitWidth";var o=i.prototype;return o._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},o.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],i=t&&t.element;this.columnWidth=i&&e(i).outerWidth||this.containerWidth}var o=this.columnWidth+=this.gutter,n=this.containerWidth+this.gutter,s=n/o,r=o-n%o,a=r&&r<1?"round":"floor";s=Math[a](s),this.cols=Math.max(s,1)},o.getContainerWidth=function(){var t=this._getOption("fitWidth"),i=t?this.element.parentNode:this.element,o=e(i);this.containerWidth=o&&o.innerWidth},o._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth%this.columnWidth,i=e&&e<1?"round":"ceil",o=Math[i](t.size.outerWidth/this.columnWidth);o=Math.min(o,this.cols);for(var n=this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition",s=this[n](o,t),r={x:this.columnWidth*s.col,y:s.y},a=s.y+t.size.outerHeight,u=o+s.col,h=s.col;h<u;h++)this.colYs[h]=a;return r},o._getTopColPosition=function(t){var e=this._getTopColGroup(t),i=Math.min.apply(Math,e);return{col:e.indexOf(i),y:i}},o._getTopColGroup=function(t){if(t<2)return this.colYs;for(var e=[],i=this.cols+1-t,o=0;o<i;o++)e[o]=this._getColGroupY(o,t);return e},o._getColGroupY=function(t,e){if(e<2)return this.colYs[t];var i=this.colYs.slice(t,t+e);return Math.max.apply(Math,i)},o._getHorizontalColPosition=function(t,e){var i=this.horizontalColIndex%this.cols,o=t>1&&i+t>this.cols;i=o?0:i;var n=e.size.outerWidth&&e.size.outerHeight;return this.horizontalColIndex=n?i+t:this.horizontalColIndex,{col:i,y:this._getColGroupY(i,t)}},o._manageStamp=function(t){var i=e(t),o=this._getElementOffset(t),n=this._getOption("originLeft"),s=n?o.left:o.right,r=s+i.outerWidth,a=Math.floor(s/this.columnWidth);a=Math.max(0,a);var u=Math.floor(r/this.columnWidth);u-=r%this.columnWidth?0:1,u=Math.min(this.cols-1,u);for(var h=this._getOption("originTop"),d=(h?o.top:o.bottom)+i.outerHeight,l=a;l<=u;l++)this.colYs[l]=Math.max(d,this.colYs[l])},o._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},o._getContainerFitWidth=function(){for(var t=0,e=this.cols;--e&&0===this.colYs[e];)t++;return(this.cols-t)*this.columnWidth-this.gutter},o.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth},i}),function(t,e){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/masonry",["../layout-mode","masonry/masonry"],e):"object"==typeof module&&module.exports?module.exports=e(require("../layout-mode"),require("masonry-layout")):e(t.Isotope.LayoutMode,t.Masonry)}(window,function(t,e){"use strict";var i=t.create("masonry"),o=i.prototype,n={_getElementOffset:!0,layout:!0,_getMeasurement:!0};for(var s in e.prototype)n[s]||(o[s]=e.prototype[s]);var r=o.measureColumns;o.measureColumns=function(){this.items=this.isotope.filteredItems,r.call(this)};var a=o._getOption;return o._getOption=function(t){return"fitWidth"==t?void 0!==this.options.isFitWidth?this.options.isFitWidth:this.options.fitWidth:a.apply(this.isotope,arguments)},i}),function(t,e){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/fit-rows",["../layout-mode"],e):"object"==typeof exports?module.exports=e(require("../layout-mode")):e(t.Isotope.LayoutMode)}(window,function(t){"use strict";var e=t.create("fitRows"),i=e.prototype;return i._resetLayout=function(){this.x=0,this.y=0,this.maxY=0,this._getMeasurement("gutter","outerWidth")},i._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth+this.gutter,i=this.isotope.size.innerWidth+this.gutter;0!==this.x&&e+this.x>i&&(this.x=0,this.y=this.maxY);var o={x:this.x,y:this.y};return this.maxY=Math.max(this.maxY,this.y+t.size.outerHeight),this.x+=e,o},i._getContainerSize=function(){return{height:this.maxY}},e}),function(t,e){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/vertical",["../layout-mode"],e):"object"==typeof module&&module.exports?module.exports=e(require("../layout-mode")):e(t.Isotope.LayoutMode)}(window,function(t){"use strict";var e=t.create("vertical",{horizontalAlignment:0}),i=e.prototype;return i._resetLayout=function(){this.y=0},i._getItemLayoutPosition=function(t){t.getSize();var e=(this.isotope.size.innerWidth-t.size.outerWidth)*this.options.horizontalAlignment,i=this.y;return this.y+=t.size.outerHeight,{x:e,y:i}},i._getContainerSize=function(){return{height:this.y}},e}),function(t,e){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size","desandro-matches-selector/matches-selector","fizzy-ui-utils/utils","isotope/js/item","isotope/js/layout-mode","isotope/js/layout-modes/masonry","isotope/js/layout-modes/fit-rows","isotope/js/layout-modes/vertical"],function(i,o,n,s,r,a){return e(t,i,o,n,s,r,a)}):"object"==typeof module&&module.exports?module.exports=e(t,require("outlayer"),require("get-size"),require("desandro-matches-selector"),require("fizzy-ui-utils"),require("isotope/js/item"),require("isotope/js/layout-mode"),require("isotope/js/layout-modes/masonry"),require("isotope/js/layout-modes/fit-rows"),require("isotope/js/layout-modes/vertical")):t.Isotope=e(t,t.Outlayer,t.getSize,t.matchesSelector,t.fizzyUIUtils,t.Isotope.Item,t.Isotope.LayoutMode)}(window,function(t,e,i,o,n,s,r){function a(t,e){return function(i,o){for(var n=0;n<t.length;n++){var s=t[n],r=i.sortData[s],a=o.sortData[s];if(r>a||r<a){var u=void 0!==e[s]?e[s]:e,h=u?1:-1;return(r>a?1:-1)*h}}return 0}}var u=t.jQuery,h=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^\s+|\s+$/g,"")},d=e.create("isotope",{layoutMode:"masonry",isJQueryFiltering:!0,sortAscending:!0});d.Item=s,d.LayoutMode=r;var l=d.prototype;l._create=function(){this.itemGUID=0,this._sorters={},this._getSorters(),e.prototype._create.call(this),this.modes={},this.filteredItems=this.items,this.sortHistory=["original-order"];for(var t in r.modes)this._initLayoutMode(t)},l.reloadItems=function(){this.itemGUID=0,e.prototype.reloadItems.call(this)},l._itemize=function(){for(var t=e.prototype._itemize.apply(this,arguments),i=0;i<t.length;i++){var o=t[i];o.id=this.itemGUID++}return this._updateItemsSortData(t),t},l._initLayoutMode=function(t){var e=r.modes[t],i=this.options[t]||{};this.options[t]=e.options?n.extend(e.options,i):i,this.modes[t]=new e(this)},l.layout=function(){return!this._isLayoutInited&&this._getOption("initLayout")?void this.arrange():void this._layout()},l._layout=function(){var t=this._getIsInstant();this._resetLayout(),this._manageStamps(),this.layoutItems(this.filteredItems,t),this._isLayoutInited=!0},l.arrange=function(t){this.option(t),this._getIsInstant();var e=this._filter(this.items);this.filteredItems=e.matches,this._bindArrangeComplete(),this._isInstant?this._noTransition(this._hideReveal,[e]):this._hideReveal(e),this._sort(),this._layout()},l._init=l.arrange,l._hideReveal=function(t){this.reveal(t.needReveal),this.hide(t.needHide)},l._getIsInstant=function(){var t=this._getOption("layoutInstant"),e=void 0!==t?t:!this._isLayoutInited;return this._isInstant=e,e},l._bindArrangeComplete=function(){function t(){e&&i&&o&&n.dispatchEvent("arrangeComplete",null,[n.filteredItems])}var e,i,o,n=this;this.once("layoutComplete",function(){e=!0,t()}),this.once("hideComplete",function(){i=!0,t()}),this.once("revealComplete",function(){o=!0,t()})},l._filter=function(t){var e=this.options.filter;e=e||"*";for(var i=[],o=[],n=[],s=this._getFilterTest(e),r=0;r<t.length;r++){var a=t[r];if(!a.isIgnored){var u=s(a);u&&i.push(a),u&&a.isHidden?o.push(a):u||a.isHidden||n.push(a)}}return{matches:i,needReveal:o,needHide:n}},l._getFilterTest=function(t){return u&&this.options.isJQueryFiltering?function(e){return u(e.element).is(t)}:"function"==typeof t?function(e){return t(e.element)}:function(e){return o(e.element,t)}},l.updateSortData=function(t){
var e;t?(t=n.makeArray(t),e=this.getItems(t)):e=this.items,this._getSorters(),this._updateItemsSortData(e)},l._getSorters=function(){var t=this.options.getSortData;for(var e in t){var i=t[e];this._sorters[e]=f(i)}},l._updateItemsSortData=function(t){for(var e=t&&t.length,i=0;e&&i<e;i++){var o=t[i];o.updateSortData()}};var f=function(){function t(t){if("string"!=typeof t)return t;var i=h(t).split(" "),o=i[0],n=o.match(/^\[(.+)\]$/),s=n&&n[1],r=e(s,o),a=d.sortDataParsers[i[1]];return t=a?function(t){return t&&a(r(t))}:function(t){return t&&r(t)}}function e(t,e){return t?function(e){return e.getAttribute(t)}:function(t){var i=t.querySelector(e);return i&&i.textContent}}return t}();d.sortDataParsers={parseInt:function(t){return parseInt(t,10)},parseFloat:function(t){return parseFloat(t)}},l._sort=function(){if(this.options.sortBy){var t=n.makeArray(this.options.sortBy);this._getIsSameSortBy(t)||(this.sortHistory=t.concat(this.sortHistory));var e=a(this.sortHistory,this.options.sortAscending);this.filteredItems.sort(e)}},l._getIsSameSortBy=function(t){for(var e=0;e<t.length;e++)if(t[e]!=this.sortHistory[e])return!1;return!0},l._mode=function(){var t=this.options.layoutMode,e=this.modes[t];if(!e)throw new Error("No layout mode: "+t);return e.options=this.options[t],e},l._resetLayout=function(){e.prototype._resetLayout.call(this),this._mode()._resetLayout()},l._getItemLayoutPosition=function(t){return this._mode()._getItemLayoutPosition(t)},l._manageStamp=function(t){this._mode()._manageStamp(t)},l._getContainerSize=function(){return this._mode()._getContainerSize()},l.needsResizeLayout=function(){return this._mode().needsResizeLayout()},l.appended=function(t){var e=this.addItems(t);if(e.length){var i=this._filterRevealAdded(e);this.filteredItems=this.filteredItems.concat(i)}},l.prepended=function(t){var e=this._itemize(t);if(e.length){this._resetLayout(),this._manageStamps();var i=this._filterRevealAdded(e);this.layoutItems(this.filteredItems),this.filteredItems=i.concat(this.filteredItems),this.items=e.concat(this.items)}},l._filterRevealAdded=function(t){var e=this._filter(t);return this.hide(e.needHide),this.reveal(e.matches),this.layoutItems(e.matches,!0),e.matches},l.insert=function(t){var e=this.addItems(t);if(e.length){var i,o,n=e.length;for(i=0;i<n;i++)o=e[i],this.element.appendChild(o.element);var s=this._filter(e).matches;for(i=0;i<n;i++)e[i].isLayoutInstant=!0;for(this.arrange(),i=0;i<n;i++)delete e[i].isLayoutInstant;this.reveal(s)}};var c=l.remove;return l.remove=function(t){t=n.makeArray(t);var e=this.getItems(t);c.call(this,t);for(var i=e&&e.length,o=0;i&&o<i;o++){var s=e[o];n.removeFrom(this.filteredItems,s)}},l.shuffle=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t];e.sortData.random=Math.random()}this.options.sortBy="random",this._sort(),this._layout()},l._noTransition=function(t,e){var i=this.options.transitionDuration;this.options.transitionDuration=0;var o=t.apply(this,e);return this.options.transitionDuration=i,o},l.getFilteredItemElements=function(){return this.filteredItems.map(function(t){return t.element})},d});
define('mod_openstudio/lock', ["jquery","core/ajax","core/str"],function(a,b,c){var d;return d={mconfig:null,CSS:{LOCKBUTTON:"#id_lockbutton",ACTIONITEMS:".openstudio-content-actions"},init:function(b){d.mconfig=b,a(d.CSS.LOCKBUTTON).on("click",d.toggleLockContent.bind(d))},toggleLockContent:function(){var b="locked"==a(d.CSS.LOCKBUTTON).attr("data-lockstate");b?d.unlockContent():d.lockContent()},lockContent:function(){M.util.js_pending("openstudioLockContent");var e=b.call([{methodname:"mod_openstudio_external_lock",args:{cmid:d.mconfig.cmid,cid:d.mconfig.cid,locktype:d.mconfig.CONST.ALL}}]);e[0].done(function(){var b=d.mconfig.isfolder?"folderunlockfolder":"contentactionunlockname";c.get_string(b,"mod_openstudio").done(function(b){a(d.CSS.LOCKBUTTON).attr("value",b).attr("data-lockstate","locked")}),a(d.CSS.ACTIONITEMS).addClass("locked"),a("#openstudio_item_lock").removeClass("openstudio-item-unlock").addClass("openstudio-item-lock")}).always(function(){M.util.js_complete("openstudioLockContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})},unlockContent:function(){M.util.js_pending("openstudioUnlockContent");var e=b.call([{methodname:"mod_openstudio_external_unlock",args:{cmid:d.mconfig.cmid,cid:d.mconfig.cid,locktype:d.mconfig.CONST.NONE}}]);e[0].done(function(){var b=d.mconfig.isfolder?"folderlockfolder":"contentactionlockname";c.get_string(b,"mod_openstudio").done(function(b){a(d.CSS.LOCKBUTTON).attr("value",b).attr("data-lockstate","unlocked")}),a(d.CSS.ACTIONITEMS).removeClass("locked"),a("#openstudio_item_lock").addClass("openstudio-item-unlock").removeClass("openstudio-item-lock")}).always(function(){M.util.js_complete("openstudioUnlockContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})}}});
define('mod_openstudio/lockactivity', ["jquery","core/ajax","core/str"],function(a,b,c){var d;return d={mconfig:null,CSS:{ACTIVITY_UNLOCK_ICON:'span[name="activitylockbutton"]',ACTIVITY_UNLOCK_BUTTON:".openstudio-unlock-ok-btn"},init:function(b){d.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){require(["mod_openstudio/osdialogue"],function(a){d.dialogue=d.createUnlockActivityDialogue(a)})}),a(d.CSS.ACTIVITY_UNLOCK_ICON).on("click",function(){d.dialogue&&(a(d.CSS.ACTIVITY_UNLOCK_BUTTON).attr("data-level3id",a(this).attr("data-level3id")).attr("data-vuid",a(this).attr("data-vuid")),d.dialogue.show())}),a("body").delegate(d.CSS.ACTIVITY_UNLOCK_BUTTON,"click",d.unlockActivityContent),a(window).resize(d.resize.bind(d))},unlockActivityContent:function(){var c=a(this).attr("data-level3id"),e=a(this).attr("data-vuid");M.util.js_pending("openstudioUnlockActivity");var f=b.call([{methodname:"mod_openstudio_external_unlock_override_activity",args:{cmid:d.mconfig.cmid,level3id:c,vuid:e}}]);f[0].done(function(){window.location.reload()}).always(function(){M.util.js_complete("openstudioUnlockActivity")}).fail(function(a){window.console.error("Log request failed "+a.message)})},createUnlockActivityDialogue:function(a){function b(){c.get_string("contentactionunlockname","mod_openstudio").done(function(a){g.set("headerContent","<span>"+a+"</span>")})}function e(){c.get_string("modulejsdialogcontentunlock","mod_openstudio").done(function(a){g.set("bodyContent",a)})}function f(){var a={name:"cancel",action:"hide"},b={name:"lock",classNames:d.CSS.ACTIVITY_UNLOCK_BUTTON.replace(".","")};c.get_strings([{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"contentactionunlockname",component:"mod_openstudio"}]).done(function(c){a.label=c[0],b.label=c[1],g.addButton(b,["footer"]),g.addButton(a,["footer"])})}var g=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0});return b(),e(),f(),g},resize:function(){d.dialogue&&d.dialogue.get("visible")&&(Y.one("body").get("winWidth")<=d.dialogue.get("responsiveWidth")?d.dialogue.makeResponsive():d.dialogue.centerDialogue())}}});
define('mod_openstudio/managefolders', ["jquery"],function(a){var b;return b={init:function(){a(".moveup:first").hide(),a(".movedown").each(function(){var b=this.id,c=b.split(/[_ ]+/).pop(),d=a('input[name="contentid['+c+']"]').val();""!==d&&"0"!==d||(a("#id_contentmovedown_"+c).hide(),a("#id_contentmoveup_"+c).hide(),a("#id_contentdelete_"+c).hide())}),a(".movedown:visible").last().hide()}}});
define('mod_openstudio/notificationlist', ["jquery","core/ajax","core/modal","core/templates","theme_bootstrapbase/boostrap"],function(a,b,c,d){var e={STOPBUTTONS:".openstudio-notification-stopbutton",NOTIFICATIONBUTTON:".openstudio-nav-primary .dropdown.notifications",UNREAD:".openstudio-notifications-list .openstudio-notification-unread"},f={cmid:null,followflag:null},g={modal:null,init:function(b,c){f.cmid=b,f.followflag=c,a(e.STOPBUTTONS).on("click",g.stopNotifications),a('[data-toggle="tooltip"]').tooltip(),a(e.UNREAD).length>0&&a(e.NOTIFICATIONBUTTON).on("click",g.readNotifications),d.render("mod_openstudio/notification_modal",{name:""}),d.render("core/modal_backdrop",{})},reShowList:function(){window.setTimeout(function(){a(e.NOTIFICATIONBUTTON).addClass("open")},0)},stopNotifications:function(b){b.preventDefault(),g.reShowList();var e,f=a(b.target).closest(".openstudio-notification"),h=a(b.currentTarget).data("contentid"),i=a(b.currentTarget).data("commentid");e=i?"mod_openstudio/commentnotification_modal":"mod_openstudio/notification_modal",d.render(e,{name:f.find(".openstudio-notification-message a").text(),contentid:h,commentid:i}).done(function(a){g.modal=new c(a),g.modal.body.find("button").on("click",g.handleModalButton),g.modal.show()})},handleModalButton:function(c){g.reShowList();var d=a(c.target);if("yes"===d.data("action")){M.util.js_pending("openstudioStopNotifications");var e,h=d.data("commentid"),i={cmid:f.cmid,cid:d.data("contentid"),fid:f.followflag};h?(i.commentid=h,e="mod_openstudio_external_flag_comment"):(i.mode="off",e="mod_openstudio_external_flag_content");var j=b.call([{methodname:e,args:i}]);j[0].done(function(){a('.openstudio-notifications-list button[data-contentid="'+d.data("contentid")+'"]').remove(),M.util.js_complete("openstudioStopNotifications")}).fail(function(){window.console.error("Could not un-follow content"),M.util.js_complete("openstudioStopNotifications")})}g.modal.hide()},readNotifications:function(c){c.preventDefault();var d=a(e.UNREAD).map(function(){return a(this).data("id")}).get(),h=b.call([{methodname:"mod_openstudio_external_read_notifications",args:{cmid:f.cmid,ids:d}}]);h[0].done(function(){a(".openstudio-navigation-notification-text").hide(),a(e.NOTIFICATIONBUTTON).off("click",g.readNotifications)}).fail(function(a){window.console.error("Could not mark notifications read. "+a.message)})}};return g});
define('mod_openstudio/orderposts', ["jquery","core/ajax","core/str","core/templates","require"],function(a,b,c,d,e){var f;return f={mconfig:null,CSS:{ORDER_POSTS_BUTTON:"#id_orderpost",MOVE_UP_BUTTON:".openstudio-orderpost-item-moveup-button",MOVE_DOWN_BUTTON:".openstudio-orderpost-item-movedown-button",SAVE_ORDER_BUTTON:".openstudio-orderpost-save-button",ORDER_NUMBER_INPUT:".openstudio-orderpost-item-order-number-input",ITEM_CONTAINER:".openstudio-orderpost-item",ITEM_ORDER:".openstudio-orderpost-item-order",ORDER_POSTS_DIALOGUE_CONTAINER:".openstudio-orderposts-dialogue"},init:function(b){f.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){e(["mod_openstudio/osdialogue"],function(a){f.dialogue=f.createOrderPostsDialogue(a)})}),a(f.CSS.ORDER_POSTS_BUTTON).on("click",function(){if(f.dialogue){a(".openstudio-folder-posts-dialogue .openstudio-orderpost").remove(),f.setBody(f.dialogue),f.dialogue.show();var b=f.getListOrderPost(),c=[];a.each(b,function(a,b){c[a]=b[0]}),f.mconfig.listorder=c.join(","),setTimeout(function(){f.resize()},200)}}),a("body").delegate(f.CSS.SAVE_ORDER_BUTTON,"click",f.saveOrder).delegate(f.CSS.MOVE_UP_BUTTON,"click",f.moveUp).delegate(f.CSS.MOVE_DOWN_BUTTON,"click",f.moveDown).delegate(f.CSS.ORDER_NUMBER_INPUT,"keyup",f.handleNumberInputEnter).delegate(f.CSS.ORDER_NUMBER_INPUT,"blur",f.handleNumberInputBlur),a(window).resize(f.resize.bind(f))},createOrderPostsDialogue:function(a){function b(){c.get_string("folderorderpost","mod_openstudio").done(function(a){d.set("headerContent","<span>"+a+"</span>")})}var d=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0,extraClasses:[f.CSS.ORDER_POSTS_DIALOGUE_CONTAINER.replace(".",""),"openstudio-folder-posts-dialogue"]});return b(),f.setBody(d),d},setBody:function(c){M.util.js_pending("openstudioGetOrderPostsFolderContent");var d=b.call([{methodname:"mod_openstudio_external_get_order_posts",args:{cmid:f.mconfig.cmid,folderid:f.mconfig.folderid}}]);d[0].done(function(b){c.set("bodyContent",b.html),f.disableFirstLastButton(),a(document).ready(f.disableContentButton),f.checkReorder(),f.inputPosition(),a(f.CSS.SAVE_ORDER_BUTTON).attr("disabled","disabled"),f.resize()}).always(function(){M.util.js_complete("openstudioGetOrderPostsFolderContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})},moveUp:function(){var b=a(this).closest(f.CSS.ITEM_CONTAINER),c=b.find(f.CSS.ITEM_ORDER).attr("data-order");c=parseInt(c),f.swapItems(c,c-1,b)},moveDown:function(){var b=a(this).closest(f.CSS.ITEM_CONTAINER),c=b.find(f.CSS.ITEM_ORDER).attr("data-order");c=parseInt(c),f.swapItems(c,c+1,b)},moveTo:function(){var b=a(this).val();if(!(b<=0||b>f.mconfig.total)){var d=a(this).closest(f.CSS.ITEM_CONTAINER),e=d.find(f.CSS.ITEM_ORDER).attr("data-order");e=parseInt(e);var g=a(f.CSS.ITEM_CONTAINER).last().find(f.CSS.ITEM_ORDER).attr("data-order");g=parseInt(g);var h=a("div[data-order="+e+"]").hasClass("openstudio-orderpost-item-canreorder"),i=a("div[data-order="+b+"]").hasClass("openstudio-orderpost-item-canreorder");if(h&&i)return void c.get_string("foldercontentcannotreorder","mod_openstudio").done(function(a){f.showErrorMessage(a)});b>g&&(b=g),b<1&&(b=1),f.swapItems(e,b,d)}},saveOrder:function(){a(f.CSS.ORDER_NUMBER_INPUT).each(function(){var b=a(this).val().trim(),c=a(this).closest(f.CSS.ITEM_CONTAINER),d=c.find(f.CSS.ITEM_ORDER).attr("data-order");d=parseInt(d),b!=d&&f.swapItems(d,b,c)}),M.util.js_pending("openstudioOrderPostsFolderContent");var c=f.getListOrderPost(!0),d={},e="",g="";a.each(c,function(a,b){g=b[0],e=b[1],g!=e&&(d[e-1]=g)}),c="",a.each(d,function(a,b){c+=a+"-"+b+","}),c=c.substr(0,c.length-1);var h=b.call([{methodname:"mod_openstudio_external_order_posts",args:{cmid:f.mconfig.cmid,folderid:f.mconfig.folderid,listorderporst:c}}]);h[0].done(function(){window.location.reload()}).always(function(){M.util.js_complete("openstudioOrderPostsFolderContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})},swapItems:function(b,d,e){var g=!1,h=a(f.CSS.ITEM_ORDER+'[data-order="'+d+'"]');if(e.find(f.CSS.ITEM_ORDER).hasClass("openstudio-orderpost-item-canreorder")&&(g=f.checkReorderLock(b,d)),1==g)return void c.get_string("foldercontentcannotreorder","mod_openstudio").done(function(a){f.showErrorMessage(a)});h.length>0&&(b<d?h.closest(f.CSS.ITEM_CONTAINER).after(e):h.closest(f.CSS.ITEM_CONTAINER).before(e),a(f.CSS.ITEM_CONTAINER).each(function(b){b+=1;var c=b<10?"0"+b:""+b;a(this).find(f.CSS.ITEM_ORDER).attr("data-order",b).text(c),a(this).find(f.CSS.ORDER_NUMBER_INPUT).val(b);var d=a(this).find(f.CSS.MOVE_UP_BUTTON).attr("title"),e=d.match(/([0-9-.]+)/g);if(null!==e){var g=e.length,h=e[g-1],i=d.replace(h,b-1+".");a(this).find(f.CSS.MOVE_UP_BUTTON).attr("title",i)}var j=a(this).find(f.CSS.MOVE_DOWN_BUTTON).attr("title"),k=j.match(/([0-9-.]+)/g);if(null!==k){var l=k.length,m=k[l-1],n=j.replace(m,b+1+".");a(this).find(f.CSS.MOVE_DOWN_BUTTON).attr("title",n)}}));var i=f.mconfig.listorder,j=f.getListOrderPost(),k=[];a.each(j,function(a,b){k[a]=b[0]});var l=k.join(",");f.enableSaveOrder(i,l),f.checkReorder(),f.disableContentButton(),f.disableFirstLastButton()},resize:function(){f.dialogue&&f.dialogue.get("visible")&&(Y.one("body").get("winWidth")<f.dialogue.get("responsiveWidth")?(f.dialogue.makeResponsive(),a(f.CSS.SAVE_ORDER_BUTTON).removeClass("osep-smallbutton")):(a(f.CSS.SAVE_ORDER_BUTTON).addClass("osep-smallbutton"),Y.one("body").get("winWidth")>=767?f.dialogue.set("width",640):f.dialogue.set("width",500),f.dialogue.centerDialogue()))},getListOrderPost:function(b){var c={};a(f.CSS.ITEM_CONTAINER).each(function(){var d=a(this).find(f.CSS.ITEM_ORDER);b&&d.hasClass("openstudio-orderpost-item-book")||(c[d.attr("data-order")]=d.attr("data-original-order"))});var d=[];for(var e in c)d.push([e,c[e]]);return d.sort(function(a,b){return a[1]-b[1]}),d},enableSaveOrder:function(b,c){b!=c?a(f.CSS.SAVE_ORDER_BUTTON).removeAttr("disabled"):a(f.CSS.SAVE_ORDER_BUTTON).attr("disabled","disabled")},inputPosition:function(){a(document).ready(function(){a(f.CSS.ORDER_NUMBER_INPUT).keyup(function(){f.enableSaveOrder(a(this).val().length,0);var b=a(this).val();b&&!a.isNumeric(b)?c.get_string("errormoveslotnumeric","mod_openstudio").done(function(a){f.showErrorMessage(a)}):parseInt(b)>f.mconfig.total||parseInt(b)<=0?c.get_string("errormoveslotoutofrange","mod_openstudio").done(function(a){f.showErrorMessage(a)}):f.showErrorMessage(""),a(this).val(b)})})},disableFirstLastButton:function(){a(f.CSS.MOVE_UP_BUTTON+":not(.openstudio-orderpost-item-book)").removeAttr("disabled"),a(f.CSS.MOVE_DOWN_BUTTON+":not(.openstudio-orderpost-item-book)").removeAttr("disabled"),a(f.CSS.MOVE_UP_BUTTON+":first").attr("disabled","disabled"),a(f.CSS.MOVE_DOWN_BUTTON+":last").attr("disabled","disabled")},disableContentButton:function(){a(".openstudio-orderpost-item-book").attr("disabled","disabled")},checkReorder:function(){a(f.CSS.ITEM_CONTAINER).each(function(){var b="openstudio-orderpost-item-canreorder";if(a(this).find(f.CSS.ITEM_ORDER).hasClass("openstudio-orderpost-item-canreorder")){var c=a(this).next();c.find(f.CSS.ITEM_ORDER).hasClass(b)?f.disableContentButton():f.showErrorMessage("")}})},checkReorderLock:function(b,c){var d="",e="",g="",h="openstudio-orderpost-item-canreorder";if(b>c?(d=c,e=b):(d=b,e=c),b<c)for(d+=1;d<=e;){if(g=a(f.CSS.ITEM_ORDER+'[data-order="'+d+'"]'),g.hasClass(h))return!0;d++}else for(e-=1;e>=d;){if(g=a(f.CSS.ITEM_ORDER+'[data-order="'+e+'"]'),g.hasClass(h))return!0;e--}return!1},showErrorMessage:function(b){a(".openstudio-message-error").text(b)},handleNumberInputEnter:function(a){13===a.which&&f.moveTo.call(this)},handleNumberInputBlur:function(){f.moveTo.call(this)}}});
define('mod_openstudio/osdialogue', ["jquery","core/yui"],function(a,b){var c="Open Studio dialogue",d="moodle-dialogue",e=function(){arguments[0].extraClasses=arguments[0].extraClasses||[],arguments[0].extraClasses.push("openstudio-dialogue"),e.superclass.constructor.apply(this,arguments)};return b.extend(e,M.core.dialogue,{addButton:function(b,c){var d,e=this,f='<button class="'+b.classNames+'">'+b.label+"</button>";a.each(c,function(c,g){switch(g){case"footer":d=e.footerNode;break;default:return}d.append(f);var h=d.all("."+b.classNames);"hide"==b.action&&h.on("click",e.hide.bind(e)),b.events&&a.each(b.events,function(a,b){h.on(a,function(){b.apply(e,arguments)})})})}},{NAME:c,CSS_PREFIX:d}),e});
define('mod_openstudio/peoplepage', ["jquery"],function(a){var b;return b={init:function(){b.handleGroupSwitcher()},handleGroupSwitcher:function(){a("#openstudio-people-groupid").change(function(){var b=a("#openstudio-people-sort-action-url").val(),c=a(this).val(),d=a("option:selected",this).attr("vid");window.location.href=b+"&vid="+d+"&groupid="+c})}}});
define('mod_openstudio/subscribe', ["jquery","core/yui","core/templates","core/str","core/ajax","require"],function(a,b,c,d,e,f){var g;return g={dialogue:null,mconfig:null,CSS:{SUBSCRIBESETTING:".openstudio-subscribe-button",BOUNDINGBOX:".openstudio-subscribe-dialog-container",DIALOGHEADER:".openstudio-subscription-header",SUBSCRIBEBUTTON:'button[name="subscribebutton"]'},init:function(c){g.mconfig=c,b.use("moodle-core-notification-dialogue",function(){f(["mod_openstudio/osdialogue"],function(a){g.dialogue=g.createSubscriptionDialogue(a,g.CSS.BOUNDINGBOX)})}),a(g.CSS.SUBSCRIBEBUTTON).on("click",function(){g.issubscribed()?g.unsubscribe():(g.dialogue.show(),g.resize())}),a(window).resize(g.resize.bind(g))},createSubscriptionDialogue:function(a,b){function e(){d.get_string("subscriptiondialogheader","mod_openstudio").done(function(a){i.set("headerContent",'<span class="'+g.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}function f(){c.render("mod_openstudio/subscribe_dialog",g.mconfig.constants).done(function(a){i.set("bodyContent",a)})}function h(){d.get_strings([{key:"subscriptiondialogcancel",component:"mod_openstudio"},{key:"subscribe",component:"mod_openstudio"}]).done(function(a){var b={name:"cancel",label:a[0],classNames:"openstudio-cancel-btn",action:"hide"};i.addButton(b,["footer"]);var c={name:"subscribe",label:a[1],classNames:"openstudio-subscript-btn",events:{click:g.subscribe.bind(g)}};i.addButton(c,["footer"])})}var i=new a({closeButton:!0,visible:!1,centered:!1,responsive:!0,focusOnPreviousTargetAfterHide:!0,extraClasses:[b.replace(".","")]});return e(),f(),h(),i},subscribe:function(){function b(){var b={openstudioid:g.mconfig.openstudioid,emailformat:a('select[name="openstudio-subscription-email-format"]').val(),frequency:a('select[name="openstudio-subscription-email-frequency"]').val(),userid:g.mconfig.userid};M.util.js_pending("openstudioSubscribe");var d=e.call([{methodname:"mod_openstudio_external_subscribe",args:b}]);d[0].done(function(a){c(a.subscriptionid)}).always(function(){M.util.js_complete("openstudioSubscribe")}).fail(function(a){window.console.error("Log request failed "+a.message)})}function c(b){d.get_string("unsubscribe","mod_openstudio").done(function(b){a(g.CSS.SUBSCRIBEBUTTON).text(b),a("#openstudio_subscribe_button").focus()}),a(g.CSS.SUBSCRIBEBUTTON).attr("subscriptionid",b)}g.dialogue.hide(),b()},unsubscribe:function(){function b(){var b={subscriptionid:a(g.CSS.SUBSCRIBEBUTTON).attr("subscriptionid"),userid:g.mconfig.userid,cmid:g.mconfig.cmid};M.util.js_pending("openstudioUnsubscribe");var d=e.call([{methodname:"mod_openstudio_external_unsubscribe",args:b}]);d[0].done(function(){c()}).always(function(){M.util.js_complete("openstudioUnsubscribe")}).fail(function(a){window.console.warn("Log request failed "+a.message)})}function c(){d.get_string("subscribetothisstudio","mod_openstudio").done(function(b){a(g.CSS.SUBSCRIBEBUTTON).text(b)}),a(g.CSS.SUBSCRIBEBUTTON).removeAttr("subscriptionid")}b()},issubscribed:function(){return a(g.CSS.SUBSCRIBEBUTTON)[0].hasAttribute("subscriptionid")},resize:function(){var c=g.dialogue.get("visible");if(b.one("body").get("winWidth")>767){var d=a(g.CSS.SUBSCRIBESETTING).offset().top+3,e=a(g.CSS.SUBSCRIBESETTING).offset().left-330;if(g.dialogue.get("boundingBox").setStyles({top:d,left:e,width:316}),"large"==g.sizing)return;g.dialogue.hide(),g.sizing="large",c&&g.dialogue.show(),g.dialogue.get("boundingBox").setStyles({top:d,left:e,width:316})}else{if("small"==g.sizing)return;g.sizing="small",g.dialogue.hide(),c&&g.dialogue.show(),a(g.CSS.BOUNDINGBOX).parent().appendTo(a("body"))}}}});
define('mod_openstudio/viewdeleted', ["jquery","core/ajax","core/str","require"],function(a,b,c,d){var e;return e={mconfig:null,CSS:{BOUNDINGCLASS:".openstudio-view-deleted-dialogue",VIEW_DELETED_BUTTON:"#id_viewdeletedpostbutton",RESTORE_BUTTON:".openstudio-restore-deleted-button"},init:function(b){e.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){d(["mod_openstudio/osdialogue"],function(a){e.dialogue=e.createDeletedPostDialogue(a)})}),a(e.CSS.VIEW_DELETED_BUTTON).on("click",function(){e.dialogue&&(e.dialogue.show(),e.resize())}),a("body").delegate(e.CSS.RESTORE_BUTTON,"click",e.restoreContent),a(window).resize(e.resize.bind(e))},createDeletedPostDialogue:function(a){function d(){c.get_string("folderdeletedposts","mod_openstudio").done(function(a){g.set("headerContent","<span>"+a+"</span>")})}function f(){M.util.js_pending("openstudioFetchDeletedContent");var a=b.call([{methodname:"mod_openstudio_external_fetch_deleted_posts_in_folder",args:{cmid:e.mconfig.cmid,folderid:e.mconfig.folderid}}]);a[0].done(function(a){g.set("bodyContent",a)}).always(function(){M.util.js_complete("openstudioFetchDeletedContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})}var g=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0,extraClasses:[e.CSS.BOUNDINGCLASS.replace(".",""),"openstudio-folder-posts-dialogue"]});return d(),f(),g},restoreContent:function(){var c=a(this).data("content-version-id");c=parseInt(c),M.util.js_pending("openstudioRestoreContent");var d=b.call([{methodname:"mod_openstudio_external_restore_content_in_folder",args:{cmid:e.mconfig.cmid,cvid:c,folderid:e.mconfig.folderid}}]);d[0].done(function(){window.location.reload()}).always(function(){M.util.js_complete("openstudioRestoreContent")}).fail(function(a){window.console.error("Log request failed "+a.message)})},resize:function(){e.dialogue&&e.dialogue.get("visible")&&(Y.one("body").get("winWidth")<e.dialogue.get("responsiveWidth")?(e.dialogue.makeResponsive(),a(e.CSS.RESTORE_BUTTON).removeClass("osep-smallbutton")):(a(e.CSS.RESTORE_BUTTON).addClass("osep-smallbutton"),Y.one("body").get("winWidth")>=1e3?e.dialogue.set("width",640):e.dialogue.set("width",500),e.dialogue.centerDialogue()))}}});
define('mod_openstudio/viewhelper', ["jquery","amd/build/isotope.pkgd.min.js"],function(a,b){var c;return c={isotope:[],mconfig:null,CSS:{SEARCHBOX:"#oustudyplan-query"},init:function(a){c.mconfig=a||{searchtext:""},c.handleFilter(),c.handleIsotope(),c.handleGroupSwitcher(),c.handleViewSizeSwitcher(),c.handleBlockSwitcher(),c.initSearchForm()},handleIsotope:function(){var d=a(".openstudio-grid");d.each(function(){c.isotope.push(new b("#"+this.id,{layoutMode:"masonry",itemSelector:".openstudio-grid-item",masonry:{columnWidth:243,gutter:20,horizontalOrder:!0}}))});var e=d.find("img").not(function(){return this.complete}),f=e.length;f?e.on("load",function(){f--,f||c.reArrangeItems()}):c.reArrangeItems()},reArrangeItems:function(){setTimeout(function(){a.each(c.isotope,function(a,b){b.layout()})},1e3)},handleGroupSwitcher:function(){a(document).on("change","#filter_groupid",function(){c.redirectURL()})},handleBlockSwitcher:function(){a(document).on("change","#filter_block_activity",function(){c.redirectURL()})},handleViewSizeSwitcher:function(){a(document).on("change","#filter_pagesize",function(){c.redirectURL()})},redirectURL:function(){var b=a("#view_sort_action_url").val(),c=a("#vid").val();b=b+"&vid="+c,a(".openstudio-filter-select-box:visible").each(function(){var c=a(this).attr("name");b=b+"&"+c+"="+a(this).val()}),window.location.href=b},handleFilter:function(){a("#openstudio_filter_types_0").on("click",function(b){var c=a(this);return c.is(":checked")?(a(".openstudio-filter-types-checkbox").prop("checked",!1),void a("#openstudio_filter_types_0").prop("checked",!0)):(b.preventDefault(),!1)}),a(".openstudio-filter-types-checkbox").on("click",function(){var b=a(this);b.is(":checked")&&"openstudio_filter_types_0"!=b.attr("id")&&a("#openstudio_filter_types_0").prop("checked",!1);var c=a('[name="ftypearray[]"]:checked').length;0==c&&a("#openstudio_filter_types_0").prop("checked",!0)}),a("#openstudio_filter_user_flags_0").on("click",function(b){var c=a(this);return c.is(":checked")?(a(".openstudio-filter-user-flags-checkbox").prop("checked",!1),void a("#openstudio_filter_user_flags_0").prop("checked",!0)):(b.preventDefault(),!1)}),a(".openstudio-filter-user-flags-checkbox").on("click",function(){var b=a(this);b.is(":checked")&&"openstudio_filter_types_0"!=b.attr("id")&&a("#openstudio_filter_user_flags_0").prop("checked",!1);var c=a('[name="fflagarray[]"]:checked').length;0==c&&a("#openstudio_filter_user_flags_0").prop("checked",!0)}),a("#reset_filter_btn").on("click",function(){a("#reset_filter").val(1),a("#filteractive").val(0),a("#openstudio-filter-form").submit()}),a(".openstudio-filter-block").on("click",function(){var b=a(this),c=a("#filter_area_activity_value").val(),d=a('[name="fblockarray[]"]:checked').length;b.is(":checked")&&a("#filter_block").val(c),0==d&&a("#filter_block").val(0)}),a("#filter_block").on("change",function(){var b=a(this).val(),c=a("#filter_area_activity_value").val();parseInt(b)==c?a("#filter_block").val(0):a(".openstudio-filter-block").prop("checked",!1)}),a(".openstudio-filter-link a").on("click",function(){var b=!a(this).hasClass("collapsed");a(a(this).data("target")).find("input, select").attr("tabindex",b?-1:0)}),a(".openstudio-filter-link a.collapsed").each(function(){a(a(this).data("target")).find("input, select").attr("tabindex",-1)})},initSearchForm:function(){a(c.CSS.SEARCHBOX).val(c.mconfig.searchtext)}}});
define('mod_openstudio/folderactivityguidance', ["jquery","core/str","core/modal_factory"],function(a,b,c){var d,e;return d={CSS:{FOLDER_ACTIVITY_GUIDANCE:"#folder_activity_guidance",ACTIVITY_GUIDANCE_BUTTON:"#id_activity_guidance"},init:function(f){d.mconfig=f,a(d.CSS.ACTIVITY_GUIDANCE_BUTTON).on("click",function(){e?e.show():b.get_string("folderactivityguidance","mod_openstudio").done(function(b){c.create({title:b,body:a(d.CSS.FOLDER_ACTIVITY_GUIDANCE).html()}).done(function(a){e=a,e.show()})})})}}});
define('mod_openstudio/scrollto', [],function(){var a;return a={scrollToEl:function(a,b){var c=document.documentElement.scrollTop||window.scrollY;void 0===c&&(c=0);var d=setInterval(function(){c+=20,window.scrollTo(0,c),c>=a.offset().top-b&&clearInterval(d)},10)}}});
define('mod_openstudio/ansi_up', ["mod_openstudio/config","ansi_up"],function(a,b){return b});
define('mod_openstudio/config', [],function(){window.requirejs.config({paths:{ansi_up:M.cfg.wwwroot+"/mod/openstudio/js/ansi_up.min","es5-shim":M.cfg.wwwroot+"/mod/openstudio/js/es5-shim.min",marked:M.cfg.wwwroot+"/mod/openstudio/js/marked.min",notebook:M.cfg.wwwroot+"/mod/openstudio/js/notebook.min",prism:M.cfg.wwwroot+"/mod/openstudio/js/prism.min"},shim:{ansi_up:{exports:"ansi_up"},"es5-shim":{exports:"es5-shim"},marked:{exports:"marked"},notebook:{deps:["marked"],exports:"notebook"},prism:{exports:"Prism"}}})});
define('mod_openstudio/es5-shim', ["mod_openstudio/config","es5-shim"],function(a,b){return b});
define('mod_openstudio/marked', ["mod_openstudio/config","marked"],function(a,b){return b});
define('mod_openstudio/notebook', ["mod_openstudio/config","notebook"],function(a,b){return b});
define('mod_openstudio/previewipynb', ["jquery","mod_openstudio/ansi_up","mod_openstudio/marked","mod_openstudio/es5-shim","mod_openstudio/notebook","mod_openstudio/prism"],function(a,b,c,d,e,f){var g;return g={init:function(){var b=this,c=!1,d=a("#openstudio-content-previewipynb");d.length>0&&g.renderView(d,b),a("#openstudio_content_view_maximize").on("click",function(){var d=a(".openstudio-modal-content-body #openstudio-content-previewipynb");d.length>0&&(c||g.renderView(d,b),c=!0)})},renderView:function(a,b){var c=b.notebook=nb.parse(JSON.parse(a.text()));a.html(c.render()),f.highlightAll(),a.show()}}});
define('mod_openstudio/prism', ["mod_openstudio/config","prism"],function(a,b){return b});
define('mod_oublog/export', ["jquery"],function(a){var b;return b={CSS:{SELECTALLPOST:'button[name="oublog-export-select-all"]',SELECTNONE:'button[name="oublog-export-select-none"]',CHECKBOXS:'.oublog-posts-table input[type="checkbox"]',EXPORTSELECTED:'button[name="oublog-export-selected"]',EXPORTTYPE:"#oublog-export-type"},mconfig:null,contentIds:[],init:function(c){b.mconfig=c,null!==sessionStorage.getItem("contentIds")&&b.mconfig.newsession!==!0&&(b.contentIds=JSON.parse(sessionStorage.getItem("contentIds"))),a(b.CSS.SELECTALLPOST).on("click",b.selectAll.bind(b)),a(b.CSS.SELECTNONE).on("click",b.selectNone.bind(b)),a(b.CSS.CHECKBOXS).on("click",b.selectPost.bind(b)),a(b.CSS.EXPORTSELECTED).on("click",b.exportSelected.bind(b)),b.initSelectedPost(),b.initButtonState()},selectAll:function(){a(b.CSS.CHECKBOXS).prop("checked",!0),a(b.CSS.SELECTALLPOST).prop("disabled",!0),a(b.CSS.SELECTALLPOST).blur(),a(b.CSS.SELECTNONE).prop("disabled",!1),a(b.CSS.EXPORTSELECTED).prop("disabled",!1),a(b.CSS.CHECKBOXS).each(function(){a(this).prop("checked")&&b.addPost(a(this).val())})},selectNone:function(){a(b.CSS.CHECKBOXS).prop("checked",!1),a(b.CSS.SELECTALLPOST).prop("disabled",!1),a(b.CSS.SELECTNONE).prop("disabled",!0),a(b.CSS.SELECTNONE).blur(),a(b.CSS.EXPORTSELECTED).prop("disabled",!0),a(b.CSS.CHECKBOXS).each(function(){a(this).prop("checked")||b.removePost(a(this).val())})},selectPost:function(a){1==a.target.checked?b.addPost(a.target.value):b.removePost(a.target.value),b.initButtonState()},initSelectedPost:function(){a(b.CSS.CHECKBOXS).each(function(){var c=b.contentIds.indexOf(a(this).val());c!==-1&&a(this).prop("checked",!0)})},exportSelected:function(){if(b.contentIds.length>0){var c=a(b.CSS.EXPORTSELECTED).data("url"),d=a(b.CSS.EXPORTTYPE).val();c=this.updateQueryStringParameter(c,"instance",String(d)),c=this.updateQueryStringParameter(c,"ca_postids",b.contentIds.join("|")),sessionStorage.removeItem("contentIds"),b.contentIds=[],window.location.href=c}},removePost:function(a){var c=b.contentIds.indexOf(a);c!==-1&&(b.contentIds.splice(c,1),sessionStorage.setItem("contentIds",JSON.stringify(b.contentIds)))},addPost:function(a){var c=b.contentIds.indexOf(a);c===-1&&(b.contentIds.push(a),sessionStorage.setItem("contentIds",JSON.stringify(b.contentIds)))},initButtonState:function(){var c=0,d=0;a(b.CSS.CHECKBOXS).each(function(){0==a(this).prop("checked")&&c++,d++}),a(b.CSS.SELECTALLPOST).prop("disabled",0==c),a(b.CSS.SELECTNONE).prop("disabled",c==d),a(b.CSS.EXPORTSELECTED).prop("disabled",0==b.contentIds.length)},updateQueryStringParameter:function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=a.indexOf("?")!==-1?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c}}});
define('mod_oucontent/browser_compatibility', [],function(){String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.substr(b,a.length)===a});var a={};return a});
define('mod_oucontent/confirm', ["jquery","theme_osep/animations"],function(a,b){var c={fader:null,ask:function(d,e,f,g){void 0===g&&(g={}),g.positiveAction=f,g.negativeButton||(g.negativeButton=M.util.get_string("cancel","moodle")),M.util.js_pending("oucontent-confirm"),c.fader=a('<div id="oucontent-editfader"></div>'),c.fader.appendTo(document.body);var h=function(a){M.util.js_pending("oucontent-confirm");var b=a?"positive":"negative",d=b+"ActionImmediate";g[d]&&g[d]();var e=function(){var a=b+"Action";g[a]&&g[a]()};g[b+"StayFaded"]?e():c.removeFader(function(){e()})},i=a('<div id="oucontent-confirmbox"><p></p><div><button/><button/></div></div>');i.find("p").append(d);var j=i.find("button:first-child");j.append(e),j.on("click",function(){h(!0)});var k=i.find("button:last-child");k.append(g.negativeButton),k.on("click",function(){h(!1)}),c.fader.append(i),b.fadeIn(c.fader,b.DEFAULT_TIME,{after:function(){M.util.js_complete("oucontent-confirm")}})},removeFader:function(a){if(!c.fader)throw"Coding problem: no current fader";b.fadeOut(this.fader,b.DEFAULT_TIME,{after:function(){c.fader.remove(),c.fader=null,a&&a(),M.util.js_complete("oucontent-confirm")}})}};return c});
define('mod_oucontent/copypaste', ["jquery","mod_oucontent/editchunks","mod_oucontent/svg","theme_osep/autoscroll","mod_oucontent/dragchunks"],function(a,b,c,d,e){var f={STATE_STARTING:"maybedragging",STATE_DRAGGING:"dragging",STATE_OFF:"off",DRAG_THRESHOLD_SQUARED:100,state:null,startOffset:null,rangeStart:null,rangeEnd:null,rangeChunks:new Map,skipClickTime:0,init:function(){f.state=f.STATE_OFF;var b=a(".oucontent-editingarea");b.css("user-select","none"),b.on("mousedown",f.mouseDown),a(window).on("mouseup",f.mouseUp),a(window).on("mousemove",f.mouseMove),window.addEventListener("click",f.click,!0),c.loadSeveral(["edit/copy","edit/cut"],"mod_oucontent"),a(document.body).on("click","#oucontent-selectionactions button[name=copy]",f.popupCopy),a(document.body).on("click","#oucontent-selectionactions button[name=cut]",f.popupCut),a(document.body).on("click","#oucontent-selectionactions button[name=cancel]",f.popupCancel),f.getClipboard()&&e.showClipboardIcon(!0)},mouseDown:function(a){f.disableSelect()||(f.rangeStart=f.getPointPosition(a),f.startOffset=f.getPageOffset(a),f.rangeEnd=null,f.state=f.STATE_STARTING,f.updateRangeChunks(new Map))},mouseMove:function(a){if(f.state!==f.STATE_OFF){if(f.state===f.STATE_STARTING){var b=f.getDistanceSquared(f.getPageOffset(a),f.startOffset);b>f.DRAG_THRESHOLD_SQUARED&&(f.state=f.STATE_DRAGGING,d.start())}f.state===f.STATE_DRAGGING&&f.setEndPosition(f.getPointPosition(a))}},mouseUp:function(){switch(f.state){case f.STATE_OFF:return;case f.STATE_STARTING:return void(f.state=f.STATE_OFF)}f.state=f.STATE_OFF,d.stop(),f.rangeChunks.size>0&&f.showActions(),f.skipClickTime=(new Date).getTime()},getPageOffset:function(a){return{left:a.pageX,top:a.pageY}},getDistanceSquared:function(a,b){var c=a.top-b.top,d=a.left-b.left;return c*c+d*d},click:function(b){var c=(new Date).getTime()-f.skipClickTime;return f.disableSelect()?void(a("#oucontent-selectionactions").length&&c<100&&b.stopPropagation()):void(c<100?b.stopPropagation():f.updateRangeChunks(new Map))},getPointPosition:function(c){var d,e,g,h=null,i=a(".oucontent-editchunk");for(d=0;d<i.length;d++){var j=a(i[d]);switch(j.data("chunkType")){case"itemdata":continue;case"title":continue}if(e=j.offset().top,g=j.outerHeight(),c.pageY<e){h={relation:"before",chunk:j};break}if(c.pageY<e+g){h={relation:"in",chunk:j};break}}if(h||(h={relation:"after",chunk:a(i[i.length-1])}),"in"===h.relation){var k=h.chunk.data("chunkType");if(b.typeObjects[k].selectInsideChunk){if(h.caret=f.getCaretPositionFromPoint(c,h.chunk),null===h.caret)c.pageY-e<g/2?h.relation="before":h.relation="after";else if("actuallyAfter"===h.caret.node)h.caret=null,h.relation="after";else if("actuallyBefore"===h.caret.node)h.caret=null,h.relation="before";else if(h.caret.node.oucontentOriginal){var l=h.caret.node.oucontentOriginal,m=l.oucontentClones;for(d=0;d<m.length&&m[d]!==h.caret.node;d++)h.caret.offset+=m[d].nodeValue.length;h.caret.node=l}}else h.caret=null}else h.caret=null;return h},getAllTextNodes:function(a,b){for(var c=a.firstChild;null!==c;c=c.nextSibling)c.nodeType===Node.TEXT_NODE?b.push(c):c.nodeType===Node.ELEMENT_NODE&&f.getAllTextNodes(c,b)},getCaretPositionFromPoint:function(b,c){var d=b.clientX;if(d<0?d=0:d>=document.body.clientWidth&&(d=document.body.clientWidth),document.caretPositionFromPoint){var e=document.caretPositionFromPoint(d,b.clientY);return null===e?null:c[0].contains(e.offsetNode)?{node:e.offsetNode,offset:e.offset}:null}if(document.caretRangeFromPoint){var g=document.caretRangeFromPoint(d,b.clientY);return null===g?null:c[0].contains(g.startContainer)?{node:g.startContainer,offset:g.startOffset}:null}var h=document.elementFromPoint(d,b.clientY);if(null===h)return null;for(;"oucontent-selectedtext"===h.className&&"SPAN"===h.nodeName;)h=h.parentNode;var i=[];f.getAllTextNodes(h,i);var j,k,l,m,n,o=[],p=new Map;for(j=0;j<i.length;j++){l=i[j];var q=l.nodeValue;for(n=l.parentNode,k=0;k<q.length;k++)m=document.createElement("span"),m.appendChild(document.createTextNode(q[k])),o.push(m),n.insertBefore(m,l),0===k&&p.set(l,m),a(m).data("textNode",l),a(m).data("offset",k);n.removeChild(l)}var r=null;for(j=0;j<o.length;j++){var s=a(o[j]),t=s.offset();if(t.bottom=t.top+s.height(),t.right=t.left+s.width(),t.top>b.pageY&&null!==r)break;(t.left<=b.pageX||t.bottom<b.pageY||null===r)&&(r={node:s.data("textNode"),offset:s.data("offset")}),j===o.length-1&&(t.bottom<b.pageY||t.right<=b.pageX)&&(r={node:"actuallyAfter"})}for(o.length>0&&r.node===a(o[0]).data("textNode")&&0===r.offset&&(r.node="actuallyBefore"),j=0;j<i.length;j++)l=i[j],m=p.get(l),n=m.parentNode,n.insertBefore(l,m);for(j=0;j<o.length;j++)o[j].parentNode.removeChild(o[j]);return r?r:{node:h,offset:0}},disableSelect:function(){return!!a("#oucontent-editfader").length},displayPosition:function(b){if(null===b)return"null";var c=a(".oucontent-editchunk"),d=b.relation+" #"+c.index(b.chunk);return null!==b.caret&&(d+=' caret "'+b.caret.node.nodeValue+'" '+b.caret.offset),d},setEndPosition:function(b){if(null===f.rangeEnd||f.rangeEnd.relation!==b.relation||!f.rangeEnd.chunk.is(b.chunk)||!(null===f.rangeEnd.caret&&null===b.caret||null!==f.rangeEnd.caret&&null!==b.caret&&f.rangeEnd.caret.node===b.caret.node&&f.rangeEnd.caret.offset===b.caret.offset)){f.rangeEnd=b;var c,d,e,g=new Map,h=a(".oucontent-editchunk");for(e=0;e<h.length;e++)f.rangeStart.chunk.is(h[e])&&(c=e),f.rangeEnd.chunk.is(h[e])&&(d=e);var i,j,k,l;if(c<d)i=f.rangeStart,j=f.rangeEnd,k=c,l=d;else if(c===d){var m=f.rangeStart.chunk[0];if(null!==f.rangeStart.caret&&null!==f.rangeEnd.caret){var n;n=f.rangeStart.caret.node===f.rangeEnd.caret.node?f.rangeStart.caret.offset<f.rangeEnd.caret.offset:!!(f.rangeStart.caret.node.compareDocumentPosition(f.rangeEnd.caret.node)&Node.DOCUMENT_POSITION_FOLLOWING),f.rangeStart.caret.node===f.rangeEnd.caret.node&&f.rangeStart.caret.offset===f.rangeEnd.caret.offset||(n?g.set(m,{start:f.rangeStart.caret,end:f.rangeEnd.caret}):g.set(m,{start:f.rangeEnd.caret,end:f.rangeStart.caret}))}else null!==f.rangeStart.caret||null!==f.rangeEnd.caret?"before"===f.rangeStart.relation||"after"===f.rangeEnd.relation?g.set(m,{start:f.rangeStart.caret,end:f.rangeEnd.caret}):g.set(m,{start:f.rangeEnd.caret,end:f.rangeStart.caret}):f.rangeStart.relation===f.rangeEnd.relation&&"in"!==f.rangeStart.relation||g.set(m,{start:null,end:null})}else i=f.rangeEnd,j=f.rangeStart,k=d,l=c;if(i)for("after"===i.relation&&k++,"before"===j.relation&&l--,e=k;e<=l;e++){var o={start:null,end:null};e===k&&i.caret?o.start=i.caret:e===l&&j.caret&&(o.end=j.caret),g.set(h[e],o)}f.updateRangeChunks(g)}},updateRangeChunks:function(c){var d=a(".oucontent-editchunk"),e="Ranges: ";c.forEach(function(a,b){e+=d.index(b)+" [",e+=null===a.start?"start":'"'+a.start.node.nodeValue+'" ('+a.start.offset+")",e+="-",e+=null===a.end?"end":'"'+a.end.node.nodeValue+'" ('+a.end.offset+")",e+="] "}),console.log(e),f.rangeChunks.forEach(function(d,e){if(c.has(e)){var g=c.get(e),h=!1;if(null===g.start||null!==d.start&&d.start.node===g.start.node&&d.start.offset===g.start.offset?null===g.start&&null!==d.start?h=!0:null===g.end||null!==d.end&&d.end.node===g.end.node&&d.end.offset===g.end.offset?null===g.end&&null!==d.end&&(h=!0):h=!0:h=!0,h){null===d.start&&null===d.end&&a(e).removeClass("oucontent-selectedchunk");var i=a(e).data("chunkType");b.typeObjects[i].setSelection(a(e),g.start,g.end),null===g.start&&null===g.end&&a(e).addClass("oucontent-selectedchunk"),f.rangeChunks.set(e,g)}}else{if(null===d.start&&null===d.end)a(e).removeClass("oucontent-selectedchunk");else{var j=a(e).data("chunkType");b.typeObjects[j].setSelection(a(e),null,null)}f.rangeChunks["delete"](e)}}),c.forEach(function(c,d){if(!f.rangeChunks.has(d)){if(null===c.start&&null===c.end)a(d).addClass("oucontent-selectedchunk");else{var e=a(d).data("chunkType");b.typeObjects[e].setSelection(a(d),c.start,c.end)}f.rangeChunks.set(d,c)}})},setTextSelection:function(b,c,d){var e=b.children(".oucontent-originalnodes");return null===c&&null===d?void(e.length&&(b.children().remove(),b.append(e.children()))):(e.length||(e=a('<div class="oucontent-originalnodes"></div>'),e.append(b.children()),b.append(e)),b.children(":not(.oucontent-originalnodes)").remove(),b.append(e.children().clone()),f.recursiveAddCrossReferences(e.children(),b.children(":not(.oucontent-originalnodes)")),void f.recursiveHighlightBetween(b[0],c,d,!1))},recursiveAddCrossReferences:function(a,b){if(a.length!==b.length)throw new Error("Non-matching original and clones");for(var c=0;c<a.length;c++){var d=a[c],e=b[c];switch(d.nodeType){case Node.TEXT_NODE:d.oucontentClones=[e],e.oucontentOriginal=d;break;case Node.ELEMENT_NODE:f.recursiveAddCrossReferences(d.childNodes,e.childNodes)}}},recursiveHighlightBetween:function(a,b,c,d){var e={on:!1,off:!1};if(a.nodeType===Node.ELEMENT_NODE&&"oucontent-originalnodes"===a.className)return e;if(a.nodeType===Node.TEXT_NODE){var g=a.parentNode,h=document.createElement("span");h.className="oucontent-selectedtext";var i,j,k,l,m=a.nodeValue,n=[];if(d)null!==c&&c.node===a.oucontentOriginal?(l=c.offset,l>0&&(g.insertBefore(h,a),i=document.createTextNode(m.substring(0,l)),h.appendChild(i),n.push(i),l<m.length&&(j=document.createTextNode(m.substring(l)),g.insertBefore(j,a),n.push(j)),g.removeChild(a)),e.off=!0):(g.insertBefore(h,a),i=document.createTextNode(m),h.appendChild(i),n.push(i),g.removeChild(a));else if(null===b||b.node===a.oucontentOriginal){var o=b?b.offset:0;null!==c&&c.node===a.oucontentOriginal?(l=c.offset,o!=l&&(0!==o&&(i=document.createTextNode(m.substring(0,o)),g.insertBefore(i,a),n.push(i)),g.insertBefore(h,a),j=document.createTextNode(m.substring(o,l)),h.appendChild(j),n.push(j),l<m.length&&(k=document.createTextNode(m.substring(l)),g.insertBefore(k,a),n.push(k)),g.removeChild(a)),e.off=!0):(e.on=!0,0!==o&&(i=document.createTextNode(m.substring(0,o)),g.insertBefore(i,a),n.push(i)),o<m.length&&(g.insertBefore(h,a),j=document.createTextNode(m.substring(o)),h.appendChild(j),n.push(j)),g.removeChild(a))}return n.length&&(a.oucontentOriginal.oucontentClones=n,n.forEach(function(b){b.oucontentOriginal=a.oucontentOriginal}),delete a.oucontentOriginal),e}for(var p=a.firstChild;null!==p;){var q=p.nextSibling,r=f.recursiveHighlightBetween(p,b,c,d);if(r.off){e.off=!0;break}r.on&&(d=!0,e.on=!0),p=q}return e},getTextSelection:function(b,c){var d=document.createElement("div");return c?f.recursiveAddUnselected(d,b[0]):f.recursiveAddSelected(d,b[0]),a(d)},recursiveAddSelected:function(a,b){for(var c=!1,d=b.firstChild;d;d=d.nextSibling)if(d.nodeType===Node.ELEMENT_NODE&&"oucontent-originalnodes"!==d.className)if("SPAN"!==d.nodeName||"oucontent-selectedtext"!==d.className){var e=d.cloneNode(!1),g=f.recursiveAddSelected(e,d);g&&(a.appendChild(e),c=!0)}else a.appendChild(d.firstChild.cloneNode(!0)),c=!0;return c},recursiveAddUnselected:function(a,b){for(var c=!1,d=b.firstChild;d;d=d.nextSibling)if(d.nodeType!==Node.TEXT_NODE){if("oucontent-originalnodes"!==d.className&&("SPAN"!==d.nodeName||"oucontent-selectedtext"!==d.className)){var e=d.cloneNode(!1),g=f.recursiveAddUnselected(e,d);g&&(a.appendChild(e),c=!0)}}else a.appendChild(d.cloneNode(!0)),c=!0;return c},showActions:function(){var c=a('<div id="oucontent-selectionactions"><div>'+f.makeImageButton("copy","copy","direct_copy")+f.makeImageButton("cut","cut","direct_cut")+'<button name="cancel">'+M.util.get_string("cancel","moodle")+"</button></div></div>");c.appendTo(document.body),c.find("button[name=copy]").focus(),b.addFader()},makeImageButton:function(a,b,d){return'<button name="'+a+'">'+c.get("edit/"+b,"mod_oucontent")+" <span>"+M.util.get_string(d,"oucontent")+"</span></button>"},setClipboard:function(a){localStorage.setItem("oucontent-clipboard",a),localStorage.setItem("oucontent-clipboardsesskey",M.cfg.sesskey)},getClipboard:function(){var a=localStorage.getItem("oucontent-clipboard");if(null!==a){var b=localStorage.getItem("oucontent-clipboardsesskey");b!==M.cfg.sesskey&&(a=null,localStorage.removeItem("oucontent-clipboard"),localStorage.removeItem("oucontent-clipboardsesskey"))}return a},popupCopy:function(a,c){var d=f.getSelectedXml(),g=f.extractAssets(d);console.log(g),f.setClipboard(g.xml),f.popupCancel(null,!0),f.reserveAssets(g.assets,function(){c||b.removeFader(),e.showClipboardIcon(!0)})},popupCut:function(){M.util.js_pending("mod_oucontent_cut");var c=[],d=new Map,e=[],g=new Map;f.rangeChunks.forEach(function(f,h){var i=a(h).data("combinedIds");if(i||(i=[a(h).data("chunkId")]),null===f.start&&null===f.end)Array.prototype.push.apply(c,i),e.push(h);else{var j=a(h).data("chunkType"),k=b.typeObjects[j].getSelectedCutReplacement(a(h)),l=i.shift();Array.prototype.push.apply(c,i),d.set(l,k),g.set(h,k)}}),f.popupCopy(null,!0);var h=a("div.oucontent-editingarea"),i={page:h.data("pageid"),editchunkids:"",editchunkxmls:"",deletechunkids:c.join(",")};d.forEach(function(a,b){""!==i.editchunkids&&(i.editchunkids+=",",i.editchunkxmls+="<?S?>"),i.editchunkids+=b,i.editchunkxmls+=a}),b.applyChange("multi_delete_and_edit",i,function(a){f.cutAjaxSuccess(a,e,g)},b.editingAjaxError)},cutAjaxSuccess:function(c,d,e){if(!c||!c.ok)return void b.editingAjaxError();var f=null;d.length?f=d[0]:e.forEach(function(a,b){null===f&&(f=b)});var g=function(){var b=a(this).children(".oucontent-editchunk"),c=!1;return d.forEach(function(a){b.is(a)&&(c=!0)}),e.forEach(function(a,d){b.is(d)&&(c=!0)}),!c},h=a(f).closest(".oucontent-editchunk-outer"),i=h.prevAll().filter(g).first().children(".oucontent-editchunk"),j=h.nextAll().filter(g).first().children(".oucontent-editchunk");d.forEach(function(b){a(b).closest(".oucontent-editchunk-outer").remove()}),e.forEach(function(c,d){var e=a.parseXML("<page>"+c+"</page>"),f=b.editingXsl.transform(e);b.addLangStrings(f);var g=b.wrapAndCombineChunks(a(document.importNode(f,!0)).children("div")),h=a(d).closest(".oucontent-editchunk-outer");h.after(g.children()),a(d).remove()}),i.length&&b.considerRecombine(i),j.length&&b.considerRecombine(j),b.removeFader(),M.util.js_complete("mod_oucontent_cut")},popupCancel:function(c,d){d||b.removeFader(),a("#oucontent-selectionactions").remove(),f.updateRangeChunks(new Map)},getSelectedXml:function(){var c="<clipboard>";return f.rangeChunks.forEach(function(d,e){var f=a(e).data("chunkType");null===d.start&&null===d.end?a(e).find("*[data-xml]").each(function(){c+=a(this).data("xml"),"table"===f&&(c=c.replace(/(!LT!|!!)/g,""))}):c+=b.typeObjects[f].getSelectedXml(a(e))}),c+="</clipboard>"},paste:function(c){b.addFader(),M.util.js_pending("mod_oucontent_paste");var d=b.prepareToInsert(c),e=f.getClipboard(),g=/(<[^>]*x-chunkid=")([^"]+)"/g;e=e.replace(g,function(a,c){return c+b.getNextChunkId()+'"'}),e=e.replace(/(<\/?)clipboard>/g,"$1combined>"),f.pasteAssets(e,function(e){var g=a("div.oucontent-editingarea"),h={page:g.data("pageid"),xml:e,afterchunkid:c};b.applyChange("add_chunks",h,function(a){f.pasteAjaxSuccess(a,e,d)},b.editingAjaxError)})},pasteAjaxSuccess:function(c,d,e){if(!c||!c.ok)return void b.editingAjaxError();var f=a.parseXML(d.replace(/(<\/?)combined>/g,"$1page>")),g=b.editingXsl.transform(f);b.addLangStrings(g);var h=b.wrapAndCombineChunks(a(document.importNode(g,!0)).children("div")),i=h.children().last().children(".oucontent-editchunk");e.after(h.children()),b.considerRecombine(e.children(".oucontent-editchunk")),b.considerRecombine(i),b.removeFader(),M.util.js_complete("mod_oucontent_paste")},extractAssets:function(a){var b={xml:"",assets:[]},c=new RegExp('<[^<]+ x_contenthash="([0-9a-f]{40})"[^>]*>',"g");return b.xml=a.replace(c,function(a,c){return b.assets.push(c),a.replace(/ src="[^"]+"/,' src=""')}),b},reserveAssets:function(c,d){if(0===c.length)return void d();var e=new Map;c.forEach(function(a){e.set(a,!0)});var f="";e.forEach(function(a,b){""!==f&&(f+=","),f+=b});var g=a("div.oucontent-editingarea"),h={sesskey:M.cfg.sesskey,id:g.data("cmid"),assets:f,mode:"copy"};a.ajax({url:M.cfg.wwwroot+"/mod/oucontent/edit/copypasteassets.php",method:"POST",data:h,error:b.editingAjaxError,success:function(a){return a&&a.ok?void d():void b.editingAjaxError()},dataType:"json"})},pasteAssets:function(c,d){var e=new RegExp('<[^<]+ x_contenthash="([0-9a-f]{40})".*?>',"g"),f=new Map;if(c.replace(e,function(a,b){return f.set(b,!0),a}),!f.size)return void d(c);var g="";f.forEach(function(a,b){""!==g&&(g+=","),g+=b});var h=a("div.oucontent-editingarea"),i={sesskey:M.cfg.sesskey,id:h.data("cmid"),assets:g,mode:"paste"};a.ajax({url:M.cfg.wwwroot+"/mod/oucontent/edit/copypasteassets.php",method:"POST",data:i,error:b.editingAjaxError,success:function(a){return a&&a.ok?(a.files.forEach(function(a){f.set(a.contenthash,{folderhash:a.folderhash,filename:a.filename})}),c=c.replace(e,function(a,b){var c=f.get(b);if(!c)throw new Error("Unable to find contenthash "+b);return a=a.replace(/x_folderhash="[^"]*"/,'x_folderhash="'+c.folderhash+'"'),a=a.replace(/x_((image|audio|video)src|filename)="[^"]*"/,'x_filename="'+c.filename+'"')}),void d(c)):void b.editingAjaxError()},dataType:"json"})}};return f});
define('mod_oucontent/dragchunks', ["jquery","theme_osep/animations","mod_oucontent/editchunks","theme_osep/drag"],function(a,b,c,d){var e={DRAG_ACCURACY:50,selectedTarget:null,paletteMode:"upper",paletteFixedX:0,actionPaletteFixedX:0,init:function(){var b=a("#oucontent-toolpalette");b.on("mousedown","li",function(b){if(b.preventDefault(),b.stopPropagation(),a(document.body).hasClass("oucontent-pagedisabled"))return!1;var c=a(b.currentTarget).find("img"),f=a('<div id="oucontent-tooldragproxy"><img src="" alt=""/></div>');f.find("img").prop("src",c.prop("src")),f.appendTo(document.body);var g=c.offset(),h=f.find("img").offset(),i=f.offset();g.left-=h.left-i.left,g.top-=h.top-i.top,f.css(g),f.data("tool",a(b.currentTarget).data("tool")),e.addDropTargets(f),d.start(b,f,e.updateSelectedTarget,e.finishDrag)}),b.on("click","a",function(a){a.preventDefault()}),a(window).on("resize",e.resizeForPalette),a(window).on("scroll",e.scrollForPalette),setTimeout(e.scrollForPalette,0),setTimeout(e.resizeForPalette,0);var c=a(".oucontent-editingarea");c.on("mousedown","a.oucontent-chunkmove",e.startChunkDrag)},showClipboardIcon:function(b){var c=a("#oucontent-toolpalette > ul");b?c.find('li[data-tool="!clipboard"]').length||c.append(a('<li data-tool="!clipboard"><a href="#"><img class="smallicon" alt="" src="'+M.util.image_url("edit/paste","mod_oucontent")+'"/><span>'+M.util.get_string("direct_paste","oucontent")+"</span></a></li>")):c.find('li[data-tool="!clipboard"]').remove()},resizeForPalette:function(){var b=a("#region-main"),c=a("#oucontent-toolpalette"),d=a("#oucontent-actionpalette");e.paletteFixedX=b.offset().left+b.outerWidth()-c.outerWidth()-50,e.actionPaletteFixedX=b.offset().left+b.outerWidth()-d.outerWidth()-12,"fixed"===e.paletteMode&&(c.css({left:e.paletteFixedX}),d.css({left:e.actionPaletteFixedX})),e.scrollForPalette()},scrollForPalette:function(){var b=a("#region-main"),c=a("#oucontent-edit-lower"),d=a("#oucontent-toolpalette"),f=b.offset().top+b.outerHeight()-d.outerHeight(),g=c.offset().top,h=a(window).scrollTop();h>f?e.setPaletteMode("lower"):h>g?e.setPaletteMode("fixed"):e.setPaletteMode("upper")},setPaletteMode:function(b){if(e.paletteMode!==b){var c=a("#oucontent-toolpalette"),d=a("#oucontent-actionpalette");switch(e.paletteMode=b,b){case"lower":c.removeClass("oucontent-fixed"),c.addClass("oucontent-bottom"),c.css({left:""}),d.removeClass("oucontent-fixed"),d.addClass("oucontent-bottom"),d.css({left:""});break;case"fixed":c.addClass("oucontent-fixed"),c.removeClass("oucontent-bottom"),c.css({left:e.paletteFixedX}),d.addClass("oucontent-fixed"),d.removeClass("oucontent-bottom"),d.css({left:e.actionPaletteFixedX});break;case"upper":c.removeClass("oucontent-fixed"),c.removeClass("oucontent-bottom"),c.css({left:""}),d.removeClass("oucontent-fixed"),d.removeClass("oucontent-bottom"),d.css({left:""})}}},addDropTargets:function(b,c){for(var d=a(".oucontent-editingarea *[data-chunkid]"),e="editor"===b.data("tool"),f=0;f<d.length;f++){var g=a(d[f]),h=null;if(f+1<d.length&&(h=a(d[f+1])),!h||"title"!==h.closest(".oucontent-editchunk").data("chunkType")){if(e&&!c){if("editor"===g.closest(".oucontent-editchunk").data("chunkType"))continue;if(h&&"editor"===h.closest(".oucontent-editchunk").data("chunkType"))continue}if(!c||!c.is(g)&&!c.is(h)){var i=a('<div class="oucontent-tooldroptarget"></div>');i.data("chunkId",g.data("chunkid")),i.appendTo(document.body),i.css("visibility","hidden");var j=document.createElement("img");j.src=M.util.image_url("edit/add_chunk","mod_oucontent"),i.append(j);var k,l=g.offset(),m=l.top+g.outerHeight();k=h?h.offset().top-m:32;var n=Math.round(m+k/2);i.css({left:l.left,top:n-1,width:g.outerWidth()})}}}},updateSelectedTarget:function(b,c){for(var d=a(".oucontent-tooldroptarget"),f=null,g=0,h=0;h<d.length;h++){var i=a(d[h]),j=i.offset(),k=j.top+1;if(!(c>k+e.DRAG_ACCURACY)){if(c<k-e.DRAG_ACCURACY)break;if(!(b<j.left-32||b>j.left+i.outerWidth()+32)){var l=Math.abs(c-k);(!f||l<g)&&(f=i,g=l)}}}e.selectedTarget&&e.selectedTarget.css("visibility","hidden"),e.selectedTarget=f,e.selectedTarget&&e.selectedTarget.css("visibility","visible")},finishDrag:function(){if(e.selectedTarget){var b=a("#oucontent-tooldragproxy").data("tool"),d=e.selectedTarget.data("chunkId");"!clipboard"===b?require(["mod_oucontent/copypaste"],function(a){a.paste(d)}):c.addChunk(b,d)}a(".oucontent-tooldroptarget").remove()},startChunkDrag:function(b){b.preventDefault(),b.stopPropagation();var c=a(b.currentTarget).closest(".oucontent-editchunk-outer");c.addClass("oucontent-dragging");var f=c.find(".oucontent-editchunk"),g=f.data("chunkType"),h=a('<div id="oucontent-tooldragproxy"><img src="" alt=""/></div>');h.find("img").prop("src",M.util.image_url("edit/tool-"+g,"mod_oucontent")),h.appendTo(document.body),h.data("outer",c),h.data("tool",g),h.css({left:Math.round(b.pageX-h.outerWidth()/2),top:Math.round(b.pageY-h.outerHeight()/2)}),e.addDropTargets(h,f.find("> *[data-chunkid]")),d.start(b,h,e.updateSelectedTarget,e.dropChunk)},dropChunk:function(b,d,f){var g=f.data("outer");if(g.removeClass("oucontent-dragging"),e.selectedTarget){var h=a("div.oucontent-editingarea"),i={page:h.data("pageid"),moveafter:e.selectedTarget.data("chunkId")},j=f.data("outer").find(".oucontent-editchunk");j.data("chunkId")?i.chunkids=j.data("chunkId"):i.chunkids=j.data("combinedIds").join(","),M.util.js_pending("oucontent-dropchunk"),c.applyChange("move_chunks",i,function(a){e.moveAjaxSuccess(a,g,i.moveafter)},e.moveAjaxError),c.addFader()}a(".oucontent-tooldroptarget").remove()},moveAjaxSuccess:function(b,d,f){if(!b||!b.ok)return void e.moveAjaxError();var g=a("div.oucontent-editingarea"),h=g.find("div[data-chunkid="+f+"]"),i=h.closest(".oucontent-editchunk-outer");if(h.next().length){var j=a('<div class="oucontent-editchunk" tabindex="0"/>'),k=c.wrapChunk(j);i.after(k),j.append(h.nextAll()),c.updateCombinedData(j),c.updateCombinedData(i.children(".oucontent-editchunk"))}var l=d.next();l.length||(l=d.prev()),i.after(d),c.considerRecombine(d.children(".oucontent-editchunk")),c.considerRecombine(l.children(".oucontent-editchunk")),c.removeFader(),M.util.js_complete("oucontent-dropchunk")},moveAjaxError:function(){M.util.js_complete("oucontent-dropchunk"),window.alert("There was an error saving data. To proceed, reload this page and try again.")}};return e});
define('mod_oucontent/edit_audio', ["jquery","mod_oucontent/media_upload","mod_oucontent/form_utils"],function(a,b,c){var d={saveOnReturn:!0,currentAudio:null,draggingValid:!1,fileTarget:null,addControls:function(a,e){d.fileTarget=b.addControls(a,function(a){return/\.(mp3)$/.test(a.toLowerCase())},function(b){d.currentAudio=b,null===b?a.find("#oucontent-chunksave").prop("disabled",!0):(a.find("#oucontent-chunksave").prop("disabled",!1),d.updateUploadMessage())},function(a,b,c){b.src=M.cfg.wwwroot+"/mod/oucontent/pix/icons/audio.png",c()},M.util.get_string("direct_audioupload_message","oucontent"),e),a.append(c.labelledInput("caption"))},getInitialFocus:function(){return d.fileTarget},updateUploadMessage:function(){var a=document.createElement("img");a.src=M.cfg.wwwroot+"/mod/oucontent/pix/icons/audio.png",d.fileTarget.find("img:first-child").remove(),b.initImage(d.fileTarget,a),d.fileTarget.find("div.oucontent-mediamessage").html('<div class="oucontent-mediamessage-av">'+d.currentAudio.filename+"</div>"+M.util.get_string("direct_audioupload_message","oucontent"))},setControlsFromXml:function(b,e){var f="",g=a(e),h=g.find("Caption").clone();h.length&&(f=h.text()),c.setValue(b,"caption",f),d.currentAudio=null;var i=g.find("MediaContent");if("audio"==i.attr("type")){var j=a("div.oucontent-editingarea"),k={src:"",width:i.attr("x_audiowidth"),height:i.attr("x_audioheight"),filepath:i.attr("x_folderhash"),contenthash:i.attr("x_contenthash")};i.attr("x_filename")?k.filename=i.attr("x_filename"):k.filename=i.attr("x_audiosrc"),"undefined"!=typeof k.filename&&(k.src=M.cfg.wwwroot+"/mod/oucontent/edit/versionfile.php/"+j.data("versionid")+"/"+k.contenthash+"/"+k.filepath+"/"+k.filename,d.currentAudio=k,d.updateUploadMessage())}return null!==d.currentAudio},setXmlFromControls:function(b,e){var f=a(e),g=f.find("Caption"),h=f.find("MediaContent"),i=c.getValue(b,"caption");d.currentAudio&&d.currentAudio.filename&&(h.attr("src",""),h.attr("x_audiowidth",d.currentAudio.width),h.attr("x_audioheight",d.currentAudio.height),h.attr("x_filename",d.currentAudio.filename),h.attr("x_folderhash",d.currentAudio.filepath.replace(/\//g,"")),h.attr("x_contenthash",d.currentAudio.contenthash),h.removeAttr("x_audiosrc")),""===i?g.length&&g.remove():(g.length||(g=a(e.createElement("Caption")),f.find("MediaContent").append(g)),g.contents().remove(),g.append(e.createTextNode(i)))},createNewXml:function(a){return'<MediaContent x-chunkid="'+a+'" type="audio" src=""></MediaContent>'}};return d});
define('mod_oucontent/edit_audioreadernote', ["jquery","mod_oucontent/editchunks","mod_oucontent/edit_editor"],function(a,b,c){var d="AudioReaderNote",e=a.extend(!0,{},c);return e.recursiveConvertXmlToHtml=function(a){if(a.nodeType===Node.TEXT_NODE)return e.escape(a.nodeValue);if(a.nodeType===Node.ELEMENT_NODE){var b,c;switch(a.nodeName){case"b":case"i":case"u":case"sup":case"sub":b="<"+a.nodeName+">",c="</"+a.nodeName+">";break;default:b=" ",c=""}for(var d=b,f=a.firstChild;f;f=f.nextSibling)d+=e.recursiveConvertXmlToHtml(f);return d+=c}},e.recursiveConvertHtmlToXml=function(b,c){var f=c.ownerDocument;if(b.nodeType===Node.TEXT_NODE){if(!a(c).closest("*[x-chunkid]").length){var g=f.createElement(d);return c.appendChild(g),e.addChunkId(g),void e.recursiveConvertHtmlToXml(b,g)}return void c.appendChild(f.createTextNode(" "+b.nodeValue))}if(b.nodeType===Node.ELEMENT_NODE){var h=null;switch(b.nodeName){case"B":case"I":case"U":case"SUP":case"SUB":h=f.createElement(b.nodeName.toLowerCase());break;case"BR":h=f.createTextNode(" ")}h?c.appendChild(h):h=c;for(var i=b.firstChild;i;i=i.nextSibling)e.recursiveConvertHtmlToXml(i,h)}},e.setXmlFromControls=function(b,c){for(var d=c.documentElement;d.firstChild;)d.removeChild(d.firstChild);e.recursiveConvertHtmlToXml(a("#oucontent-editor-textareaeditable")[0],d),d.appendChild(d.ownerDocument.createElement("br"))},e.createNewXml=function(a){return"<"+d+' x-chunkid="'+a+'"></'+d+">"},e});
define('mod_oucontent/edit_authorcomment', ["jquery","mod_oucontent/editchunks","mod_oucontent/edit_editor"],function(a,b,c){var d="AuthorComment",e=a.extend(!0,{},c);return e.recursiveConvertXmlToHtml=function(a){if(a.nodeType===Node.TEXT_NODE)return e.escape(a.nodeValue);if(a.nodeType===Node.ELEMENT_NODE){var b,c;switch(a.nodeName){case"b":case"i":case"u":case"sup":case"sub":b="<"+a.nodeName+">",c="</"+a.nodeName+">";break;default:b=" ",c=""}for(var d=b,f=a.firstChild;f;f=f.nextSibling)d+=e.recursiveConvertXmlToHtml(f);return d+=c}},e.recursiveConvertHtmlToXml=function(b,c){var f=c.ownerDocument;if(b.nodeType===Node.TEXT_NODE){if(!a(c).closest("*[x-chunkid]").length){var g=f.createElement(d);return c.appendChild(g),e.addChunkId(g),void e.recursiveConvertHtmlToXml(b,g)}return void c.appendChild(f.createTextNode(" "+b.nodeValue))}if(b.nodeType===Node.ELEMENT_NODE){var h=null;switch(b.nodeName){case"B":case"I":case"U":case"SUP":case"SUB":h=f.createElement(b.nodeName.toLowerCase());break;case"BR":h=f.createTextNode(" ")}h?c.appendChild(h):h=c;for(var i=b.firstChild;i;i=i.nextSibling)e.recursiveConvertHtmlToXml(i,h)}},e.setXmlFromControls=function(b,c){for(var d=c.documentElement;d.firstChild;)d.removeChild(d.firstChild);e.recursiveConvertHtmlToXml(a("#oucontent-editor-textareaeditable")[0],d),d.appendChild(d.ownerDocument.createElement("br"))},e.createNewXml=function(a){return"<"+d+' x-chunkid="'+a+'"></'+d+">"},e});
define('mod_oucontent/edit_editor', ["jquery","mod_oucontent/editchunks","mod_oucontent/copypaste","mod_oucontent/xsl"],function(a,b,c,d){var e={saveOnReturn:!1,selectInsideChunk:!0,html2xmlproc:null,xml2htmlproc:null,runAfterProcessorsLoad:[],interval:null,loadEditorInterval:null,addControls:function(b){var c=a(".editor_atto");b.append(c),c.css("display","block"),e.interval=setInterval(function(){e.disableSave()},2e3),c.find(".editor_atto_content").css("height","400px")},beforeRemoveControls:function(){var b=a(".editor_atto");b.css("display","none"),clearInterval(e.interval),a(document.body).append(b)},getInitialFocus:function(a){return YUI().use("node-event-simulate",function(a){a.one("#oucontent-editor-textareaeditable").simulate("mousedown")}),a.find(".editor_atto_content")},setControlsFromXml:function(b,c){console.log(c),console.log((new XMLSerializer).serializeToString(c));var d=e.convertXmlToHtml(c);return a("#oucontent-editor-textareaeditable")[0].innerHTML=d,!0},convertXmlToHtml:function(a){var b=e.xml2htmlproc.transform(a),c=(new XMLSerializer).serializeToString(b);return c},escape:function(a){return a.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")},convertHtmlToXml:function(c,d){for(var f=a.parseXML('<combined xmlns="http://www.w3.org/1999/xhtml"></combined>'),g=c.firstChild;g;g=g.nextSibling)f.documentElement.appendChild(f.importNode(g,!0));e.html2xmlproc.setParameter("chunkid",b.getNextChunkId());for(var h=e.html2xmlproc.transform(f);h.firstChild;)d.appendChild(h.firstChild)},addChunkId:function(a){a.setAttribute("x-chunkid",b.getNextChunkId())},setXmlFromControls:function(b,c){for(var d=c.documentElement;d.firstChild;)d.removeChild(d.firstChild);e.convertHtmlToXml(a("#oucontent-editor-textareaeditable")[0],d)},createNewXml:function(a){return'<Paragraph x-chunkid="'+a+'">&#160;</Paragraph>'},setSelection:function(a,b,d){c.setTextSelection(a,b,d)},getSelectedXml:function(a){return e.convertSelectionToXml(c.getTextSelection(a))},convertSelectionToXml:function(b){b.children("div[data-chunkid]").each(function(){a(this).before(this.childNodes),a(this).remove()});var c=a.parseXML("<combined/>");e.convertHtmlToXml(b[0],c.documentElement);var d=(new XMLSerializer).serializeToString(c);return d=d.replace(/^.*?<combined>([\S\s]*)<\/combined>$/,"$1")},getSelectedCutReplacement:function(a){return e.convertSelectionToXml(c.getTextSelection(a,!0))},disableSave:function(){var b=a("#oucontent-editor-textareaeditable")[0],c=[];e.checkNestedList(b,c),c.length>0?a("#oucontent-chunksave").prop("disabled",!0):(a("#oucontent-chunksave").prop("disabled",!1),c=[])},checkNestedList:function(b,c){var d="OL OL OL, OL OL UL, OL UL OL, OL UL UL, UL OL OL, UL OL UL, UL UL OL, UL UL UL";a(b).find(d).each(function(a){c.push(a)})},requireDataLoaded:function(b){e.html2xmlproc&&e.xml2htmlproc&&null!==a("#oucontent-editor-textareaeditable")[0]?b():e.runAfterProcessorsLoad.push(b)},isEditorLoaded:function(){var b=a("#oucontent-editor-textareaeditable")[0];if(null!==b){clearInterval(e.loadEditorInterval);for(var c=0;c<e.runAfterProcessorsLoad.length;c++)e.runAfterProcessorsLoad[c]();e.runAfterProcessorsLoad=null}},waitForEditor:function(){e.loadEditorInterval=setInterval(function(){e.isEditorLoaded()},100)}},f=a(".oucontent-editingarea"),g=f.data("oucontentversion");return d.loadProcessor(g,"html2xml.xsl",function(a){e.html2xmlproc=a,e.xml2htmlproc&&e.waitForEditor()}),d.loadProcessor(g,"xml2html.xsl",function(a){e.xml2htmlproc=a,e.html2xmlproc&&e.waitForEditor()}),e});
define('mod_oucontent/edit_editorcomment', ["jquery","mod_oucontent/editchunks","mod_oucontent/edit_editor"],function(a,b,c){var d="EditorComment",e=a.extend(!0,{},c);return e.recursiveConvertXmlToHtml=function(a){if(a.nodeType===Node.TEXT_NODE)return e.escape(a.nodeValue);if(a.nodeType===Node.ELEMENT_NODE){var b,c;switch(a.nodeName){case"b":case"i":case"u":case"sup":case"sub":b="<"+a.nodeName+">",c="</"+a.nodeName+">";break;default:b=" ",c=""}for(var d=b,f=a.firstChild;f;f=f.nextSibling)d+=e.recursiveConvertXmlToHtml(f);return d+=c}},e.recursiveConvertHtmlToXml=function(b,c){var f=c.ownerDocument;if(b.nodeType===Node.TEXT_NODE){if(!a(c).closest("*[x-chunkid]").length){var g=f.createElement(d);return c.appendChild(g),e.addChunkId(g),void e.recursiveConvertHtmlToXml(b,g)}return void c.appendChild(f.createTextNode(" "+b.nodeValue))}if(b.nodeType===Node.ELEMENT_NODE){var h=null;switch(b.nodeName){case"B":case"I":case"U":case"SUP":case"SUB":h=f.createElement(b.nodeName.toLowerCase());break;case"BR":h=f.createTextNode(" ")}h?c.appendChild(h):h=c;for(var i=b.firstChild;i;i=i.nextSibling)e.recursiveConvertHtmlToXml(i,h)}},e.setXmlFromControls=function(b,c){for(var d=c.documentElement;d.firstChild;)d.removeChild(d.firstChild);e.recursiveConvertHtmlToXml(a("#oucontent-editor-textareaeditable")[0],d),d.appendChild(d.ownerDocument.createElement("br"))},e.createNewXml=function(a){return"<"+d+' x-chunkid="'+a+'"></'+d+">"},e});
define('mod_oucontent/edit_figure', ["jquery","mod_oucontent/media_upload","mod_oucontent/form_utils"],function(a,b,c){var d={saveOnReturn:!0,currentImage:null,draggingValid:!1,fileTarget:null,addControls:function(e){d.fileTarget=b.addControls(e,function(a){return/\.(jpg|png|svg)$/.test(a.toLowerCase())},function(a){d.currentImage=a,null===a?e.find("#oucontent-chunksave").prop("disabled",!0):e.find("#oucontent-chunksave").prop("disabled",!1)},function(a,b,c){var d=new FileReader;d.onload=function(a){b.src=a.target.result,c()},d.readAsDataURL(a)},M.util.get_string("direct_figureupload_message","oucontent")),e.append(c.labelledInput("alternative"));var f=a('<div class="oucontent-numberpair"></div>');e.append(f),f.append(c.labelledInput("number")),f.append(c.labelledInput("caption"))},getInitialFocus:function(){return d.fileTarget},setControlsFromXml:function(e,f){var g="",h="",i="",j=a(f),k=j.find("Caption").clone();if(k.length){var l=k.find("Number");l.length&&(h=l.text(),l.remove()),g=k.text()}var m=j.find("Alternative");m.length&&(i=m.text()),c.setValue(e,"number",h),c.setValue(e,"caption",g),c.setValue(e,"alternative",i);var n=j.find("Image");if(n.attr("x_imagewidth")){var o={width:n.attr("x_imagewidth"),height:n.attr("x_imageheight"),filepath:n.attr("x_folderhash"),contenthash:n.attr("x_contenthash")};n.attr("x_filename")?o.filename=n.attr("x_filename"):o.filename=n.attr("x_imagesrc"),d.currentImage=o;var p=a("div.oucontent-editingarea"),q=document.createElement("img");q.src=M.cfg.wwwroot+"/mod/oucontent/edit/versionfile.php/"+p.data("versionid")+"/"+o.contenthash+"/"+o.filepath+"/"+o.filename,b.initImage(d.fileTarget,q)}else d.currentImage=null;return null!==d.currentImage},setXmlFromControls:function(b,e){var f=c.getValue(b,"number"),g=c.getValue(b,"caption"),h=c.getValue(b,"alternative"),i=a(e),j=i.find("Caption > Number"),k=i.find("Caption"),l=i.find("Alternative"),m=i.find("Image");d.currentImage&&(m.attr("src",""),m.attr("x_imagewidth",d.currentImage.width),m.attr("x_imageheight",d.currentImage.height),m.attr("x_filename",d.currentImage.filename),m.attr("x_folderhash",d.currentImage.filepath.replace(/\//g,"")),m.attr("x_contenthash",d.currentImage.contenthash),m.removeAttr("x_imagesrc")),""===g&&""===f?k.length&&k.remove():(k.length||(k=a(e.createElement("Caption")),i.find("Image").after(k)),k.contents().remove(),""!==f&&(j=a(e.createElement("Number")),k.append(j),j.append(e.createTextNode(f)),k.append(e.createTextNode(" "))),k.append(e.createTextNode(g))),""===h?l.length&&l.remove():(l.length||(l=a(e.createElement("Alternative")),k?k.after(l):m.after(l)),l.contents().remove(),l.append(e.createTextNode(h)))},createNewXml:function(a){return'<Figure x-chunkid="'+a+'"><Image src="placeholder:image.jpg"/></Figure>'}};return d});
define('mod_oucontent/edit_itemdata', ["jquery","mod_oucontent/form_utils"],function(a,b){var c={saveOnReturn:!0,shortCodes:["en","cy","de","es","fr","hi","it","sw"],addControls:function(d){d.append(b.labelledInput("title",M.util.get_string("direct_label_doctitle","oucontent")));var e,f,g={en:"eng",cy:"cym",de:"deu",es:"spa",fr:"fra",hi:"hin",it:"ita",sw:"swa"},h={},i="";for(e=0;e<c.shortCodes.length;e++)f=c.shortCodes[e],h[f]=M.util.get_string(g[f],"iso6392");for(c.shortCodes.sort(function(a,b){return"en"===a?-1:"en"===b?1:h[a]<h[b]?-1:h[a]>h[b]?1:0}),e=0;e<c.shortCodes.length;e++){f=c.shortCodes[e];var j=h[f];"en"!==f&&(j+=" ("+f+")"),i+='<option value="'+f+'">'+j+"</option>"}d.append(a('<div class="oucontent-labelledinput oucontent-labelledinput-lang"><label><span>'+M.util.get_string("direct_label_lang","oucontent")+'</span><select name="lang">'+i+"</select></div>"))},getInitialFocus:function(a){return a.find("input[name=title]")},setControlsFromXml:function(b,d){for(var e=a(d).find("ItemTitle").text(),f=a(d).find("Item").attr("xml_lang"),g="",h=0;h<c.shortCodes.length;h++){var i=c.shortCodes[h];if(f&&f.toLowerCase()===i){g=i;break}}return g||(g="en"),b.find("input[name=title]").prop("value",e),b.find("select[name=lang]").prop("value",f),!0},setXmlFromControls:function(b,c){var d=b.find("input[name=title]").prop("value");a(c).find("ItemTitle").text(d);var e=b.find("select[name=lang]").prop("value");"en"===e?a(c).find("Item").removeAttr("xml_lang"):a(c).find("Item").attr("xml_lang",e)}};return c});
define('mod_oucontent/edit_title', ["jquery","mod_oucontent/form_utils"],function(a,b){var c={saveOnReturn:!0,addControls:function(c){var d=a('<div class="oucontent-numberpair"></div>');c.append(d),d.append(b.labelledInput("number")),d.append(b.labelledInput("title"))},fieldsUpdated:function(c){var d=!0,e=[],f=b.getValue(c,"number"),g=b.getValue(c,"title");if(""!==f){for(var h=a(".block.oucontent-contents .oucontent-tree-item a .oucontent-number"),i=0;i<h.length;i++){var j=b.trim(a(h[i]).text());if(String(j)===String(f)){d=!1,e.push(M.util.get_string("direct_error_duplicatenumber","oucontent"));break}}var k=a(".oucontent-edit-toolbar .oucontent-buttons a.osep-smallbutton:has(img.osep-toptoolbar-preview)");if(k){var l=k.attr("href");k.attr("href",l.replace("&section=","&sectionold="))}}""===g&&(d=!1),b.setErrors(c,e),c.find("#oucontent-chunksave").prop("disabled",!d)},getInitialFocus:function(a){return a.find("input[name=title]")},setControlsFromXml:function(c,d){var e=a(d).find("Title").clone(),f=e.find("Number"),g=f.text();f.remove();var h=b.trim(e.text());return c.find("input[name=number]").prop("value",g),c.find("input[name=title]").prop("value",h),!0},setXmlFromControls:function(c,d){var e=b.getValue(c,"number"),f=b.getValue(c,"title"),g=a(d).find("Title");if(g.text(f),e){var h=d.createElement("Number");a(h).text(e),g.prepend(h),a(h).after(" ")}}};return c});
define('mod_oucontent/edit_video', ["jquery","mod_oucontent/media_upload","mod_oucontent/form_utils"],function(a,b,c){var d={saveOnReturn:!0,currentVideo:null,draggingValid:!1,fileTarget:null,addControls:function(a,e){d.fileTarget=b.addControls(a,function(a){return/\.(mp4)$/.test(a.toLowerCase())},function(b){d.currentVideo=b,null===b?a.find("#oucontent-chunksave").prop("disabled",!0):(a.find("#oucontent-chunksave").prop("disabled",!1),d.updateUploadMessage())},function(a,b,c){b.src=M.cfg.wwwroot+"/mod/oucontent/pix/icons/video.png",c()},M.util.get_string("direct_videoupload_message","oucontent"),e),a.append(c.labelledInput("caption"))},getInitialFocus:function(){return d.fileTarget},updateUploadMessage:function(){var a=document.createElement("img");a.src=M.cfg.wwwroot+"/mod/oucontent/pix/icons/video.png",d.fileTarget.find("img:first-child").remove(),b.initImage(d.fileTarget,a),d.fileTarget.find("div.oucontent-mediamessage").html('<div class="oucontent-mediamessage-av">'+d.currentVideo.filename+"</div>"+M.util.get_string("direct_videoupload_message","oucontent"))},setControlsFromXml:function(b,e){var f="",g=a(e),h=g.find("Caption").clone();h.length&&(f=h.text()),c.setValue(b,"caption",f),d.currentVideo=null;var i=g.find("MediaContent");if("video"==i.attr("type")){var j=a("div.oucontent-editingarea"),k={src:"",width:i.attr("x_videowidth"),height:i.attr("x_videoheight"),filepath:i.attr("x_folderhash"),contenthash:i.attr("x_contenthash")};i.attr("x_filename")?k.filename=i.attr("x_filename"):k.filename=i.attr("x_videosrc"),"undefined"!=typeof k.filename&&(k.src=M.cfg.wwwroot+"/mod/oucontent/edit/versionfile.php/"+j.data("versionid")+"/"+k.contenthash+"/"+k.filepath+"/"+k.filename,d.currentVideo=k,d.updateUploadMessage())}return null!==d.currentVideo},setXmlFromControls:function(b,e){var f=a(e),g=f.find("Caption"),h=f.find("MediaContent"),i=c.getValue(b,"caption");d.currentVideo&&d.currentVideo.filename&&(h.attr("src",""),h.attr("width",d.currentVideo.width),h.attr("height",d.currentVideo.height),h.attr("x_filename",d.currentVideo.filename),h.attr("x_folderhash",d.currentVideo.filepath.replace(/\//g,"")),h.attr("x_contenthash",d.currentVideo.contenthash),h.removeAttr("x_videosrc")),""===i?g.length&&g.remove():(g.length||(g=a(e.createElement("Caption")),f.find("MediaContent").append(g)),g.contents().remove(),g.append(e.createTextNode(i)))},createNewXml:function(a){return'<MediaContent x-chunkid="'+a+'" type="video" src=""></MediaContent>'}};return d});
define('mod_oucontent/editchunks', ["jquery","theme_osep/animations","mod_oucontent/xsl","mod_oucontent/confirm","mod_oucontent/browser_compatibility"],function(a,b,c,d){var e={editingChunk:null,SUPPORTED_TYPES:["title","editor","figure","audio","video","authorcomment","editorcomment","itemdata","quote","equation","table"],typeObjects:{},chunkIdBase:"",chunkIdCount:0,editingXsl:null,maxBytes:0,autoSaveData:null,timerInterval:null,init:function(b){e.maxBytes=b;var d=a(".oucontent-editingarea"),f=d.data("oucontentversion");d.data("debugmode")&&(f=!1),M.util.js_pending("oucontent-editchunks-loading"),c.loadProcessor(f,"editchunks.xsl",function(b){e.editingXsl=b,e.editingXsl.setParameter("VERSIONFILEBASE","versionfile.php/"+d.data("versionid")+"/");var c=a.parseXML(d.data("xml")),f=e.editingXsl.transform(c),g=a.parseXML(d.data("itemxml")),h=e.editingXsl.transform(g);e.addLangStrings(f),e.addLangStrings(h),e.initChunks(document.importNode(f,!0),document.importNode(h,!0))})},isFirstPage:function(){var b=a("#osep-sidecol span.oucontent-tree-item").first().closest("li");return b.hasClass("oucontent-tree-current")},reRenderEquation:function(b){var c=a(b).find(".oucontent-edit-equation"),d=a("body").attr("class").match(/context(.*)/);if(0!==d.length&&0!==c.length){var e=d[0].split(" ")[0],f=e.split("context-")[1],g=c.data("xml"),h=c.find(".oucontent-equation-code").data("type"),i=c.find(".oucontent-equation-preview"),j={rand:"",context:parseInt(f)};"tex"===h?(j.type="tex",j.eq=a(g).find("Tex").html().replace("&gt;",">").replace("!LT!&lt;!!","<")):"mathml"===h&&(j.type="mathml",j.eq=a(g).find("MathML").html().replace("&gt;",">").replace("!LT!&lt;!!","<")),a.ajax({url:M.cfg.wwwroot+"/lib/editor/atto/plugins/oumaths/preview.php",data:j,success:function(b){var c=a("<div>"+b+"</div>"),d=c.find(".text_to_html");i.html(d.html())}})}},updateFirstPage:function(){var b=a(".oucontent-edit-itemdata").closest(".oucontent-editchunk-outer");b.css("display",e.isFirstPage()?"block":"none")},wrapAndCombineChunks:function(b){for(var c=a("<div/>"),d=0;d<b.length;d++){var f=a('<div class="oucontent-editchunk" tabindex="0"></div>'),g=a(b[d]);if(e.isCombinable(g)){for(var h=[g.data("chunkid")],i="<combined>"+g.data("xml"),j=d+1;j<b.length;j++){var k=a(b[j]);if(!e.isCombinable(k))break;h.push(k.data("chunkid")),i+=k.data("xml")}i+="</combined>",f.data("combinedIds",h),f.data("chunkType","editor"),f.data("xml",a.parseXML(i)),c.append(e.wrapChunk(f)),f.append(g);for(var l=0;l<h.length-1;l++)d++,f.append(b[d])}else{f.data("chunkId",g.data("chunkid"));var m=g.attr("class"),n=m.replace(/^oucontent-edit-/,""),o=g.data("xml");f.data("chunkType",n),"equation"==n&&(o=o.replace(/default:/g,"")),f.data("xml",a.parseXML(o)),c.append(e.wrapChunk(f)),f.append(g)}}return c},initChunks:function(c,d){var f=a(d).children("div");f=f.add(a(c).children("div"));var g=e.wrapAndCombineChunks(f),h=a(".oucontent-editingarea");h.append(g.children());var i=null,j=h.find("div.oucontent-edit-title");if(j.length){var k=j.parent();"Untitled page"===k.data("xml").documentElement.innerHTML&&(i=k)}h.find(".oucontent-editchunk").each(function(){e.reRenderEquation(this)}),e.updateFirstPage(),b.fadeIn(h,void 0,{after:function(){M.util.js_complete("oucontent-editchunks-loading")}}),h.on("mouseenter focus",".oucontent-editchunk",function(b){a(document.body).hasClass("oucontent-pagedisabled")||a(b.currentTarget).addClass("oucontent-hover")}),h.on("mouseleave blur",".oucontent-editchunk",function(b){a(b.currentTarget).removeClass("oucontent-hover")}),h.on("click",".oucontent-editchunk",function(b){var c=b.target.tagName.toLowerCase();"video"===c||"audio"===c?b.stopPropagation():e.startEditing(a(b.currentTarget),"click")}),h.on("keypress",".oucontent-editchunk",function(b){var c=b.target.tagName.toLowerCase();"video"===c||"audio"===c?b.stopPropagation():13===Number(b.which)&&e.startEditing(a(b.currentTarget),"keypress")}),h.on("click",".oucontent-chunkdelete",function(b){b.preventDefault(),e.deleteChunk(a(b.currentTarget).closest(".oucontent-editchunk-outer").children(".oucontent-editchunk"))}),h.on("click",".oucontent-chunkedit",function(b){b.preventDefault();var c=e.typeObjects.table;c.editMode=!1,e.startEditing(a(b.currentTarget).closest(".oucontent-editchunk-outer").children(".oucontent-editchunk"),"")}),h.on("keypress",".oucontent-editchunk.oucontent-editing input, .oucontent-editchunk.oucontent-editing button, .oucontent-editchunk.oucontent-editing select",function(b){13===Number(b.which)&&a("#oucontent-chunksave").data("saveOnReturn")&&(b.preventDefault(),e.saveEditing())}),h.on("input",".oucontent-editchunk.oucontent-editing input[type=text]",e.formFieldChanged);for(var l=[],m=0;m<e.SUPPORTED_TYPES.length;m++)l[m]="mod_oucontent/edit_"+e.SUPPORTED_TYPES[m];require(l,function(){for(var a=0;a<e.SUPPORTED_TYPES.length;a++)e.typeObjects[e.SUPPORTED_TYPES[a]]=arguments[a];null!==e.autoSaveData?(M.util.js_pending("oucontent-editchunks-xsl"),e.typeObjects.editor.requireDataLoaded(function(){e.startEditingAutoSave(),M.util.js_complete("oucontent-editchunks-xsl")})):i&&(M.util.js_pending("oucontent-editchunks-autostart"),setTimeout(function(){e.startEditing(i),M.util.js_complete("oucontent-editchunks-autostart")},0))})},wrapChunk:function(b,c){var d="table"===b.data("chunkType")||"table"===c?'<a href="#" class="oucontent-chunkedit"><span></span></a>':"",e=a('<div class="oucontent-editchunk-outer"></div>'),f=a('<div class="oucontent-chunkicons"><a href="#" class="oucontent-chunkmove"><span></span></a>'+d+'<a href="#" class="oucontent-chunkdelete"><span></span></a></div>');return e.append(b),"title"!==b.data("chunkType")&&"itemdata"!==b.data("chunkType")&&e.append(f),e},isCombinable:function(a){switch(a.attr("class")){case"oucontent-edit-paragraph":return!0;case"oucontent-edit-bulletedlist":return!0;case"oucontent-edit-numberedlist":return!0;default:return!1}},startEditing:function(b,c){if(!a(document.body).hasClass("oucontent-pagedisabled")&&!e.editingChunk){var d=b.closest(".oucontent-editchunk-outer").prev().children(".oucontent-editchunk"),f=[];d.find("*[data-chunkid]").each(function(b,c){f.push(a(c).data("chunkid"))}),e.editingChunk=b,e.addFader(),b.addClass("oucontent-editing"),b.children().css("display","none");var g=a('<div id="oucontent-chunkcontrols"></div>'),h=b.data("chunkType");g.addClass("oucontent-editcontrols-"+h),g.appendTo(b);var i=e.typeObjects[h];i.addControls(g,e.maxBytes,c);var j=null;j=null!==e.autoSaveData?e.autoSaveData:b.data("xml");var k=i.setControlsFromXml(g,j);"table"!==h&&(e.timerInterval=setInterval(function(){e.autoSaveChunk(f)},15e3));var l="";i.saveOnReturn&&(l=" ⏎");var m=a('<button id="oucontent-chunksave">'+M.util.get_string("direct_savechunk","oucontent")+l+"</button>");k||m.prop("disabled",!0),m.data("saveOnReturn",i.saveOnReturn);var n=a('<div class="oucontent-chunkbuttons"></div>');g.append(n),n.append(m),n.append(document.createTextNode(" "));var o=a("<button>"+M.util.get_string("cancel","moodle")+"</button>");n.append(o),"table"===h?(i.editMode=!1,o.on("click",function(){i.editMode=!1,e.cancelDocumentEditing(e.editingChunk)}),m.on("click",function(){i.editMode?e.saveEditing():(i.drawTable(j),e.timerInterval=setInterval(function(){e.autoSaveChunk(f)},15e3))})):(o.on("click",function(){e.cancelEditing()}),m.on("click",function(){e.saveEditing()}));var p=a('<span id = "oucontent-chunkAutoSaveTime"></span>');n.append(p),navigator.userAgent.toLowerCase().indexOf("firefox")==-1&&(M.util.js_pending("oucontent-editchunks-focus"),setTimeout(function(){i.getInitialFocus(g).focus(),M.util.js_complete("oucontent-editchunks-focus")},0))}},addFader:function(){M.util.js_pending("oucontent-editchunks-fadeout");var c=a('<div id="oucontent-editfader"></div>');c.appendTo(document.body),b.fadeIn(c,b.DEFAULT_TIME,{after:function(){M.util.js_complete("oucontent-editchunks-fadeout")}})},removeFader:function(){M.util.js_pending("oucontent-editchunks-fadein");var c=a("#oucontent-editfader");b.fadeOut(c,b.DEFAULT_TIME,{after:function(){c.remove(),M.util.js_complete("oucontent-editchunks-fadein")}})},cancelEditing:function(){var b=e.editingChunk,c=a("#oucontent-chunkcontrols"),f=b.data("xml"),g=(new XMLSerializer).serializeToString(f).replace(/x-chunkid="[^"]+"/g,"x-chunkid=#dummyid"),h=f.implementation.createDocument(null,null,null),i=h.importNode(f.documentElement,!0);h.appendChild(i);var j=e.typeObjects[b.data("chunkType")];j.setXmlFromControls(c,h);var k=(new XMLSerializer).serializeToString(h).replace(/x-chunkid="[^"]+"/g,"x-chunkid=#dummyid");k=k.replace(/\s\s+/g," "),g!=k?(e.setZindex(!0),d.ask(M.util.get_string("direct_canceldocumentchange_message","oucontent"),M.util.get_string("yes","oucontent"),function(){e.setZindex(!1),e.cancelDocumentEditing(b)},{negativeButton:M.util.get_string("no","oucontent"),negativeAction:function(){e.startEditing(b),e.setZindex(!1)},positiveStayFaded:!1})):(e.setZindex(!1),e.cancelDocumentEditing(b))},setZindex:function(b){var c=a("div.oucontent-editing");c&&b===!0?(c.css("z-index",1),b=!1):c.css("z-index",2)},cancelDocumentEditing:function(b){if(e.finishEditing(),b.data("newlyAdded")){var c=b.closest(".oucontent-editchunk-outer"),d=c.prev();c.remove(),d.length&&e.considerRecombine(d.children(".oucontent-editchunk"))}if(clearInterval(e.timerInterval),null!==e.autoSaveData){e.autoSaveData=null;var f=a("div.oucontent-editingarea").data("pageid"),g={page:f,xml:"",mode:"delete"};e.ajaxAutoSave(g)}var h=a("div.oucontent-editing");h&&h.css("zIndex",2)},finishEditing:function(){e.removeFader();var b=e.editingChunk,c=a("#oucontent-chunkcontrols"),d=e.typeObjects[b.data("chunkType")];d.beforeRemoveControls&&d.beforeRemoveControls(c),c.remove(),b.children().css("display","block"),b.removeClass("oucontent-editing"),b.removeClass("oucontent-hover"),e.editingChunk=null,e.reRenderEquation(b)},saveEditing:function(){M.util.js_pending("oucontent-editchunks-save"),clearInterval(e.timerInterval),e.autoSaveData=null;var b=e.editingChunk,c=e.typeObjects[b.data("chunkType")],d=a("#oucontent-chunkcontrols"),f=b.data("xml");c.setXmlFromControls(d,f);var g=(new XMLSerializer).serializeToString(f);b.addClass("oucontent-saving");var h=a("div.oucontent-editingarea"),i=!!b.data("combinedIds");if(i){var j=[];a(f).find("*[x-chunkid]").each(function(a,b){j.push(b.getAttribute("x-chunkid"))}),b.data("newCombinedIds",j)}var k,l={page:h.data("pageid"),xml:g};b.data("newlyAdded")?(k=i?"add_chunks ":"add_chunk",l.afterchunkid=b.data("newlyAdded")):"ITEMCHUNK"===b.data("chunkId")?(k="edit_item",delete l.page):b.data("chunkId")?(k="edit_chunk",l.chunkid=b.data("chunkId")):(k="edit_chunks",l.chunkids=b.data("combinedIds").join(",")),e.applyChange(k,l,function(a){e.editingAjaxSuccess(a,g)},e.editingAjaxError)},formFieldChanged:function(){var b=e.editingChunk,c=e.typeObjects[b.data("chunkType")],d=a("#oucontent-chunkcontrols");c.fieldsUpdated&&c.fieldsUpdated(d)},applyChange:function(b,c,d,e){var f=a("div.oucontent-editingarea"),g={sesskey:M.cfg.sesskey,id:f.data("cmid"),change:b,data:JSON.stringify(c)};a.ajax({url:M.cfg.wwwroot+"/mod/oucontent/edit/applychange.php",method:"POST",data:g,error:e,success:d,dataType:"json"})},editingAjaxSuccess:function(b,c){if(!b||!b.ok)return void e.editingAjaxError();var d=e.editingChunk;d.removeData("newlyAdded");var f=e.typeObjects[d.data("chunkType")];if(f.beforeRemoveControls){var g=a("#oucontent-chunkcontrols");f.beforeRemoveControls(g)}d.removeClass("oucontent-saving"),d.data("newCombinedIds")&&(d.data("combinedIds",d.data("newCombinedIds")),d.removeData("newCombinedIds")),c.startsWith("<Item")||(c="<page>"+c.replace(/<\/?combined>/g,"")+"</page>");var h=a.parseXML(c),i=e.editingXsl.transform(h);e.addLangStrings(i),d.children().remove(),a(i).children().appendTo(d),b.newindexhtml&&a("div.block.oucontent-contents > .content").prop("innerHTML",b.newindexhtml),e.finishEditing(),M.util.js_complete("oucontent-editchunks-save")},addLangStrings:function(b){a("span[data-langstring]",b).each(function(b,c){var d=a(c).data("langstring"),e=d.split("/");if(2!==e.length)throw"Invalid lang string (must have name and component): "+d;c.innerHTML=M.util.get_string(e[0],e[1]),c.removeAttribute("data-langstring")})},editingAjaxError:function(){e.editingChunk&&(e.editingChunk.removeClass("oucontent-saving"),M.util.js_complete("oucontent-editchunks-save")),window.alert("There was an error saving data. To proceed, copy any edited text into a safe location, then reload this page and try again.")},prepareToInsert:function(b){var c=a("*[data-chunkid="+b+"]");if(!c.length)throw"Unable to find required chunk";var d=c.closest(".oucontent-editchunk"),f=d.closest(".oucontent-editchunk-outer");if(d.data("combinedIds")&&c.next().length){var g=a('<div class="oucontent-editchunk" tabindex="0"></div>');g.data("chunkType","editor"),f.after(e.wrapChunk(g)),g.append(c.nextAll()),e.updateCombinedData(d),e.updateCombinedData(g)}return f},addChunk:function(b,c){var d=null;d=null!==e.autoSaveData?(new XMLSerializer).serializeToString(e.autoSaveData):e.typeObjects[b].createNewXml(e.getNextChunkId());var f=e.prepareToInsert(c),g=a('<div class="oucontent-editchunk" tabindex="0"></div>');e.wrapChunk(g,b).insertAfter(f),d="<page>"+d.replace(/<\/?combined>/g,"")+"</page>";var h=a.parseXML(d),i=e.editingXsl.transform(h);g.children().remove(),a(i).children().appendTo(g);var j=g.children();g.data("chunkType",b),"editor"===b?(g.data("combinedIds",[j.data("chunkid")]),g.data("xml",a.parseXML("<combined>"+j.data("xml")+"</combined>"))):(g.data("chunkId",j.data("chunkid")),g.data("xml",a.parseXML(j.data("xml")))),g.data("newlyAdded",c),M.util.js_pending("oucontent-editchunks-autostart"),e.typeObjects.editor.requireDataLoaded(function(){e.startEditing(g),M.util.js_complete("oucontent-editchunks-autostart")})},updateCombinedData:function(b){var c="<combined>",d=[];b.find("*[data-chunkid]").each(function(b,e){c+=a(e).data("xml"),d.push(a(e).data("chunkid"))}),c+="</combined>",b.data("xml",a.parseXML(c)),b.data("combinedIds",d),b.data("chunkType","editor")},getNextChunkId:function(){return e.chunkIdBase||(e.chunkIdBase=(new Date).getTime().toString(16)+"_"),e.chunkIdCount++,e.chunkIdBase+e.chunkIdCount},considerRecombine:function(a){if(!a.hasClass("oucontent-editchunk")||1!==a.length)throw new Error("Parameter is not a chunk div");var b=a.closest(".oucontent-editchunk-outer");if(a.data("combinedIds")){var c,d=b.prev(".oucontent-editchunk-outer").children(".oucontent-editchunk"),f=b.next(".oucontent-editchunk-outer").children(".oucontent-editchunk");d.data("combinedIds")?(c=d.data("combinedIds"),Array.prototype.push.apply(c,a.data("combinedIds")),d.data("combinedIds",c),d.append(a.children()),e.updateCombinedData(d),b.remove()):f.data("combinedIds")&&(c=f.data("combinedIds"),Array.prototype.unshift.apply(c,a.data("combinedIds")),f.data("combinedIds",c),f.prepend(a.children()),e.updateCombinedData(f),b.remove())}},deleteChunk:function(b){var c=b.closest(".oucontent-editchunk-outer");c.addClass("oucontent-deletepending"),d.ask(M.util.get_string("direct_confirm_deletechunk","oucontent"),M.util.get_string("delete","moodle"),function(){M.util.js_pending("oucontent-editchunks-delete");var c=a("div.oucontent-editingarea"),d={page:c.data("pageid")};b.data("chunkId")?d.chunkids=b.data("chunkId"):d.chunkids=b.data("combinedIds").join(","),e.applyChange("delete_chunks",d,function(){e.deletingAjaxSuccess(b)},function(){e.deletingAjaxError(b)})},{negativeActionImmediate:function(){c.removeClass("oucontent-deletepending")},positiveStayFaded:!0})},deletingAjaxSuccess:function(a){d.removeFader();var c=a.closest(".oucontent-editchunk-outer");c.removeClass("oucontent-deletepending"),b.openClose(c,!1,{after:function(){var a=c.prev(".oucontent-editchunk-outer");c.remove(),e.considerRecombine(a.children(".oucontent-editchunk")),M.util.js_complete("oucontent-editchunks-delete")}})},deletingAjaxError:function(a){d.removeFader();var b=a.closest(".oucontent-editchunk-outer");b.removeClass("oucontent-deletepending"),window.alert("There was an error saving data. To proceed, reload this page and try again.")},autoSaveChunk:function(b){var c=e.editingChunk,d=null;d=null!==e.autoSaveData?e.autoSaveData:c.data("xml");var f=(new XMLSerializer).serializeToString(d);f=f.replace(/x-chunkid="[^"]+"/g,"x-chunkid=#dummyid");var g=e.getNewXMLObj(d,c),h=(new XMLSerializer).serializeToString(g),i=h.replace(/x-chunkid="[^"]+"/g,"x-chunkid=#dummyid");if(f!==i){e.autoSaveData=g;var j,k=a("div.oucontent-editingarea").data("pageid");j=c.data("combinedIds")?c.data("combinedIds").join(","):c.data("chunkId");var l="EXISTING";c.data("newlyAdded")&&(l=c.data("chunkType"),j=b.length>0?b.join(","):b);var m=Math.round((new Date).getTime()/1e3),n="<autosave pageid = '"+k+"' time = '"+m+"' ";n+=" chunkids = '"+j+"' chunkType = '"+l+"'>",n+=h+"</autosave>";var o={page:k,xml:n,mode:"autosave"};e.ajaxAutoSave(o,e.ajaxAutoSaveSuccess)}},ajaxAutoSaveSuccess:function(a){a&&a.ok&&(document.getElementById("oucontent-chunkAutoSaveTime").innerHTML=M.util.get_string("direct_autosave_time","oucontent",e.getDate()))},ajaxAutoSave:function(b,c){var d={sesskey:M.cfg.sesskey,id:a("div.oucontent-editingarea").data("cmid"),data:JSON.stringify(b)};a.ajax({url:M.cfg.wwwroot+"/mod/oucontent/edit/autosave.php",method:"POST",data:d,success:c,dataType:"json"})},getNewXMLObj:function(b,c){var d=b.implementation.createDocument(null,null,null),f=d.importNode(b.documentElement,!0);d.appendChild(f);var g=e.typeObjects[c.data("chunkType")],h=a("#oucontent-chunkcontrols");return g.setXmlFromControls(h,d),d},getDate:function(){var a=new Date,b=a.getHours();b<10&&(b="0"+b);var c=a.getMinutes();c<10&&(c="0"+c);var d=a.getSeconds();return d<10&&(d="0"+d),b+":"+c+":"+d},loadAutoSave:function(a){e.autoSaveData=a},startEditingAutoSave:function(){var b=a.parseXML(e.autoSaveData),c=b.documentElement.getAttribute("chunkids"),d=c.split(","),f=b.documentElement.getAttribute("chunkType");if(e.autoSaveData=a.parseXML(e.autoSaveData.replace(/[<\/]+autosave[^>]*>/g,"")),"EXISTING"!=f)e.addChunk(f,d[d.length-1]);else{var g=a("*[data-chunkid="+d[d.length-1]+"]");g.length||window.alert(M.util.get_string("direct_autosave_error","oucontent"));var h=g.closest(".oucontent-editchunk");M.util.js_pending("oucontent-editchunks-autostart"),setTimeout(function(){e.startEditing(h),M.util.js_complete("oucontent-editchunks-autostart")},0)}}};return e});
define('mod_oucontent/editpages', ["jquery","theme_osep/animations","theme_osep/drag","mod_oucontent/editchunks","mod_oucontent/confirm"],function(a,b,c,d,e){var f={BEFORE_OFFSET:1,AFTER_OFFSET:1,DEPTH_OFFSETS:[0,10,30],DRAG_ACCURACY:32,selectedTarget:null,movingPage:null,init:function(){a(".block.oucontent-contents").on("mousedown","a.oucontent-moveicon",function(b){b.preventDefault();var d=a(b.currentTarget);f.movingPage=d.data("pageid");var e=a('<div id="oucontent-pagedragproxy"><img src="" alt=""/> <span></span></div>');e.data("target",d),e.find("img").prop("src",M.util.image_url("edit/move","mod_oucontent")),e.appendTo(document.body),e.find("span").prop("innerHTML",d.closest(".oucontent-tree-item").find("> *:not(.oucontent-moveicon)").prop("innerHTML"));var g=a(b.currentTarget).offset(),h=e.find("img").offset(),i=e.offset();g.left-=h.left-i.left,g.top-=h.top-i.top,e.css(g),d.css("visibility","hidden");var j=d.closest(".oucontent-tree-item"),k=j.parents(".block.oucontent-contents li").length;j.css("opacity",.3);var l=a(".block.oucontent-contents span.oucontent-tree-item");l[0]!==j[0]&&f.addDropTarget(a(l[0]),"start",1,1);for(var m=null,n=0;n<l.length;n++){var o,p=a(l[n]);if(p[0]===j[0]){var q;for(q=null!==m?m+1:1,o=1;o<=q&&o<=3;o++){var r=f.addDropTarget(p,"on",o,k);o===k&&r.data("nochange",!0)}m=k}else for(m=p.parents(".block.oucontent-contents li").length,o=1;o<=m+1&&o<=3;o++)f.addDropTarget(p,"after",o,m)}c.start(b,e,f.onMove,f.onDrop)}),a(".block.oucontent-contents").on("click","a.oucontent-deleteicon",function(b){f.deletePage(a(b.currentTarget).data("pageid"))}),a(".block.oucontent-contents").on("keypress","a.oucontent-deleteicon",function(b){13===Number(b.which)&&f.deletePage(a(b.currentTarget).data("pageid"))})},addDropTarget:function(b,c,d,e){var g,h=b.offset().top;switch(c){case"start":g=h-f.BEFORE_OFFSET;break;case"after":g=h+b.outerHeight()+f.AFTER_OFFSET;break;case"on":g=Math.round(h+b.outerHeight()/2)}var i=b.find("a.oucontent-moveicon"),j=Math.round(i.offset().left+i.outerWidth()/2);j-=f.DEPTH_OFFSETS[e-1],j+=f.DEPTH_OFFSETS[d-1];var k=a('<div class="oucontent-pagedroptarget"><img/></div>');return k.find("img").prop("src",M.util.image_url("edit/add_chunk","mod_oucontent")),k.appendTo(document.body),k.css({position:"absolute",visibility:"hidden"}),k.css({left:j-k.outerWidth()/2,top:g-k.outerHeight()/2}),k.data("targetLocation",c),k.data("targetDepth",d),k.data("targetPage",b.find("a.oucontent-moveicon").data("pageid")),k},onMove:function(b,c,d){for(var e=d.find("> img"),g=e.offset(),h=g.left+e.outerWidth()/2,i=g.top+e.outerHeight()/2,j=a(".oucontent-pagedroptarget"),k=null,l=0,m=0;m<j.length;m++){var n=a(j[m]),o=n.offset(),p=o.top+n.outerHeight()/2,q=o.left+n.outerWidth()/2,r=i-p,s=h-q,t=r*r+s*s;(!k||t<l)&&(k=n,l=t)}l>f.DRAG_ACCURACY*f.DRAG_ACCURACY&&(k=null),f.selectedTarget&&f.selectedTarget.css("visibility","hidden"),f.selectedTarget=k,f.selectedTarget&&f.selectedTarget.css("visibility","visible")},onDrop:function(b,c,e){var g,h,i,j=!0;if(f.selectedTarget&&(j=f.selectedTarget.data("nochange"),g=f.selectedTarget.data("targetLocation"),h=f.selectedTarget.data("targetDepth"),i=f.selectedTarget.data("targetPage")),a("div.oucontent-pagedroptarget").remove(),j){var k=e.data("target");return k.css("visibility","visible"),void k.closest(".oucontent-tree-item").css("opacity",1)}d.addFader();var l=a("div.oucontent-editingarea");return"on"===g?void d.applyChange("indent_page",{pageid:f.movingPage,depth:h,viewpageid:l.data("pageid")},f.moveAjaxSuccess,f.moveAjaxError):"after"===g?void d.applyChange("move_page",{pageid:f.movingPage,afterpageid:i,depth:h,viewpageid:l.data("pageid")},f.moveAjaxSuccess,f.moveAjaxError):"start"===g?void d.applyChange("move_page",{pageid:f.movingPage,afterpageid:"",depth:1,viewpageid:l.data("pageid")},f.moveAjaxSuccess,f.moveAjaxError):void 0},moveAjaxSuccess:function(b){return b&&b.newindexhtml?(a("div.block.oucontent-contents > .content").prop("innerHTML",b.newindexhtml),d.updateFirstPage(),void d.removeFader()):void f.moveAjaxError()},moveAjaxError:function(){window.alert("There was an error saving data. To proceed, reload this page and try again.")},deletePage:function(b){var c=a(".oucontent-editingarea");c.addClass("oucontent-deletepending"),e.ask(M.util.get_string("direct_confirm_deletepage","oucontent"),M.util.get_string("delete","moodle"),function(){M.util.js_pending("oucontent-editchunks-delete"),d.applyChange("delete_page",{pageid:b},function(){location.replace(M.cfg.wwwroot+"/mod/oucontent/edit/edit.php?id="+c.data("cmid"))},function(){e.removeFader(),c.removeClass("oucontent-deletepending"),window.alert("There was an error saving data. To proceed, reload this page and try again.")})},{negativeActionImmediate:function(){c.removeClass("oucontent-deletepending")},positiveStayFaded:!0})}};return f});
define('mod_oucontent/edittoolbar', ["jquery","mod_oucontent/confirm"],function(a,b){var c={revertButton:null,init:function(){c.revertButton=a(".oucontent-edit-toolbar a.osep-smallbutton.osep-toptoolbar-revertbutton"),c.revertButton.on("click",function(a){a.preventDefault(),c.revertChanges()})},revertChanges:function(){b.ask(M.util.get_string("direct_revertdocument_message","oucontent"),M.util.get_string("direct_revertdocument","oucontent"),function(){a(location).attr("href",c.revertButton.attr("href"))},{negativeActionImmediate:function(){},positiveStayFaded:!0})}};return c});
define('mod_oucontent/form_utils', ["jquery"],function(a){var b={PROGRESS_PIE_RADIUS:30,PROGRESS_PIE_SPACING:2,SVG_NS:"http://www.w3.org/2000/svg",trim:function(a){return a.replace(/^\s*(.*?)\s*$/,"$1")},getValue:function(a,c){return b.trim(a.find("[name="+c+"]").prop("value"))},setValue:function(a,c,d){a.find("[name="+c+"]").prop("value",b.trim(d))},labelledInput:function(b,c){return void 0===c&&(c=M.util.get_string("direct_label_"+b,"oucontent")),a('<div class="oucontent-labelledinput oucontent-labelledinput-'+b+'"><label><span>'+c+'</span><input name="'+b+'" type="text"/></label></div>')},labelledTextarea:function(b,c){return void 0===c&&(c=M.util.get_string("direct_label_"+b,"oucontent")),a('<div class="oucontent-labelledtextarea oucontent-labelledtextarea-'+b+'"><label><span>'+c+'</span><textarea name="'+b+'" ></textarea></label></div>')},labelledSelect:function(b,c,d){void 0===d&&(d=M.util.get_string("direct_label_"+b,"oucontent"));for(var e="",f=0;f<c.length;f++)e+='<option value="'+c[f].value+'">'+c[f].label+"</option>";return a('<div class="oucontent-labelledselect oucontent-labelledselect-'+b+'"><label><span>'+d+'</span><select name="'+b+'">'+e+"</select></label></div>")},createProgressPie:function(){var a=document.createElementNS(b.SVG_NS,"svg");a.setAttribute("width",2*b.PROGRESS_PIE_RADIUS+2*b.PROGRESS_PIE_SPACING),a.setAttribute("height",2*b.PROGRESS_PIE_RADIUS+2*b.PROGRESS_PIE_SPACING);var c=document.createElementNS(b.SVG_NS,"circle");return a.appendChild(c),c.setAttribute("r",b.PROGRESS_PIE_RADIUS),c.setAttribute("cx",b.PROGRESS_PIE_RADIUS+b.PROGRESS_PIE_SPACING),c.setAttribute("cy",b.PROGRESS_PIE_RADIUS+b.PROGRESS_PIE_SPACING),c.setAttribute("stroke","#832884"),c.setAttribute("stroke-width","2"),c.setAttribute("fill","none"),a},updateProgressPie:function(a,c){var d;if("path"===a.lastChild.nodeName){if(d=a.lastChild,0===c)return void a.removeChild(d)}else{if(0===c)return;d=document.createElementNS(b.SVG_NS,"path"),a.appendChild(d),d.setAttribute("fill","#832884"),d.setAttribute("stroke","none")}100===c&&(c=99.999);var e=b.PROGRESS_PIE_RADIUS+b.PROGRESS_PIE_SPACING,f=Math.cos(2*Math.PI/(100/c))*-b.PROGRESS_PIE_RADIUS+e,g=Math.sin(2*Math.PI/(100/c))*b.PROGRESS_PIE_RADIUS+e,h=c>50?1:0;d.setAttribute("d","M "+e+","+e+" V"+b.PROGRESS_PIE_SPACING+" A"+b.PROGRESS_PIE_RADIUS+","+b.PROGRESS_PIE_RADIUS+" 0 "+h+" 1 "+g+","+f+"z")},setErrors:function(b,c){void 0===c&&(c=[]);var d=b.find(".oucontent-errors");if(0===c.length)d.remove();else{d.length||(d=a('<ul class="oucontent-errors"/>'),b.find(".oucontent-chunkbuttons").before(d)),d.children().remove();for(var e=0;e<c.length;e++)d.append(a("<li>"+c[e]+"</li>"))}}};return b});
define('mod_oucontent/keepalive', ["jquery"],function(a){var b={CHECK_FREQUENCY:15e3,REQUEST_TIMEOUT:2e4,status:"ok",aborted:!1,pendingRequest:!1,lastCheck:0,nextCheckTime:0,unloading:!1,init:function(){b.lastCheck=(new Date).getTime(),a(document).on("visibilitychange",b.requestNextCheck),a(window).on("beforeunload",function(){b.unloading=!0}),b.requestNextCheck()},requestNextCheck:function(){if(!b.aborted&&!(document.hidden||b.nextCheckTime&&b.nextCheckTime-b.lastCheck<=b.CHECK_FREQUENCY)){var a=(new Date).getTime(),c=b.lastCheck+b.CHECK_FREQUENCY-a;c<0?b.periodicCheck():(b.nextCheckTime=a+c,setTimeout(function(){b.nextCheckTime=0,b.requestNextCheck()},c))}},periodicCheck:function(){var c=a("div.oucontent-editingarea"),d={id:c.data("cmid"),version:c.data("versionid")};a.ajax({url:M.cfg.wwwroot+"/mod/oucontent/edit/stillediting.php",method:"POST",data:d,error:b.checkError,success:b.checkSuccess,dataType:"json",timeout:b.REQUEST_TIMEOUT}),b.lastCheck=(new Date).getTime()},checkError:function(c){var d;c.status>=200?d=b.setStatus("error"):(d=b.setStatus("network"),a("#oucontent-keepalive-message a").attr("href","#")),d&&(b.aborted=!0),b.requestNextCheck()},checkSuccess:function(a){var c=b.setStatus(a.status,a);c&&(b.aborted=!0),b.requestNextCheck()},setStatus:function(a,c){return b.status!==a&&(b.status=a,b.showPopup(a,c),"network"!==a&&"ok"!==a)},showPopup:function(c,d){if(!b.unloading){if(a("#oucontent-keepalive-message").remove(),"ok"===c)return void b.hideControls(!1);var e="";switch(c){case"error":e=M.util.get_string("direct_keepalive_error","oucontent");break;case"notloggedin":e=M.util.get_string("direct_keepalive_notloggedin","oucontent");break;case"selfkicked":e=M.util.get_string("direct_keepalive_selfkicked","oucontent");break;case"kickedout":e=M.util.get_string("direct_keepalive_kickedout","oucontent","<b></b>");break;case"network":e=M.util.get_string("direct_keepalive_network","oucontent")}var f=a("div.oucontent-editingarea"),g="";g="network"===c?'<a class="osep-button" href="#">'+M.util.get_string("direct_retry","oucontent")+"</a>":'<a class="osep-button" href="versions.php?id='+f.data("cmid")+'">'+M.util.get_string("direct_versions","oucontent")+"</a>";var h=a('<div id="oucontent-keepalive-message" class="oucontent-keepalive-'+c+'" role="alert"><div><p>'+e+"</p><p>"+M.util.get_string("direct_keepalive_reassurance","oucontent")+"</p><div>"+g+"</div></div></div>");"kickedout"===c&&h.find("b").text(d.name),a(document.body).append(h),h.find("a").focus(),"network"===c&&a("#oucontent-keepalive-message a").on("click",function(c){c.preventDefault(),b.periodicCheck(),a("#oucontent-keepalive-message a").removeAttr("href")}),b.hideControls(!0)}},hideControls:function(b){var c=a(document.body);if(b){if(c.hasClass("oucontent-pagedisabled"))return;c.addClass("oucontent-pagedisabled")}else{if(!c.hasClass("oucontent-pagedisabled"))return;c.removeClass("oucontent-pagedisabled")}a("#oucontent-chunksave, .oucontent-edit-toolbar input[type=submit]").each(function(){var c=a(this);b?(c.data("oucontent-wasdisabled",c.prop("disabled")),c.prop("disabled",!0)):(c.prop("disabled",c.data("oucontent-wasdisabled")),c.removeData("oucontent-wasdisabled"))}),a(".oucontent-tree-item > a, .oucontent-edit-toolbar a").each(function(){var c=a(this);b?(c.data("oucontent-oldhref",c.attr("href")),c.removeAttr("href")):(c.attr("href",c.data("oucontent-oldhref")),c.removeData("oucontent-oldhref"))})}};return b});
define('mod_oucontent/media_upload', ["jquery","mod_oucontent/form_utils","theme_osep/animations"],function(a,b,c){var d={addControls:function(c,e,f,g,h,i){var j=a('<div class="oucontent-edit-mediauploadtarget"></div>');c.append(j),j.append(a('<div class="oucontent-mediamessage">'+h+"</div>"));var k=a('<input type="file"/>');k.css({position:"absolute",visibility:"hidden"}),c.append(k);var l=document.createElement("img");l.className="oucontent-dropicon",l.src=M.util.image_url("edit/add_chunk","mod_oucontent"),j.append(l);var m=b.createProgressPie();return j.append(m),k.on("change",function(a){d.updateFile(a.currentTarget.files,e,f,g,j,i)}),j.prop("tabIndex",0),j.on("click",function(){k.click()}),j.on("keypress",function(a){13===Number(a.which)&&k.click()}),j.on("dragover dragenter",function(a){a.stopPropagation(),a.preventDefault(),j.addClass("oucontent-draghover")}),j.on("dragleave dragend",function(a){a.stopPropagation(),a.preventDefault(),j.removeClass("oucontent-draghover")}),j.on("drop",function(a){a.stopPropagation(),a.preventDefault(),j.removeClass("oucontent-draghover"),d.updateFile(a.originalEvent.dataTransfer.files,e,f,g,j,i)}),j},initImage:function(a,b){a.prepend(b)},updateFile:function(e,f,g,h,i,j){if(i.find("img").first().remove(),g(null),1==e.length){a(".oucontent-media-upload-toolarge").remove();var k=e[0];if(j<k.size){var l=M.util.get_string("direct_upload_toolarge","oucontent"),m='<span class="oucontent-media-upload-toolarge">'+l+"</span>";return void a(".oucontent-mediamessage").prepend(m)}if(null!==k&&f(k.name)){M.util.js_pending("oucontent-media-upload"),i.addClass("oucontent-pending");var n=document.createElement("img");h(k,n,function(){i.prepend(n);var e=i.find("svg")[0];b.updateProgressPie(e,0),a(e).css("display","inline"),d.uploadFile(k,function(a){b.updateProgressPie(e,a)},function(d){b.updateProgressPie(e,100),c.fadeOut(a(e),c.DEFAULT_TIME,{after:function(){i.removeClass("oucontent-pending"),M.util.js_complete("oucontent-media-upload")}}),g(d)},function(){window.alert("An error occurred while uploading the file. Reload this page and try again."),i.removeClass("oucontent-pending"),M.util.js_complete("oucontent-media-upload")})})}}},uploadFile:function(b,c,d,e){var f=new XMLHttpRequest;f.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c(b)}},!1),f.upload.addEventListener("load",function(){c(100)}),f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){if(200!==f.status)return void e();try{var a=JSON.parse(f.responseText);d(a)}catch(b){return void e()}}},f.open("POST",M.cfg.wwwroot+"/mod/oucontent/edit/uploadasset.php");var g=new FormData,h=a("div.oucontent-editingarea");g.append("id",h.data("cmid")),g.append("sesskey",M.cfg.sesskey),g.append("asset",b),f.send(g)}};return d});
define('mod_oucontent/svg', ["jquery"],function(a){var b={svgs:{},init:function(){},load:function(c,d,e){var f=M.util.image_url(c,d);a.get(f,function(a){b.svgs[c+":"+d]=a,e&&e()},"text")},loadSeveral:function(a,c,d){var e=a.length;a.forEach(function(a){b.load(a,c,function(){e--,0===e&&d&&d()})})},get:function(a,c){var d=a+":"+c;if(void 0===b.svgs[d])throw new Error("SVG not loaded: "+d);return b.svgs[d]}};return b});
define('mod_oucontent/toggle_structure', ["jquery"],function(a){var b={animationSpeed:"fast",structureMargin:"24%",toolbarMargin:"",contentMargin:"",actionPaletteMargin:"",init:function(){a(document).ready(function(){b.toolbarMargin=a(".osep-layoutleft .osep-toptoolbar").css("margin-left"),b.contentMargin=a("#oucontent-edit-lower").css("margin-right"),b.actionPaletteMargin=a("#oucontent-actionpalette").css("right");var c,d=[],e=document.URL.split("?")[1];if(void 0!==e){e=e.split("&");for(var f=0;f<e.length;f++)c=e[f].split("="),d.push(c[1]),d[c[0]]=c[1]}d.page?b.showStructure():b.hideStructure(),a(".block.oucontent-contents").addClass("da-oucontent-tree"),a("#oucontent-actionpalette-bar").show(),a(".osep-toptoolbar-showstructure a.osep-smallbutton").on("click",function(c){c.stopPropagation(),c.preventDefault(),"0"==a(".osep-toptoolbar-showstructure").attr("data-showstructure")?b.showStructure():b.hideStructure()}),a("#oucontent-actionpalette-tools a").on("click",function(a){a.stopPropagation(),a.preventDefault(),b.hideStructure()})})},showStructure:function(){a(".osep-toptoolbar-showstructure").attr("data-showstructure",1),a(".osep-toptoolbar-showstructure input:first-child").attr("value",M.util.get_string("direct_hidestructure","oucontent")),a("#oucontent-toolpalette").hide(),a(".osep-layoutleft #osep-maincol").css("margin-left",b.structureMargin),a(".osep-layoutleft .osep-toptoolbar").css("margin-left",""),a("#oucontent-edit-lower").css("margin-right","30px"),a("#oucontent-actionpalette").css("right","-49px"),a("#block-region-side-post").show(b.animationSpeed),a("#oucontent-actionpalette-tools").removeClass("active-actionpalette"),a("#oucontent-actionpalette-tools .inactive-palette-icon").show(),a("#oucontent-actionpalette-tools .active-palette-icon").hide()},hideStructure:function(){a(".osep-toptoolbar-showstructure").attr("data-showstructure",0),a(".osep-toptoolbar-showstructure input:first-child").attr("value",M.util.get_string("direct_showstructure","oucontent")),a("#block-region-side-post").hide(),a(".osep-layoutleft #osep-maincol").css("margin-left","0px"),a(".osep-layoutleft .osep-toptoolbar").css("margin-left","-30px"),a("#oucontent-edit-lower").css("margin-right",b.contentMargin),a("#oucontent-actionpalette").css("right",b.actionPaletteMargin),a("#oucontent-toolpalette").show(b.animationSpeed),a("#oucontent-actionpalette-tools").addClass("active-actionpalette"),a("#oucontent-actionpalette-tools .inactive-palette-icon").hide(),a("#oucontent-actionpalette-tools .active-palette-icon").show()}};return b});
define('mod_oucontent/xsl', ["jquery"],function(a){var b={loadProcessor:function(b,c,d){b===!1&&(b=(new Date).getTime());var e=M.cfg.wwwroot+"/mod/oucontent/edit/xsl.php/"+b+"/"+c;a.get(e,function(b){var c,e={};if(window.XSLTProcessor)c=new XSLTProcessor,c.importStylesheet(a.parseXML(b)),e.transform=function(b){var d=c.transformToDocument(b);return d instanceof HTMLDocument?a(d.documentElement).children("body")[0]:d.documentElement},e.setParameter=function(a,b){c.setParameter(null,a,b)};else if(window.ActiveXObject||"ActiveXObject"in window){var f=new ActiveXObject("Msxml2.XSLTemplate"),g=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.3.0");g.async=!1,g.preserveWhiteSpace=!0,g.loadXML(b);var h=!1,i=g.getElementsByTagName("xsl:output");i.length&&(h="html"===i.item(0).getAttribute("method")),f.stylesheet=g,c=f.createProcessor(),e.transform=function(b){if(c.input=b,c.transform(),h){var d=document.createElement("div");return d.innerHTML=c.output.replace(/^.*?<body>(.*)<\/body>.*$/,"$1"),d}return a.parseXML(c.output).documentElement},e.setParameter=function(a,b){c.addParameter(a,b)}}else window.alert("Editing features are unavailable on this browser");d(e)},"text")}};return b});
define('mod_oucontent/edit_quote', ["jquery","mod_oucontent/editchunks","mod_oucontent/edit_editor","mod_oucontent/form_utils"],function(a,b,c,d){var e=a.extend(!0,{},c);return e.tagName="Quote",e.addControls=function(b){var c=[];c[0]={value:"Quote",label:M.util.get_string("direct_quote","oucontent")},c[1]={value:"Verse",label:M.util.get_string("direct_verse","oucontent")},b.append(d.labelledSelect("type",c)),b.append(d.labelledInput("heading"));var e=a(".editor_atto");b.append(e),e.css("display","block"),e.find(".editor_atto_content").css("height","400px");var f=M.util.get_string("direct_label_credits","oucontent");b.append(d.labelledInput("sourcereference",f,4))},e.setControlsFromXml=function(b,c){var f=a(c);e.tagName=c.documentElement.nodeName;var g=f.find(e.tagName).children(),h="";if(d.setValue(b,"type",e.tagName),0!==g.length){var i=document.implementation.createDocument("",e.tagName,null),j=a(i),k=["Heading","SourceReference"];f.find(e.tagName).children().each(function(){k.indexOf(this.nodeName)===-1?j.find(e.tagName).append(a(this).clone()):d.setValue(b,this.nodeName.toLowerCase(),a(this).text())}),h=e.convertXmlToHtml(i)}else h=e.convertXmlToHtml(c);return a("#oucontent-editor-textareaeditable")[0].innerHTML=h,!0},e.setXmlFromControls=function(b,c){var f=c.documentElement,g=f.ownerDocument,h=d.getValue(b,"type");if(f.nodeName!=h){e.tagName=h;var i=g.createElement(h);i.innerHTML=f.innerHTML;for(var j=0;j<f.attributes.length;j++){var k=f.attributes[j].name,l=f.attributes[j].value;i.setAttribute(k,l)}c.replaceChild(i,f),f=c.documentElement,g=f.ownerDocument}for(;f.firstChild;)f.removeChild(f.firstChild);var m=d.getValue(b,"heading");if(""!==m){var n=g.createElement("Heading");n.appendChild(g.createTextNode(m)),f.appendChild(n)}var o=a("#oucontent-editor-textareaeditable")[0];e.convertHtmlToXml(o,f);for(var p=0;p<f.childNodes.length;p++)f.childNodes[p].removeAttribute("x-chunkid");var q=d.getValue(b,"sourcereference","textarea");if(""!==q){var r=g.createElement("SourceReference");r.appendChild(c.createTextNode(q)),f.appendChild(r)}},e.createNewXml=function(a){return"<"+e.tagName+' x-chunkid="'+a+'"><Paragraph>&#160;</Paragraph></'+e.tagName+">"},e});
define('mod_oucontent/edit_equation', ["jquery","mod_oucontent/editchunks","mod_oucontent/edit_editor","mod_oucontent/form_utils"],function(a,b,c,d){var e=a.extend(!0,{},c);e.content=null;var f=null,g="atto_oumaths",h={MARKUPTABS:g+"_markuptabs",MARKUPS:g+"_markups",MARKUP:g+"_markup",TEX_TAB:g+"_tex_tab",MATHML_TAB:g+"_mathml_tab",INSTRUCTIONS:g+"_instructions",CODE:g+"_code",INLINE:g+"_inline",FORM:g+"_form",PREVIEW:g+"_preview",IFRAME:g+"_iframe",INSERT:g+"_insert",RAND:g+"_rand",CANCEL:g+"_cancel"},i={CODE:"."+h.CODE,CURRENTCODE:".yui3-tab-panel-selected ."+h.CODE,MARKUPTABS:"."+h.MARKUPTABS,MARKUPTABSID:"#"+h.MARKUPTABS,MARKUP:"."+h.MARKUP,INSERT:"."+h.INSERT,INLINE:"#"+h.INLINE,RAND:"."+h.RAND,CANCEL:"."+h.CANCEL,YUITAB:".yui3-tab",TEXTAB:"#"+h.IFRAME+"_tex",MATHMLTAB:"#"+h.IFRAME+"_mathml",TEXTABINDEX:0,MATHMLTABINDEX:1,TEXCODE:"#"+h.CODE+"_tex",MATHMLCODE:"#"+h.CODE+"_mathml"},j='<div><div id="{{CSS.MARKUPTABS}}" class="{{CSS.MARKUPTABS}}"><ul role="tablist">{{#tabs}}<li id="{{tabid}}" role="tab"><a href="#{{../CSS.MARKUP}}_{{name}}">{{label}}</a></li>{{/tabs}}</ul><div class="{{CSS.MARKUPS}}">{{#tabs}}<div id="{{../CSS.MARKUP}}_{{name}}" class="{{../CSS.MARKUP}}"><div class="{{../CSS.INSTRUCTIONS}}">{{instructionstring}} <a href="{{helpurl}}" target="_blank" tabindex="0">{{helpurlstring}}</a></div><form id="{{../CSS.FORM}}_{{name}}" class="atto_form" target="{{../CSS.IFRAME}}_{{name}}"  action="{{../previewurl}}" method="post"><label style="display:none" for="{{../CSS.CODE}}_{{name}}">{{get_string "codelabel" ../component}}</label><textarea id="{{../CSS.CODE}}_{{name}}" class="{{../CSS.CODE}}" name="eq" tabindex="0">{{ formdata.eq }}</textarea><fieldset><input type="hidden" name="type" value="{{name}}"/><input type="hidden" name="rand" class="{{../CSS.RAND}}"/><input type="hidden" name="context" value="{{../context}}" /><legend>{{previewstring}}</legend><div class="{{../CSS.PREVIEW}}"><div class="preview-content" src="about:blank" id="{{../CSS.IFRAME}}_{{name}}" name="{{../CSS.IFRAME}}_{{name}}" tabindex="-1"></iframe></div></fieldset></form></div>{{/tabs}}</div></div></div>';return e.throttle=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),Y.log("delaying call"),c=setTimeout(function(){a.apply(d,e)},b)}},e.addControls=function(b){var c={},k={},l=[],m=e.throttle(e.updatePreview,500);c={name:"tex",label:"Tex",instructionstring:"Enter TeX code (without $$) into the box below.",helpurl:"http://docs.moodle.org/31/en/atto/oumaths/tex",helpurlstring:"Full explanation",tabid:h.TEX_TAB,inline:!0,inlinestring:"Inline display (for use mid-sentence)",previewstring:"Preview",formdata:{eq:"",inline:!1}},k={name:"mathml",label:"MathML",instructionstring:"Paste MathML code, beginning '<math', into the box below.",helpurl:"http://docs.moodle.org/31/en/atto/oumaths/mathml",helpurlstring:"Full explanation",tabid:h.MATHML_TAB,inline:!1,previewstring:"Preview",formdata:{eq:""}},l=[c,k];var n=Y.Handlebars.compile(j),o=Y.Node.create(n({component:g,CSS:h,previewurl:M.cfg.wwwroot+"/lib/editor/atto/plugins/oumaths/preview.php",tabs:l})),p=a('<div class="oucontent-numberpair"></div>');p.append(d.labelledInput("number")),p.append(d.labelledInput("caption")),b.append(o.getHTML()),b.append(p),f=new Y.TabView({srcNode:i.MARKUPTABSID}),f.render(),f.after("selectionChange",function(a){e.allowSavingEquation(a.newVal.get("index"))}),a(i.CODE).on("change keyup paste",m)},e.allowSavingEquation=function(b){var c=a("#oucontent-chunksave");b==i.TEXTABINDEX&&!a(i.TEXCODE).val()||b==i.MATHMLTABINDEX&&!a(i.MATHMLCODE).val()?c.prop("disabled",!0):c.prop("disabled",!1)},e.updatePreview=function(){var b=a("body").attr("class").match(/context(.*)/),c=f.indexOf(f.get("selection"));if(e.allowSavingEquation(c),0!==b.length){var d=b[0].split(" ")[0],g=d.split("context-")[1],h={rand:"",context:parseInt(g)},j=null;c==i.TEXTABINDEX?(h.type="tex",h.eq=a(i.TEXCODE).val().replace("&gt;",">").replace("!LT!&lt;!!","<"),j=a(i.TEXTAB)):c==i.MATHMLTABINDEX&&(h.type="mathml",h.eq=a(i.MATHMLCODE).val().replace("&gt;",">").replace("!LT!&lt;!!","<"),j=a(i.MATHMLTAB)),j.contents().find("html").html(""),a.ajax({url:M.cfg.wwwroot+"/lib/editor/atto/plugins/oumaths/preview.php",data:h,success:function(b){var c=a("<div>"+b+"</div>"),d=c.find(".text_to_html");j.html(d.html())}})}},e.setControlsFromXml=function(b,c){var d=a(c),g=d.find("TeX");if(g.length){var h=g.text().replace("!LT!&lt;!!","&lt;");b.find(i.TEXCODE).val(h),f.selectChild(0)}var j=d.find("MathML");if(j.length){var k=a("<div>").append(j.find("math").clone()).html().replace("!LT!&lt;!!","&lt;");b.find(i.MATHMLCODE).val(k),f.selectChild(1)}var l=d.find("Number"),m=d.find("Caption");b.find('input[name="number"]').val(l.text()),b.find('input[name="caption"]').val(m.text()),e.updatePreview();var n=f.indexOf(f.get("selection"));return!(n==i.TEXTABINDEX&&!a(i.TEXCODE).val()||n==i.MATHMLTABINDEX&&!a(i.MATHMLCODE).val())},e.setXmlFromControls=function(b,c){var e=a(c),g=a(i.TEXCODE),h=a(i.MATHMLCODE),j=d.getValue(b,"number"),k=d.getValue(b,"caption"),l=e.find("Caption > Number"),m=e.find("Caption"),n=f.indexOf(f.get("selection")),o=e.find("Equation");if(e.find("TeX").remove(),e.find("MathML").remove(),n==i.TEXTABINDEX){var p=a(c.createElement("TeX"));p.append(document.createTextNode(g.val())),g.val()&&o.append(p)}else if(n==i.MATHMLTABINDEX){var q=a(c.createElement("MathML"));q.append(a(h.val())),h.val()&&o.append(q)}""===k&&""===j?m.length&&m.remove():(m.length||(m=a(c.createElement("Caption")),o.append(m)),m.contents().remove(),""!==j&&(l=a(c.createElement("Number")),m.append(l),l.append(c.createTextNode(j)),m.append(c.createTextNode(" "))),m.append(c.createTextNode(k)))},e.createNewXml=function(a){return'<Equation x-chunkid="'+a+'"></Equation>'},e});
define('mod_oucontent/edit_table', ["jquery","mod_oucontent/table_utils","mod_oucontent/xsl"],function(a,b,c){var d={CAPTION:"caption",CAPTIONPOSITION:"captionposition",HEADERS:"headers",ROWS:"rows",COLUMNS:"columns",SUBMIT:"submit",FORM:".da-table-tool.atto_form",BORDERS:"borders",BORDERSIZE:"bordersize",BORDERSIZEUNIT:"px",BORDERCOLOUR:"bordercolour",BORDERSTYLE:"borderstyle",BACKGROUNDCOLOUR:"backgroundcolour",WIDTH:"customwidth",WIDTHUNIT:"%",AVAILABLECOLORS:"availablecolors",COLOURROW:"colourrow",STYLES:"styles"},e={STYLES:".da-table-tool ."+d.STYLES,CAPTION:"."+d.CAPTION,CAPTIONPOSITION:"."+d.CAPTIONPOSITION,HEADERS:"."+d.HEADERS,ROWS:"."+d.ROWS,COLUMNS:"."+d.COLUMNS,SUBMIT:"."+d.SUBMIT,BORDERS:"."+d.BORDERS,BORDERSIZE:"."+d.BORDERSIZE,BORDERCOLOURS:"."+d.BORDERCOLOUR+' input[name="borderColour"]',SELECTEDBORDERCOLOUR:"."+d.BORDERCOLOUR+' input[name="borderColour"]:checked',BORDERSTYLE:"."+d.BORDERSTYLE,BACKGROUNDCOLOURS:"."+d.BACKGROUNDCOLOUR+' input[name="backgroundColour"]',SELECTEDBACKGROUNDCOLOUR:"."+d.BACKGROUNDCOLOUR+' input[name="backgroundColour"]:checked',FORM:".da-table-tool.atto_form",WIDTH:"."+d.WIDTH,AVAILABLECOLORS:"."+d.AVAILABLECOLORS,SAVE:"#oucontent-chunksave",CELLGRIDTEXT:".da-table-text-center",AGRIDCELL:"table.da-table-grid td a",TABLEGRID:"table.da-table-grid",ATTORFORM:".atto_form",OUCONTENTEDITING:".oucontent-editing",EDITORATTORCONTENT:".editor_atto_content",DESCRIPTIONEDITOREDITABLE:"#da-description-table-editoreditable",EDITINGAREA:".oucontent-editingarea",EDITORATTO:".oucontent-editchunk.oucontent-editing .editor_atto"},f={tagName:"Table",row:0,column:0,tableHead:"",defineHeader:"",tableStyle:"",editMode:!1,xml2htmlproc:null,_loadEditorInterval:null,_tableHtml:"",buildTablePropertiesTemplate:function(){var a='<form class="da-table-tool atto_form">'+this.buildCellGridHTML()+'<label for="table_rows" class="sameline">Number of rows<span class="required">*</span></label><input class="rows" value="'+this.row+'" id="table_rows" size="8" min="1" max="50"/><br/><label for="table_columns" class="sameline">Number of columns<span class="required">*</span></label><input class="columns" value="'+this.column+'" id="table_columns"size="8" min="1" max="20"/><br/><label for="table_caption">Table header</label><input class="caption fullwidth" id="table_caption" value="'+this.tableHead+'" /><br/><br/><label for="table_headers" class="sameline">Define headers on</label><select class="headers" id="table_headers"><option value="rows" '+("rows"===f.defineHeader?'selected="selected"':"")+'>Rows</option><option value="columns" '+("columns"===f.defineHeader?'selected="selected"':"")+'>Columns</option><option value="both" '+("both"===f.defineHeader?'selected="selected"':"")+'>Both</option></select><br/><label for="table_styles" class="sameline">Table styles</label><select class="styles" id="table_styles"><option value="normal" '+("normal"===f.tableStyle?'selected="selected"':"")+'>Normal (Default)</option><option value="wide" '+("wide"===f.tableStyle?'selected="selected"':"")+'>Wide</option><option value="type 2" '+("type 2"===f.tableStyle?'selected="selected"':"")+'>Type2</option></select><br/><div class="mdl-align"><br/></div></form>';return a},buildCellGridHTML:function(){for(var a,b,c,d,e=0,f=0,g="";e<10;){for(a=0,c="";a<10;)b='<td role="gridcell" tabindex="-1"><a id="da-tablegrid'+f+'" href="#" title="Click to confirm selection" data-da-table-x="'+e+'" data-da-table-y="'+a+'" class=""></a></td>',c+=b,f++,a++;c="<tr>"+c+"</tr>",g+=c,e++}return d='<div class="da-table-container-body da-table-stack-layout"><div id="da-table" class="da-table-container da-table-stack-layout-item"><div id="da-table-body" class="da-table-container-body"><table role="grid" class="da-table-grid da-table-grid-border" aria-readonly="true"><tbody>'+g+'</tbody></table><div class="da-table-text-center" role="presentation">'+this.row+" x "+this.column+" (Required)</div></div></div></div>"},_doActiveCellGrid:function(b,c){a(e.AGRIDCELL).removeClass("da-table-active"),a(e.AGRIDCELL).each(function(){parseInt(this.getAttribute("data-da-table-x"))<=b&&parseInt(this.getAttribute("data-da-table-y"))<=c&&a(this).addClass("da-table-active")}),a(e.CELLGRIDTEXT).text(b+1+" x "+(c+1)+" (Required)")},doCellGridBehavior:function(){var b=this;a(e.AGRIDCELL).click(function(b){b.preventDefault(),f.row=parseInt(this.getAttribute("data-da-table-x"))+1,f.column=parseInt(this.getAttribute("data-da-table-y"))+1,a(e.ROWS).val(f.row),a(e.COLUMNS).val(f.column),a(e.ROWS).trigger("change")}),a(e.TABLEGRID).mouseleave(function(){f.row&&f.column&&b._doActiveCellGrid(f.row-1,f.column-1)}),a(e.AGRIDCELL).mousemove(function(){var a=parseInt(this.getAttribute("data-da-table-x")),c=parseInt(this.getAttribute("data-da-table-y"));b._doActiveCellGrid(a,c)}),b._doActiveCellGrid(f.row-1,f.column-1)},validateTablePropertiesForm:function(){var b=this;a(e.ROWS).change(function(){var a=this.value,c=Y.one(e.COLUMNS).get("value");b.validateValues(c,a)&&(f.row=parseInt(a),f.column=parseInt(c),b._doActiveCellGrid(f.row-1,f.column-1))}),a(e.COLUMNS).change(function(){var a=this.value,c=Y.one(e.ROWS).get("value");b.validateValues(a,c)&&(f.column=parseInt(a),f.row=parseInt(c),b._doActiveCellGrid(f.row-1,f.column-1))})},validateValues:function(a,b){var c;return b=parseFloat(b),a=parseFloat(a),b>0&&b%1===0&&a>0&&a%1===0&&b<51&&a<21?(Y.one(e.SAVE).set("disabled",!1),c=!0):(Y.one(e.SAVE).set("disabled",!0),c=!1),c},updateTableProperties:function(b){var c=b.parent(),d=a(c.data("xml"));f.row=0!==d.find("tr").length?d.find("tr").length:3,f.column=d.find("tr:nth-child(1)").children().length?d.find("tr:nth-child(1)").children().length:3,f.tableHead=a.trim(d.find("TableHead").text());var e=d.find("Table"),g=d.find("tr:nth-child(1) th").length===f.column,h=d.find("tr th:nth-child(1)").length===f.row,i=h&&g;i?f.defineHeader="both":h?f.defineHeader="columns":f.defineHeader="rows",e.hasClass("wide")?f.tableStyle="wide":e.hasClass("type 2")?f.tableStyle="type 2":f.tableStyle="normal"},addControls:function(c){var d='<textarea id="da-description-table-editor" name="description_editor[text]" rows="15" cols="80" spellcheck="true" hidden="hidden" style="display: none;"></textarea>';this.updateTableProperties(c),c.append(d),b.renderTableEditor("da-description-table-editor"),c.append(this.buildTablePropertiesTemplate()),c.append(d),this.validateTablePropertiesForm(),this.doCellGridBehavior(),"click"!==arguments[2]&&"keypress"!==arguments[2]||(a(e.ATTORFORM).hide(),a(e.OUCONTENTEDITING).hide(),f.waitForEditor(c))},getInitialFocus:function(a){return a.find(e.EDITORATTORCONTENT)},setControlsFromXml:function(a,b){return f._tableHtml=f.convertXmlToHtml(b),!0},convertXmlToHtml:function(a){var b=f.xml2htmlproc.transform(a),c=(new XMLSerializer).serializeToString(b).replace(/!LT!&lt;!!/g,"&lt;");return c},cleanUpTableForXML:function(b){return b.find("*").removeAttr("id"),b.find("> strong, thead > strong, tbody > strong, tr > strong").remove(),b.find("thead").length&&(b.find("tbody").prepend(b.find("thead").html()),b.find("thead").remove()),b.find("tr > div > th").each(function(b,c){var d=a(c).parent();d.after(a(c))}),b},recursiveConvertHtmlToXml:function(a,b){var c=b.ownerDocument;if(a.nodeType===Node.TEXT_NODE)return void b.appendChild(c.createTextNode(" "+a.nodeValue));if(a.nodeType===Node.ELEMENT_NODE){var d=null;switch(a.nodeName){case"B":case"I":case"U":case"SUP":case"SUB":d=c.createElement(a.nodeName.toLowerCase());break;case"STRONG":d=c.createElement("b");break;case"EM":d=c.createElement("i");break;case"BR":d=c.createElement("br")}if(d)b.appendChild(d);else if("P"===a.nodeName){var e=c.createElement("br");b.appendChild(e)}else d=b;if("P"!==a.nodeName)for(var g=a.firstChild;g;g=g.nextSibling)f.recursiveConvertHtmlToXml(g,d);else for(var h=a.firstChild;h;h=h.nextSibling)f.recursiveConvertHtmlToXml(h,b)}},setXmlFromControls:function(b,c){var d,g,h,i=a(c),j=f.cleanUpTableForXML(a(b).find(e.DESCRIPTIONEDITOREDITABLE).find("table").first()),k=a(b).find(e.DESCRIPTIONEDITOREDITABLE).find(".oucontent-heading").first(),l=i.find("Table"),m=i.find("tbody"),n=i.find("TableHead"),o=j.find("tr");m.empty(),n.empty(),f.recursiveConvertHtmlToXml(k[0],n[0]),a.each(o,function(b,e){g=c.createElement("tr"),a.each(e.cells,function(b,e){var i=a(e),j="";if("TD"===e.nodeName)switch(d=c.createElement("td"),i.hasClass("oucontent-tableright")?d.setAttribute("class","TableRight"):i.hasClass("oucontent-tablemiddle")?d.setAttribute("class","TableCentered"):d.setAttribute("class","TableLeft"),j=0!==i.find("p").length?i.find("p").attr("align"):e.style.textAlign){case"center":d.setAttribute("class","TableCentered");break;case"right":d.setAttribute("class","TableRight");break;case"left":d.setAttribute("class","TableLeft")}else{switch(d=c.createElement("th"),h=e.getAttribute("scope"),i.hasClass("oucontent-tableright")?d.setAttribute("class","ColumnHeadRight"):i.hasClass("oucontent-tablemiddle")?d.setAttribute("class","ColumnHeadCentered"):d.setAttribute("class","ColumnHeadLeft"),j=0!==i.find("p").length?i.find("p").attr("align"):e.style.textAlign){case"center":d.setAttribute("class","ColumnHeadCentered");break;case"right":d.setAttribute("class","ColumnHeadRight");break;case"left":d.setAttribute("class","ColumnHeadLeft")}h&&d.setAttribute("scope",h)}f.recursiveConvertHtmlToXml(e,d);var k=d.firstChild;k&&"br"===k.nodeName&&d.removeChild(k),g.appendChild(d)}),m.append(g)});var p=j.data("style");p&&l.attr("class",p),k||n.text("")},createNewXml:function(a){return"<"+f.tagName+' x-chunkid="'+a+'"><TableHead></TableHead><tbody></tbody></'+f.tagName+">"},drawTable:function(c){b.drawTable(e,c),a(e.EDITORATTO).addClass("da-table-editingarea"),f.editMode=!0,f.waitForEditor()},isEditorLoaded:function(b){var c=Y.one(e.DESCRIPTIONEDITOREDITABLE);if(null!==c){clearInterval(f._loadEditorInterval),f.editMode||(a(".oucontent-editing .editor_atto").show(),a(e.OUCONTENTEDITING).show(),a(e.DESCRIPTIONEDITOREDITABLE)[0].innerHTML=f._tableHtml,a(e.EDITORATTO).addClass("da-table-editingarea"),YUI().use("node-event-simulate",function(a){a.one(e.DESCRIPTIONEDITOREDITABLE).simulate("mousedown"),b&&b.find(e.EDITORATTORCONTENT).focus()}),f.editMode=!0),f.pasteContent();var d=a("#da-description-table-editoreditable");navigator.userAgent.toLowerCase().indexOf("msie")==-1&&navigator.userAgent.toLowerCase().indexOf("trident")==-1||(d.removeAttr("contenteditable"),d.find("h2").attr("contenteditable",!0),d.find(".oucontent-table-wrapper").attr("contenteditable",!0))}},pasteContent:function(){a("#da-description-table-editoreditable table td, #da-description-table-editoreditable table th,#da-description-table-editoreditable div h2").bind("paste",function(){setTimeout(function(){"wide"==f.tableStyle?a("#da-description-table-editoreditable div").first().attr("class","oucontent-table oucontent-s-wide oucontent-s-box"):"type 2"==f.tableStyle?a("#da-description-table-editoreditable div").first().attr("class","oucontent-table oucontent-s-type2 oucontent-s-box"):a("#da-description-table-editoreditable div").first().attr("class","oucontent-table oucontent-s-normal oucontent-s-box"),a("#da-description-table-editoreditable div h2").first().attr("class","oucontent-h3 oucontent-heading oucontent-nonumber"),f.pasteContent()},500)})},waitForEditor:function(a){f._loadEditorInterval=setInterval(function(){f.isEditorLoaded(a)},100)}},g=a(e.EDITINGAREA),h=g.data("oucontentversion");return c.loadProcessor(h,"xml2html.xsl",function(a){f.xml2htmlproc=a}),f});
define('mod_oucontent/equationlabels', ["jquery"],function(a){var b={lastWidth:0,init:function(){var c=a(".filter_clientmaths_svg"),d=a("div.oucontent-equation div.oucontent-label");b.addWrapperMath(d),d=a("div.oucontent-equation div.oucontent-label"),b.restructureEquations(d),c.length>0&&b.initClientMathJax(c),b.lastWidth=window.innerWidth,a(window).on("resize",function(){var a=window.innerWidth;a!=b.lastWidth&&(b.lastWidth=a,b.restructureEquations(d))})},addWrapperMath:function(b){a.each(b,function(){var b=a(this).parent(),c=b.find(".oucontent-display-mathml");if(!c.length){var d=a(this),e=d.clone();d.remove();var f=b.html();b.html(""),c=a('<span class="oucontent-display-mathml"></span>'),c.html(f),b.append(c),b.append(e)}})},restructureEquations:function(c){a.each(c,function(){var c=a(this);b.moveLabelEquation(c)})},moveLabelEquation:function(a){if(0!=a.length){var b=a.parent(),c=b.parents("li"),d=c.is(":visible");d||c.show(),a.removeClass("oucontent-eqlabel-moved");var e=b.outerWidth(),f=b.find(".oucontent-display-mathml").outerWidth(),g=b.find(".oucontent-label .oucontent-inner").outerWidth();d||c.hide(),e<=f+g&&a.addClass("oucontent-eqlabel-moved")}},initClientMathJax:function(c){var d=setInterval(function(){"undefined"!=typeof MathJax&&(MathJax.Hub.Register.StartupHook("End",function(){c.each(function(c,d){var e=a(d).closest(".oucontent-equation"),f=e.find(".oucontent-label");b.moveLabelEquation(f)})}),clearInterval(d))},500)}};return b});
define('mod_oucontent/responsive', ["jquery"],function(a){var b={inited:!1,lastWidth:0,myPages:[],addWidthListener:function(){b.getLabelledEquations(),b.getMovedLabels(),b.inited||(b.inited=!0,b.lastWidth=b.getWidth(),a(window).on("resize",function(){var a=b.getWidth();a!=b.lastWidth&&(b.lastWidth=a,b.getLabelledEquations(),b.getMovedLabels())}))},restructureEquations:function(){a.each(b.myPages,function(){var b=this.position();if(b)if(this.hasClass("oucontent-eqlabel-moved")){var c=this.prev().width(),d=a(this).prev().find("svg").width(),e=this.data("originwidth");if(c-d-e>60){var f=this.prev();this.removeClass("oucontent-eqlabel-moved"),f.append(a(this))}}else{var g=this.offset(),h=a(this).prev().find("svg"),i=h.offset(),j=i.left,k=this.prev().find("svg").width();if(j+k>g.left){var l=a(this).parent(),m=this.find(".oucontent-inner"),n=m[0].offsetWidth;this.data("originwidth",n),this.addClass("oucontent-eqlabel-moved"),a(this).insertAfter(l)}}})},getLabelledEquations:function(){b.myPages.length=0,a("div.oucontent-equation").each(function(c,d){var e=a(d).children("div.oucontent-label");e.length>0&&b.myPages.push(e)}),b.restructureEquations()},getMovedLabels:function(){b.myPages.length=0,a("div.oucontent-eqlabel-moved").each(function(c,d){b.myPages.push(a(d))}),b.restructureEquations()},getWidth:function(a){return void 0===a&&(a=window.innerWidth),a}};return b});
define('mod_oucontent/table_utils', ["jquery"],function(a){var b={editor:null,_updateStyleOfTableAfterEditorChanged:function(){this.editor.disableCssStyling=function(){var b=a(".editor_atto.da-table-editingarea .oucontent-heading");b.removeAttr("style"),b.parent().removeAttr("style"),b.find("p").removeAttr("style").removeAttr("align");try{document.execCommand("styleWithCSS",0,!1)}catch(c){try{document.execCommand("useCSS",0,!0)}catch(d){try{document.execCommand("styleWithCSS",!1,!1)}catch(e){}}}}},_registerEventHandle:function(){var a=this;a.editor.editor.on("keydown",function(b){var c=b.keyCode||b.which,d=!!window.chrome,e=!!document.documentMode;if((46==c||8==c)&&(d||e))for(var f=a.editor.plugins.table.get("host").getSelection(),g=f[0],h=g.getNodes(),i=0,j=!0;i<h.length;){var k=h[i];"TD"!==k.nodeName&&"TH"!==k.nodeName||(j&&(b.preventDefault(),j=!1),k.innerHTML=""),i++}},a)},renderTableEditor:function(a){var b=this;Y.use("moodle-editor_atto-editor","moodle-atto_table-button","moodle-atto_align-button",function(){b.editor=Y.M.editor_atto.Editor.init({elementid:a,content_css:"",contextid:1,autosaveEnabled:!1,language:"en",directionality:"ltr",filepickeroptions:[],plugins:[{group:"align",plugins:[{name:"align",params:[]}]},{group:"style1",plugins:[{name:"bold",params:[]},{name:"italic",params:[]},{name:"underline",params:[]}]},{group:"insert",plugins:[{name:"table",params:[],allowBorders:!0,allowWidth:!0,allowBackgroundColour:!0}]}]}),b._updateStyleOfTableAfterEditorChanged(),b._registerEventHandle()})},updateColumnItem:function(b,c){return a.each(b.attributes,function(){"ColumnHeadRight"===this.value||"TableRight"===this.value?c.attr("class","oucontent-tableright"):"ColumnHeadCentered"!==this.value&&"TableCentered"!==this.value||c.attr("class","oucontent-tablemiddle")}),c},drawTable:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;d=Y.one(b.CAPTION),e=Y.one(b.STYLES),f=Y.one(b.BORDERS),g=Y.one(b.BORDERSIZE),i=Y.one(b.SELECTEDBORDERCOLOUR),h=Y.one(b.BORDERSTYLE),n=Y.one(b.SELECTEDBACKGROUNDCOLOUR),j=Y.one(b.ROWS),k=Y.one(b.COLUMNS),l=Y.one(b.HEADERS),o=Y.one(b.WIDTH);var r=this.editor.plugins.table.get("host").getSelectionFromNode(Y.one(".editor_atto_content br"));this.editor.plugins.table.get("host").setSelection(r);var s="\n",t=Y.guid(),u=e.get("value"),v='<div class="oucontent-table oucontent-s-'+u.toLowerCase().replace(" ","")+' oucontent-s-box">',w='<h2 class="oucontent-h3 oucontent-heading oucontent-nonumber">'+Y.Escape.html(d.get("value"))+"</h2>";if(m="<br/>"+s+v+w+'<div class="oucontent-table-wrapper"><table id="'+t+'" data-style="'+u+'">'+s,p=0,"rows"===l.get("value")||"both"===l.get("value")){for(p=1,m+="<thead><tr>",q=0;q<parseInt(k.get("value"),10);q++)m+='<th scope="col"></th>';m+="</tr></thead>"}for(m+="<tbody>"+s;p<parseInt(j.get("value"),10);p++){for(m+="<tr>",q=0;q<parseInt(k.get("value"),10);q++)m+=0!==q||"columns"!==l.get("value")&&"both"!==l.get("value")?"<td ></td>":'<th scope="row"></th>';m+="</tr>"}m+="</tbody>"+s,m+="</table>"+s+"</div></div><br/>";for(var x=(new XMLSerializer).serializeToString(c.documentElement).replace(/!LT!&lt;!!/g,"&lt;"),y=a(a.parseXML(x)),z=a("<div>"+m+"</div>"),A=0;A<y.find("tr").length;A++){var B=a(y.find("tr")[A]);if(z.find("tr")[A])for(var C=a(z.find("tr")[A]),D=0;D<B.children().length;D++){var E=B.children()[D],F=a(E);if(C.children()[D]){var G=a(C.children()[D]);0!==F.children().length?G.html(F.children()):G.text(F.text()),G=this.updateColumnItem(E,G)}}}var H,I=Y.Node.create(z.html()),J=this.editor.plugins.table.get("host").getSelectionFromNode(Y.one(".editor_atto_content br"));J.length>0&&(H=J[0],H.deleteContents(),H.insertNode(I.getDOMNode()));var K=Y.one("#"+t);this.editor.plugins.table._setAppearance(K,{width:o,borders:f,borderColour:i,borderSize:g,borderStyle:h,backgroundColour:n}),K.removeAttribute("id"),this.editor.plugins.table.markUpdated(),Y.one(".atto_form").hide(),a(".oucontent-editing .editor_atto").show()}};return b});
define('mod_oucontent/accounts_layout', ["jquery"],function(a){"use strict";var b={widthMap:{},content:a("div.oucontent-content table td:first-child"),getWidth:function(c){if(void 0!==b.widthMap[c])return b.widthMap[c];var d=a("<span>"+c+"</span>").appendTo(b.content[0]),e=d.width();return d.remove(),b.widthMap[c]=e,e},adjustDecimals:function(){var c=a("td.oucontent-tabledecimal").parents("table");c.each(function(c,d){var e={},f={},g=a(d).find("td.oucontent-tabledecimal");g.each(function(c,d){var g,h=a(d),i=h.text(),j=h.index();return void 0===i||""===i.trim()||(g=i.search(/\./)>0?i.replace(/^.*\./,""):i.replace(/^.*[0-9,]/,""),void 0===g||(void 0===f[i]&&(g="."+g,f[i]=b.getWidth(g)),void 0===e[j]&&(e[j]=0),void(e[j]=Math.max(f[i],e[j]))))}),g.each(function(b,c){var d,g=a(c),h=g.text(),i=g.index();return void 0===h||""===h.trim()||void(f[h]<e[i]&&(d=h+'<span style="margin-right:'+(e[i]-f[h])+'px"></span>',g.html(g.html().replace(h,d))))})})},adjustAccounts:function(){var c=b.getWidth("("),d=a("div.oucontent-s-accounts>div>table");d.each(function(d,e){var f,g,h=a(e),i={},j={},k=h.find("td");k.each(function(c,d){var e=a(d),f=e.find("sup"),g=f.text(),h=e.index(),k=e.text();g.length>0&&(k=k.replace(g,""));var l=k.replace(/[^0-9\.\,]/gi,""),m=k.replace(/[^0-9\.]/gi,""),n=k.indexOf("(")>-1;void 0!==l&&""!==l||(l=0),void 0===i[h]&&(i[h]={maxnumber:0,maxwidth:0,maxsupwidth:0,negatives:!1,sups:!1}),j[l+""]=b.getWidth(l),j[g]=b.getWidth("<sup>"+g+"</sup>"),m>i[h].maxnumber&&(i[h].maxnumber=m),j[l]>i[h].maxwidth&&(i[h].maxwidth=j[l]),j[g]>i[h].maxsupwidth&&(i[h].maxsupwidth=j[g]),n&&(i[h].negatives=!0),f.length>0&&(i[h].sups=!0)});for(f in i)f&&b.adjustCell(h,f,j,i[f].maxwidth,i[f].maxsupwidth,i[f].negatives,c,i[f].sups);var l=Object.keys(i).length;g=h.find("th.oucontent-tableright"),g.each(function(d,e){var f=a(e),g=f.text(),h=f.index(),j=f.parent().children().length,k=0,m="",n=0,o=0,p=0,q=0;return!i[h]||(l>j?(h+=l-j,n=i[h].maxwidth,o=i[h].maxsupwidth):(n=i[h].maxwidth,o=i[h].maxsupwidth),void("£"===g||"&pound;"===g||"&#163;"===g?(p=b.getWidth("999"),q=b.getWidth("999999"),k=n/2-3.5,(n<=q&&n>p||k>p)&&(k=p-1.5),i[h].negatives&&(k+=c),i[h].sups&&(k+=o),m='&pound;<span style="margin-right:'+k+'px"></span>',f.html(f.html().replace(g,m))):(i[h].negatives&&(k+=c),i[h].sups&&(k+=o),m=g+'<span style="margin-right:'+k+'px"></span>',f.html(f.html().replace(g,m)))))})})},adjustCell:function(c,d,e,f,g,h,i,j){var k=c.find("tr");k.each(function(c,k){var l=a(k).find("td").eq(d),m=l.find("sup"),n=l.text(),o=m.text(),p=l.html(),q=0;if(m.length>0&&(n=n.replace(o,""),q=b.getWidth("<sup>"+o+"</sup>")),void 0!==p&&(p=p.replace(/&nbsp;/gi,""),p=p.replace(/\s+(?=[^()a-zA-Z]*\))/gi,""),l.html(p)),void 0===n)return!0;var r=n.replace(/[^0-9\.]/gi,"").length,s=n.replace(/[^()\-]/gi,"").length,t=b.getWidth("-");if(void 0===r||""===r||"£000"===n)return!0;var u=n.replace(/[^0-9\.\\±\,]/gi,""),v=n.indexOf("(")>-1,w=g-q,x=n.indexOf("±")>-1;if(x&&(u=u.replace("±"," ± ")),0===r){if(h&&v)if(3===s){if(j){var y=(f-t)/2;E='(<span style="margin-left:'+y+'px"></span>-<span style="margin-right:'+y+'px"></span>)'}else{var y=(f-t)/2;E='(<span style="margin-left:'+y+'px"></span>-<span style="margin-right:'+y+'px"></span>)'}E='<span class="oucontent-rawnumber">'+E+"</span>";var z=l.html().replace("(-)",E),A=z+'<span style="margin-right:'+w+'px"></span>';l.html(A),l.html(l.html().replace("(-)",E))}else{E=j?'(<span style="margin-left:'+f+'px"></span>)':'(<span style="margin-left:'+f+'px"></span>)',E='<span class="oucontent-rawnumber">'+E+"</span>",l.html(l.html().replace(/\(\)/gi,E));var B=l.html().replace(/\(\)/gi,E),C=B+'<span style="margin-right:'+w+'px"></span>';l.html(C)}return!0}var D=0;j?b.getWidth(u)+q<f&&(D=f-b.getWidth(u)):e[u+""]<f&&(D=f-e[u+""]);var E=u;if(h)if(v){E='<span style="margin-left:'+D+'px"></span>'+E;var F=l.html().replace(u,E),G='<span class="oucontent-negative">'+F+"</span>";l.html(G),l.append(b.adjustCellPadding("right",w,"px"))}else 0==m.length&&(E='<span class="oucontent-rawnumber">'+E+"</span>",l.html(l.html().replace(u,E)),l.append(b.adjustCellPadding("right",i+w,"px")));else E='<span class="oucontent-rawnumber">'+E+"</span>",l.html(l.html().replace(u,E)),l.append(b.adjustCellPadding("right",w,"px"))})},adjustCellPadding:function(a,b,c){var d;return d='<span style="margin-'+a+":"+b+c+'"></span>'}};return{init:function(){var c=a("td.oucontent-tabledecimal");c.length&&b.adjustDecimals();var d=a("div.oucontent-table.oucontent-s-accounts");d.length&&b.adjustAccounts()}}});
define('mod_oucontent/matching_dnd', ["jquery","theme_osep/animations","theme_osep/drag"],function(a,b,c){"use strict";var d={DRAG_ACCURACY:25,ANIMATION_DURATION:800,CHANGECOLUMNWIDTH:450,CONTAINERWIDTHPHONE:3200,EXTRALOWERAREAHEIGHTPHONE:30,GAP:8,jsstrings:{},init:function(){if(!M.mod_oucontent)return void setTimeout(d.init,50);var b=[];d.jsstrings=M.mod_oucontent.jsstrings,a(".oucontent-matching-container").each(function(a,c){b[a]=new d.questionInstance,b[a].initInstance(c,c.oucontentmatches)}),a(window).on("resize orientationchange",function(){a(".oucontent-matching-container").each(function(a,c){setTimeout(function(){b[a].adjustFormation(c,!1)})})})},questionInstance:function(){return{dataFormation:{},dragProxy:null,qContainer:null,initInstance:function(b,c){var d=a("#"+a(b).attr("id").substring(8));d.css("display","block"),this.qContainer=d,this.setInitialFormation(b,c,d);for(var e=0;e<this.dataFormation.slots.length;e++){var f=this.dataFormation.slots[e];this.addKeyboardEvents(d,f)}for(e=0;e<this.dataFormation.options.length;e++){var g=this.dataFormation.options[e];g.css({cursor:"move"}),g.addClass(".moodle-has-zindex"),g.on("mousedown touchstart",this.getMouseDownOrTouchStart(g))}},setInitialFormation:function(b,c,e){this.dataFormation.options=[],this.dataFormation.help=a('<div class="oucontent-interactionhelp" ><p>'+d.jsstrings.interaction_matching_info+"</p></div>"),this.dataFormation.matches=[],this.dataFormation.slots=[],this.dataFormation.answer=e.parent().find(".oucontent-saq-interactiveanswer"),this.dataFormation.discussion=e.parent().find(".oucontent-saq-interactivediscussion"),this.dataFormation.lowerArea=this.displayLowerArea(e);var f=this.getDimension(e.width(),c);f.height+=d.GAP;for(var g=0;g<c.length;g++){var h=a("#"+c[g].option),i=a("#"+c[g].match),j=this.createDropSlot(f.width,f.height,g);this.useDesktopView(e.width())&&j.css("margin-top",d.GAP+"px"),h.originalPosition=h.position(),h.data("inSlot",!1),h.data("matchid",i.prop("id")),j.data("matchid",i.prop("id")),this.dataFormation.options.push(h),this.dataFormation.matches.push(i),this.dataFormation.slots.push(j)}this.dataFormation.options=this.shuffleOptions(this.dataFormation.options),this.dataFormation.help.data({string:d.jsstrings.interaction_matching_info,left:0,width:f.width,height:f.height,mHeights:f.mHeights,helpHeight:f.helpHeight,dimention:f}),e.append(this.dataFormation.options),e.append(this.dataFormation.matches),e.append(this.dataFormation.slots),e.append(this.dataFormation.lowerArea),this.addSkipLink(e),this.adjustFormation(b)},adjustFormation:function(b,c){c="undefined"==typeof c||c;for(var e=a("#"+a(b).attr("id").substring(8)),f=e.width(),g=this.dataFormation.help.data("height"),h=this.dataFormation.help.data("width"),i=this.dataFormation.help.data("mHeights"),j=this.dataFormation.help.data("helpHeight"),k=0,l={},m=0;m<this.dataFormation.options.length;m++)l=this.adjustPosition(f,m,g),this.dataFormation.options[m].css({top:l.top+"px",left:l.left+"px",height:l.height+"px",width:l.width+"px"}),this.dataFormation.options[m].data("inSlot")===!0&&this.dataFormation.options[m].css({top:0,left:0}),this.dataFormation.options[m].originalPosition=this.dataFormation.options[m].position(),0===l.left&&(k+=l.height+d.GAP);var n=this.dataFormation.help;n.css({top:k+"px",left:0,width:f+"px",height:j+"px",position:"absolute"}),e.append(n),j=parseInt(n.css("height"))+d.GAP,this.dataFormation.help.data("height",l.height),this.dataFormation.help.data("width",l.width);var o=l.top+j+l.height+d.GAP;for(m=0;m<this.dataFormation.matches.length;m++){h=Math.floor(f);var p=i[m],q=o,r=0,s=q+p-d.GAP,t=0;this.useDesktopView(f)?(p=p>g?p:g+d.GAP,t=h/2+d.GAP,h/=2,s=q,o+=p):o+=p+g+d.GAP,this.dataFormation.matches[m].css({display:"block",top:q+"px",left:r,width:h+"px",height:p+"px"}),this.dataFormation.slots[m].css({top:s+"px",left:t+"px",width:h+"px",height:g+"px"})}var u=o,v=parseInt(this.dataFormation.lowerArea.css("height"));this.dataFormation.lowerArea.css({left:0,top:u+d.GAP+"px",width:f+"px"});var w=0,x=e.parent().find(".oucontent-interactionrightwrong");x&&"none"==x.css("display")?w=u-23:x&&"block"==x.css("display")&&!c&&(w=u-30),f<d.CONTAINERWIDTHPHONE?w>0?e.css("height",w+v+d.EXTRALOWERAREAHEIGHTPHONE+d.GAP+"px"):e.css("height",u+v+d.EXTRALOWERAREAHEIGHTPHONE+d.GAP+"px"):e.css("height",u+v+d.GAP+"px")},addKeyboardEvents:function(a,b){var c=this;b.on("focus",function(a){a.preventDefault(),a.stopPropagation(),b.addClass("oucontent-matching-focus")}),b.on("blur",function(a){a.preventDefault(),a.stopPropagation(),b.removeClass("oucontent-matching-focus"),b.addClass("oucontent-matching-blur")}),b.on("keydown",function(d){c.revealButton.attr("disabled",c.revealButtonStatus()),c.keyDownHandler(d,a,b),c.revealButton.attr("disabled",c.revealButtonStatus())})},addSkipLink:function(b){var c=this,e=a(b).attr("id"),f=a('<a href="#matching_access_'+e+'"></a>');f.on("click",function(d){return d.preventDefault(),c.addReturnLink(b,f),a(b).hide(),a(b).parent().find("div.oucontent-interaction-print").attr("id","matching_access_"+e).show(),f.hide(),!0}),f.html(d.jsstrings.interaction_skip_matching),b.before(f)},addReturnLink:function(b,c){var e=a(b).attr("id"),f=a('<a href="#close_matching_access_'+e+'"></a>');f.on("click",function(d){return d.preventDefault(),a(b).show(),a(b).parent().find("div.oucontent-interaction-print").attr("id","matching_access_"+e).hide(),c.show(),f.hide(),!0}),f.html(d.jsstrings.interaction_return_matching),b.before(f)},displayLowerArea:function(b){var c=this,e=a('<div class="oucontent-interaction-lower"/>');e.css({position:"relative",width:b.width()+"px",left:0});var f=a('<div class="oucontent-interactionbuttons"/>');this.useDesktopView(b.width())?f.css("margin-right","-18px"):f.css("margin-right","-10px");var g=a('<input type="button"/>'),h=a('<input type="button"/>');this.setInputValue(g,d.jsstrings.interaction_check_your_answer),g.attr("disabled",!1);var i=a('<div class="oucontent-interactionrightwrong"/>');return i.before(f),i.css("display","none"),g.on("click",function(a){a.preventDefault(),i=c.checkHandler(a,i)}),f.append(g),f.append(document.createTextNode(" ")),b.hasClass("oucontent-specimen-answer")?this.setInputValue(h,d.jsstrings.interaction_reveal_specimen_answer):this.setInputValue(h,d.jsstrings.interaction_reveal_answer),h.attr("disabled",!1),h.on("click",function(a){a.preventDefault(),c.revealHandler()}),this.revealButton=h,f.append(h),f.css("position","relative"),e.append(f),e.append(i),e},adjustPosition:function(a,b,c){var e={height:Math.floor(c),width:Math.floor(a),top:0,left:0},f=b%2===0;return this.useDesktopView(a)?(e.width/=2,e.top=Math.floor(Math.floor(b/2)*(c+d.GAP)),f===!1&&(e.left=e.width+d.GAP)):e.top=Math.floor(b*(c+d.GAP)),e},getDimension:function(b,c){for(var d={height:0,width:0,mHeights:[],oLength:0,mLengths:[],oImageHeight:0,helpHeight:40},e=0;e<c.length;e++){var f=a("#"+c[e].option),g=a("#"+c[e].match),h=f.height(),i=f.width();d.mHeights[e]=g.height();var j=f[0].innerText.length;d.mLengths[e]=g[0].innerText.length;var k=this.getImageHeight(f),l=this.getImageHeight(g);h>d.height&&(d.height=h),i>d.width&&(d.width=i),j>d.oLength&&(d.oLength=j),k>d.oImageHeight&&(d.oImageHeight=k),l>d.mImageHeight&&(d.mImageHeight=l)}return this.useDesktopView(b)&&(d=this.computeHeight(b,d)),d},getImageHeight:function(a){var b=a.find("img").height();return this.isEmpty(b)?0:b},computeHeight:function(a,b){this.isEmpty(b.oImageHeight)?b.height=this.calculateTextHeight(a,b.height,b.oLength):b.height=b.oImageHeight+this.calculateTextHeight(a,b.height-b.oImageHeight,b.oLength);for(var c=0;c<b.mHeights.length;c++)this.isEmpty(b.mImageHeight)?b.mHeights[c]=this.calculateTextHeight(a,b.mHeights[c],b.mLengths[c]):b.mHeights[c]=b.mImageHeight+this.calculateTextHeight(a,b.mHeight[c]-b.mImageHeight,b.mLengths[c]);return b},calculateTextHeight:function(a,b,c){return b+=this.getLengthFactor(c),b*this.getWidthFactor(a)},getLengthFactor:function(a){return.3*a},getWidthFactor:function(a){return(a+.03*a)/a},useDesktopView:function(b){return a(window).width()>767&&b>d.CHANGECOLUMNWIDTH},createDropSlot:function(b,c,d){var e="oucontent-matching-slot-"+d,f=a('<div id="'+e+'" class="oucontent-matching-slot"/>');return f.css({width:b+"px",height:c+"px"}),f.addClass("oucontent-matching-slot-bgoriginal"),f.prop("tabindex",0),f},shuffleOptions:function(a){for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=a[c],b[c].sortorder=Math.random();return b.sort(function(a,b){return a.sortorder<b.sortorder?-1:1}),b},getMouseDownOrTouchStart:function(a){var b=this;return function(d){if(c.prepare(d).start===!0){b.dragProxy=a,b.dragProxy.data("statusondrop","notremove");var e=function(){b.onMove(b)},f=function(){b.onDrop(b)};c.start(d,b.dragProxy,e,f)}}},onMove:function(a){a.dragProxy.css("z-index",2);for(var b=0;b<a.dataFormation.slots.length;b++){var c=a.dragInSlot(a.dataFormation.slots[b]);if(!a.isEmpty(c)){if(a.isSameDrag(c))return a.dataFormation.slots[b].removeClass("oucontent-matching-slot-bgondrop"),void a.dataFormation.slots[b].addClass("oucontent-matching-slot-bgoriginal");a.isDragCloseToTarget(a.dragProxy,a.dataFormation.slots[b])?(c.removeClass("oucontent-matching-option-bgoriginal"),c.addClass("oucontent-matching-option-bgondrop")):(c.removeClass("oucontent-matching-option-bgondrop"),c.addClass("oucontent-matching-option-bgoriginal"))}a.isDragCloseToTarget(a.dragProxy,a.dataFormation.slots[b])?(a.dataFormation.slots[b].removeClass("oucontent-matching-slot-bgoriginal"),a.dataFormation.slots[b].addClass("oucontent-matching-slot-bgondrop")):(a.dataFormation.slots[b].removeClass("oucontent-matching-slot-bgondrop"),a.dataFormation.slots[b].addClass("oucontent-matching-slot-bgoriginal"))}},dragInSlot:function(a){if(!a)return null;var b=a.children();if(b.length)for(var c=0;c<this.dataFormation.options.length;c++)if(b.data("matchid")===this.dataFormation.options[c].data("matchid"))return b.data("inSlot",!0),this.revealButton.attr("disabled",!0),b;return a.removeClass("oucontent-matching-slot-bgondrop"),a.addClass("oucontent-matching-slot-bgoriginal"),this.revealButton.attr("disabled",!1),null},onDrop:function(a){for(var b=0;b<a.dataFormation.slots.length;b++)if(a.isDragCloseToTarget(a.dragProxy,a.dataFormation.slots[b])){var c=a.dragInSlot(a.dataFormation.slots[b]);if(!a.isEmpty(c)){if(a.isSameDrag(c))return;c.removeClass("oucontent-matching-option-bgondrop"),c.addClass("oucontent-matching-option-bgoriginal"),a.dataFormation.slots[b].removeClass("oucontent-matching-slot-bgondrop"),a.dataFormation.slots[b].addClass("oucontent-matching-slot-bgoriginal"),a.putBackToOrigin(c)}return a.dragProxy.css("z-index",a.dragProxy.css("z-index")-1),a.appendToSlot(this.dataFormation.slots[b],a.dragProxy),a.revealButton.attr("disabled",a.revealButtonStatus()),void a.dragProxy.css("cursor","auto")}a.putBackToOrigin(a.dragProxy)},isSameDrag:function(a){return this.dragProxy.data("inSlot")===!0&&this.dragProxy.data("matchid")===a.data("matchid")},putBackToOrigin:function(a){a.css({cursor:"move"});for(var b=0;b<this.dataFormation.options.length;b++)if(a.data("matchid")===this.dataFormation.options[b].data("matchid")){var c=this.dataFormation.options[b].originalPosition.top+"px",e=this.dataFormation.options[b].originalPosition.left+"px";this.animateEl(this.dataFormation.options[b],d.ANIMATION_DURATION,"swing",c,e),this.dataFormation.options[b].data("inSlot",!1),this.qContainer.append(this.dataFormation.options[b])}},isDragCloseToTarget:function(a,b){var c=a.offset().left+a.outerWidth()/2,e=a.offset().top+a.outerHeight()/2,f=b.offset().left+b.outerWidth()/2,g=b.offset().top+b.outerHeight()/2;return c>f-d.DRAG_ACCURACY&&c<f+d.DRAG_ACCURACY&&e>g-d.DRAG_ACCURACY&&e<g+d.DRAG_ACCURACY?(b.removeClass("oucontent-matching-slot-bgoriginal"),b.addClass("oucontent-matching-slot-bgondrop"),!0):(b.removeClass("oucontent-matching-slot-bgondrop"),b.addClass("oucontent-matching-slot-bgoriginal"),!1)},setInputValue:function(a,b){var c=b.replace(/<[^>]+>/g,"");c=c.replace("&amp;","&"),c=c.replace("&lt;","<"),c=c.replace("&gt;",">"),c=c.replace("&quot;","'"),a.attr("value",c);var d=b.match(/<span lang='([a-z]+)'/);d&&a.attr("lang",d[1])},isEmpty:function(a){return void 0===a||null===a||a.length<=0},appendToSlot:function(a,b){b.data("inSlot",!0),b.css({top:0,left:0}),a.append(b)},keyDownHandler:function(a,b,c){var d=a.keyCode,e=0,f=this.dragInSlot(c),g=-1;if(f)for(e=0;e<this.dataFormation.options.length;e++)if(this.dataFormation.options[e].data("matchid")===f.data("matchid")){g=e;break}var h=null;if(39===d||32===d||13===d){for(a.preventDefault(),a.stopPropagation(),e=g+1;e!==g&&(e===this.dataFormation.options.length&&(e=-1),e!==-1)&&this.dataFormation.options[e].data("inSlot")!==!1;e++);e===-1?h=null:(this.dataFormation.options[e].data("inSlot",!0),h=this.dataFormation.options[e])}else if(37===d){for(a.preventDefault(),a.stopPropagation(),e=g-1;e!==g&&(e<-1&&(e=this.dataFormation.options.length-1),e!==-1)&&this.dataFormation.options[e].data("inSlot")!==!1;e--);e===-1?h=null:(this.dataFormation.options[e].data("inSlot",!0),h=this.dataFormation.options[e])}else{if(46!==d&&8!==d&&27!==d)return;a.preventDefault(),a.stopPropagation(),h=null,c.addClass("oucontent-matching-slot-bgoriginal")}h&&this.appendToSlot(c,h),f&&this.putBackToOrigin(f)},checkHandler:function(a,b){for(var c=0,e=0,f=this.dataFormation.slots.length,g=[],h=0;h<f;h++){var i=this.dragInSlot(this.dataFormation.slots[h]);this.isEmpty(i)?c++:i.data("matchid")===this.dataFormation.slots[h].data("matchid")?++e:(this.putBackToOrigin(i),this.dataFormation.slots[h].removeClass("oucontent-matching-slot-bgondrop"),this.dataFormation.slots[h].addClass("oucontent-matching-slot-bgoriginal"))}var j='<img src="'+M.mod_oucontent.pix.invalidinput+'" class="invalid-input" alt="" />',k='<img src="'+M.mod_oucontent.pix.wronganswer+'" class="wrong-answer" alt="" />',l='<img src="'+M.mod_oucontent.pix.rightanswer+'" class="right-answer" alt="" />',m='<img src="'+M.mod_oucontent.pix.retry+'" alt="" class="retry" />',n="",o=parseInt(this.qContainer.find(".oucontent-interactionbuttons").css("height"));c===f?(b.addClass("invalid-input-interfaction"),this.qContainer.addClass("invalid-input-container"),n=j+"<b>"+d.jsstrings.interaction_please_choose_n+"</b>"):0===e?(b.addClass("wrong-answer-interfaction"),this.qContainer.addClass("wrong-answer-container"),n=k+d.jsstrings.interaction_not_correct):e===f?(b.addClass("correct-answer-interfaction"),this.qContainer.addClass("correct-answer-container"),n=l+d.jsstrings.interaction_correct,this.dataFormation.answer&&this.dataFormation.answer.css("display","block"),this.dataFormation.discussion&&this.dataFormation.discussion.css("display","block"),this.qContainer.find(".oucontent-interactionbuttons").css("display","none")):1===e?(b.addClass("retry-singular-interfaction"),this.qContainer.addClass("retry-singular-container"),n=m+d.jsstrings.interaction_correct_incomplete_singular):(b.addClass("retry-plural-interfaction"),this.qContainer.addClass("retry-plural-container"),n=m+d.jsstrings.interaction_correct_incomplete_plural),b.html(n.replace("#1","<b>"+e+"</b>"));for(var p=0;p<g.length;p++)b.appendTo(g[p]);return b&&"none"==b.css("display")?e===f?this.qContainer.css("height",this.qContainer.height()+b.height()-17-o):this.qContainer.css("height",this.qContainer.height()+b.height()+2):e===f&&this.qContainer.css("height",this.qContainer.height()-17-o),b.css("display","block"),this.dataFormation.lowerArea.append(b),b},revealHandler:function(){for(var b=0;b<this.dataFormation.options.length;b++)for(var c=this.dataFormation.options[b].data("matchid"),e=0;e<this.dataFormation.slots.length;e++){var f=this.dataFormation.slots[e].data("matchid");c===f&&(a(this.dataFormation.options[b]).css({top:0,left:0}),this.animateEl(this.dataFormation.options[b],d.ANIMATION_DURATION,"swing",0,0),this.appendToSlot(this.dataFormation.slots[e],this.dataFormation.options[b]))}this.qContainer.find(".oucontent-interactionbuttons").css("display","none");var g=parseInt(this.qContainer.find(".oucontent-interactionbuttons").css("height")),h=this.qContainer.find(".oucontent-interactionrightwrong");h&&"none"==h.css("display")?this.qContainer.css("height",this.qContainer.height()-g):(h.find(".invalid-input").length?(h.removeClass("invalid-input-interfaction").addClass("reveal-invalid-input-interfaction"),this.qContainer.removeClass("invalid-input-container").addClass("reveal-invalid-input-container")):h.find(".wrong-answer").length?(h.removeClass("wrong-answer-interfaction").addClass("reveal-wrong-answer-interfaction"),h.addClass("reveal-wrong-answer-container"),this.qContainer.removeClass("wrong-answer-container").addClass("reveal-wrong-answer-container")):h.find(".retry").length&&(h.removeClass("retry-singular-interfaction retry-plural-interfaction").addClass("reveal-retry-interfaction"),this.qContainer.removeClass("retry-plural-container retry-singular-container").addClass("reveal-retry-container")),this.qContainer.css("height",this.qContainer.height()-h.height()-g+2)),this.dataFormation.answer&&this.dataFormation.answer.css("display","block"),this.dataFormation.discussion&&this.dataFormation.discussion.css("display","block")},revealButtonStatus:function(){for(var a=0;a<this.dataFormation.options.length;a++)if(this.dataFormation.options[a].data("inSlot")===!0)return!0;return!1},callback:function(a){setTimeout(function(){a.removeAttr("style").hide().fadeIn()},1e3)},animateEl:function(a,b,c,d,e){a.animate({opacity:.2,width:parseInt(a.css("width"))+5+"px",height:parseInt(a.css("height"))+5+"px",top:parseInt(d)+5+"px",left:parseInt(e)+5+"px"},{duration:b,easing:c}),a.animate({opacity:1,width:a.css("width"),height:a.css("height"),top:d,left:e},{duration:b,easing:c})}}}};return d});
define('mod_oucontent/dynamic_word_count', ["jquery"],function(a){var b={defaultWordCount:0,init:function(){var b=this.findFreeResponseId();b.length>0&&a.each(b,function(b,c){if(a("#"+c.replace("responsebox_","")).data("formatted"))var d=10,e=setInterval(function(){(a("#"+c+"editable").length>0||0===d)&&(this.addEvent(c),clearInterval(e)),d--}.bind(this),500);else this.addEvent(c)}.bind(this))},findFreeResponseId:function(){var b=[],c=a("[id^='responsebox_']");return c.length>0&&a.each(c,function(a,c){var d=c.id;d.indexOf("editable")===-1&&b.push(d)}),b},getWordCount:function(b){var c=a("#"+b).val(),d=this.figureOutWordCount(String(c));return"<p>"!==c.substring(0,3)&&c.indexOf("<p>")>-1&&(c=c.replace("<p>","</p><p>"),c="<p>"+c,d=this.figureOutWordCount(c)),d},setWordCount:function(a,b){var c=this.findWordCountElement(a);c.length>0&&c.html(b)},figureOutWordCount:function(a){for(var b=this.defaultWordCount,c=new RegExp("\\</p>|</li>|</span>","g"),d=new RegExp("\\<[^>]*>","g"),e=a.replace(c,"\n").replace(d,"").trim().split(/ |\n|&nbsp;/),f=0;f<e.length;f++)e[f]&&b++;return b},findWordCountElement:function(b){var c=a("#"+b),d="form.oucontent-freeresponse",e=".oucontent-word-count span",f=c.parents(d).children().find(e);if(0===f.length){d="form.oucontent-buttons-freeresponse-cell";var g=c.parents("table").attr("id"),h='input[name="tableid"][value="'+g+'"]';f=a(d).children().find(h).parents(d).children().find(e)}return f},updateLastFocusElement:function(a,b){this.findWordCountElement(a).removeAttr("data-focus").attr("data-focus",b.attr("id").replace("editable",""))},addEvent:function(c){var d=a("#"+c),e=this.findWordCountElement(c),f=a("#"+c.replace("responsebox_","")).data("formatted")?a("#"+c+"editable"):d;d.on("change input paste keyup",function(){b.setWordCount(c,b.getWordCount(c)),b.updateLastFocusElement(c,a(this))}),f.on("focusin",function(d){d.target.id&&(d.target.id.indexOf("editable")>-1?c=d.target.id.replace("editable",""):d.target.id.indexOf("responsebox")>-1&&(c=d.target.id)),b.setWordCount(c,b.getWordCount(c)),b.updateLastFocusElement(c,a(this)),e.parent().show()}).on("focusout",function(){b.setWordCount(c,b.defaultWordCount),e.parent().hide()})}},c=100,d=setInterval(function(){"undefined"!=typeof M.mod_oucontent&&"undefined"!==M.mod_oucontent.freeresponse&&(M.mod_oucontent.freeresponse.updateWordCount=function(c,d){var e=a("#"+c),f=d?"focusin":"focusout",g=b.findWordCountElement(c).attr("data-focus"),h="undefined"!==g?g:c;e.parents("div.editor_atto_wrap").length>0&&a("#"+g).parents("form#"+c.replace("responsebox_","")).data("formatted")&&(h+="editable"),a("#"+h).trigger(f)},clearInterval(d)),0===c&&clearInterval(d),c--},100);return b});
define('mod_quiz/preflightcheck', ["jquery","core/yui"],function(a,b){var c={confirmDialogue:null,init:function(a,d,e,f){var g=a;b.use("moodle-core-notification",function(){b.one(e)&&(c.confirmDialogue=new M.core.dialogue({headerContent:d,bodyContent:b.one(e),draggable:!0,visible:!1,center:!0,modal:!0,width:null,extraClasses:["mod_quiz_preflight_popup"]}),b.one(a).on("click",c.displayDialogue),b.one("#id_cancel").on("click",c.hideDialogue),g=c.confirmDialogue.get("boundingBox").one('[name="submitbutton"]')),f&&b.one(g).on("click",c.launchQuizPopup,c,f)})},displayDialogue:function(a){a&&a.halt(),c.confirmDialogue.show()},hideDialogue:function(a){a&&a.halt(),c.confirmDialogue.hide(a)},launchQuizPopup:function(a,c){a.halt(),b.use("moodle-core-formchangechecker","io-form",function(){M.core_formchangechecker.reset_form_dirty_state();var d=a.target.ancestor("form");window.openpopup(a,{url:d.get("action")+"?"+b.IO.stringify(d).replace(/\bcancel=/,"x="),windowname:"quizpopup",options:c,fullscreen:!0})})}};return c});
define('mod_quiz/add_question_modal_launcher', ["jquery","core/notification","core/modal_factory"],function(a,b,c){return{init:function(d,e,f,g){var h=a("body");return c.create({type:d,large:!0,preShowCallback:function(b,c){b=a(b),c.setContextId(f),c.setAddOnPageId(b.attr("data-addonpage")),c.setTitle(b.attr("data-header")),g&&g(b,c)}},[h,e]).fail(b.exception)}}});
define('mod_quiz/add_random_form', ["jquery","mod_quiz/random_question_form_preview"],function(a,b){var c=2e3,d={PREVIEW_CONTAINER:'[data-region="random-question-preview-container"]',CATEGORY_FORM_ELEMENT:'[name="category"]',SUBCATEGORY_FORM_ELEMENT:'[name="includesubcategories"]',TAG_IDS_FORM_ELEMENT:'[name="fromtags[]"]'},e=function(a){return a.find(d.CATEGORY_FORM_ELEMENT).val()},f=function(a){var b=e(a),c=b.split(",");return c[0]},g=function(a,b){var c=e(a);return b.indexOf(c)>-1},h=function(a,b){return!!g(a,b)||a.find(d.SUBCATEGORY_FORM_ELEMENT).is(":checked")},i=function(a){var b=a.find(d.TAG_IDS_FORM_ELEMENT).val();return b.map(function(a){var b=a.split(",");return b[0]})},j=function(a,c,e){var g=a.find(d.PREVIEW_CONTAINER);b.reload(g,f(a),h(a,e),i(a),c)},k=function(a){return a.closest(d.CATEGORY_FORM_ELEMENT).length>0||(a.closest(d.SUBCATEGORY_FORM_ELEMENT).length>0||a.closest(d.TAG_IDS_FORM_ELEMENT).length>0)},l=function(d,e,f){var g=null;d.on("change",function(h){k(a(h.target))&&(b.showLoadingIcon(d),g&&clearTimeout(g),g=setTimeout(function(){j(d,e,f)},c))})},m=function(b,c,d){var e=a("#"+b);j(e,c,d),l(e,c,d)};return{init:m}});
define('mod_quiz/add_random_question', ["mod_quiz/add_question_modal_launcher","mod_quiz/modal_add_random_question"],function(a,b){return{init:function(c,d,e,f){a.init(b.TYPE,'.menu [data-action="addarandomquestion"]',c,function(a,b){b.setCategory(d),b.setReturnUrl(e),b.setCMID(f)})}}});
define('mod_quiz/modal_add_random_question', ["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates"],function(a,b,c,d,e,f,g,h){var i=!1,j={EXISTING_CATEGORY_CONTAINER:'[data-region="existing-category-container"]',EXISTING_CATEGORY_FORM_ELEMENT:"#id_existingcategoryheader",NEW_CATEGORY_CONTAINER:'[data-region="new-category-container"]',NEW_CATEGORY_FORM_ELEMENT:"#id_newcategoryheader",TAB_CONTENT:'[data-region="tab-content"]',ADD_ON_PAGE_FORM_ELEMENT:'[name="addonpage"]',SUBMIT_BUTTON_ELEMENT:'input[type="submit"]',CANCEL_BUTTON_ELEMENT:'input[type="submit"][name="cancel"]',FORM_HEADER:"legend",BUTTON_CONTAINER:".fitem"},k=function(a){d.call(this,a),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1};return k.TYPE="mod_quiz-quiz-add-random-question",k.prototype=Object.create(d.prototype),k.prototype.constructor=k,k.prototype.setContextId=function(a){this.contextId=a},k.prototype.getContextId=function(){return this.contextId},k.prototype.setAddOnPageId=function(a){this.addOnPageId=a,this.getBody().find(j.ADD_ON_PAGE_FORM_ELEMENT).val(a)},k.prototype.getAddOnPageId=function(){return this.addOnPageId},k.prototype.setCategory=function(a){this.category=a},k.prototype.getCategory=function(){return this.category},k.prototype.setReturnUrl=function(a){this.returnUrl=a},k.prototype.getReturnUrl=function(){return this.returnUrl},k.prototype.setCMID=function(a){this.cmid=a},k.prototype.getCMID=function(){return this.cmid},k.prototype.moveFormElementIntoTab=function(b,c){var d=b.find(j.SUBMIT_BUTTON_ELEMENT),e=a('<div class="modal-footer m-t-1" data-region="footer"></div>');b.find(j.FORM_HEADER).addClass("hidden"),b.wrap(c),d.closest(j.BUTTON_CONTAINER).remove(),d.appendTo(e),e.appendTo(b)},k.prototype.moveTabsIntoTabContent=function(a){var b=this.getBody().find(j.TAB_CONTENT).empty();a.find('[role="tabpanel"]').wrapAll(b)},k.prototype.moveCancelButtonToTabs=function(a){var b=a.find(j.CANCEL_BUTTON_ELEMENT).addClass("m-l-1"),c=a.find('[data-region="footer"]');b.closest(j.BUTTON_CONTAINER).remove(),b.clone().appendTo(c)},k.prototype.loadForm=function(){return g.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:this.getAddOnPageId(),cat:this.getCategory(),returnurl:this.getReturnUrl(),cmid:this.getCMID()}).then(function(b,c){var d=a(b),e=d.find(j.EXISTING_CATEGORY_FORM_ELEMENT),f=this.getBody().find(j.EXISTING_CATEGORY_CONTAINER),g=d.find(j.NEW_CATEGORY_FORM_ELEMENT),i=this.getBody().find(j.NEW_CATEGORY_CONTAINER);this.moveFormElementIntoTab(e,f),this.moveFormElementIntoTab(g,i),this.moveTabsIntoTabContent(d),this.moveCancelButtonToTabs(d),h.replaceNode(this.getBody().find(j.TAB_CONTENT),d,c)}.bind(this)).then(function(){b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}).fail(c.exception)},k.prototype.show=function(){d.prototype.show.call(this),this.loadedForm||(this.loadForm(),this.loadedForm=!0)},i||(f.register(k.TYPE,k,"mod_quiz/modal_add_random_question"),i=!0),k});
define('mod_quiz/modal_quiz_question_bank', ["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],function(a,b,c,d,e,f,g){var h=!1,i={ADD_TO_QUIZ_CONTAINER:"td.addtoquizaction",ANCHOR:"a[href]",PREVIEW_CONTAINER:"td.previewaction",SEARCH_OPTIONS:"#advancedsearch",DISPLAY_OPTIONS:"#displayoptions"},j=function(a){d.call(this,a),this.contextId=null,this.addOnPageId=null};return j.TYPE="mod_quiz-quiz-question-bank",j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.setContextId=function(a){this.contextId=a},j.prototype.getContextId=function(){return this.contextId},j.prototype.setAddOnPageId=function(a){this.addOnPageId=a},j.prototype.getAddOnPageId=function(){return this.addOnPageId},j.prototype.show=function(){return this.reloadBodyContent(window.location.search),d.prototype.show.call(this)},j.prototype.reloadBodyContent=function(a){var b=g.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:a}).fail(c.exception);this.setBody(b)},j.prototype.handleAddToQuizEvent=function(a,b){var c=b.attr("href")+"&addonpage="+this.getAddOnPageId();b.attr("href",c)},j.prototype.handlePreviewContainerEvent=function(a,b){var c=["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"];window.openpopup(a,{url:b.attr("href"),name:"questionpreview",options:c.join(",")})},j.prototype.handleDisplayOptionFormEvent=function(b){b.stopPropagation(),b.preventDefault();var c=a(b.target).closest(i.DISPLAY_OPTIONS),d="?"+c.serialize();this.reloadBodyContent(d)},j.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",i.DISPLAY_OPTIONS,function(b){var c=a(b.target);c.attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(b)}.bind(this)),this.getModal().on("submit",i.DISPLAY_OPTIONS,function(a){this.handleDisplayOptionFormEvent(a)}.bind(this))},j.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("click",i.ANCHOR,function(b){var c=a(b.currentTarget);return c.closest(i.ADD_TO_QUIZ_CONTAINER).length?void this.handleAddToQuizEvent(b,c):c.closest(i.PREVIEW_CONTAINER).length?void this.handlePreviewContainerEvent(b,c):void(c.closest(i.SEARCH_OPTIONS).length||(b.preventDefault(),this.reloadBodyContent(c.prop("search"))))}.bind(this)),this.getRoot().on(e.bodyRendered,function(){b.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})})},h||(f.register(j.TYPE,j,"core/modal"),h=!0),j});
define('mod_quiz/quizquestionbank', ["mod_quiz/add_question_modal_launcher","mod_quiz/modal_quiz_question_bank"],function(a,b){return{init:function(c){a.init(b.TYPE,'.menu [data-action="questionbank"]',c)}}});
define('mod_quiz/random_question_form_preview', ["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],function(a,b,c,d,e,f){var g=5,h="mod_quiz/random_question_form_preview_question_list",i={LOADING_ICON_CONTAINER:'[data-region="overlay-icon-container"]',QUESTION_COUNT_CONTAINER:'[data-region="question-count-container"]',QUESTION_LIST_CONTAINER:'[data-region="question-list-container"]'},j=function(a){a.find(i.LOADING_ICON_CONTAINER).removeClass("hidden")},k=function(a){a.find(i.LOADING_ICON_CONTAINER).addClass("hidden")},l=function(a,b){c.get_string("questionsmatchingfilter","mod_quiz",b).then(function(b){a.find(i.QUESTION_COUNT_CONTAINER).html(b)}).fail(d.exception)},m=function(a,c,d,e,f,g){var h={methodname:"core_question_get_random_question_summaries",args:{categoryid:a,includesubcategories:c,tagids:d,contextid:e,limit:f,offset:g}};return b.call([h])[0]},n=function(a,b,c,i,j,k){return f.createFromAjax(j,g,function(f){return f.map(function(f){var g=f.limit,j=f.offset;return 0==j?e.render(h,{questions:k}):m(a,b,c,i,g,j).then(function(a){var b=a.questions;return e.render(h,{questions:b})}).fail(d.exception)})})},o=function(b,c,f,h,o){return j(b),m(c,f,h,o,g,0).then(function(a){var c=a.totalcount;return l(b,c),a}).then(function(b){var d=b.totalcount,e=b.questions;return e.length?n(c,f,h,o,d,e):a.Deferred().resolve("","")}).then(function(a,c){var d=b.find(i.QUESTION_LIST_CONTAINER);e.replaceNodeContents(d,a,c)}).always(function(){k(b)}).fail(d.exception)};return{reload:o,showLoadingIcon:j,hideLoadingIcon:k}});
define('mod_studentquiz/studentquiz', ["jquery"],function(a){function b(){a(".studentquiz_behaviour .show_more").off("click").on("click",function(){a(".studentquiz_behaviour .comment_list div").removeClass("hidden"),a(this).addClass("hidden"),a(".studentquiz_behaviour .show_less").removeClass("hidden")}),a(".studentquiz_behaviour .show_less").off("click").on("click",function(){a(".studentquiz_behaviour .comment_list div").each(function(b){b>1&&!a(this).hasClass("button_controls")&&a(this).addClass("hidden")}),a(this).addClass("hidden"),a(".studentquiz_behaviour .show_more").removeClass("hidden")}),a(".studentquiz_behaviour .remove_action").off("click").on("click",function(){var b=a(this).closest("form").find(".cmid_field"),d=b.attr("value"),e=a(this).attr("data-question_id"),f=a(this).closest(".comments").children(".comment_list");a.post(a("#baseurlmoodle").val()+"/mod/studentquiz/remove.php",{id:a(this).attr("data-id"),cmid:d,sesskey:M.cfg.sesskey},function(){c(e,f,d)})})}function c(c,d,e){var f=a("#baseurlmoodle").val()+"/mod/studentquiz/comment_list.php?questionid=";f+=c+"&cmid="+e+"&sesskey="+M.cfg.sesskey,a.get(f,function(a){d.html(a),b()})}return{initialise:function(){a(".studentquiz_behaviour .add_comment").off("click").on("click",function(){var b=a(this).closest(".comments"),d=b.find(".add_comment_field"),e=d.attr("name").substr(1),f=a(this).closest("form").find(".cmid_field"),g=f.attr("value"),h=b.children(".comment_list");a.post(a("#baseurlmoodle").val()+"/mod/studentquiz/save.php",{save:"comment",cmid:g,questionid:e,sesskey:M.cfg.sesskey,text:d.val()},function(){d.val(""),c(e,h,g)})}),a(".studentquiz_behaviour .rate .rating .rateable").off("click").on("click",function(){var b=a(this).attr("data-rate"),c=a(this),d=a(this).closest("form").find(".cmid_field"),e=d.attr("value");a.post(a("#baseurlmoodle").val()+"/mod/studentquiz/save.php",{save:"rate",cmid:e,questionid:a(this).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:b},function(){var d=c.closest(".rating").children("span");d.removeClass("star"),d.addClass("star-empty"),d.each(function(){a(this).attr("data-rate")<=b&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .rate > .error").addClass("hide")})}),a('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",function(){var b=a(this);if(!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+\-submit$/)}).is(":disabled")){var c=!1;return a(".rating span").each(function(){a(this).hasClass("star")&&(c=!0)}),c?(b.submit(),!0):(a(".studentquiz_behaviour > .rate > .error").removeClass("hide"),!1)}return b.submit(),!0}),b()}}});
define('mod_studio/activityview', ["jquery"],function(a){var b,c=[],d=0,e=0;return b={init:function(){a("a.studio-activity-wrapper-view-more-link").on("click",b.moreData),this.initFilters()},initFilters:function(){a("a.studio-activity-wrapper-cold-filter-a").unbind("click"),a("a.studio-activity-wrapper-cold-filter-a").on("click",b.filterA),a("a.studio-activity-wrapper-cold-filter-b").unbind("click"),a("a.studio-activity-wrapper-cold-filter-b").on("click",b.filterB)},moreData:function(f){f&&f.preventDefault();var g=parseInt(a("div.studio-activity-wrapper-timewindow").attr("data-value")),h=parseInt(a("div.studio-activity-wrapper-endtime").attr("data-value")),i=parseInt(a("div.studio-activity-wrapper-slotownerid").attr("data-value")),j=parseInt(a("div.studio-activity-wrapper-vid").attr("data-value")),k=parseInt(a("div.studio-activity-wrapper-cmid").attr("data-value")),l=a("div.studio-activity-wrapper-url").attr("data-value"),m=l+"?id="+k+"&action=activityview&action-value=moredata",n=g;h>=g&&(n=h),n-=1,m=m+"&ct="+n,m=m+"&vid="+j,m=m+"&vuid="+i,a.ajax({url:m}).done(function(g){if(a("table.studio-activity-wrapper tbody").append(g.html),a("div.studio-activity-wrapper-currenttime").attr("data-value",g.currenttime),a("div.studio-activity-wrapper-timewindow").attr("data-value",g.timewindow),h>=g.timewindow&&a("div.studio-activity-wrapper-view-more").css("display","none"),a("a.studio-activity-wrapper-cold-filter-a").unbind("click"),a("a.studio-activity-wrapper-cold-filter-a").on("click",b.filterA),a("a.studio-activity-wrapper-cold-filter-b").unbind("click"),a("a.studio-activity-wrapper-cold-filter-b").on("click",b.filterB),d>0)20>e?g.timewindow>h-1&&(e++,b.moreData(f)):e=0,b.filterBProcessing(d,!0);else for(var i in c){var j=c[i];b.filterAProcessing(i,!j)}})},filterA:function(d){d.preventDefault();var e=parseInt(a(this).parent().parent().attr("data-activity-slotid"));if(e){var f=!1;e in c&&(f=c[e]),b.filterAProcessing(e,f),c[e]=!f}},filterAProcessing:function(b,c){if(b){var d=!0;a(".studio-activity-wrapper tr").each(function(e,f){if(a(f).attr("data-activity-slotid")==b||a(f).attr("data-activity-setid")==b)if(d&&a(f).attr("data-activity-slotid")==b){var g;d=!1,c?(a(f).removeAttr("data-activity-collapsed"),g=a(".studio-activity-wrapper-cold-filter-a-"+b).attr("src"),g=g.replace(/openstudio_notifications_filter_down/gi,"openstudio_notifications_filter_up"),a(".studio-activity-wrapper-cold-filter-a-"+b).attr("src",g),a("img.studio-activity-wrapper-cold-filter-a-"+b).parent().attr("title","Collapse activity related to this item"),a(".studio-activity-wrapper-cold-filter-b-"+b).css("display","")):(a(f).attr("data-activity-collapsed",1),g=a(".studio-activity-wrapper-cold-filter-a-"+b).attr("src"),g=g.replace(/openstudio_notifications_filter_up/gi,"openstudio_notifications_filter_down"),a(".studio-activity-wrapper-cold-filter-a-"+b).attr("src",g),a("img.studio-activity-wrapper-cold-filter-a-"+b).parent().attr("title","Expand activity related to this item"),a(".studio-activity-wrapper-cold-filter-b-"+b).css("display","none"))}else c?(a(f).css("display",""),a(f).removeAttr("data-activity-collapsed")):a(f).css("display","none")})}},filterB:function(c){c.preventDefault();var e=parseInt(a(this).parent().parent().attr("data-activity-slotid")),f=parseInt(a(this).parent().parent().attr("data-activity-setid"));if(e){var g=e;f>0&&(g=f);var h=!1;0===d?(d=g,h=!0):(d=0,h=!1),b.filterBProcessing(g,h),h&&(b.moreData(!1),a("div.studio-activity-wrapper-view-more").css("display","none")),window.location.href="#studio-activity-wrapper-anchor"}},filterBProcessing:function(b,c){if(b){var d=!1;a(".studio-activity-wrapper tr").each(function(e,f){var g=parseInt(a(f).attr("data-activity-slotid")),h=parseInt(a(f).attr("data-activity-setid"));if(g==b||h==b){var i;d=!0,c?(i=a(".studio-activity-wrapper-cold-filter-b-"+b).attr("src"),i=i.replace(/openstudio_notifications_filter_right/gi,"openstudio_notifications_filter_left"),a(".studio-activity-wrapper-cold-filter-b-"+b).attr("src",i),a("img.studio-activity-wrapper-cold-filter-b-"+b).parent().attr("title","Remove filter to show all items")):(i=a(".studio-activity-wrapper-cold-filter-b-"+b).attr("src"),i=i.replace(/openstudio_notifications_filter_left/gi,"openstudio_notifications_filter_right"),a(".studio-activity-wrapper-cold-filter-b-"+b).attr("src",i),a("img.studio-activity-wrapper-cold-filter-b-"+b).parent().attr("title","Filter by this item"))}else(g||h)&&(d=!0,c?a(f).css("display","none"):a(f).css("display",""))}),d&&(c?(a(".studio-activity-wrapper-cold-filter-b-"+b).css("display","none"),a(".studio-activity-wrapper-cold-filter-b-"+b).first().css("display",""),a(".studio-activity-wrapper-cold-filter-a").css("display","none")):(a(".studio-activity-wrapper-cold-filter-b-"+b).css("display",""),a(".studio-activity-wrapper-cold-filter-a").css("display",""),a("div.studio-activity-wrapper-view-more").css("display","")))}}}});
define('mod_studio/comments', ["jquery"],function(a){var b;return b={list:{},statusMessage:{},errorMessage:{},bigLoader:{},smallLoader:{},init:function(){a("a.studio-slot-comment-actions-flag").on("click",b.flagComment),a("#studio-slot-view-comments-reply form, #studio-slot-comment-add form").on("submit",b.postComment),a("a.studio-slot-view-comment-actions-delete").on("click",b.deleteConfirm),a("a.studio-slot-view-comment-actions-reply").on("click",b.showReplyForm),a(".studio-slot-view-showreply form").on("submit",b.showReplyForm),a("#studio-slot-view-comment-showform form").on("submit",b.showCommentForm),a(".studio-slot-flag-addcomment a").on("click",b.showCommentForm),b.statusMessage=a('<div id="studio-slot-comments-status-message" role="status" aria-live="polite" class="accesshide"></div>'),b.errorMessage=a('<div id="studio-slot-comments-error-message" class="alert alert-error" role="alert" aria-live="polite"></div>');var c=a("#studio-slot-view-comments-list");c.before(b.statusMessage),c.before(b.errorMessage),b.errorMessage.hide(),b.list=a(".studio-slot-view-comments-list"),b.smallLoader=a('<img id="studio-comment-loader" alt="" src="'+M.cfg.wwwroot+'/pix/i/loading_small.gif" />'),b.bigLoader=a('<img id="studio-comment-loader-big" alt="" src="'+M.cfg.wwwroot+'/pix/i/loading.gif" />')},flagComment:function(c){c.preventDefault();var d=a(c.target),e=d.data("cid"),f=d.attr("href"),g=d.attr("id"),h=g+"-error",i=a("#"+h);a(d.parent()).append(b.smallLoader[0].outerHTML),M.util.js_pending("studio-commentflag-"+e),a.ajax({url:f}).done(function(c){i.length&&i.remove();var f=a("#studio-slot-comment-flagicon-"+e),g=a("#studio-slot-comment-flagcount-"+e);g.hasClass("studio-slot-comment-flagcount-flagged")||(g.addClass("studio-slot-comment-flagcount-flagged"),f.attr("src",f.attr("src")+"_flagged"),f.attr("alt",M.util.get_string("slotcommentliked","studio"))),g.html(c.count),b.statusMessage.text(M.util.get_string("statuscommentliked","studio")+c.count+" "+M.util.get_string("slotcommentliked","studio")),d.remove()}).fail(function(a){var c=a.responseJSON;b.errorMessage.text(c.message),b.scrollIntoViewIfNeeded(b.errorMessage)}).always(function(){a("#studio-comment-loader").remove(),M.util.js_complete("studio-commentflag-"+e)})},postComment:function(c){c.preventDefault();var d=a(c.target),e=d.find("#id_commenttext");if(e.siblings(".mceEditor").length>0){var f=d.find("#id_commenttext_ifr").get(0).contentDocument.getElementById("tinymce").innerHTML;e.val(f)}var g=d.serialize(),h=d.attr("action"),i=d.find("#id_submitbutton");b.errorMessage.hide(),i.attr("disabled",!0),i.after(b.smallLoader[0].outerHTML),M.util.js_pending("studio-commentpost"),b.statusMessage.text(M.util.get_string("statussendingcomment","studio")),a.ajax({url:h,type:"POST",data:g}).done(function(c){if(c.comment.length>0){var e=a(c.comment);if(e.on("click","a.studio-slot-comment-actions-flag",b.flagComment),e.on("click","a.studio-slot-view-comment-actions-delete",b.deleteConfirm),e.on("click","a.studio-slot-view-comment-actions-reply",b.showReplyForm),"studio-slot-view-comments-reply"===a(d.parent()).attr("id"))a(d.parent()).replaceWith(e);else{a(".studio-slot-view-showreply").length>0?a(".studio-slot-view-showreply:last-child").first().after(e):a(".studio-slot-view-comments-list-item").length>0?a(".studio-slot-view-comments-list-item:last-child").first().after(e):(0===a("ul.studio-slot-view-comments-list").length&&a("#studio-slot-view-comments-list").after('<h4 class="studio-slot-view-comments-header">'+M.util.get_string("slotcomments","studio")+'</h4><ul class="studio-slot-view-comments-list"></ul>'),a("ul.studio-slot-view-comments-list").append(e));var f=a(c.button);a("#studio-slot-view-comment-form").replaceWith(f),f.find("form").on("submit",b.showCommentForm)}var g=a(c.replybutton);g.find("form").on("submit",b.showReplyForm),e.after(g),b.statusMessage.text(M.util.get_string("statussentcomment","studio"))}}).fail(function(a){var c=a.responseJSON;b.errorMessage.text(c.message),b.errorMessage.show(),b.scrollIntoViewIfNeeded(b.errorMessage),i.attr("disabled",!1)}).always(function(){M.util.js_complete("studio-commentpost"),a("#studio-comment-loader").remove(),b.applyStriping()})},deleteConfirm:function(c){c.preventDefault();var d=a("#studio-slot-view-comments-reply");d&&(d.next(".studio-slot-view-showreply").show(),d.remove()),0===a("div#studio-dialog-slotcomment").length&&a("body").append('<div id="studio-dialog-slotcomment"></div>');var e=a(c.target),f=e.attr("href");window.require(["core/yui"],function(c){c.use("panel",function(c){var d=new c.Panel({bodyContent:M.util.get_string("modulejsdialogcommentdeleteconfirm","studio"),width:320,zIndex:6,centered:!0,render:"#studio-dialog-slotcomment",modal:!0,visible:!1,buttons:{footer:[{name:"proceed",label:M.util.get_string("delete","moodle"),action:"onOK"},{name:"cancel",label:M.util.get_string("cancel","moodle"),action:"onCancel"}]}});d.onCancel=function(a){a.preventDefault(),this.hide(),this.callback=!1},d.onOK=function(c){c.preventDefault(),this.hide(),b.bigLoader.css("marginTop","-7em"),e.parent().parent().append(b.bigLoader),M.util.js_pending("studio-deletecomment"),b.statusMessage.text(M.util.get_string("statuscommentdeleting","studio")),a.ajax({url:f,type:"POST",data:{confirm:!0}}).done(function(c){var d,e,f,g=a(c.html),h=a("#studio-slot-view-comments-list-item-id-"+c.message),i=h.find(".studio-slot-view-comment-reply").first();if(i.length>0){var j=/-replyto-(\d+)/.exec(i.attr("class")),k=j[1];f=a("#studio-slot-view-comments-list-item-id-"+k),d=a(".studio-slot-view-comment-replyto-"+k)}else f=h,d=a(".studio-slot-view-comment-replyto-"+c.message),a("#studio-slot-view-showreply-"+c.message).remove();e=d.filter(":not(.studio-slot-view-comment-item-deleted):not(#studio-slot-view-comments-list-item-id-"+c.message+" div)"),0!==e.length||f!==h&&0===f.find(".studio-slot-view-comment-item-deleted").length?(h.find(".studio-slot-view-comment-item").hasClass("studio-slot-view-comment-reply")&&g.find(".studio-slot-view-comment-item").addClass("studio-slot-view-comment-reply"),h.replaceWith(g)):(f.remove(),d.parent().remove(),a("#studio-slot-view-showreply-"+c.message).remove()),b.statusMessage.text(M.util.get_string("statuscommentdeleted","studio"))}).fail(function(a){var c=a.responseJSON;b.errorMessage.text(c.message),b.scrollIntoViewIfNeeded(b.errorMessage)}).always(function(){b.bigLoader.remove(),b.bigLoader.css("marginTop","0em"),M.util.js_complete("studio-deletecomment"),b.applyStriping()}),this.callback=!1},d.show(),window.scrollBy(0,1),window.scrollBy(0,-1)})})},showReplyForm:function(c){c.preventDefault();var d=a("#studio-slot-view-comments-reply");d&&(d.next(".studio-slot-view-showreply").show(),d.remove());var e,f,g=a(c.target);if(g.attr("href")?(e=g.attr("href"),f=g.data("inreplyto")):(e=g.attr("action"),f=g.find("input[name=inreplyto]").attr("value")),g.attr("action")){var h=e.split("#");e=h[0]+="?"+g.serialize()}var i=a("#studio-slot-view-showreply-"+f);i.after(b.bigLoader),i.hide(),b.scrollIntoViewIfNeeded(b.bigLoader),M.util.js_pending("studio-replyform"),b.statusMessage.text(M.util.get_string("statusreplyformloading","studio")),a.ajax({url:e}).done(function(c){var d=a(c.form);i.before(d),d.on("submit",b.postComment),Y.one("#id_commenttext_reply").focus()}).fail(function(a){var c=a.responseJSON;i.show(),b.errorMessage.text(c.message),b.scrollIntoViewIfNeeded(b.errorMessage)}).always(function(){b.bigLoader.remove(),M.util.js_complete("studio-replyform"),b.statusMessage.text(M.util.get_string("statusreplyformloaded","studio")),b.applyStriping()})},showCommentForm:function(c){c.preventDefault();var d,e=a(c.currentTarget);d=e.attr("href")?e.attr("href"):e.attr("action");var f=d.split("#");e.attr("action")&&(f[0]+="?"+e.serialize()),d=f[0]+"&iframe=1",M.util.js_pending("studio-commentform"),b.statusMessage.text(M.util.get_string("statuscommentformloading","studio"));var g=a("#studio-slot-view-comment-showform");b.bigLoader.css("marginTop","-10em"),g.after(b.bigLoader);var h=a('<iframe seamless="seamless" scrolling="no" id="studio-slot-view-comment-form" name="studio-slot-view-comment-form" src="'+d+'"></iframe>');g.replaceWith(h),b.scrollIntoViewIfNeeded(h),h.on("load",function(){M.util.js_complete("studio-commentform"),a("#studio-slot-view-comment-form").contents().find("form").on("submit",function(a){a.preventDefault(),b.statusMessage.text(M.util.get_string("statuscommentformloaded","studio")),b.postComment(a)});var c=h.contents().find(".fitem_feditor"),d=h.contents().find(".fitem_ffilepicker");c.length>0&&d.length>0?h.css("height","50em"):c.length>0?h.css("height","38em"):d.length>0?h.css("height","30em"):h.css("height","20em"),h.attr("scrolling","auto"),h.css("visibility","visible"),h.css("overflow","scroll"),h.contents().find("#id_commenttext").focus(),b.bigLoader.remove(),b.bigLoader.css("marginTop","0em")})},scrollIntoViewIfNeeded:function(b){if(b.length>0){var c=a(document),d=a(window),e=c.scrollTop(),f=c.scrollLeft(),g=d.innerHeight(),h=d.innerWidth(),i=b.offset(),j=i.left,k=i.top,l=b.width(),m=b.height();if(l>=h){if(j>f||f+h>j+l)return b[0].scrollIntoView(),b}else if(f>j||j+l>f+h)return b[0].scrollIntoView(),b;if(m>=g){if(k>e||e+g>k+m)return b[0].scrollIntoView(),b}else if(e>k||k+m>e+g)return b[0].scrollIntoView(),b;return b}},applyStriping:function(){b.list.find("li:visible:even div, li:visible:even form").css("background","white"),b.list.find("li:visible:odd div, li:visible:odd form").css("background","#dbdfdb")}}});
define('mod_survey/validation', ["jquery","core/str","core/modal_factory","core/notification"],function(a,b,c,d){return{ensureRadiosChosen:function(e){var f=b.get_strings([{key:"error",component:"moodle"},{key:"questionsnotanswered",component:"survey"}]).then(function(a){return c.create({type:c.types.CANCEL,title:a[0],body:a[1]})})["catch"](d.exception),g=a("#"+e);g.submit(function(a){return 0===g.find('input:radio[data-survey-default="true"]:checked').length||(a.preventDefault(),f.then(function(a){return a.show(),!1}))})}}});
define('mod_useroptions/chooseconfirmdialog', ["jquery","core/modal_factory","core/modal_events"],function(a,b,c){var d,e={init:function(){e.initDialog()},initDialog:function(){var e=a("#userid-hidden").val(),f=a("#choose-form"),g=a("#choose-button");g.click(function(a){e?d?d.show():b.create({type:b.types.SAVE_CANCEL,title:M.util.get_string("choice_confirm_title","useroptions"),body:M.util.get_string("choice_confirm","useroptions")}).done(function(a){d=a,d.show(),d.getRoot().on(c.save,function(){f.submit()})}):f.submit()})}};return e});
define('mod_useroptions/userselectionfilter', ["jquery"],function(a){var b={init:function(){b.initFilterInputEvent()},initFilterInputEvent:function(){a("input.filter").keyup(function(){var b=a(this).attr("data-filter-for"),c=a(this).val().toLowerCase(),d=a("table[data-filter-id="+b+"] tbody tr");d.hide(),a.each(d,function(b,d){var e=a(d).find(".filterable");a.each(e,function(b,e){return-1!==a(e).text().toLowerCase().indexOf(c)?(a(d).show(),!1):void 0})})})}};return b});
define('mod_workshop/workshopview', ["jquery"],function(a){function b(b){var c=0;b.height("auto"),b.each(function(){var b=a(this).height();b>c&&(c=b)}),b.height(c)}return{init:function(){var c=a(".path-mod-workshop .userplan dt"),d=a(".path-mod-workshop .userplan dd");b(c),b(d),a(window).on("resize",function(){b(c),b(d)})}}});
define('enrol_manual/form-potential-user-selector', ["jquery","core/ajax","core/templates","core/str"],function(a,b,c,d){var e=100;return{processResults:function(b,c){var d=[];return a.isArray(c)?(a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d):c},transport:function(f,g,h,i){var j,k=a(f).attr("courseid");"undefined"==typeof k&&(k="1");var l=a(f).attr("enrolid");"undefined"==typeof l&&(l=""),j=b.call([{methodname:"core_enrol_get_potential_users",args:{courseid:k,enrolid:l,search:g,searchanywhere:!0,page:0,perpage:e+1}}]),j[0].then(function(b){var f=[],g=0;return b.length<=e?(a.each(b,function(b,d){var e=d,g=[];a.each(["idnumber","email","phone1","phone2","department","institution"],function(a,b){"undefined"!=typeof d[b]&&""!==d[b]&&(e.hasidentity=!0,g.push(d[b]))}),e.identity=g.join(", "),f.push(c.render("enrol_manual/form-user-selector-suggestion",e))}),a.when.apply(a.when,f).then(function(){var c=arguments;a.each(b,function(a,b){b._label=c[g],g++}),h(b)})):d.get_string("toomanyuserstoshow","core",">"+e).then(function(a){h(a)})}).fail(i)}}});
define('enrol_manual/quickenrolment', ["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g,h){var i={COHORTSELECT:"#id_cohortlist",TRIGGERBUTTONS:".enrolusersbutton.enrol_manual_plugin [type='submit']",UNWANTEDHIDDENFIELDS:":input[value='_qf__force_multiselect_submission']"},j=function(a){this.contextid=a.contextid,this.initModal()};return j.prototype.courseid=0,j.prototype.modal=null,j.prototype.initModal=function(){var a=b(i.TRIGGERBUTTONS);b.when(c.get_strings([{key:"enroluserscohorts",component:"enrol_manual"},{key:"enrolusers",component:"enrol_manual"}]),f.create({type:f.types.SAVE_CANCEL,large:!0},a)).then(function(a,c){this.modal=c,c.setTitle(a[1]),c.setSaveButtonText(a[1]),c.getRoot().on(g.save,this.submitForm.bind(this)),c.getRoot().on("submit","form",this.submitFormAjax.bind(this)),c.getRoot().on(g.hidden,function(){c.setBody("")}),c.getRoot().on(g.shown,function(){var d=this.getBody();d.then(function(d){var e=b(d).find(i.COHORTSELECT).length?0:1;c.setSaveButtonText(a[e])}).fail(e.exception),c.setBody(d)}.bind(this))}.bind(this)).fail(e.exception)},j.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},j.prototype.submitFormAjax=function(a){a.preventDefault();var c=this.modal.getRoot().find("form"),f=c.find(i.UNWANTEDHIDDENFIELDS);f.each(function(){b(this).remove()});var g=c.serialize();this.modal.hide();var h={type:"GET",processData:!1,contentType:"application/json"},j=d.wwwroot+"/enrol/manual/ajax.php?"+g;b.ajax(j,h).then(function(a){a.error?e.addNotification({message:a.error,type:"error"}):("undefined"!=typeof window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload())}).fail(e.exception)},j.prototype.getBody=function(){return h.loadFragment("enrol_manual","enrol_users_form",this.contextid,{}).fail(e.exception)},j.prototype.getFooter=function(){return a.render("enrol_manual/enrol_modal_footer",{})},{init:function(a){new j(a)}}});
define('message_popup/message_popover_controller', ["jquery","core/ajax","core/templates","core/str","core/notification","core/custom_interaction_events","core/popover_region_controller","core_message/message_repository","core/url"],function(a,b,c,d,e,f,g,h,i){var j={MARK_ALL_READ_BUTTON:'[data-action="mark-all-read"]',CONTENT:'[data-region="messages"]',CONTENT_ITEM_CONTAINER:'[data-region="message-content-item-container"]',EMPTY_MESSAGE:'[data-region="empty-message"]',COUNT_CONTAINER:'[data-region="count-container"]'},k=function(a){g.call(this,a),this.markAllReadButton=this.root.find(j.MARK_ALL_READ_BUTTON),this.content=this.root.find(j.CONTENT),this.userId=this.root.attr("data-userid"),this.limit=20,this.offset=0,this.loadedAll=!1,this.initialLoad=!1,this.unreadCount=this.root.find(j.COUNT_CONTAINER).html()};return k.prototype=Object.create(g.prototype),k.prototype.constructor=k,k.prototype.getContent=function(){return this.content},k.prototype.incrementOffset=function(){this.offset+=this.limit},k.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?d.get_string("hidemessagewindow","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):this.unreadCount?d.get_string("showmessagewindowwithcount","message",this.unreadCount).done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):d.get_string("showmessagewindownonew","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this))},k.prototype.renderUnreadCount=function(){var a=this.root.find(j.COUNT_CONTAINER);this.unreadCount?(a.text(this.unreadCount),a.removeClass("hidden")):a.addClass("hidden")},k.prototype.hideUnreadCount=function(){this.root.find(j.COUNT_CONTAINER).addClass("hidden")},k.prototype.renderMessages=function(b,d){var e=[];return a.each(b,function(a,b){b.contexturl=i.relativeUrl("/message/index.php",{user:this.userId,id:b.userid}),b.profileurl=i.relativeUrl("/user/profile.php",{id:b.userid});var d=c.render("message_popup/message_content_item",b).then(function(a,b){return{html:a,js:b}});e.push(d)}.bind(this)),a.when.apply(a,e).then(function(){a.each(arguments,function(a,b){d.append(b.html),c.runTemplateJS(b.js)})})},k.prototype.loadMoreMessages=function(){if(this.isLoading||this.loadedAll)return a.Deferred().resolve();this.startLoading();var b={userid:this.userId,limit:this.limit,offset:this.offset},c=this.getContent();return h.query(b).then(function(a){var b=a.contacts;return this.loadedAll=!b.length||b.length<this.limit,this.initialLoad=!0,this.updateButtonAriaLabel(),!!b.length&&(this.incrementOffset(),this.renderMessages(b,c))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},k.prototype.markAllAsRead=function(){return this.markAllReadButton.hasClass("loading")?a.Deferred().resolve():(this.markAllReadButton.addClass("loading"),h.markAllAsRead({useridto:this.userId}).then(function(){this.unreadCount=0,this.hideUnreadCount(),this.getContent().find(j.CONTENT_ITEM_CONTAINER).removeClass("unread")}.bind(this)).always(function(){this.markAllReadButton.removeClass("loading")}.bind(this)))},k.prototype.registerEventListeners=function(){f.define(this.root,[f.events.keyboardActivate]),this.root.on(this.events().menuOpened,function(){this.hideUnreadCount(),this.updateButtonAriaLabel(),this.initialLoad||this.loadMoreMessages()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.renderUnreadCount(),this.updateButtonAriaLabel()}.bind(this)),this.root.on(f.events.scrollBottom,function(){this.loadMoreMessages()}.bind(this)),this.root.on(f.events.activate,j.MARK_ALL_READ_BUTTON,function(a,b){this.markAllAsRead(),a.stopPropagation(),b.originalEvent.preventDefault()}.bind(this)),f.define(this.getContentContainer(),[f.events.scrollLock]),a(document).on("messagearea:conversationselected",function(){this.unreadCount--,this.renderUnreadCount()}.bind(this))},k});
define('message_popup/notification_area_content_area', ["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f){var g={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',HEADER:'[data-region="header"]',FOOTER:'[data-region="footer"]',TOGGLE_MODE:'[data-action="toggle-mode"]'},h={HEADER:"message_popup/notification_area_content_area_header",CONTENT:"message_popup/notification_area_content_area_content",FOOTER:"message_popup/notification_area_content_area_footer"},i=function(b,c){this.root=a(b),this.container=this.root.closest(g.CONTAINER),this.userId=c,this.header=this.root.find(g.HEADER),this.content=this.root.find(g.CONTENT),this.footer=this.root.find(g.FOOTER),this.registerEventListeners()};return i.prototype.getRoot=function(){return this.root},i.prototype.getContainer=function(){return this.container},i.prototype.getUserId=function(){return this.userId},i.prototype.getHeader=function(){return this.header},i.prototype.getContent=function(){return this.content},i.prototype.getFooter=function(){return this.footer},i.prototype.show=function(){this.getContainer().addClass("show-content-area")},i.prototype.hide=function(){this.getContainer().removeClass("show-content-area")},i.prototype.setHeaderHTML=function(a){this.getHeader().empty().html(a)},i.prototype.setContentHTML=function(a){this.getContent().empty().html(a)},i.prototype.setFooterHTML=function(a){this.getFooter().empty().html(a)},i.prototype.showNotification=function(c){var d=b.render(h.HEADER,c).done(function(a){this.setHeaderHTML(a)}.bind(this)),e=b.render(h.CONTENT,c).done(function(a){this.setContentHTML(a)}.bind(this)),g=b.render(h.FOOTER,c).done(function(a){this.setFooterHTML(a)}.bind(this));return a.when(d,e,g).done(function(){this.show(),this.getContainer().trigger(f.notificationShown,[c])}.bind(this))},i.prototype.registerEventListeners=function(){d.define(this.getRoot(),[d.events.activate]),this.getRoot().on(d.events.activate,g.VIEW_TOGGLE,function(){this.hide()}.bind(this)),this.getContainer().on(f.showNotification,function(a,b){this.showNotification(b)}.bind(this))},i});
define('message_popup/notification_area_control_area', ["jquery","core/templates","core/notification","core/custom_interaction_events","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f){var g={CONTAINER:'[data-region="notification-area"]',CONTENT:'[data-region="content"]',NOTIFICATION:'[data-region="notification-content-item-container"]',CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]'},h={NOTIFICATION:"message_popup/notification_content_item"},i=function(b,c){this.root=a(b),this.container=this.root.closest(g.CONTAINER),this.userId=c,this.content=this.root.find(g.CONTENT),this.offset=0,this.limit=20,this.initialLoad=!1,this.isLoading=!1,this.loadedAll=!1,this.notifications={},this.registerEventListeners()};return i.prototype.getRoot=function(){return this.root},i.prototype.getContainer=function(){return this.container},i.prototype.getUserId=function(){return this.userId},i.prototype.getContent=function(){return this.content},i.prototype.getOffset=function(){return this.offset},i.prototype.getLimit=function(){return this.limit},i.prototype.setOffset=function(a){this.offset=a},i.prototype.setLimit=function(a){this.limit=a},i.prototype.incrementOffset=function(){this.offset+=this.limit},i.prototype.startLoading=function(){this.isLoading=!0,this.getRoot().addClass("loading")},i.prototype.stopLoading=function(){this.isLoading=!1,this.getRoot().removeClass("loading")},i.prototype.hasDoneInitialLoad=function(){return this.initialLoad},i.prototype.hasLoadedAllContent=function(){return this.loadedAll},i.prototype.setLoadedAllContent=function(a){this.loadedAll=a},i.prototype.setCacheNotification=function(a){this.notifications[a.id]=a},i.prototype.getCacheNotification=function(a){return this.notifications[a]},i.prototype.getNotificationElement=function(a){var b=this.getRoot().find(g.NOTIFICATION+'[data-id="'+a+'"]');return 1==b.length?b:null},i.prototype.scrollNotificationIntoView=function(a){var b=a.position(),c=this.getRoot(),d=b.top-c.scrollTop();if(d>c.innerHeight()){var e=a.outerHeight();e=4*e;var f=b.top-e;c.scrollTop(f)}},i.prototype.showNotification=function(b){if("object"!=typeof b&&(b=this.getNotificationElement(b)),b&&b.length){this.getRoot().find(g.NOTIFICATION).removeClass("selected"),b.addClass("selected").find(g.CAN_RECEIVE_FOCUS).focus();var c=b.attr("data-id"),d=this.getCacheNotification(c);this.scrollNotificationIntoView(b),this.getContainer().trigger(f.showNotification,[a.extend({},d)])}},i.prototype.markNotificationAsRead=function(a){return e.markAsRead(a.attr("data-id")).done(function(){a.removeClass("unread")})},i.prototype.renderNotifications=function(c){var d=[],e=this.getContent();return a.each(c,function(a,c){var e=c.contexturl;delete c.contexturl;var f=b.render(h.NOTIFICATION,c).then(function(a,b){return c.contexturl=e,this.setCacheNotification(c),{html:a,js:b}}.bind(this));d.push(f)}.bind(this)),a.when.apply(a,d).then(function(){a.each(arguments,function(a,c){e.append(c.html),b.runTemplateJS(c.js)})})},i.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return a.Deferred().resolve();this.startLoading();var b={limit:this.getLimit(),offset:this.getOffset(),useridto:this.getUserId()};this.initialLoad||(b.limit=this.getOffset()+this.getLimit(),b.offset=0);var c=e.query(b).then(function(a){var b=a.notifications;return this.unreadCount=a.unreadcount,this.setLoadedAllContent(!b.length||b.length<this.getLimit()),this.initialLoad=!0,!!b.length&&(this.incrementOffset(),this.renderNotifications(b))}.bind(this)).always(function(){this.stopLoading()}.bind(this));return c},i.prototype.registerEventListeners=function(){d.define(this.getRoot(),[d.events.activate,d.events.scrollBottom,d.events.scrollLock,d.events.up,d.events.down]),this.getRoot().on(d.events.scrollBottom,function(){this.loadMoreNotifications()}.bind(this)),this.getRoot().on(d.events.activate,g.NOTIFICATION,function(b){var c=a(b.target).closest(g.NOTIFICATION);this.showNotification(c)}.bind(this)),this.getRoot().on(d.events.up,g.NOTIFICATION,function(b,c){var d=a(b.target).closest(g.NOTIFICATION);this.showNotification(d.prev()),c.originalEvent.preventDefault()}.bind(this)),this.getRoot().on(d.events.down,g.NOTIFICATION,function(b,c){var d=a(b.target).closest(g.NOTIFICATION);this.showNotification(d.next()),c.originalEvent.preventDefault()}.bind(this)),this.getContainer().on(f.notificationShown,function(a,b){if(!b.read){var c=this.getNotificationElement(b.id);c&&this.markNotificationAsRead(c);var d=this.getCacheNotification(b.id);d&&(d.read=!0)}}.bind(this))},i});
define('message_popup/notification_area_events', [],function(){return{showNotification:"notification-area-events:showNotification",notificationShown:"notification-area-events:notificationShown"}});
define('message_popup/notification_popover_controller', ["jquery","core/ajax","core/templates","core/str","core/url","core/notification","core/custom_interaction_events","core/popover_region_controller","message_popup/notification_repository","message_popup/notification_area_events"],function(a,b,c,d,e,f,g,h,i,j){var k={MARK_ALL_READ_BUTTON:'[data-action="mark-all-read"]',ALL_NOTIFICATIONS_CONTAINER:'[data-region="all-notifications"]',NOTIFICATION:'[data-region="notification-content-item-container"]',UNREAD_NOTIFICATION:'[data-region="notification-content-item-container"].unread',NOTIFICATION_LINK:'[data-action="content-item-link"]',EMPTY_MESSAGE:'[data-region="empty-message"]',COUNT_CONTAINER:'[data-region="count-container"]'},l=function(a){h.call(this,a),this.markAllReadButton=this.root.find(k.MARK_ALL_READ_BUTTON),this.unreadCount=0,this.userId=this.root.attr("data-userid"),this.container=this.root.find(k.ALL_NOTIFICATIONS_CONTAINER),this.limit=20,this.offset=0,this.loadedAll=!1,this.initialLoad=!1,this.unreadCount=this.root.find(k.COUNT_CONTAINER).html()};return l.prototype=Object.create(h.prototype),l.prototype.constructor=l,l.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?d.get_string("hidenotificationwindow","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):this.unreadCount?d.get_string("shownotificationwindowwithcount","message",this.unreadCount).done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this)):d.get_string("shownotificationwindownonew","message").done(function(a){this.menuToggle.attr("aria-label",a)}.bind(this))},l.prototype.getContent=function(){return this.container},l.prototype.getOffset=function(){return this.offset},l.prototype.incrementOffset=function(){this.offset+=this.limit},l.prototype.hasDoneInitialLoad=function(){return this.initialLoad},l.prototype.hasLoadedAllContent=function(){return this.loadedAll},l.prototype.setLoadedAllContent=function(a){this.loadedAll=a},l.prototype.renderUnreadCount=function(){var a=this.root.find(k.COUNT_CONTAINER);this.unreadCount?(a.text(this.unreadCount),a.removeClass("hidden")):a.addClass("hidden")},l.prototype.hideUnreadCount=function(){this.root.find(k.COUNT_CONTAINER).addClass("hidden")},l.prototype.getNotificationElement=function(a){var b=this.root.find(k.NOTIFICATION+'[data-id="'+a+'"]');return 1==b.length?b:null},l.prototype.renderNotifications=function(b,d){var f=[];return a.each(b,function(a,b){var d=this.getOffset()-this.limit;b.viewmoreurl=e.relativeUrl("/message/output/popup/notifications.php",{notificationid:b.id,offset:d});var g={notificationid:b.id};b.contexturl&&(g.redirecturl=encodeURIComponent(b.contexturl)),b.contexturl=e.relativeUrl("message/output/popup/mark_notification_read.php",g);var h=c.render("message_popup/notification_content_item",b).then(function(a,b){return{html:a,js:b}});f.push(h)}.bind(this)),a.when.apply(a,f).then(function(){a.each(arguments,function(a,b){d.append(b.html),c.runTemplateJS(b.js)})})},l.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent())return a.Deferred().resolve();this.startLoading();var b={limit:this.limit,offset:this.getOffset(),useridto:this.userId},c=this.getContent();return i.query(b).then(function(a){var b=a.notifications;return this.unreadCount=a.unreadcount,this.setLoadedAllContent(!b.length||b.length<this.limit),this.initialLoad=!0,this.updateButtonAriaLabel(),!!b.length&&(this.incrementOffset(),this.renderNotifications(b,c))}.bind(this)).always(function(){this.stopLoading()}.bind(this))},l.prototype.markAllAsRead=function(){return this.markAllReadButton.addClass("loading"),i.markAllAsRead({useridto:this.userId}).then(function(){this.unreadCount=0,this.root.find(k.UNREAD_NOTIFICATION).removeClass("unread")}.bind(this)).always(function(){this.markAllReadButton.removeClass("loading")}.bind(this))},l.prototype.registerEventListeners=function(){g.define(this.root,[g.events.activate]),this.root.on(g.events.activate,k.MARK_ALL_READ_BUTTON,function(a,b){this.markAllAsRead(),a.stopPropagation(),b.originalEvent.preventDefault()}.bind(this)),this.root.on(g.events.activate,k.NOTIFICATION_LINK,function(b){var c=a(b.target).closest(k.NOTIFICATION);c.hasClass("unread")&&(this.unreadCount--,c.removeClass("unread")),b.stopPropagation()}.bind(this)),this.root.on(this.events().menuOpened,function(){this.hideUnreadCount(),this.updateButtonAriaLabel(),this.hasDoneInitialLoad()||this.loadMoreNotifications()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.renderUnreadCount(),this.updateButtonAriaLabel()}.bind(this)),this.root.on(this.events().startLoading,function(){this.getContent().attr("aria-busy","true")}.bind(this)),this.root.on(this.events().stopLoading,function(){this.getContent().attr("aria-busy","false")}.bind(this)),this.getContentContainer().on(g.events.scrollBottom,function(){this.isLoading||this.hasLoadedAllContent()||this.loadMoreNotifications()}.bind(this)),g.define(this.getContentContainer(),[g.events.scrollLock]),a(document).on(j.notificationShown,function(a,b){if(!b.read){var c=this.getNotificationElement(b.id);c&&c.removeClass("unread"),this.unreadCount--,this.renderUnreadCount()}}.bind(this))},l});
define('message_popup/notification_repository', ["core/ajax","core/notification"],function(a,b){var c=function(c){"undefined"==typeof c.limit&&(c.limit=20),"undefined"==typeof c.offset&&(c.offset=0);var d={methodname:"message_popup_get_popup_notifications",args:c},e=a.call([d])[0];return e.fail(b.exception),e},d=function(c){var d={methodname:"message_popup_get_unread_popup_notification_count",args:c},e=a.call([d])[0];return e.fail(b.exception),e},e=function(c){var d={methodname:"core_message_mark_all_notifications_as_read",args:c},e=a.call([d])[0];return e.fail(b.exception),e},f=function(c,d){var e={notificationid:c};d&&(e.timeread=d);var f={methodname:"core_message_mark_notification_read",args:e},g=a.call([f])[0];return g.fail(b.exception),g};return{query:c,countUnread:d,markAllAsRead:e,markAsRead:f}});
define('block_currentmodules/status', ["jquery","core/ajax","local_loadingstatus/loading"],function(a,b,c){var d={LAST_MODIFIED_RECENT:172800,currentTab:[],init:function(b){b?d.currentTab=b.split(";"):a(".block_currentmodules-tabs button").each(function(){if(a(this).attr("id").indexOf("recent")>-1)d.currentTab.push(a(this).attr("id").substring(25));else{var b=a(this).attr("id").substring(25),c=b.split("-").pop();d.currentTab.indexOf("recent-"+c)===-1&&d.currentTab.push(b)}}),a(".block_currentmodules").length&&d.requestStatus(),a(".block_currentmodules-tabs").on("click",".block_currentmodules-tab button",d.switchTab),a(".block_currentmodules, .block_viewstudyweek-current-week").on("click",".cmheadingbox",function(b){var c=a(b.target).closest(".cm-miniheader").find(".currentmodules-websitelink > a");a(c).get(0).click()}),a(".block_currentmodules .osep-hideblock").click(function(){var b=a(this).parents("h4.currentmodules-subheader");b.find(".osep-showblock > .title-unread").length&&b.addClass("block-unread-hidden")}),a(".block_currentmodules .osep-showblock").click(function(){a(this).parents("h4.currentmodules-subheader").removeClass("block-unread-hidden")})},switchTab:function(a){a.preventDefault(),d.selectTab(a.currentTarget.id.substring(25))},selectTab:function(a){var b=a,c=d.currentTab.indexOf(a)>-1;if(!c){d.currentTab.forEach(function(c){var d=a.split("-"),e=c.split("-");d[1]===e[1]&&(b=c)}),d.changeClassforTab(b,a);var e=d.currentTab.indexOf(b);e>-1&&d.currentTab.splice(e,1),d.currentTab.push(a);var f="";d.currentTab.forEach(function(a,b){f+=b==d.currentTab.length-1?a:a+";"}),M.util.set_user_preference("block_currentmodules_active_tab",f)}},requestStatus:function(){var a="block_currentmodules_status";c.start(a,M.util.get_string("loading_started","block_currentmodules")),M.util.js_pending("block_currentmodules_status"),b.call([{methodname:"block_currentmodules_get_status",args:{},done:function(b){M.util.js_complete("block_currentmodules_status"),c.finish(a),d.gotStatus(b)},fail:function(){M.util.js_complete("block_currentmodules_status"),c.error(a,M.util.get_string("loading_error","block_currentmodules"))}}])},gotStatus:function(b){for(var c=0;c<b.length;c++){var e=b[c],f=a('.block_currentmodules-content li[data-activitycmid="'+e.id+'"]'),g=a('.block_currentmodules-content-recent li[data-activitycmid="'+e.id+'"]');if("ok"===e.state){if(e.unread===!0){f.addClass("currentmodules-activities-unread"),g.addClass("currentmodules-activities-unread");var h=M.util.get_string("unread","block_currentmodules"),i='<img src="'+M.util.image_url("unread","block_currentmodules")+'" alt="'+h+'" title="'+h+'" class="osep-link-infoicon"/>',j=a(i),k=a(i);f.find("a").append(j),g.find("a").append(k);var l=a(f[0]).parents(".osep-showhideblock").prev().find(".osep-showhidecontrols > .osep-showblock");if(!l.find(".title-unread").length){var m=a('<img src="'+M.util.image_url("unread_white","theme_osep")+'" alt="'+h+'" title="'+h+'" class="title-unread"/>');l.prepend(m),"none"!==m.parent().css("display")&&f.parent().prev().addClass("block-unread-hidden")}}else""!==e.lastmodified&&(e.lastmodifiedage<d.LAST_MODIFIED_RECENT&&(f.addClass("currentmodules-activities-recent"),g.addClass("currentmodules-activities-recent")),f.find(".osep-link-info").append(e.lastmodified),g.find(".osep-link-info").append(e.lastmodified));""===e.lastmodified&&e.unread===!1&&g.remove()}else{var n=M.util.get_string("error","block_currentmodules"),o='<img src="'+M.util.image_url("error","block_currentmodules")+'" alt="'+n+'" title="'+n+'" class="currentmodules-error"/>',p=a(o),q=a(o);f.find("a").append(p),g.find("a").append(q)}}d.currentTab.forEach(function(b){var c="",e=b.replace("recent","viewall");c=b.indexOf("recent")>-1?e:b.replace("viewall","recent");var f=b;a("#block_currentmodules-h3-"+c).parent().parent().find(".osep-links li").length<=0&&(a("#block_currentmodules-tab-"+c).parent().addClass("disabled"),a("#block_currentmodules-tab-"+c).attr("tabindex",-1)),a("#block_currentmodules-h3-"+b).parent().parent().find(".osep-links li").length<=0&&(a("#block_currentmodules-tab-"+b).parent().addClass("disabled"),a("#block_currentmodules-tab-"+b).attr("tabindex",-1),b=e,c=f),d.changeClassforTab(c,b)})},changeClassforTab:function(b,c){a("#block_currentmodules-tab-"+b).parent().removeClass("block_currentmodules-activetab"),a("#block_currentmodules-h3-"+b).parent().parent().removeClass("block_currentmodules-active").attr("aria-hidden","true"),a("#block_currentmodules-tab-"+b).removeAttr("disabled"),a("#block_currentmodules-tab-"+c).parent().addClass("block_currentmodules-activetab"),a("#block_currentmodules-tab-"+c).attr("disabled",1);var d=a("#block_currentmodules-h3-"+c);d.parent().parent().addClass("block_currentmodules-active").attr("aria-hidden","false")}};return d});
define('block_currentmodules/tutorials', ["jquery","core/templates","core/ajax","local_loadingstatus/loading"],function(a,b,c,d){var e={isPrison:null,init:function(b){this.isPrison=b||!1;var c="";a("div.currentmodules-websitelink a").each(function(b,d){var e=a(d).attr("href");c+=e.substring(e.lastIndexOf("id=")+3)+","}),""!=c&&(c=c.slice(0,-1),b||e.requestTutorials(c),a(".block_currentmodules .currentmodules-pendingajax").length&&e.requestManageTutorialsButtons(c))},requestTutorials:function(a){var b="block_currentmodules_tutorial";d.start(b,M.util.get_string("tutorials_loading_started","block_currentmodules")),M.util.js_pending("block_currentmodules_getevents"),c.call([{methodname:"block_currentmodules_get_next_tutorial_for_each_module",args:{courseids:a},done:function(a){M.util.js_complete("block_currentmodules_getevents"),a.warningtext?d.error(b,a.warningtext):d.finish(b),e.gotTutorial(a.events)},fail:function(){M.util.js_complete("block_currentmodules_getevents"),d.error(b,M.util.get_string("tutorials_loading_error","block_currentmodules"))}}])},gotTutorial:function(b){a("li.currentmodules-tutorial").each(function(){for(var c=0;c<b.length;c++){var d=a(this);if(a(this).data("id")==b[c].id)if("no_tutorials"==b[c].mode)var f={mode:b[c].mode,no_tutorials:!0};else{if("failed"!=b[c].mode){var g=a(this).parent().parent().children("div").children("div.cmtopimage").children("div").children("a"),h=g.attr("href"),i=h+"&area=tutorials",f={areahref:i,name:b[c].name,start:b[c].start,matches:!0,mode:b[c].mode,cancelled:b[c].cancelled};return e.displayNextTutorialHTML(f,d),!0}var f={mode:b[c].mode,failed:!0}}if(c==b.length-1)if(f&&f.mode&&"failed"!=b[c].mode&&"no_tutorials"!=b[c].mode){var f={no_matches:!0,unmatched:!0};e.displayNextTutorialHTML(f,d)}else if("failed"==b[c].mode){var f={no_matches:!0,failed:!0};e.displayNextTutorialHTML(f,d)}else{if(f)f.no_matches=!0;else var f={no_matches:!0,unmatched:!0};e.displayNextTutorialHTML(f,d)}}})},displayNextTutorialHTML:function(a,c){b.render("block_currentmodules/tutorials",a).done(function(a){c.append(a)})},requestManageTutorialsButtons:function(a){var b="block_currentmodules_managetutorials";d.start(b,M.util.get_string("managetutorials_loading_started","block_currentmodules")),M.util.js_pending(b),c.call([{methodname:"block_currentmodules_get_manage_tutorials_url_and_exam_info",args:{courseids:a},done:function(a){M.util.js_complete(b),d.finish(b),e.gotManageTutorialsAndExamInfo(a)},fail:function(){M.util.js_complete(b),d.error(b,M.util.get_string("managetutorials_loading_error","block_currentmodules"))}}])},gotManageTutorialsAndExamInfo:function(b){for(var c,d,f=0;f<b.length;f++)b[f].id&&(b[f].managetutorialsurl&&(c=a(".currentmodules-managetutorials a[data-id="+b[f].id+"]"),c.attr("href",b[f].managetutorialsurl),d=c.closest("li.currentmodules-managetutorials"),d.removeClass("currentmodules-pendingajax")),b[f].nextassessment&&(d=a("li.currentmodules-assessment[data-id="+b[f].id+"]"),b[f].isPrison=e.isPrison,d.length?e.displayNextAssessmentHTML(b[f],d,"replaceWith"):(d=a("li.currentmodules-tutorial[data-id="+b[f].id+"]"),e.displayNextAssessmentHTML(b[f],d,"before"))))},displayNextAssessmentHTML:function(a,c,d){b.render("block_currentmodules/assessment",a).done(function(a){c[d](a)})}};return e});
define('block_currentmodules/customise', ["jquery","theme_osep/drag_reorder"],function(a,b){var c={init:function(){new b({list:".block_currentmodules .content",item:"li[data-id-course]",handle:".modulesboxes-movelink",proxyHtml:'<div id="ousubject-leftupper" class="osep-dragproxy"><div class="ousubject-yourmodules ousubject-editmode"><div class="block_currentmodules"><ul><li class="currentmodules">%%ITEM_HTML%%</li></ul></div></div></div>',itemMovingClass:"osep-itemmoving",idGetter:function(b){return a(b).data("id-course")},nameGetter:function(b){return a(b).find(".cmfullname > h3").text().trim()},reorderDone:c.itemMoved})},itemMoved:function(a,b,c){var d=c.join();M.util.set_user_preference("format_ousubject_reoder_moduleboxes",d),M.util.reordered_your_modules=1}};return c});
define('block_dashboardboxes/status', ["jquery","core/ajax","local_loadingstatus/loading"],function(a,b,c){var d={LAST_MODIFIED_RECENT:172800,init:function(){var b=a("ul.dashboardboxes-boxes"),c={};b.find('li[data-providerstatus="y"]').each(function(){var b=a(this).data("provider");void 0===c[b]&&(c[b]={provider:b,boxTitles:[]}),c[b].boxTitles.push(a(this).find("> h3 > a > span").text())});for(var e in c)d.requestStatus(b,c[e].provider,d.createName(c[e].boxTitles));b.find(".osep-hideblock").click(function(){if(a(this).parent().data("locked"))return!1;var b=a(this).parents("h3");0!==b.find(".osep-showblock > .title-unread").length&&b.addClass("block-unread-hidden")}),b.find(".osep-hideblock").on("keydown",function(b){13===b.which&&a(this).trigger("click")}),b.find(".osep-showblock").click(function(){return!a(this).parent().data("locked")&&void a(this).parents("h3").removeClass("block-unread-hidden")}),b.find(".osep-showblock").on("keydown",function(b){13===b.which&&a(this).trigger("click")})},createName:function(a){switch(a.length){case 1:return a[0];case 2:return a[0]+", "+a[1];default:return a[0]+", "+a[1]+", …"}},requestStatus:function(a,e,f){var g="block_dashboardboxes_status_"+e;c.start(g,M.util.get_string("loading_started","block_dashboardboxes",f)),b.call([{methodname:"block_dashboardboxes_get_status",args:{provider:e},done:function(b){c.finish(g),d.gotStatus(a,b)},fail:function(){c.error(g,M.util.get_string("loading_error","block_dashboardboxes"))}}])},gotStatus:function(b,c){for(var e=0;e<c.length;e++){var f=c[e],g=b.find('.osep-links > li[data-itemid="'+f.id+'"]');if("deleted"!==f.state)if("ok"===f.state)switch(g.data("statustype")){case"unread":if(f.unread){g.addClass("dashboardboxes-unread");var h=M.util.get_string("unread","block_dashboardboxes"),i='<img src="'+M.util.image_url("unread","block_dashboardboxes");i+='" alt="'+h+'" title="'+h,i+='" class="osep-link-infoicon"/>';var j=a(i);if(g.find("a.dashboardboxes-nonedit").append(j),!g.parent().prev().find(".osep-showblock").find(".title-unread").length){var k='<img src="'+M.util.image_url("unread_white","theme_osep");k+='" alt="'+h+'" title="'+h,k+='" class="title-unread"/>';var l=a(k);g.parent().prev().find(".osep-showblock").prepend(l),"none"!==l.parent().css("display")&&g.parent().prev().addClass("block-unread-hidden")}}break;case"lastmodified":if(""!==f.lastmodified){var m=g.find(".osep-link-info");m.html(f.lastmodified),f.lastmodifiedage<d.LAST_MODIFIED_RECENT&&g.addClass("dashboardboxes-recent")}break;default:throw"Unsupported status type"}else{var n=M.util.get_string("error","block_dashboardboxes"),o='<img src="'+M.util.image_url("error","block_dashboardboxes");o+='" alt="'+n+'" title="'+n,o+='" class="dashboardboxes-error"/>';var p=a(o);g.find("a").append(p)}else 1===g.closest("ul").children().length?g.closest("ul.dashboardboxes-boxes > li").remove():g.remove()}}};return d});
define('block_dashboardboxes/customise', ["jquery","core/yui","core/ajax","local_loadingstatus/loading","format_ousubject/editmode","core/modal_factory","core/modal_events","core/templates","theme_osep/drag_reorder"],function(a,b,c,d,e,f,g,h,i){var j={docurl:null,boxMoveStartingColumn:null,init:function(b){j.docurl=b;var c=a("ul.dashboardboxes-boxes");c.on("click",".dashboardboxes-deleteitem",j.deleteItem),new i({list:".block_dashboardboxes .content",item:"li[data-boxid], li.dashboardboxes-empty-column-marker:only-of-type",handle:" > h3 .dashboardboxes-movebox",proxyHtml:'<div class="osep-dragproxy ousubject-editmode"><ul class="dashboardboxes-boxes"><li class="%%ITEM_CLASS_NAME%%">%%ITEM_HTML%%</li></ul></div>',itemMovingClass:"osep-itemmoving",idGetter:function(b){var c=a(b);return c.hasClass("dashboardboxes-empty-column-marker")?c.closest("[data-column]").data("column")+"/0":c.closest("[data-column]").data("column")+"/"+c.data("boxid")},nameGetter:function(b){var c=a(b);return c.hasClass("dashboardboxes-empty-column-marker")?M.util.get_string("columnx","block_dashboardboxes",c.closest("[data-column]").data("column")):c.find(" > h3 > .dashboardboxes-editing > span").text().trim()},reorderStart:j.boxMoveStart,reorderDone:j.boxMoved}),new i({list:"ul.dashboardboxes-boxes li.dashboardboxes-dashboard-box ul.osep-links",item:" > li:not(:only-of-type)",handle:" a.dashboardboxes-moveitem, .dashboardboxes-editing > span",proxyHtml:'<div class="osep-dragproxy ousubject-editmode dashboardboxes-dragitem"><ul class="dashboardboxes-boxes"><li><ul class="osep-links"><li>%%ITEM_HTML%%</li></ul></li></ul></div>',itemMovingClass:"osep-itemmoving",idGetter:function(b){return a(b).data("itemid")},nameGetter:function(b){return a(b).find(" .dashboardboxes-editing > span").text()},reorderStart:j.itemMoveStart,reorderEnd:j.itemMoveEnd,reorderDone:j.itemMoved})},deleteItem:function(b){var c=a(b.currentTarget).closest("li");b.preventDefault();var d=c.find("a.dashboardboxes-nonedit span").text().trim();f.create({type:f.types.SAVE_CANCEL,title:M.util.get_string("removeconfirmtitle","block_dashboardboxes",d),body:M.util.get_string("removeconfirmmessage","block_dashboardboxes",d)}).done(function(a){a.getRoot().on(g.yes,c,j.deleteItemConfirmed),a.show()})["catch"](Notification.exception)},deleteItemConfirmed:function(b){var e=b.data,f="block_dashboardboxes_delete_item_"+e.data("itemid");d.start(f,M.util.get_string("removingitem","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_delete_favourite",args:{itemid:e.data("itemid")},done:function(){var b=!0,c=e.closest("ul");if(e.remove(),0===c.children().length&&(c.closest("li").remove(),0===a("li.dashboardboxes-dashboard-box").length)){b=!1;var g="<a href="+j.docurl+">"+M.util.get_string("computingguide","block_dashboardboxes")+"</a>";h.render("block_dashboardboxes/noboxes",{cglink:g}).then(function(b,c){h.appendNodeContents(a('.dashboardboxes-column[data-column="2"]'),b,c),d.finish(f)})}b&&d.finish(f)},fail:function(){d.error(f,M.util.get_string("remove_error","block_dashboardboxes"))}}])},boxMoveStart:function(a,b){j.boxMoveStartingColumn=b.closest("[data-column]").data("column")},boxMoved:function(a,b,e){var f="block_dashboardboxes_reorder_boxes";d.start(f,M.util.get_string("reorderboxes","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_reorder_boxes",args:{boxid:b.data("boxid"),oldcolumn:j.boxMoveStartingColumn,newcolumn:b.closest("[data-column]").data("column"),neworder:e.join(",")},done:function(){d.finish(f);var a=b.siblings(".dashboardboxes-empty-column-marker");a.detach(),b.parent().append(a)},fail:function(){d.error(f,M.util.get_string("reorderboxes_error","block_dashboardboxes"))}}])},itemMoveStart:function(b,c){var d=c.closest("ul.dashboardboxes-boxes > li").data("boxid");a('ul.dashboardboxes-boxes > li:not([data-boxid="'+d+'"])').addClass("dashboardboxes-invalidtarget")},itemMoveEnd:function(){a("ul.dashboardboxes-boxes > li").removeClass("dashboardboxes-invalidtarget")},itemMoved:function(a,b,e){var f=a.closest("ul.dashboardboxes-boxes > li").data("boxid"),g="block_dashboardboxes_reorder_items_"+f;d.start(g,M.util.get_string("reorderitems","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_reorder_items",args:{boxid:f,neworder:e.join(",")},done:function(){d.finish(g)},fail:function(){d.error(g,M.util.get_string("reorderitems_error","block_dashboardboxes"))}}])}};return j});
define('block_dashboardboxes/editing', ["jquery","core/templates","core/ajax","local_loadingstatus/loading","theme_osep/drag_reorder","core/modal_factory","core/modal_events","format_ousubject/editmode"],function(a,b,c,d,e,f,g,h){var i={checker:{},linkeditor:"",templinkeditorcontent:"",linkMoveStartingBoxId:null,isPrison:null,init:function(b){this.isPrison=b||!1;var c=a(".block_dashboardboxes .content");c.on("click","ul > li:not(:only-of-type) > h3.dashboardboxes-empty a.dashboardboxes-deletebox",i.deleteBox),c.on("click",".dashboardboxes-addnewbox",i.storeAndDisplayBox),c.on("click",".dashboardboxes-addnewlink, .dashboardboxes-canceladd",i.showOrHideAddLinkForm),c.on("click",".dashboardboxes-createlink",i.createNewLink),c.on("click",".dashboardboxes-editlink",i.showLinkEditing),c.on("click",".dashboardboxes-savelink",i.storeAndDisplayEditedLink),c.on("click",".dashboardboxes-canceledit",i.removeLinkEditing),c.on("click",".dashboardboxes-deletelink",i.deleteLink),c.on("blur",'input[name="linkurl"]',i.checkLinkUrl),c.on("blur input",'input[name="linktitle"]',i.checkLinkTitle),new e({list:"body:not(.dashboardboxes-toofewuserlinkstomove) .block_dashboardboxes .content",item:"li[data-linkid], li.dashboardboxes-empty-message:only-of-type",handle:".dashboardboxes-movelink",proxyHtml:'<div class="osep-dragproxy ousubject-editmode"><ul class="dashboardboxes-boxes"><li><ul class="osep-links"><li>%%ITEM_HTML%%</li></ul></li></ul></div>',itemMovingClass:"osep-itemmoving",idGetter:function(b){var c=a(b);return c.hasClass("dashboardboxes-empty-message")?c.closest("li[data-boxid]").data("boxid")+"/0":c.closest("li[data-boxid]").data("boxid")+"/"+c.data("linkid")},nameGetter:function(b){var c=a(b);return c.hasClass("dashboardboxes-empty-message")?c.closest("li[data-boxid]").find(" > h3 > .dashboardboxes-editing .quickeditlink").text().trim():c.find(" > .dashboardboxes-editing > span").text().trim()},reorderStart:i.linkMoveStart,reorderEnd:i.linkMoveEnd,reorderDone:i.linkMoved}),i.setupChecker(),i.checkOveralCounts(),c.on("updated","[data-inplaceeditable]",function(a){var b=c.find('li[data-boxid="'+a.ajaxreturn.itemid+'"] span.dashboardboxes-nonedit'),d=b.find("> img");d.detach(),b.html(a.ajaxreturn.displayvalue),b.prepend(d)}),h.requestNotification(function(a){a||i.closeOpenEditors()})},closeOpenEditors:function(){i.linkeditor&&(i.clearAddNewLinkForm(i.linkeditor),a(".dashboardboxes-addlink .dashboardboxes-form:visible").length>0&&i.toggleAddNewLinkForm(i.linkeditor),i.linkeditor=""),i.templinkeditorcontent&&i.removeLinkEditing()},createNewLink:function(b){b.preventDefault();var c=a(b.currentTarget).closest("li[data-boxid]"),d=c.data("boxid");i.storeAndDisplayLink({boxid:d,url:c.find(".dashboardboxes-linkurl input").val().trim(),title:c.find(".dashboardboxes-linktitle input").val().trim()}),i.clearAddNewLinkForm(d),i.toggleAddNewLinkForm(d),i.linkeditor=""},showOrHideAddLinkForm:function(b){if(b.preventDefault(),a(".aliasbar-enabled").length>0)return void h.showAliasMessage();var c=a(b.currentTarget).closest("li[data-boxid]");i.linkeditor!==c.data("boxid")&&i.closeOpenEditors(),i.clearAddNewLinkForm(c.data("boxid")),i.toggleAddNewLinkForm(c.data("boxid")),i.linkeditor=c.data("boxid")},toggleAddNewLinkForm:function(b){var c=a('li[data-boxid="'+b+'"] .dashboardboxes-form');c.slideToggle(500),a('li[data-boxid="'+b+'"] .dashboardboxes-addnewlink').slideToggle(500)},clearAddNewLinkForm:function(b){var c=a('li[data-boxid="'+b+'"] .dashboardboxes-form');c.find("input").each(function(){a(this).val("")}),c.find(".dashboardboxes-linkurl-notice").html(""),c.find(".dashboardboxes-linktitle-notice").html(""),c.find(".dashboardboxes-linkurl-warning").addClass("hidden"),c.find(".dashboardboxes-linktitle-warning").addClass("hidden"),c.find(".dashboardboxes-createlink").attr("disabled","disabled")},linkWarning:function(a,b,c){a.find(".dashboardboxes-"+b+"-notice").html(c),c?a.find(".dashboardboxes-"+b).addClass("dashboardboxes-problem"):a.find(".dashboardboxes-"+b).removeClass("dashboardboxes-problem")},setupChecker:function(){a("ul.dashboardboxes-boxes > li").each(function(){var b=a(this).data("boxid");i.checker[b]={url:!1,title:!1}})},updateCreateLink:function(a){var b=a.find(".dashboardboxes-createlink, .dashboardboxes-savelink");i.checker[a.data("boxid")].url&&i.checker[a.data("boxid")].title?b.removeAttr("disabled"):b.attr("disabled","disabled")},checkLinkUrl:function(b){var d=a(b.currentTarget).closest("li[data-boxid]"),e=a(this).val().trim();if(i.checker[d.data("boxid")].url=!1,i.updateCreateLink(d),""===e)return void i.linkWarning(d,"linkurl",M.util.get_string("warningaddurl","block_dashboardboxes"));var f;if(this.isPrison){if(f=new RegExp(M.cfg.wwwroot),!f.test(e))return void i.linkWarning(d,"linkurl",M.util.get_string("warningaddhttp_prison","block_dashboardboxes",M.cfg.wwwroot))}else if(f=new RegExp("(http|ftp|https)://"),!f.test(e))return void i.linkWarning(d,"linkurl",M.util.get_string("warningaddhttp","block_dashboardboxes"));c.call([{methodname:"block_dashboardboxes_validate_url",args:{url:e},done:function(a){"invalid_wrongdomain"===a.state?(i.checker[d.data("boxid")].url=!1,i.linkWarning(d,"linkurl",M.util.get_string("warningaddhttp_prison","block_dashboardboxes",M.cfg.wwwroot))):"invalid_unclean"===a.state?(i.checker[d.data("boxid")].url=!1,i.linkWarning(d,"linkurl",M.util.get_string("warningurlnotvalid","block_dashboardboxes"))):(i.checker[d.data("boxid")].url=!0,i.updateCreateLink(d),"valid"===a.state?i.linkWarning(d,"linkurl",""):i.linkWarning(d,"linkurl",M.util.get_string("warningurlnotconfirmed","block_dashboardboxes")))},fail:function(a){console.log("validateurl failure: "+a)}}])},checkLinkTitle:function(b){var c=a(b.currentTarget).closest("li[data-boxid]"),d=a(this).val().trim();""===d?(i.checker[c.data("boxid")].title=!1,i.linkWarning(c,"linktitle",M.util.get_string("warningaddtitle","block_dashboardboxes"))):(i.checker[c.data("boxid")].title=!0,i.updateCreateLink(c),i.linkWarning(c,"linktitle","")),i.updateCreateLink(c)},storeAndDisplayLink:function(a){var b="block_dashboardboxes_adding_link";d.start(b,M.util.get_string("savinglink","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_add_link",args:a,done:function(c){i.displayNewLink(b,a.boxid,c,a.url,a.title)},fail:function(){d.error(b,M.util.get_string("savinglink_error","block_dashboardboxes"))}}])},displayNewLink:function(c,e,f,g,h){b.render("block_dashboardboxes/userlink",{id:f,link:g,title:h}).done(function(f,g){var h=a('li[data-boxid="'+e+'"]'),j=h.find("ul.osep-links");b.appendNodeContents(j,f,g),j.append(j.find(".dashboardboxes-empty-message")),h.find("h3").removeClass("dashboardboxes-empty"),i.checkOveralCounts(),d.finish(c)})},checkOveralCounts:function(){a("li.dashboardboxes-userlink-box li[data-linkid], li.dashboardboxes-userlink-box li.dashboardboxes-empty-message:only-of-type").length<2?a("body").addClass("dashboardboxes-toofewuserlinkstomove"):a("body").removeClass("dashboardboxes-toofewuserlinkstomove"),1===a("ul.dashboardboxes-boxes li.dashboardboxes-userlink-box").length?a("body").addClass("dashboardboxes-onlyoneuserlinkbox"):a("body").removeClass("dashboardboxes-onlyoneuserlinkbox")},storeAndDisplayBox:function(a){a.preventDefault();var b="block_dashboardboxes_adding_box";d.start(b,M.util.get_string("addingbox","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_add_box",args:{},done:function(a){i.displayNewBox(b,a.boxid,a.showhide,a.title,a.plaintitle,a.boxcolumn)},fail:function(){d.error(b,M.util.get_string("addingbox_error","block_dashboardboxes"))}}])},displayNewBox:function(a,c,e,f,g,h){i.checker[c]={url:!1,title:!1},b.render("block_dashboardboxes/userlinkbox",{id:c,userlinksbox:1,showhide:e,boxtitle:f,plainboxtitle:g,disabled:"disabled"}).done(function(c,e){b.appendNodeContents('.dashboardboxes-column[data-column="'+h+'"] ul.dashboardboxes-boxes',c,e),i.checkOveralCounts(),d.finish(a)})},showLinkEditing:function(c){c.preventDefault(),i.closeOpenEditors();var d=a(c.currentTarget).closest("li[data-linkid]"),e=d.closest("li[data-boxid]").data("boxid");b.render("block_dashboardboxes/editlink",{linkid:d.data("linkid"),linktitle:d.find(".dashboardboxes-editing > span").text().trim(),url:d.find("a.dashboardboxes-nonedit").attr("href")}).done(function(a,c){i.checker[e]={url:!0,title:!0},d.slideUp(50),i.templinkeditorcontent=d.html(),b.replaceNodeContents(d,a,c),d.slideDown(400)})},storeAndDisplayEditedLink:function(e){e.preventDefault();var f=a(e.currentTarget).closest("li[data-linkid]"),g=f.closest("li[data-boxid]"),h="block_dashboardboxes_save_link_"+f.data("linkid");d.start(h,M.util.get_string("savinglink","block_dashboardboxes"));var j={boxid:g.data("boxid"),linkid:f.data("linkid"),url:f.find('input[name="linkurl"]').val().trim(),linktitle:f.find('input[name="linktitle"]').val().trim()};c.call([{methodname:"block_dashboardboxes_edit_link",args:j,done:function(){i.removeLinkEditing(),b.render("block_dashboardboxes/userlink",{id:f.data("linkid"),link:j.url,title:j.linktitle}).done(function(a,c){b.replaceNode(f,a,c),d.finish(h)})},fail:function(){d.error(h,M.util.get_string("savinglink_error","block_dashboardboxes"))}}])},removeLinkEditing:function(b){"undefined"!=typeof b&&b.preventDefault();var c=a(".dashboardboxes-editlinkform").closest("li");c.slideUp(400),c.html(i.templinkeditorcontent),i.templinkeditorcontent="",c.slideDown(50)},deleteLink:function(b){var c=a(b.currentTarget).closest("li[data-linkid]");b.preventDefault();var d=i.escapeHTML(c.find("a.dashboardboxes-nonedit span").text().trim());f.create({type:f.types.SAVE_CANCEL,title:M.util.get_string("deleteconfirmtitle","block_dashboardboxes",d),body:M.util.get_string("deleteconfirmmessage","block_dashboardboxes",d)}).done(function(a){a.getRoot().on(g.yes,c,i.deleteLinkConfirmed),a.show()})["catch"](Notification.exception)},deleteLinkConfirmed:function(a){var b=a.data,e=b.closest("li[data-boxid]"),f="block_dashboardboxes_delete_link_"+b.data("linkid");d.start(f,M.util.get_string("deletingitem","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_delete_link",args:{boxid:e.data("boxid"),linkid:b.data("linkid")},done:function(){b.remove(),i.checkOveralCounts(),0===e.find("li[data-linkid]").length&&e.find("h3").addClass("dashboardboxes-empty"),d.finish(f)},fail:function(){d.error(f,M.util.get_string("savinglink_error","block_dashboardboxes"))}}])},deleteBox:function(b){b.preventDefault();var e=a(b.currentTarget).closest("li");if(!(e.find("li[data-linkid]").length>0)){var f="block_dashboardboxes_delete_box_"+e.data("boxid");d.start(f,M.util.get_string("deletingbox","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_delete_box",args:{boxid:e.data("boxid")},done:function(){e.remove(),i.checkOveralCounts(),d.finish(f)},fail:function(){d.error(f,M.util.get_string("deletingbox_error","block_dashboardboxes"))}}])}},linkMoveStart:function(b,c){i.linkMoveStartingBoxId=c.closest("li[data-boxid]").data("boxid"),a("ul.dashboardboxes-boxes > li:not(.dashboardboxes-userlink-box)").addClass("dashboardboxes-invalidtarget")},linkMoveEnd:function(b,c){a("ul.dashboardboxes-boxes > li").removeClass("dashboardboxes-invalidtarget")},linkMoved:function(b,e,f){var g="block_dashboardboxes_reorder_links";d.start(g,M.util.get_string("reorderlinks","block_dashboardboxes")),c.call([{methodname:"block_dashboardboxes_reorder_links",args:{linkid:e.data("linkid"),oldboxid:i.linkMoveStartingBoxId,newboxid:e.closest("li[data-boxid]").data("boxid"),neworder:f.join(",")},done:function(){d.finish(g);var b=e.siblings(".dashboardboxes-empty-message");b.detach(),e.parent().append(b),e.closest("li[data-boxid]").find("h3").removeClass("dashboardboxes-empty");var c=a('li[data-boxid="'+i.linkMoveStartingBoxId+'"]');0===c.find("li[data-linkid]").length&&c.find("h3").addClass("dashboardboxes-empty")},fail:function(){d.error(g,M.util.get_string("reorderlinks_error","block_dashboardboxes"))}}])},escapeHTML:function(b){return a("<div />").text(b).html()}};return i});
define('block_inactivemodules/tabs', ["jquery","core/ajax","local_loadingstatus/loading","core/templates"],function(a,b,c,d){var e={currentTab:null,init:function(){e.currentTab=a(".block_inactivemodules-activetab a").attr("id").substring(26),a(".block_inactivemodules-tabs").on("click",".block_inactivemodules-tab a",e.switchTab),c.start("block_inactivemodules_load",M.util.get_string("pluginname","block_inactivemodules")),b.call([{methodname:"block_inactivemodules_get_modules",args:{},done:function(a){c.finish("block_inactivemodules_load"),e.gotModuleLists(a)},fail:function(){c.error("block_inactivemodules_load",M.util.get_string("loading_error","block_inactivemodules")),e.showLoadingFailedMessage()}}])},switchTab:function(a){a.preventDefault(),e.selectTab(a.currentTarget.id.substring(26),!0)},selectTab:function(b,c){if(b!==e.currentTab){a("#block_inactivemodules-tab-"+e.currentTab).parent().removeClass("block_inactivemodules-activetab"),a("#block_inactivemodules-h3-"+e.currentTab).parent().parent().removeClass("block_inactivemodules-active").attr("aria-hidden","true"),a("#block_inactivemodules-tab-"+b).parent().addClass("block_inactivemodules-activetab");var d=a("#block_inactivemodules-h3-"+b);d.parent().parent().addClass("block_inactivemodules-active").attr("aria-hidden","false"),c===!0&&d.attr("tabindex",-1).focus(),e.currentTab=b}},gotModuleLists:function(b){var c=null;a(".block_inactivemodules-content h3").each(function(e,f){var g=f.id.substring(25);b[g]&&b[g].length>0?(d.render("block_inactivemodules/modulelist",{modules:b[g]}).then(function(b,c){d.replaceNode(a("#block_inactivemodules-h3-"+g).parent().parent().find("div.loadingmessage"),b,c)}),c||(c=g)):(a("#block_inactivemodules-tab-"+g).parent().remove(),a("#block_inactivemodules-h3-"+g).parent().parent().remove())}),c?e.selectTab(c,!1):e.showMessage(M.util.get_string("nomodulesmessage","block_inactivemodules"))},showLoadingFailedMessage:function(){e.showMessage(M.util.get_string("loading_error","block_inactivemodules"))},showMessage:function(b){d.render("block_inactivemodules/nomodules",{message:b}).then(function(b,c){a(".block_inactivemodules-tabs").remove(),a(".block_inactivemodules-content").remove(),d.prependNodeContents(".block_inactivemodules .content",b,c)})}};return e});
define('block_myoverview/calendar_events_repository', ["jquery","core/ajax","core/notification"],function(a,b,c){var d=20,e=function(a){a.hasOwnProperty("limit")||(a.limit=d),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime);var e={methodname:"core_calendar_get_action_events_by_course",args:a},f=b.call([e])[0];return f.fail(c.exception),f},f=function(a){a.hasOwnProperty("limit")||(a.limit=10),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime);var d={methodname:"core_calendar_get_action_events_by_courses",args:a},e=b.call([d])[0];return e.fail(c.exception),e},g=function(a){a.hasOwnProperty("limit")||(a.limit=d),a.limitnum=a.limit,delete a.limit,a.hasOwnProperty("starttime")&&(a.timesortfrom=a.starttime,delete a.starttime),a.hasOwnProperty("endtime")&&(a.timesortto=a.endtime,delete a.endtime),a.limittononsuspendedevents=!0;var e={methodname:"core_calendar_get_action_events_by_timesort",args:a},f=b.call([e])[0];return f.fail(c.exception),f};return{queryByTime:g,queryByCourse:e,queryByCourses:f}});
define('block_myoverview/event_list', ["jquery","core/notification","core/templates","core/custom_interaction_events","block_myoverview/calendar_events_repository"],function(a,b,c,d,e){var f=86400,g={EMPTY_MESSAGE:'[data-region="empty-message"]',ROOT:'[data-region="event-list-container"]',EVENT_LIST:'[data-region="event-list"]',EVENT_LIST_CONTENT:'[data-region="event-list-content"]',EVENT_LIST_GROUP_CONTAINER:'[data-region="event-list-group-container"]',LOADING_ICON_CONTAINER:'[data-region="loading-icon-container"]',VIEW_MORE_BUTTON:'[data-action="view-more"]'},h={EVENT_LIST_ITEMS:"block_myoverview/event-list-items",COURSE_EVENT_LIST_ITEMS:"block_myoverview/course-event-list-items"},i=function(a){a.attr("data-loaded-all",!0)},j=function(a){return!!a.attr("data-loaded-all")},k=function(a){var b=a.find(g.LOADING_ICON_CONTAINER),c=a.find(g.VIEW_MORE_BUTTON);a.addClass("loading"),b.removeClass("hidden"),c.prop("disabled",!0)},l=function(a){var b=a.find(g.LOADING_ICON_CONTAINER),c=a.find(g.VIEW_MORE_BUTTON);a.removeClass("loading"),b.addClass("hidden"),j(a)?c.addClass("hidden"):c.prop("disabled",!1)},m=function(a){return a.hasClass("loading")},n=function(a){a.attr("data-has-events",!0)},o=function(a){return!!a.attr("data-has-events")},p=function(a,b){b?n(a):o(a)||q(a)},q=function(a){a.find(g.EVENT_LIST_CONTENT).addClass("hidden"),a.find(g.EMPTY_MESSAGE).removeClass("hidden")},r=function(a,b,d){return a.removeClass("hidden"),c.render(d,{events:b}).done(function(b,d){c.appendNodeContents(a.find(g.EVENT_LIST),b,d)})},s=function(a,b){var c=b.timesort||0;return c-a},t=function(a,b,c){var d=a.attr("data-midnight"),e=+c.attr("data-start-day")*f,g=+c.attr("data-end-day")*f,h=s(d,b);return""===c.attr("data-end-day")?e<=h:e<=h&&h<g},u=function(b,c){return function(d){return t(b,d,a(c))}},v=function(b,c){var d=0,e=h.EVENT_LIST_ITEMS;return b.attr("data-course-id")&&(e=h.COURSE_EVENT_LIST_ITEMS),a.when.apply(a,a.map(b.find(g.EVENT_LIST_GROUP_CONTAINER),function(f){var g=c.filter(u(b,f));return g.length?(d+=g.length,r(a(f),g,e)):null})).then(function(){return d})},w=function(c,d){c=a(c);var g=+c.attr("data-limit"),h=+c.attr("data-course-id"),j=c.attr("data-last-id"),n=c.attr("data-midnight"),o=n-14*f;if(m(c))return a.Deferred().resolve();if(k(c),"undefined"==typeof d){var q={starttime:o,limit:g};j&&(q.aftereventid=j),h?(q.courseid=h,d=e.queryByCourse(q)):d=e.queryByTime(q)}return d.then(function(a){if(!a.events.length)return i(c),0;var b=a.events;return c.attr("data-last-id",b[b.length-1].id),b.length<g&&i(c),v(c,b).then(function(a){return a<b.length&&i(c),b.length})}).then(function(a){return p(c,a)}).fail(b.exception).always(function(){l(c)})},x=function(a){d.define(a,[d.events.activate]),a.on(d.events.activate,g.VIEW_MORE_BUTTON,function(){w(a)})};return{init:function(b){b=a(b),w(b),x(b)},registerEventListeners:x,load:w,rootSelector:g.ROOT}});
define('block_myoverview/event_list_by_course', ["jquery","block_myoverview/event_list","block_myoverview/calendar_events_repository"],function(a,b,c){var d=86400,e={EVENTS_BY_COURSE_CONTAINER:'[data-region="course-events-container"]',EVENT_LIST_CONTAINER:'[data-region="event-list-container"]'},f=function(f){var g=f.find(e.EVENTS_BY_COURSE_CONTAINER);if(g.length){var h=g.find(e.EVENT_LIST_CONTAINER).first(),i=h.attr("data-midnight"),j=i-14*d,k=h.attr("data-limit"),l=g.map(function(){return a(this).attr("data-course-id")}).get(),m=c.queryByCourses({courseids:l,starttime:j,limit:k});g.each(function(c,d){d=a(d);var e=d.attr("data-course-id"),f=d.find(b.rootSelector),g=a.Deferred();m.done(function(a){var b=[],c=a.groupedbycourse.filter(function(a){return a.courseid==e});c.length&&(b=c[0].events),g.resolve({events:b})}).fail(function(a){g.reject(a)}),b.load(f,g)})}};return{init:function(b){b=a(b),f(b)}}});
define('block_myoverview/paging_bar', ["jquery","core/custom_interaction_events"],function(a,b){var c={ROOT:'[data-region="paging-bar"]',PAGE_ITEM:'[data-region="page-item"]',ACTIVE_PAGE_ITEM:'[data-region="page-item"].active'},d={PAGE_SELECTED:"block_myoverview-paging-bar-page-selected"},e=function(a,b){return a.find(c.PAGE_ITEM+'[data-page-number="'+b+'"]')},f=function(a,b){var c=b.attr("data-page-number");return"first"==c?c=1:"last"==c&&(c=a.attr("data-page-count")),c},g=function(g){g=a(g),b.define(g,[b.events.activate]),g.on(b.events.activate,c.PAGE_ITEM,function(b,h){var i=a(b.target).closest(c.PAGE_ITEM),j=g.find(c.ACTIVE_PAGE_ITEM),k=f(g,i),l=k==f(g,j);l||(g.find(c.PAGE_ITEM).removeClass("active"),e(g,k).addClass("active")),g.trigger(d.PAGE_SELECTED,[{pageNumber:k,isSamePage:l}]),h.originalEvent.preventDefault()})};return{registerEventListeners:g,events:d,rootSelector:c.ROOT}});
define('block_myoverview/paging_content', ["jquery","core/templates","block_myoverview/paging_bar"],function(a,b,c){var d={ROOT:'[data-region="paging-content"]',PAGE_REGION:'[data-region="paging-content-item"]'},e=function(b,c){this.root=a(b),this.pagingBar=a(c)};return e.rootSelector=d.ROOT,e.prototype.createPage=function(a){return this.loadContent(a).then(function(a,c){b.appendNodeContents(this.root,a,c)}.bind(this)).then(function(){return this.findPage(a)}.bind(this))},e.prototype.findPage=function(a){return this.root.find('[data-page="'+a+'"]')},e.prototype.showPage=function(a){var b=this.findPage(a);this.root.find(d.PAGE_REGION).addClass("hidden"),b.length?b.removeClass("hidden"):this.createPage(a).done(function(a){a.removeClass("hidden")})},e.prototype.registerEventListeners=function(){this.pagingBar.on(c.events.PAGE_SELECTED,function(a,b){b.isSamePage||this.showPage(b.pageNumber)}.bind(this))},e});
define('block_myoverview/tab_preferences', ["jquery","core/ajax","core/custom_interaction_events","core/notification"],function(a,b,c,d){var e=function(e){c.define(e,[c.events.activate]),e.on(c.events.activate,"[data-toggle='tab']",function(c){var e=a(c.currentTarget).data("tabname");"function"==typeof window.history.pushState&&window.history.pushState(null,null,"?myoverviewtab="+e);var f={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"block_myoverview_last_tab",value:e}]}};b.call([f])[0].fail(d.exception)})};return{registerEventListeners:e}});
define('block_navigation/ajax_response_renderer', ["jquery","core/templates","core/notification","core/url"],function(a,b,c,d){function e(g,h){var i=a("<ul></ul>");i.attr("role","group"),i.attr("aria-hidden",!0),a.each(h,function(g,h){if("object"==typeof h){var j=a("<li></li>"),k=a("<p></p>"),l=h.id||h.key+"_tree_item",m=null,n=!(!h.expandable&&!h.haschildren);k.addClass("tree_item"),k.attr("id",l),k.attr("role","treeitem"),k.attr("tabindex","-1"),h.requiresajaxloading&&(k.attr("data-requires-ajax",!0),k.attr("data-node-id",h.id),k.attr("data-node-key",h.key),k.attr("data-node-type",h.type)),n&&(j.addClass("collapsed contains_branch"),k.attr("aria-expanded",!1),k.addClass("branch"));var o=null;if(h.link){var p=a('<a title="'+h.title+'" href="'+h.link+'"></a>');o=p,p.append('<span class="item-content-wrap">'+h.name+"</span>"),h.hidden&&p.addClass("dimmed"),k.append(p)}else{var q=a("<span></span>");o=q,q.append('<span class="item-content-wrap">'+h.name+"</span>"),h.hidden&&q.addClass("dimmed"),k.append(q)}!h.icon||n&&h.type!==f.ACTIVITY&&h.type!==f.RESOURCE||(j.addClass("item_with_icon"),k.addClass("hasicon"),h.type===f.ACTIVITY||h.type===f.RESOURCE?(m=a("<img/>"),m.attr("alt",h.icon.alt),m.attr("title",h.icon.title),m.attr("src",d.imageUrl(h.icon.pix,h.icon.component)),a.each(h.icon.classes,function(a,b){m.addClass(b)}),o.prepend(m)):("moodle"==h.icon.component&&(h.icon.component="core"),b.renderPix(h.icon.pix,h.icon.component,h.icon.title).then(function(a){o.prepend(a)})["catch"](c.exception))),j.append(k),i.append(j),h.children&&h.children.length?e(k,h.children):n&&!h.requiresajaxloading&&(j.removeClass("contains_branch"),k.addClass("emptybranch"))}}),g.parent().append(i);var j=g.attr("id")+"_group";i.attr("id",j),g.attr("aria-owns",j),g.attr("role","treeitem")}var f={ACTIVITY:40,RESOURCE:50};return{render:function(a,b){if(b.children&&b.children.length){e(a,b.children);var c=a.children("[role='treeitem']").first(),d=a.find("#"+c.attr("aria-owns"));c.attr("aria-expanded",!0),d.attr("aria-hidden",!1)}else a.parent().hasClass("contains_branch")&&(a.parent().removeClass("contains_branch"),a.addClass("emptybranch"))}}});
define('block_navigation/nav_loader', ["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],function(a,b,c,d){function e(a){return a.closest("[data-block]").attr("data-instanceid")}var f=c.wwwroot+"/lib/ajax/getnavbranch.php";return{load:function(b){b=a(b);var g=a.Deferred(),h={elementid:b.attr("data-node-id"),id:b.attr("data-node-key"),type:b.attr("data-node-type"),sesskey:c.sesskey,instance:e(b)},i={type:"POST",dataType:"json",data:h};return a.ajax(f,i).done(function(a){d.render(b,a),g.resolve()}),g}}});
define('block_navigation/navblock', ["jquery","core/tree"],function(a,b){return{init:function(a){var c=new b(".block_navigation .block_tree");c.finishExpandingGroup=function(c){b.prototype.finishExpandingGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})},c.collapseGroup=function(c){b.prototype.collapseGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})}}}});
define('block_navigation/site_admin_loader', ["jquery","core/ajax","core/config","block_navigation/ajax_response_renderer"],function(a,b,c,d){var e=71,f=c.wwwroot+"/lib/ajax/getsiteadminbranch.php";return{load:function(b){b=a(b);var g=a.Deferred(),h={type:e,sesskey:c.sesskey},i={type:"POST",dataType:"json",data:h};return a.ajax(f,i).done(function(a){d.render(b,a),g.resolve()}),g}}});
define('block_news/groupings', ["jquery"],function(a){var b={groupingSelect:null,groupSelect:null,allOption:null,init:function(){b.groupingSelect=a("#id_grouping"),b.groupSelect=a("#id_groupids"),b.allOption=b.groupSelect.find('option[value="0"]'),b.groupingSelect.on("change",b.selectGroups),b.groupSelect.on("change",b.clearGroupings),a("#fitem_id_grouping").css("display","inline-block")},selectGroups:function(c){var d=a(c.currentTarget).find("option:selected"),e=b.groupingSelect.data("groupinggroups"),f=e[d.val()];b.groupSelect.val([]),f&&f.forEach(function(a){b.groupSelect.find('option[value="'+a+'"]').prop("selected",!0)}),0===b.groupSelect.find("option:selected").length?b.allOption.prop("selected",!0):b.allOption.prop("selected",!1)},clearGroupings:function(){b.allOption.prop("selected")&&b.groupSelect.val(["0"]),b.groupingSelect.val(["0"])}};return b});
define('block_settings/settingsblock', ["jquery","core/tree"],function(a,b){return{init:function(a,c){var d=new b(".block_settings .block_tree");if(c){var e=d.treeRoot.find("#"+c),f=e.children("a").first();f.replaceWith('<span tabindex="0">'+f.html()+"</span>")}d.finishExpandingGroup=function(c){b.prototype.finishExpandingGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})},d.collapseGroup=function(c){b.prototype.collapseGroup.call(this,c),Y.use("moodle-core-event",function(){Y.Global.fire(M.core.globalEvents.BLOCK_CONTENT_UPDATED,{instanceid:a})})}}}});
define('block_socialmedia/fbresizer', ["jquery"],function(a){var b={timeout:null,instances:[],addRoot:function(){var b;a("#fb-root").length||(b='<div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.8";fjs.parentNode.insertBefore(js, fjs);'+"}(document, 'script', 'facebook-jssdk'));</script>",a(document.body).append(b))},writeContainer:function(a){a.container.html('<div class="fb-page moodle-has-zindex" data-width="'+a.width+'" data-href="https://www.facebook.com/'+a.name+'" data-height="'+a.height+'" data-tabs="timeline" data-small-header="true" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"> </div>'),"undefined"!=typeof FB&&FB.XFBML.parse()},init:function(c,d,e){var f=0,g={},h=a("#socialmedia-container-"+c);h.length&&(f=parseInt(h.width()),g.name=d,g.height=e,g.container=h,g.width=f,b.instances.push(g),b.addRoot(),b.writeContainer(g),a(window).resize(function(){clearTimeout(b.timeout),b.timeout=setTimeout(function(){var a,c,d;for(d=b.instances.length,c=0;c<d;c++)a=parseInt(b.instances[c].container.width()),a<180&&(a=180),a>500&&(a=500),b.instances[c].width!==a&&(b.instances[c].width=a,b.writeContainer(b.instances[c]))},200)}))}};return b});
define('block_subjectlist/allsubjects', ["jquery","theme_osep/animations"],function(a,b){var c={init:function(){a("ul.block_subjectlist-categories > li > div").prop("tabIndex",0),a("ul.block_subjectlist-categories").on("click","> li > div",c.expandOrCollapse),a("ul.block_subjectlist-categories").on("keypress","> li > div",function(a){13===a.which&&c.expandOrCollapse(a)}),a("ul.block_subjectlist-categories li[data-expand=1]").each(function(a,b){c.expandOrCollapse(b)})},expandOrCollapse:function(c){var d;c.target?(c.preventDefault(),d=a(c.target).closest("li")):d=a(c);var e=d.find(".block_subjectlist-subjects"),f=d.find(".block_subjectlist-expandcollapse > span:first-of-type"),g=d.find(".block_subjectlist-expandcollapse > span:last-of-type");d.data("subjectlist-pending")||(d.data("subjectlist-expanded")?(d.data("subjectlist-pending",!0),b.openClose(e,!1,{after:function(){d.removeData("subjectlist-expanded"),d.removeData("subjectlist-pending"),f.css("display",""),g.css("display","")}})):(d.data("subjectlist-pending",!0),f.css("display","none"),g.css("display","inline"),b.openClose(e,!0,{after:function(){d.data("subjectlist-expanded",!0),d.removeData("subjectlist-pending")}})))}};return c});
define('block_subjectlist/infoicon', ["jquery","core/modal_events","core/modal_factory"],function(a,b,c){var d={init:function(){a("body").on("click",".block_subjectlist-infoicon",d.showInfo);var b=a(".block_subjectlist-is-this-subject .block_subjectlist-infoicon"),c=a("#ousubject-coursedetails h1");1===c.length&&1===b.length&&c.append(b.clone())},showInfo:function(d){d.preventDefault(),c.create({title:M.util.get_string("qualifications","block_subjectlist"),body:a(d.currentTarget).data("whyamihere")}).done(function(c){c.show(),c.getModal().css("visibility","hidden"),c.getRoot().on(b.hidden,function(){c.destroy()});var e=function(){var b=c.getModal().outerHeight();if(0==b)return void setTimeout(e,50);var f=d.currentTarget.parentNode.getBoundingClientRect().bottom+4,g=a(window).height();f+b>=g&&(f=d.currentTarget.parentNode.getBoundingClientRect().top-b-4),c.getRoot().css("top",f),c.getModal().css("marginTop",0),c.getModal().css("visibility","visible")};e()})}};return d});
define('block_viewstudyweek/dialogue', ["jquery","core/yui"],function(a,b){var c={dialogue:null,iframeUrl:null,courseCount:1,init:function(b,d){c.iframeUrl=b,c.courseCount=d,a(".block-viewstudyweek-mainbutton").on("click",c.showPopup)},showPopup:function(d){d.preventDefault(),b.use("moodle-core-notification",function(){c.dialogue&&1!==M.util.reordered_your_modules||(c.dialogue=c.createDialogue(),M.util.reordered_your_modules={}),c.dialogue.show(),a(c.dialogue.bodyNode.getDOMNode()).find("iframe").on("load",function(){a(this.contentWindow.document.body).keydown(function(a){27===a.keyCode&&c.dialogue.hide()});var b=a(".block-viewstudyweek-dialogue .moodle-dialogue-fullscreen .moodle-dialogue-bd"),d=b.length>0;if(!d){var e=this.contentWindow.document.body.offsetHeight+a(c.dialogue.headerNode.getDOMNode()).height();e<c.dialogue.get("height")&&c.dialogue.set("height",e+"px")}d&&/iPod|iPhone/.test(navigator.userAgent)&&(b.css("-webkit-overflow-scrolling","touch"),b.css("overflow-y","scroll"),a(this.contentWindow.document.body).css("padding-bottom","55px"))})})},createDialogue:function(){return new M.core.dialogue({headerContent:M.util.get_string("dialoguetitle","block_viewstudyweek"),bodyContent:'<iframe name="currentweeks" tabindex="0" src="'+c.iframeUrl+'">',additionalBaseClass:"block-viewstudyweek-dialogue",draggable:!1,visible:!1,center:!0,modal:!0,width:Math.min(768,370*c.courseCount),height:500,focusOnShowSelector:"button"})}};return c});
define('media_videojs/loader', ["jquery","core/event"],function(a,b){var c,d=function(d){c=d,e(null,a("body")),b.getLegacyEvents().done(function(b){a(document).on(b.FILTER_CONTENT_UPDATED,e)})},e=function(b,d){var e=".mediaplugin_videojs";d.find(e).addBack(e).find("audio, video").each(function(){var b=a(this).attr("id"),d=a(this).data("setup-lazy"),e=["media_videojs/video-lazy"];d.techOrder&&d.techOrder.indexOf("youtube")!==-1&&e.push("media_videojs/Youtube-lazy"),d.techOrder&&d.techOrder.indexOf("flash")!==-1&&e.push("media_videojs/videojs-flash-lazy"),require(e,function(a){c&&(c(a),c=null),a(b,d)})})};return{setUp:d}});
define('filter_embedquestion/question', [],function(){var a={currentHeight:null,init:function(){window.frameElement&&(a.resizeContainingFrame(),"undefined"!=typeof document.compatMode&&"BackCompat"!==document.compatMode&&setInterval(a.resizeContainingFrame,100),document.documentElement.style["overflow-y"]="hidden",document.documentElement.style.height="auto")},resizeContainingFrame:function(){a.currentHeight!==document.body.offsetHeight&&(a.currentHeight=document.body.offsetHeight,window.frameElement.style.height=a.currentHeight+25+"px")}};return a});
define('filter_embedquestion/questionid_choice_updater', ["jquery","core/ajax"],function(a,b){var c={init:function(){a("select#id_categoryidnumber").on("change",c.categoryChanged),c.lastCategory=null},lastCategory:null,categoryChanged:function(){a("select#id_categoryidnumber").val()!==c.lastCategory&&(M.util.js_pending("filter_embedquestion-get_questions"),c.lastCategory=a("select#id_categoryidnumber").val(),""===c.lastCategory?c.updateChoices([]):b.call([{methodname:"filter_embedquestion_get_sharable_question_choices",args:{courseid:a("input[name=courseid]").val(),categoryidnumber:c.lastCategory}}])[0].done(c.updateChoices))},updateChoices:function(b){var c=a("select#id_questionidnumber");c.empty(),a(b).each(function(a,b){c.append('<option value="'+b.value+'">'+b.label+"</option>")}),M.util.js_complete("filter_embedquestion-get_questions")}};return c});
define('filter_ipud/ipudelement', ["jquery","core/str","core/ajax","core/modal_factory","core/templates","core/fragment","core/modal_events","core/config"],function(a,b,c,d,e,f,g,h){return function(){return{elementselector:null,btnexpandall:null,btncollapseall:null,btnpostreply:null,groupselector:null,subjectselector:null,introselector:null,postcontainerselector:null,courseid:null,discussionid:null,loc:null,idnumber:null,showtitle:null,showintro:null,dialogue:null,loadingicon:null,lastfocuselement:null,baserootpostid:null,rootpostid:null,postformselector:null,contextid:null,langstring:{},deletedialog:null,undeletedialog:null,posttodelete:null,posttoundelete:null,hasExpanded:!1,canAddPlaceHolder:!0,emptycontent:["<br><p><br></p>","<p><br></p>","<br>",""],init:function(c){var d=this;d.elementselector=a("#"+a.escapeSelector(c.id)),d.btnexpandall=d.elementselector.find(".ipud-expand"),d.btncollapseall=d.elementselector.find(".ipud-collapse"),d.postreply=d.elementselector.find("#id_submitbutton"),d.groupselector=d.elementselector.find('select[name="group"]'),d.subjectselector=d.elementselector.find(".ipud-subject"),d.introselector=d.elementselector.find(".ipud-introduction"),d.postcontainerselector=d.elementselector.find(".ipud-replies"),d.postcountselector=d.elementselector.find(".ipud-postcount"),d.loadingicon=d.elementselector.find(".ipud-loading"),d.courseid=c.courseid,d.discussionid=c.discussionid,d.loc=c.loc,d.idnumber=c.idnumber,d.showtitle=c.showtitle,d.showintro=c.showintro,d.baserootpostid=c.rootpostid,d.rootpostid=c.rootpostid,d.postformselector=d.elementselector.find(".ipud-postform > form"),d.contextid=c.contextid,d.userid=c.userid,this.groupselector.length&&(null===c.groupid?this.groupselector.val(0):this.groupselector.val(c.groupid)),b.get_strings([{key:"required",component:"core"},{key:"deletepost",component:"filter_ipud"},{key:"confirmdelete",component:"mod_forumng"},{key:"delete",component:"filter_ipud"},{key:"cancel",component:"core"},{key:"undeletepost",component:"filter_ipud"},{key:"confirmundelete",component:"mod_forumng"},{key:"reply",component:"filter_ipud"},{key:"replies",component:"filter_ipud"},{key:"editorplaceholder",component:"filter_ipud"},{key:"deleteandemail",component:"filter_ipud"},{key:"deletepostandemail",component:"filter_ipud"}]).done(function(a){d.langstring.required=a[0],d.langstring.deletepost=a[1],d.langstring.confirmdelete=a[2],d.langstring["delete"]=a[3],d.langstring.cancel=a[4],d.langstring.undeletepost=a[5],d.langstring.confirmundelete=a[6],d.langstring.reply=a[7],d.langstring.replies=a[8],d.langstring.editorplaceholder=a[9],d.langstring.deleteandemail=a[10],d.langstring.deletepostandemail=a[11]}),this.initdiscussionview(),this.bindevent()},initdiscussionview:function(){var a=this;a.changeworkingstate(!0),a.postcontainerselector.empty(),a.btncollapseall.hide(),a.btnexpandall.hide(),a.btnexpandall.prop("disabled",!0),a.postcountselector.empty(),a.loadingicon.show(),a.groupselector&&a.groupselector.prop("disabled",!0);var b=setInterval(function(){0!==a.postformselector.find(".editor_atto_content").length&&(a.initAttoEditor(a.postformselector),clearInterval(b))},500);this.bindformtextareaevent(a.postformselector),M.util.js_pending("ipudgetposts"),a.getposts(a.discussionid,3,function(b){var c=a.countpostsandreplies(b.data),d=c.postcount,e=c.totaldelete;0!==d||0!==e?(a.btnexpandall.show(),b.data.reverse(),a.updatediscussioncount(d,b.totalpost),a.renderpost(b.data,!1)):(a.loadingicon.hide(),a.changeworkingstate(!1),a.elementselector.find(".ipud-groupselector .ipud-expand,.ipud-groupselector .ipud-collapse,.ipud-groupselector .ipud-postcount").hide(),a.updatediscussioncount(0,0)),M.util.js_complete("ipudgetposts")})},bindevent:function(){var a=this;this.btnexpandall.click(function(){a.postcontainerselector.empty(),a.btnexpandall.hide(),a.btncollapseall.show(),a.loadingicon.show(),a.changeworkingstate(!0),a.lastfocuselement=a.btncollapseall,M.util.js_pending("ipudgetposts"),a.getposts(a.discussionid,0,function(b){var c=a.countpostsandreplies(b.data),d=c.total;a.updatediscussioncount(d,b.totalpost),a.renderpost(b.data,!0),M.util.js_complete("ipudgetposts")})}),this.postformselector.submit(function(a){a.preventDefault()}),this.btncollapseall.click(function(){a.loadingicon.show(),a.btncollapseall.hide(),a.postcontainerselector.empty(),a.btnexpandall.show(),a.lastfocuselement=a.btnexpandall,a.initdiscussionview()}),this.postreply.click(function(){var b=a.convertformtojson(a.postformselector);if(b.replyto=a.rootpostid,0===b["message[text]"].length){var c=a.postformselector.find(".editor_atto_wrap");return 0===c.length||c.hasClass("error")||(c.addClass("error"),c.prepend('<span id="id_error_message_5btext_5d" class="error" tabindex="0">'+a.langstring.required+"</span>")),!1}return a.changeworkingstate(!0),a.loadingicon.show(),a.createreply({replyto:a.rootpostid,subject:"",message:{text:b["message[text]"],format:b["message[format]"],itemid:b["message[itemid]"]}},function(b){setTimeout(function(){a.postformselector.trigger("reset"),a.postformselector.find("#id_message"+a.baserootpostid+"editable").empty()}),b.replies=[],a.postformselector.find("#id_submitbutton").addClass("disabled"),a.appendpost(b,a.elementselector.find(".ipud-replies"))}),!0}),this.groupselector.unbind("change"),this.groupselector.on("change",function(){var b=this.value;a.changeworkingstate(!0),a.loadingicon.show(),M.util.js_pending("ipudchangegroup"),c.call([{methodname:"filter_ipud_get_discussion",args:{idnumber:a.idnumber,groupid:b,courseid:a.courseid,loc:a.loc},done:function(b){a.showtitle&&a.subjectselector.html(b.subject),a.showintro&&a.introselector.html(b.message),a.discussionid=b.discussionid,a.rootpostid=b.rootpostid,a.initdiscussionview(),M.util.js_complete("ipudchangegroup")},fail:function(b){a.showerror(b.message),M.util.js_complete("ipudchangegroup")}}])})},getposts:function(a,b,d){var e=this;c.call([{methodname:"mod_forumng_get_posts",args:{discussionid:a,numbertoshow:b},done:function(a){d(a)},fail:function(a){e.showerror(a.message)}}])},getpost:function(a,b,d){var e=this;c.call([{methodname:"mod_forumng_get_post",args:{postid:a,shortentext:b},done:function(a){d(a)},fail:function(a){e.showerror(a.message)}}])},showerror:function(c){var d=this,e=b.get_string("error","core");a.when(e).done(function(a){d.showdialog(a,c),d.changeworkingstate(!1)})},showdialog:function(a,b){var c=this;c.dialogue?(c.dialogue.title.html(a),c.dialogue.body.html(b),c.dialogue.show()):d.create({type:d.types.DEFAULT,title:a,body:b}).done(function(a){c.dialogue=a,c.dialogue.show()})},updatediscussioncount:function(c,d){var e=this;d===-1?d=e.lasttotal:e.lasttotal=d,c===-1?c=e.lastcurrentcount:e.lastcurrentcount=c;var f=b.get_string("postof","filter_ipud",{current:c,total:d});a.when(f).done(function(a){e.postcountselector.text(a)})},renderpost:function(b,c){var d=this;return b=d.convertpostsfortemplate(b,c),e.render("filter_ipud/posts",{posts:b}).done(function(c){var e=a(c);d.postcontainerselector.append(e);var f=0;for(f;f<b.length;f++){var g=b[f];d.bindpostevent(g,e)}d.changeworkingstate(!1),d.loadingicon.hide()}),!1},bindpostevent:function(a,b){var c=this,d=b.find("#post"+a.postid),e=0;for(e;e<a.replies.length;e++){var f=a.replies[e];c.bindreplyevent(f,d)}d.find(".ipud-btndelete").click(function(b){c.bindpostdeleteevent(a),b.preventDefault()}),d.find(".ipud-btnundelete").click(function(b){c.bindpostundeleteevent(a),b.preventDefault()}),d.find(".ipud-btnreport").click(function(){}),d.find(".ipud-btnreply").click(function(b){c.getfragmentformevent(a,!1),b.preventDefault()}),d.find(".ipud-btnedit").click(function(b){c.getfragmentformevent(a,!0),b.preventDefault()}),d.find(".ipud-expandlink").click(function(b){b.preventDefault(),c.bindpostexpandevent(a)}),d.find(".ipud-collapselink").click(function(b){b.preventDefault(),c.bindpostcollapseevent(a)})},bindreplyevent:function(a,b){var c=this,d=b.find("#post"+a.postid);d.find(".ipud-btnreportreply").click(function(){}),d.find(".ipud-btndeletereply").click(function(b){c.bindpostdeleteevent(a),b.preventDefault()}),d.find(".ipud-btnundeletereply").click(function(b){c.bindpostundeleteevent(a),b.preventDefault()}),d.find(".ipud-btneditreply").click(function(b){c.getfragmentformevent(a,!0),b.preventDefault()})},changeworkingstate:function(a){var b=this;a?(b.btnexpandall.prop("disabled",!0),b.btncollapseall.prop("disabled",!0),b.elementselector.find(".ipud-btnreport").prop("disabled",!0),b.elementselector.find(".ipud-btnreply").prop("disabled",!0),b.elementselector.find(".ipud-btnedit").addClass("disabled"),b.elementselector.find(".ipud-btnedit").attr("tabindex",-1),b.elementselector.find(".ipud-btndelete").prop("disabled",!0),b.elementselector.find(".ipud-btndeletereply").prop("disabled",!0),b.elementselector.find(".ipud-btnundelete").prop("disabled",!0),b.elementselector.find(".ipud-btnundeletereply").prop("disabled",!0),b.elementselector.find(".ipud-btnreport").prop("disabled",!0),b.elementselector.find(".ipud-btneditreply").addClass("disabled"),b.elementselector.find(".ipud-btneditreply").attr("tabindex",-1),b.elementselector.find(".ipud-expandlink").css("visibility","hidden"),b.elementselector.find(".ipud-collapselink").css("visibility","hidden"),b.deletedialog&&(b.deletedialog.getFooter().find('button[data-action="yes"]').prop("disabled",!0),b.deletedialog.getFooter().find('button[data-action="yesandemail"]').prop("disabled",!0)),b.undeletedialog&&b.undeletedialog.getFooter().find('button[data-action="yes"]').prop("disabled",!0),b.postreply.prop("disabled",!0),b.groupselector&&b.groupselector.prop("disabled",!0)):(b.btnexpandall.prop("disabled",!1),b.btncollapseall.prop("disabled",!1),b.elementselector.find(".ipud-btnreport").prop("disabled",!1),b.elementselector.find(".ipud-btnreply").prop("disabled",!1),b.elementselector.find(".ipud-btnedit").removeClass("disabled"),b.elementselector.find(".ipud-btnedit").removeAttr("tabindex"),b.elementselector.find(".ipud-btndelete").prop("disabled",!1),b.elementselector.find(".ipud-btndeletereply").prop("disabled",!1),b.elementselector.find(".ipud-btnundelete").prop("disabled",!1),b.elementselector.find(".ipud-btnundeletereply").prop("disabled",!1),b.elementselector.find(".ipud-btnreport").prop("disabled",!1),b.elementselector.find(".ipud-btneditreply").removeClass("disabled"),b.elementselector.find(".ipud-btneditreply").removeAttr("tabindex"),b.elementselector.find(".ipud-expandlink").css("visibility","visible"),b.elementselector.find(".ipud-collapselink").css("visibility","visible"),b.postreply.prop("disabled",!1),b.deletedialog&&(b.deletedialog.getFooter().find('button[data-action="yes"]').prop("disabled",!1),b.deletedialog.getFooter().find('button[data-action="yesandemail"]').prop("disabled",!1)),b.undeletedialog&&b.undeletedialog.getFooter().find('button[data-action="yes"]').prop("disabled",!1),b.groupselector&&b.groupselector.prop("disabled",!1),b.lastfocuselement&&(b.lastfocuselement.focus(),b.lastfocuselement=null))},countpostsandreplies:function(a){var b=0,c=0,d=0,e=0;a.constructor!==Array&&(a=[a]);for(var f=0;f<a.length;f++){var g=a[f];0===g.deletedtime?b++:c++;for(var h=0;h<g.replies.length;h++){var i=g.replies[h];0===i.deletedtime?d++:e++}}return{total:b+d,totaldelete:c+e,postcount:b,deletepostcount:c,replycount:d,deletereplycount:e}},expandpost:function(a,b,d){var e=this;c.call([{methodname:"mod_forumng_expand_post",args:{discussionid:a,postid:b},done:function(a){d(a)},fail:function(a){e.showerror(a.message)}}])},bindpostexpandevent:function(b){var c=this,d=c.elementselector.find("#post"+b.postid),f=c.loadingicon.clone().show();c.changeworkingstate(!0),d.find(".ipud_post-replies").append(f),a(this).hide(),M.util.js_pending("ipudexpandpost"),c.expandpost(c.discussionid,b.postid,function(f){for(var g=c.convertpostsfortemplate(f,!0),h=0;h<g.replies.length;h++){var i=g.replies[h];i.deleted&&!i.canviewdeleted&&(g.replies.splice(h,1),h--)}var j=d.find(".ipud_post-replies .ipud-post").length,k=c.countpostsandreplies(g).replycount,l=c.lastcurrentcount+k-j,m=c.lasttotal+(g.numberofreply-b.numberofreply);b.deleted&&!g.deleted&&(l++,m++),!b.deleted&&g.deleted&&(l--,m--),l===m&&(c.btnexpandall.hide(),c.btncollapseall.show()),c.updatediscussioncount(l,m),e.render("filter_ipud/post",g).done(function(b){var e=a(b);d.replaceWith(e),c.lastfocuselement=e.find(".ipud-collapselink"),c.bindpostevent(f,e.parent()),c.changeworkingstate(!1),M.util.js_complete("ipudexpandpost")})})},bindpostcollapseevent:function(a){var b=this,c=b.elementselector.find("#post"+a.postid),d=c.find(".ipud_post-replies .ipud-text").length;b.updatediscussioncount(b.lastcurrentcount-d,-1),a.numberofreply=d,c.find(".ipud_post-replies").empty(),a.deleted?c.find(".ipud-delete-content").html(a.shortcontent):c.find(".ipud-text ").html(a.shortcontent),c.find(".ipud-collapselink").hide(),c.find(".ipud-expandlink").show().focus(),a.expanded=!1},convertpostsfortemplate:function(a,b){var c=!1;a.constructor!==Array&&(a=[a],c=!0);var d=0;for(d;d<a.length;d++){var e=a[d];e.canviewdeleted="1"===e.canviewdeleted,e.deleted=0!==e.deletedtime,e.canreply="1"===e.canreply,e.canreport="1"===e.canreport,e.candelete="1"===e.candelete,e.canundelete="1"===e.canundelete,e.canedit="1"===e.canedit,e.plural=0===e.numberofreply||e.numberofreply>1,e.expanded=b,e.showmod=1===e.ismoderator||2===e.ismoderator,e.postasanonmod=2===e.ismoderator,e.showauthor=!e.postasanonmod||e.postasanonmod&&e.canviewanon,e.isanon=e.isanon,e.canviewanonpost=e.postasanonmod&&e.canviewanon,e.ispost=!0;var f=0;for(f;f<e.replies.length;f++){var g=e.replies[f];g.canreply="1"===g.canreply,g.canreport="1"===g.canreport,g.candelete="1"===g.candelete,g.canundelete="1"===g.canundelete,g.canedit="1"===g.canedit,g.canviewdeleted="1"===g.canviewdeleted,g.deleted=0!==g.deletedtime,g.showmod=1===g.ismoderator||2===g.ismoderator,g.postasanonmod=2===g.ismoderator,g.showauthor=!g.postasanonmod||g.postasanonmod&&g.canviewanon,g.isanon=g.isanon,g.canviewanonpost=g.postasanonmod&&g.canviewanon,g.ispost=!1}}return c?a[0]:a},convertformtojson:function(b){var c=b.serializeArray(),d={};return a.each(c,function(){d[this.name]=this.value||""}),d},createreply:function(a,b){var d=this;c.call([{methodname:"mod_forumng_create_reply",args:a,done:function(a){b(a)},fail:function(b){d.showerror(b.message),d.elementselector.find("#post"+a.replyto+" .ipud-postfragmentform").empty()}}])},appendpost:function(b,c,d){var f=this;b=f.convertpostsfortemplate(b,!0),d&&(b.ispost=!1),e.render("filter_ipud/post",b).done(function(e){var g=a(e);c.append(g),f.lastcurrentcount?f.updatediscussioncount(f.lastcurrentcount+1,f.lasttotal+1):(f.updatediscussioncount(1,1),f.btncollapseall.prop("disabled",!1),f.btncollapseall.show()),d?(f.bindreplyevent(b,g.parent()),f.lastfocuselement=c.find(".ipud-btneditreply")):(f.bindpostevent(b,g.parent()),f.lastfocuselement=c.find(".ipud-btnedit")),f.loadingicon.hide(),f.changeworkingstate(!1)})},loadfragmentform:function(a,b,c){var d=this,g=[];b?g.edit=a.postid:g.replyto=a.postid;var h=d.postformselector.find(".editor_atto_wrap");0!==h.length&&h.hasClass("error")&&(h.removeClass("error"),h.find("#id_error_message_5btext_5d").remove()),M.util.js_pending("ipudloadfragmentform"),f.loadFragment("mod_forumng","postform",d.contextid,g).done(function(f,g){e.replaceNodeContents(c,f,g),c.find("#id_message"+a.postid+"editable").focus(),c.find("form").submit(function(a){a.preventDefault()}),M.util.js_complete("ipudloadfragmentform"),b?d.bindfragmentformactionevent(c,a,!0):d.bindfragmentformactionevent(c,a,!1)})},bindfragmentformactionevent:function(a,b,c){var d=this,e=a.find("#id_submitbutton"),f=a.find("form");e.click(function(){var e=d.convertformtojson(f);if(0===e["message[text]"].length)return!0;var g=d.loadingicon.clone().show();return g.appendTo(a),f.hide(),d.changeworkingstate(!0),c?d.editpostevent(a,b,f,e):d.createreplyevent(a,b,f,e),!0}),d.fragmentformcancelbutonevent(f,c),d.bindformtextareaevent(a)},editpostevent:function(a,b,c,d){var e=this;M.util.js_pending("ipudeditpost"),e.editpost({postid:b.postid,subject:"",message:{text:d["message[text]"],format:d["message[format]"],itemid:d["message[itemid]"]}},function(c){var d=e.elementselector.find("#post"+b.postid);e.lastfocuselement=d.find(".ipud-btnedit"),0===e.lastfocuselement.length&&(e.lastfocuselement=d.find(".ipud-btneditreply")),b.shortcontent=c.shortcontent,d.find(".ipud-text").first().html(c.content),a.empty(),e.changeworkingstate(!1),M.util.js_complete("ipudeditpost")})},createreplyevent:function(a,b,c,d){var e=this;M.util.js_pending("ipudcreatereply"),e.createreply({replyto:b.postid,subject:"",message:{text:d["message[text]"],format:d["message[format]"],itemid:d["message[itemid]"]}},function(c){var d=e.elementselector.find("#post"+b.postid),f=d.find(".ipud_post-replies");b.numberofreply++;var g=parseInt(d.find(".ipud-count-number").text())+1;d.find(".ipud-count-number").text(g),d.find(".ipud-count-text").html(1===g?e.langstring.reply:e.langstring.replies),a.empty(),c.replies=[],e.appendpost(c,f,!0),M.util.js_complete("ipudcreatereply")})},editpost:function(a,b){var d=this;c.call([{methodname:"mod_forumng_edit_post",args:a,done:function(a){b(a)},fail:function(b){d.showerror(b.message),d.elementselector.find("#post"+a.postid+" .ipud-postfragmentform").empty()}}])},getfragmentformevent:function(a,b){var c=this,d=c.elementselector.find("#post"+a.postid),e=d.find(".ipud-postfragmentform").first(),f=c.loadingicon.clone().show();e.append(f),c.loadfragmentform(a,b,e),c.changeworkingstate(!0)},fragmentformcancelbutonevent:function(a,b){var c=this,d=a.find("#id_cancel");d.click(function(d){d.preventDefault();var e=a.closest(".ipud-post");b?(c.lastfocuselement=e.find(".ipud-btnedit"),0===c.lastfocuselement.length&&(c.lastfocuselement=e.find(".ipud-btneditreply"))):c.lastfocuselement=e.find(".ipud-btnreply"),c.changeworkingstate(!1),a.parent().empty()})},bindpostdeleteevent:function(b){var c=this;c.posttodelete=b,c.deletedialog?(c.posttodelete.authorid==c.userid?c.deletedialog.getFooter().find('button[data-action="yesandemail"]').hide():c.deletedialog.getFooter().find('button[data-action="yesandemail"]').show(),c.deletedialog.show()):(c.changeworkingstate(!0),d.create({type:d.types.DEFAULT,title:c.langstring.deletepost,body:c.langstring.confirmdelete,footer:'<button type="button" data-action="yesandemail" title="'+c.langstring.deletepostandemail+'">'+c.langstring.deleteandemail+'</button><button type="button" data-action="yes" title="'+c.langstring.deletepost+'">'+c.langstring["delete"]+'</button><button type="button" data-action="no" title="'+c.langstring.cancel+'">'+c.langstring.cancel+"</button>"}).done(function(b){c.deletedialog=b,c.posttodelete.authorid==c.userid?b.getFooter().find('button[data-action="yesandemail"]').hide():b.getFooter().find('button[data-action="yesandemail"]').show(),b.getFooter().find('button[data-action="no"]').click(function(a){a.preventDefault(),b.hide()}),b.getFooter().find('button[data-action="yesandemail"]').click(function(a){a.preventDefault(),c.changeworkingstate(!0),b.hide(),window.location.href=h.wwwroot+"/mod/forumng/deletepost.php?p="+c.posttodelete.postid+"&delete=1&email=1&refer=ipud"}),b.getFooter().find('button[data-action="yes"]').click(function(d){d.preventDefault(),M.util.js_pending("ipuddeletepost"),c.changeworkingstate(!0),c.deletepost(c.posttodelete.postid,function(d){if(d.success){var f=a("#post"+d.postinfo.postid);d.postinfo.replies=[];var g=c.convertpostsfortemplate(d.postinfo,c.posttodelete.expanded);g.ispost=c.posttodelete.ispost,g.ispost||(g.expanded=!0),e.render("filter_ipud/post",g).done(function(b){var e=a(b);if(!g.ispost){var h=f.parent().closest(".ipud-post").find(".ipud-totalreply"),i=parseInt(h.find(".ipud-count-number").text())-1;h.find(".ipud-count-number").text(i),h.find(".ipud-count-text").html(1===i?c.langstring.reply:c.langstring.replies)}var j=f.find(".ipud_post-replies").clone(!0);f.replaceWith(e),e.find(".ipud_post-replies").replaceWith(j);var k=e.find(".ipud-btnundelete");0===k.length&&(k=e.find(".ipud-btnundeletereply")),0===k.length?c.lastfocuselement=e.find(".ipud-pic > a").first():c.lastfocuselement=k,c.updatediscussioncount(c.lastcurrentcount-1,c.lasttotal-1),c.posttodelete.ispost?c.bindpostevent(d.postinfo,e.parent()):c.bindreplyevent(d.postinfo,e.parent()),c.changeworkingstate(!1),M.util.js_complete("ipuddeletepost")})}else c.showerror(d.message);b.hide()})}),b.getRoot().on(g.hidden,function(){var b=a("#post"+c.posttodelete.postid);c.posttodelete.ispost?b.find(".ipud-btndelete").first().focus():b.find(".ipud-btndeletereply").first().focus()}),b.getRoot().on(g.shown,function(){c.changeworkingstate(!1)}),b.show(),c.changeworkingstate(!1)}))},bindpostundeleteevent:function(b){var c=this;c.posttoundelete=b,c.undeletedialog?c.undeletedialog.show():(c.changeworkingstate(!0),d.create({type:d.types.DEFAULT,title:c.langstring.undeletepost,body:c.langstring.confirmundelete,footer:'<button type="button" data-action="yes" title="'+c.langstring.undeletepost+'">'+c.langstring.undeletepost+'</button><button type="button" data-action="no" title="'+c.langstring.cancel+'">'+c.langstring.cancel+"</button>"}).done(function(b){c.undeletedialog=b,b.getFooter().find('button[data-action="no"]').click(function(a){a.preventDefault(),b.hide()}),b.getFooter().find('button[data-action="yes"]').click(function(d){d.preventDefault(),M.util.js_pending("ipudundeletepost"),c.changeworkingstate(!0),c.undeletepost(c.posttoundelete.postid,function(d){if(d.success){var f=a("#post"+d.postinfo.postid);d.postinfo.replies=[];var g=c.convertpostsfortemplate(d.postinfo,c.posttoundelete.expanded);g.ispost=c.posttoundelete.ispost,g.ispost||(g.expanded=!0),e.render("filter_ipud/post",g).done(function(b){var e=a(b);if(!g.ispost){var h=f.parent().closest(".ipud-post").find(".ipud-totalreply"),i=parseInt(h.find(".ipud-count-number").text())+1;h.find(".ipud-count-number").text(i),h.find(".ipud-count-text").html(1===i?c.langstring.reply:c.langstring.replies)}var j=f.find(".ipud_post-replies").clone(!0);f.replaceWith(e),e.find(".ipud_post-replies").replaceWith(j);var k=e.find(".ipud-btndelete");0===k.length&&(k=e.find(".ipud-btndeletereply")),c.lastfocuselement=k,c.updatediscussioncount(c.lastcurrentcount+1,c.lasttotal+1),c.posttoundelete.ispost?c.bindpostevent(d.postinfo,e.parent()):c.bindreplyevent(d.postinfo,e.parent()),c.changeworkingstate(!1),M.util.js_complete("ipudundeletepost")})}else c.showerror(d.message);b.hide()})}),b.getRoot().on(g.hidden,function(){var b=a("#post"+c.posttoundelete.postid);c.posttoundelete.ispost?b.find(".ipud-btnundelete").first().focus():b.find(".ipud-btnundeletereply").first().focus()}),b.getRoot().on(g.shown,function(){c.changeworkingstate(!1)}),b.show()}))},deletepost:function(a,b){var d=this;c.call([{methodname:"mod_forumng_delete_post",args:{postid:a},done:function(a){b(a)},fail:function(a){d.showerror(a.message)}}])},undeletepost:function(a,b){var d=this;c.call([{methodname:"mod_forumng_undelete_post",args:{postid:a},done:function(a){b(a)},fail:function(a){d.showerror(a.message)}}])},initAttoEditor:function(a){var b=this,c=125,d=a.find(".editor_atto_content_wrap"),e=a.find(".editor_atto_content"),f=a.find("textarea"),g=a.find(".editor_atto_toolbar");M.util.js_pending("initeditor"),b.addRemovePlaceHolder(e,d,f),a.find(".editor_atto_content, textarea").focus(function(a){b.hasExpanded||(M.util.js_pending("expandeditor"),a.preventDefault(),g.fadeIn(),e.is(":visible")&&e.height()<c&&(e.animate({height:c},200),f.height(c)),f.is(":visible")&&f.height()<c&&(f.animate({height:c},200),e.height(c)),d.attr("data-placeholder",""),f.attr("placeholder",""),b.canAddPlaceHolder=!1,b.hasExpanded=!0,M.util.js_complete("expandeditor"))}),M.util.js_complete("initeditor")},addRemovePlaceHolder:function(a,b,c){var d=this;if(d.canAddPlaceHolder){if(!(d.emptycontent.indexOf(a.html())>-1))return b.attr("data-placeholder",""),c.attr("placeholder",""),void(d.canAddPlaceHolder=!1);b.attr("data-placeholder",d.langstring.editorplaceholder).addClass("force-redraw").removeClass("force-redraw"),c.attr("placeholder",d.langstring.editorplaceholder),setTimeout(function(){d.addRemovePlaceHolder(a,b,c)},250)}},bindformtextareaevent:function(b){var c=this,d=b.find("#id_submitbutton");d.addClass("disabled");var e=b.find('textarea[id^="id_message"]');e.on("change",function(){var b=Date.now();M.util.js_pending("textchange"+b),c.emptycontent.indexOf(a(this).val())>-1?(d.addClass("disabled"),d.prop("disabled",!0)):(d.removeClass("disabled"),d.prop("disabled",!1)),M.util.js_complete("textchange"+b)});var f=setInterval(function(){b.find('textarea[id^="id_message"]').trigger("change")},350);setTimeout(function(){clearInterval(f)},5e3)}}}});
define('filter_ipud/ipudinitial', ["jquery","filter_ipud/ipudelement"],function(a,b){var c={init:function(a){var c=new b;c.init(JSON.parse(a))}};return c});
define('filter_oumaths/eqinfo', ["jquery"],function(a){var b=function(a,b,c){a.exception(b),c.removeClass("filter_oumaths_selectable"),c.attr("tabindex",-1),c.attr("role",""),c.off()},c={init:function(){a("span[data-ehash]").not(".filter_oumaths_selectable").each(function(){a(this).addClass("filter_oumaths_selectable"),a(this).attr("tabindex",0),a(this).attr("role","link"),a(this).on("keypress click",function(c){if("keypress"!==c.type||13===c.keyCode){var d=a(this);window.require(["core/ajax","core/templates","core/str","core/notification"],function(c,e,f,g){c.call([{methodname:"filter_oumaths_get_equation_info",args:{ehash:d.data("ehash")},fail:function(a){b(g,a,d)},done:function(c){var h=e.render("filter_oumaths/eqinfo",c),i=f.get_strings([{key:"info_title",component:"filter_oumaths"},{key:"info_close",component:"filter_oumaths"}]),j=a.when(h,i);j.done(function(a,b){window.top.require(["core/yui"],function(c){window.top.Y.use("moodle-core-notification-alert",function(){var c=new window.top.M.core.alert({title:b[0],message:a[0],yesLabel:b[1],modal:!0,draggable:!0,constrain:!0,focused:!0});c.show()})})}),j.fail(function(a){b(g,a,d)})}}])})}})})}};return c});
function load_client_math(){$('script[id="cdnmathjax"]').length>0&&MathJax.Hub.Queue(["Typeset",MathJax.Hub])}define('filter_oumaths/clientmathjax', ["jquery"],function(a){var b={mathfont:null,cdnmathjax:null,init:function(a,c){b.mathfont=c,b.cdnmathjax=a,window.hasOwnProperty("behattesting")&&window.behattesting?setTimeout(b.loadmath,2e3):(setTimeout(b.configure,3e3),setTimeout(b.loadmath,2e3),setTimeout(b.configureBasic,3e3))},typeset:function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])},loadmath:function(a){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.id="cdnmathjax",d.src=b.cdnmathjax,c.appendChild(d)},configureBasic:function(){MathJax.Hub.Configured()},configure:function(){MathJax.Hub.Config({styles:{".MathJax_SVG svg > g, .MathJax_SVG_Display svg > g":{fill:"#1a1a1a",stroke:"#1a1a1a","font-family":"inherit"}},jax:["input/TeX","input/MathML","output/SVG","output/HTML-CSS","output/PreviewHTML"],displayAlign:"left",tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],ignoreClass:"[a-zA-Z1-9]*",processClass:"oucontent-display-mathml|oucontent-inlinemathml|filter_clientmaths_svg",processEscapes:!0,Preview:"none"},extensions:["[Contrib]/a11y/accessibility-menu.js","mml2jax.js","FontWarnings.js","MatchWebFonts.js"],menuSettings:{"Assistive-subtitle":!1,autocollapse:!1,collapsible:!1,explorer:!0},errorSettings:{message:["[",["MathProcessingError","Math Processing Error"],"]"],style:{color:"#CC0000","font-style":"italic"}},TeX:{noErrors:{disabled:!0,inlineDelimiters:[["$","$"],["\\(","\\)"]]}},SVG:{mtextFontInherit:!0,blacker:7,linebreaks:{automatic:!0},font:b.mathfont,addMMLclasses:!0,EqnChunk:10},"HTML-CSS":{linebreaks:{automatic:!0},mtextFontInherit:!0,webFont:b.mathfont,availableFonts:[],preferredFont:null},mtextFontInherit:!0,MathML:{useMathMLspacing:!0},MatchWebFonts:{matchFor:{SVG:!0},fontCheckDelay:500,fontCheckTimeout:15e3}}),MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function(a){console.log(a[1])}),MathJax.Hub.Register.MessageHook("Math Processing Error",function(a){console.log(a[2])})}};return b});
define('format_oustudyplan/areas', ["jquery"],function(a){var b={init:function(){b.initEditingToggles()},initEditingToggles:function(){var b=/[?&]id=([0-9]+).*?&area=([a-z]+)/.exec(location.search);if(b){var c="/course/view.php?id="+b[1]+"&area="+b[2];a("a[href*=course\\/view\\.php][href*=\\&edit\\=]").each(function(){this.href+="&return="+encodeURIComponent(c)}),a(".singlebutton input[type=hidden][name=edit]").each(function(){a(this).before('<input type="hidden" name="return" value="'+c+'" />')})}}};return b});
define('format_oustudyplan/completion', ["jquery"],function(a){var b={init:function(){a("form.togglecompletion").on("submit",function(){M.util.js_pending("format_oustudyplan-detectCompletionChange"),b.detectCompletionChange(this)}),a("form.togglecompletion button").on("mouseover mouseout focus blur load",b.checkBoxHover)},detectCompletionChange:function(c){var d=a("button img",c).attr("src"),e=0,f=function(){return a("button img",c).attr("src")===d?(e++,void(e<100&&setTimeout(f,50))):(b.recalculateSectionCompletion(c),b.updateProgressBar(c),b.updateProgressPercent(),void M.util.js_complete("format_oustudyplan-detectCompletionChange"))};setTimeout(f,50)},recalculateSectionCompletion:function(b){var c=a(b).closest("li.section"),d=0;a("form.togglecompletion button img",c).each(function(a,b){b.src.match(/manual-y$/)&&d++}),a("span.autocompletion > img",c).each(function(a,b){b.src.match(/auto-n$/)||d++}),a(".oustudyplan-progresscount .oustudyplan-done",c).html(d)},updateProgressBar:function(b){var c=a("input[name=id]",b).val(),d=a("button img",b).attr("src").match(/manual-y$/),e=a("#oustudyplan-blob"+c);if(e.length){var f,g=e.closest("g").attr("mydata:name");d?(e.removeAttr("class"),e.attr("fill","url(#oustudyplan-progressbar-complete)"),f=M.util.get_string("blob_complete","format_oustudyplan",g)):(e.removeAttr("fill"),e.attr("class","oustudyplan-incompletefill"),f=M.util.get_string("blob_incomplete","format_oustudyplan",g)),e.parent().find("title").text(f)}},updateProgressPercent:function(){var b=0,c=0;a("form.togglecompletion button img").each(function(a,d){c++,d.src.match(/manual-y$/)&&b++}),a("span.autocompletion > img").each(function(a,d){c++,d.src.match(/auto-n$/)||b++});var d=0;c>0&&(d=100*b/c);var e=Math.round(d)+"%";a("#oustudyplan-progressbar-percent").prop("innerHTML",e),a("#oustudyplan-skip-progressbar-percent").prop("innerHTML",e)},checkBoxHover:function(b){var c,d,e;switch(a(b.target).is("img")?(c=a(b.target).parent(),d=a(b.target)):(c=a(b.target),d=a(b.target).find("img").first()),b.type){case"mouseover":d.data("hovered",!0),e="show";break;case"mouseout":d.data("hovered",!1),e="hide";break;case"focus":d.data("focused",!0),e="show";break;case"blur":d.data("focused",!1),e="hide";break;case"load":e="show"}c.parent().find('input[name="completionstate"][value="1"]').length>0&&("show"===e&&(d.data("hovered")||d.data("focused"))?d.attr("src",M.util.image_url("completion-manual-hover","theme_osep")):"hide"!==e||d.data("hovered")||d.data("focused")||d.first().attr("src",M.util.image_url("i/completion-manual-n")))}};return b});
define('format_oustudyplan/dropimage', ["jquery"],function(a){var b={courseId:0,width:0,height:0,kb:0,init:function(c){b.courseId=c;var d=a("#oustudyplan-imageeditbox");if(d.length){if(b.width=d.data("width"),b.height=d.data("height"),b.kb=d.data("kb"),a("a",d).on("click",function(){a("#oustudyplan-imageeditfile").click()}),a("#oustudyplan-imageeditfile").on("change",function(){var a=this.files&&1===this.files.length&&b.checkFile(this.files[0]);a?(d.removeClass("oustudyplan-hovererror"),b.processFile(this.files[0])):d.addClass("oustudyplan-hovererror")}),!(window.File&&window.FileList&&window.FileReader&&(new XMLHttpRequest).upload&&window.FormData))return void d.addClass("oustudyplan-nodragsupport");d.on("dragover",function(a){a.stopPropagation(),a.preventDefault(),b.checkHasFiles(a.originalEvent)?(d.removeClass("oustudyplan-hovererror"),d.addClass("oustudyplan-hoverok")):d.addClass("oustudyplan-hovererror")}),d.on("dragleave",function(a){a.stopPropagation(),a.preventDefault(),d.removeClass("oustudyplan-hovererror"),d.removeClass("oustudyplan-hoverok")}),d.on("drop",function(a){a.stopPropagation(),a.preventDefault(),b.checkImageFile(a.originalEvent)?b.processFile(a.originalEvent.dataTransfer.files[0]):(d.addClass("oustudyplan-hovererror"),d.removeClass("oustudyplan-hoverok"))})}},processFile:function(c){var d=new FileReader;d.onload=function(d){var e=document.createElement("img");e.onload=function(){var d=a("#oustudyplan-imageeditbox");if(e.width!=b.width||e.height!=b.height)d.addClass("oustudyplan-hovererror"),d.removeClass("oustudyplan-hoverok");else{d.removeClass("oustudyplan-hoverok"),d.addClass("oustudyplan-uploading");var f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&(200===f.status?location.href=M.cfg.wwwroot+"/course/view.php?id="+b.courseId:(d.removeClass("oustudyplan-uploading"),window.alert("Error uploading image")))},f.open("POST",M.cfg.wwwroot+"/course/format/oustudyplan/changeimage.php",!0);var g=new FormData;g.append("id",b.courseId),g.append("file",c),f.send(g)}},e.src=d.target.result},d.readAsDataURL(c)},checkHasFiles:function(a){if(a.dataTransfer.types)for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"===a.dataTransfer.types[b])return!0;return!1},checkImageFile:function(a){return!(!a.dataTransfer||1!==a.dataTransfer.files.length)&&!!b.checkFile(a.dataTransfer.files[0])},checkFile:function(a){return"image/jpeg"===a.type&&!(a.size>1024*b.kb)}};return b});
define('format_oustudyplan/hamburger', ["jquery","format_oustudyplan/searchbox","theme_osep/responsive"],function(a,b,c){var d={removedButton:null,searchLi:null,FADER_MAX_OPACITY:.7,ANIMATE_TIME:100,init:function(){a("#oustudyplan-hamburger").on("click","> a",function(a){a.preventDefault(),d.showMenu()}),c.addWidthListener(function(a,b){d.shown&&"mobile"===b&&d.hideMenu()});var b=this.getLightBox();b.on("touchstart click",function(a){a.preventDefault(),d.hideMenu()})},getLightBox:function(){var b=a("#hamburger-light-box");return b.length||(b=a(document.createElement("div")),b.prop("id","hamburger-light-box"),b.css("opacity",0),b.css("display","none"),a("body").append(b)),b},getMenuDiv:function(){var c=a("#oustudyplan-hamburgermenu");if(!c.length){c=a(document.createElement("div")),c.prop("id","oustudyplan-hamburgermenu"),c.css("display","none"),c.prependTo("#oustudyplan-hamburger");var e=a("#oustudyplan-hamburger > a"),f=document.createElement("div");c.append(f),e.clone().appendTo(f),a("#oustudyplan-hamburgermenu > div > a").on("click",function(a){a.preventDefault(),d.hideMenu()});var g=a(".oustudyplan-headerstripe > ul").clone();g.appendTo(c);var h=document.createElement("li");g.append(h);var i=document.createElement("a");h.appendChild(i),i.href=a(".oustudyplan-helplink").prop("href");var j=document.createElement("img");j.alt="",j.src=a(".oustudyplan-helplink img").prop("src"),i.appendChild(document.createTextNode(a(".oustudyplan-helplink img").prop("alt"))),i.appendChild(j),b.form.length&&(d.searchLi=a("<li></li>"),g.append(d.searchLi))}return c},showMenu:function(){var c=d.getMenuDiv(),e=d.getLightBox();e.css("display","block"),c.css("opacity",0),c.css("display","block"),d.searchLi&&d.searchLi.append(b.form),c.animate({opacity:1},d.ANIMATE_TIME,function(){d.removedButton=a("#oustudyplan-hamburger > a"),d.removedButton.remove()}),e.animate({opacity:d.FADER_MAX_OPACITY},d.ANIMATE_TIME),a("ul > li:first-child a",c).focus(),d.shown=!0},hideMenu:function(){var c=d.getMenuDiv(),e=d.getLightBox();a("#oustudyplan-hamburger").append(d.removedButton),d.removedButton=null,c.animate({opacity:0},d.ANIMATE_TIME,function(){c.css("display","none"),a(".oustudyplan-rightbit").append(b.form),a("#oustudyplan-hamburger a").focus()}),e.animate({opacity:0},d.ANIMATE_TIME,function(){e.css("display","none")}),d.shown=!1}};return d});
define('format_oustudyplan/multiselect', ["jquery"],function(a){var b={layer:null,cloned:null,stripe:null,allButton:null,noneButton:null,moveButton:null,deleteButton:null,cancelButton:null,supportsTransitions:!1,init:function(){b.supportsTransitions="transition"in document.body.style,a("body").on("click","button.oustudyplan-multiselect",function(a){a.preventDefault(),b.startMultiSelect()})},startMultiSelect:function(){b.addLayer(),b.cloneActivities(),b.addBar()},addLayer:function(){a("body").append('<div id="oustudyplan-coverup"></div>'),b.layer=a("#oustudyplan-coverup"),b.supportsTransitions?(M.util.js_pending("format_oustudyplan_multiselect"),setTimeout(function(){b.layer.addClass("showing")},0),b.layer.one("transitionend",function(){M.util.js_complete("format_oustudyplan_multiselect")})):b.layer.addClass("showing")},removeLayer:function(){b.smoothRemove(b.cloned),b.smoothRemove(b.layer),b.smoothRemove(b.stripe)},smoothRemove:function(a){a&&(b.supportsTransitions?(M.util.js_pending("format_oustudyplan_multiselect"),a.on("transitionend",function(){M.util.js_complete("format_oustudyplan_multiselect"),a.remove()}),a.removeClass("showing")):a.remove())},cloneActivities:function(){a("body").append('<div id="oustudyplan-cloned"></div>'),b.cloned=a("#oustudyplan-cloned"),setTimeout(function(){b.cloned.addClass("showing")},100);var c=null,d=null,e=null;a("ul.section > li.activity, li.section").each(function(){var f=a(this),g=f.closest("li.section");if(f.hasClass("section")){var h=f.find("ul.section > li.activity").length;if(!h)return;e=a("<section></section>"),b.cloned.append(e);var i=f.find("h3.sectionname").text(),j=f.find(".content").first().offset(),k=a('<div class="oustudyplan-section"></div>'),l=a('<div class="oustudyplan-inner"></div>');k.append(l),k.css("left",g.offset().left+"px"),k.css("top",j.top+"px"),k.css("width",g.width()+"px");var m=a("<h3></h3>");if(m.append(i),l.append(m),h>0){l.append(" ");var n=a('<button class="oustudyplan-all">'+M.util.get_string("selectallinx","format_oustudyplan",i)+"</button>");l.append(n);var o=a('<button class="oustudyplan-none">'+M.util.get_string("selectnoneinx","format_oustudyplan",i)+"</button>");l.append(o),n.on("click",function(){a(this).closest("section").find(".oustudyplan-activity input").each(function(){this.checked=!0}),b.updateButtonState()}),o.on("click",function(){a(this).closest("section").find(".oustudyplan-activity input").each(function(){this.checked=!1}),b.updateButtonState()}),e.append(k),d||(d=g)}}else{var p=f.find(".contentwithoutlink, .activityinstance").first(),q=f.offset(),r=a('<div class="oustudyplan-activity"></div>'),s=a('<div class="oustudyplan-inner"></div>');r.append(s),r.css("left",g.offset().left+"px"),r.css("top",q.top+"px"),r.css("width",g.width()+"px"),r.css("height",g.height()+"px");var t=a("<label></label>"),u=this.id.replace(/^module-/,""),v=a('<input type="checkbox" data-cmid="'+u+'"/>');c||(c=v),t.append(v),s.append(t),e.append(r);var w=a('<span class="oustudyplan-withoutlink"></span>');if(p.hasClass("activityinstance")){var x=p.find("span.instancename").parents(".mod-indent-outer").clone(!1);t.append(p.find("img").first().clone(!1)),t.append(" "),t.append(p.find("span.instancename").first().contents().clone(!1)),x.find("div.contentafterlink").length&&(w.append(x.find("div.contentafterlink").first().contents().clone(!1)),t.append(w)),r.addClass("oustudyplan-normal")}else p.hasClass("contentwithoutlink")&&(p.find("div.no-overflow > div.no-overflow").parents(".modtype_label").length?w.append(p.find("div.no-overflow > div.no-overflow").first().contents().clone(!1)):p.find("h4").parents(".modtype_heading").length?w.append(p.find("h4").first().contents().clone(!1)):p.find("h3").parents(".modtype_feed").length?(w.append(p.find("h3").first().clone(!1)),p.find("div.feed_ref_export_buttons").remove(),w.append(p.find("li.feed_item").first().contents().clone(!1)),w.append(p.find("li.feed_item").next().contents().clone(!1)),w.append("</br>")):p.find("div.oustudyplanshare-editing").parents(".modtype_oustudyplanshare").length?w.append(p.find("div.oustudyplanshare-editing").contents().clone(!1)):p.find("div.sharedsubpage_editing").parents(".modtype_sharedsubpage").length&&w.append(p.find("div.sharedsubpage_editing").contents().clone(!1)),t.append(w),r.addClass("oustudyplan-nolink"));d||(d=g)}}),c&&a("html,body").animate({scrollTop:d.offset().top},500,"swing",function(){c.focus()}),a("body").on("click",".oustudyplan-activity input",b.updateButtonState)},addBar:function(){b.stripe=a('<div id="oustudyplan-bottomstripe"></div>'),a("body").append(b.stripe),b.allButton=a('<button id="oustudyplan-all">'+M.util.get_string("selectall","format_oustudyplan")+"</button>"),b.stripe.append(b.allButton),b.noneButton=a('<button id="oustudyplan-none">'+M.util.get_string("selectnone","format_oustudyplan")+"</button>"),b.stripe.append(b.noneButton),b.stripe.append('<span class="oustudyplan-spacer"> </span>'),b.moveButton=a('<button id="oustudyplan-move">'+M.util.get_string("selected_move","format_oustudyplan")+"</button>"),b.stripe.append(b.moveButton),b.deleteButton=a('<button id="oustudyplan-delete">'+M.util.get_string("selected_delete","format_oustudyplan")+"</button>"),b.stripe.append(b.deleteButton),b.stripe.append('<span class="oustudyplan-spacer"> </span>'),b.cancelButton=a('<button id="oustudyplan-cancel">'+M.util.get_string("cancel","moodle")+"</button>"),b.stripe.append(b.cancelButton),b.supportsTransitions?(M.util.js_pending("format_oustudyplan_multiselect"),setTimeout(function(){b.stripe.addClass("showing")},100),b.stripe.one("transitionend",function(){M.util.js_complete("format_oustudyplan_multiselect")})):b.stripe.addClass("showing"),b.updateButtonState(),b.cancelButton.on("click",function(){b.removeLayer()}),a(document).on("keyup",function(a){27==a.keyCode&&b.removeLayer()}),b.allButton.on("click",function(){a(".oustudyplan-activity input").each(function(){this.checked=!0}),b.updateButtonState()}),b.noneButton.on("click",function(){a(".oustudyplan-activity input").each(function(){this.checked=!1}),b.updateButtonState()}),b.moveButton.on("click",function(){b.postAction("move")}),b.deleteButton.on("click",function(){b.postAction("delete")})},updateButtonState:function(){var c=!1,d=!0;a(".oustudyplan-activity input").each(function(){this.checked?c=!0:d=!1}),b.allButton.prop("disabled",d),b.noneButton.prop("disabled",!c),b.moveButton.prop("disabled",!c),b.deleteButton.prop("disabled",!c),a("#oustudyplan-cloned section").each(function(){a(this).find("button").length&&(c=!1,d=!0,a(this).find(".oustudyplan-activity input").each(function(){this.checked?c=!0:d=!1}),a(this).find("button.oustudyplan-all").prop("disabled",d),a(this).find("button.oustudyplan-none").prop("disabled",!c))})},postAction:function(b){var c=a('<form action="'+M.cfg.wwwroot+'/course/format/oustudyplan/multiaction.php" method="post"><div><input type="hidden" name="action" value="'+b+'"/><input type="hidden" name="cmids" value=""/></form>'),d="";a(".oustudyplan-activity input").each(function(){this.checked&&(""!==d&&(d+=","),d+=a(this).data("cmid"))}),c.find("input[name=cmids]").attr("value",d),a("body").append(c),c.submit()}};return b});
define('format_oustudyplan/notify', ["jquery"],function(a){var b={currentNotification:null,outQueue:[],fadingOut:!1,fadingIn:!1,alert:function(c){if(b.currentNotification)return b.outQueue.push(c),void b.fade();var d=M.util.get_string("hidenotification","format_oustudyplan"),e=a('<div class="oustudyplan-notification"><div role="alert">'+c+'<a class="oustudyplan-cancel" href="#" title="'+d+'"><img src="'+M.util.image_url("t/delete")+'" alt="'+d+'" /></a></div></div>');b.currentNotification=e,a("body").append(e),e.on("click","a.oustudyplan-cancel",function(a){a.preventDefault(),b.fade()}),M.util.js_pending("format_oustudyplan_notificationshow"),b.fadingIn=!0,b.handlePossibleTransitions(b.currentNotification,function(){M.util.js_complete("format_oustudyplan_notificationshow"),b.fadingIn=!1,b.outQueue.length&&b.fade()}),setTimeout(function(){e.addClass("oustudyplan-shown")},0)},handlePossibleTransitions:function(a,b,c){void 0===c&&(c=10),a.one("transitionend",function(){b()});var d=!1;a.one("transitionstart",function(){d=!0}),setTimeout(function(){d||b()},c)},fade:function(){b.fadingOut||b.fadingIn||b.currentNotification&&(b.fadingOut=!0,M.util.js_pending("format_oustudyplan_notificationcancel"),b.handlePossibleTransitions(b.currentNotification,function(){b.currentNotification.remove(),b.currentNotification=null,M.util.js_complete("format_oustudyplan_notificationcancel"),b.fadingOut=!1,b.outQueue.length&&b.alert(b.outQueue.shift())}),b.currentNotification.addClass("oustudyplan-faded"))}};return b});
define('format_oustudyplan/owned', ["jquery"],function(a){var b={init:function(){b.initEditingToggles()},initEditingToggles:function(){var b=/[?&]id=([0-9]+).*?&cmid=([0-9]+)/.exec(location.search);if(b){var c="/course/view.php?id="+b[1]+"&cmid="+b[2];a("a[href*=course\\/view\\.php][href*=\\&edit\\=]").each(function(){this.href+="&return="+encodeURIComponent(c)}),a(".singlebutton input[type=hidden][name=edit]").each(function(){a(this).before('<input type="hidden" name="return" value="'+c+'" />')})}}};return b});
define('format_oustudyplan/postlinks', ["jquery"],function(a){var b={init:function(){a("body").on("click","a[data-postlink=1]",function(b){b.preventDefault(),a(this).closest("form").submit()})}};return b});
define('format_oustudyplan/searchbox', ["jquery"],function(a){var b={form:null,input:null,button:null,rightBit:null,waitingFocus:!1,foundFocus:!1,justExpanded:0,init:function(){if(b.form=a("form.oustudyplan-searchbox"),b.form.length){a(window).on("resize",function(){b.updateSearchButton()}),b.input=a("input[type=text]",b.form),b.button=a("button",b.form),b.rightBit=b.form.closest(".oustudyplan-rightbit"),b.input.on("input",function(){b.updateSearchButton()}),b.input.on("blur",function(){b.partBlurred()}),b.button.on("blur",function(){b.partBlurred()}),b.input.on("focus",function(){b.partFocused()}),b.button.on("focus",function(){b.partFocused()}),b.button.on("click",function(a){b.searchClicked(a)}),b.updateSearchButton();var c=/[?&]query=([^&]+)/,d=c.exec(location.search);d&&/(resources_search|ousearch)\/search\.php$/.test(location.pathname)&&(d[1]=d[1].replace(/\+/g," "),b.input.val(decodeURIComponent(d[1])))}},getContent:function(){return b.input.val().replace(/^\s*(.*)\s*$/,"$1")},updateSearchButton:function(){"0px"===b.input.css("width")||b.isExpanded()?b.button.prop("disabled",!1):b.button.prop("disabled",""===b.getContent())},searchClicked:function(a){Date.now()-b.justExpanded<250?a.preventDefault():b.isExpanded()&&""===b.getContent()?(a.preventDefault(),b.rightBit.removeClass("oustudyplan-searchexpanded")):"0px"===b.input.css("width")&&(a.preventDefault(),b.expand())},expand:function(){b.rightBit.addClass("oustudyplan-searchexpanded"),b.input.focus(),b.justExpanded=Date.now(),setTimeout(function(){b.updateSearchButton()},100)},partFocused:function(){return b.waitingFocus?void(b.foundFocus=!0):void("0px"===b.input.css("width")&&b.expand())},isExpanded:function(){return b.rightBit.hasClass("oustudyplan-searchexpanded")},partBlurred:function(){b.isExpanded()&&(b.waitingFocus=!0,b.foundFocus=!1,setTimeout(function(){b.waitingFocus=!1,b.foundFocus||(b.rightBit.removeClass("oustudyplan-searchexpanded"),setTimeout(function(){b.updateSearchButton()},250))},0))}};return b});
define('format_oustudyplan/sections', ["jquery","format_oustudyplan/notify","theme_osep/animations","theme_osep/drag","theme_osep/dialogue","core/ajax"],function(a,b,c,d,e,f){var g={supportsTransitions:!1,editing:!1,sectionNumber:!1,sectionDragging:null,sectionNewIndex:0,sectionOriginalIndex:0,previousSectionIdList:null,previousSectionColumnList:null,sectionDraggingStartTime:0,CLICK_TIME:500,CSS:{ID:{LAST_INSERT:"oustudyplan-lastinsert",LAST_INSERT_SECOND:"oustudyplan-lastinsert-secondcolumn",BLOCK_REGION_CONTAINER:"osep-sidecol-container"},CLASS:{COLUMN:"oustudyplan",PLACEHOLDER:"oustudyplan-secondcolumn-placeholder",SECOND_COLUMN:"oustudyplan-secondcolumn"}},SELECTORS:{ACTIVITY:"li.activity",AFTERSECTION_SUFFIX:" input[name=aftersection]",ALL_SECTIONS:"ul.oustudyplan > li.section",BEFORESECTION_PREFIX:"#oustudyplan-beforesection",COLUMN_WRAPPER:".oustudyplan-columns",FIRST_COLUMN:".oustudyplan-columns > ul:not(.oustudyplan-secondcolumn)",FIRST_COLUMN_SECTIONS:".oustudyplan-columns > ul:not(.oustudyplan-secondcolumn) > li.section",INSERT:".oustudyplan-insert",LAST_INSERT:"#oustudyplan-lastinsert",LAST_INSERT_SECOND:"#oustudyplan-lastinsert-secondcolumn",PLACEHOLDER:".oustudyplan-secondcolumn-placeholder",SECOND_COLUMN:".oustudyplan-columns > ul.oustudyplan-secondcolumn",SECOND_COLUMN_SECTIONS:".oustudyplan-columns > ul.oustudyplan-secondcolumn > li.section",SECOND_LAST_CHILD:":nth-last-child(2)",SECTIONS:"li.section",SECTION_NAME:".oustudyplan-sectionupper > h3.sectionname",SECTION_PREFIX:"#section-",BLOCK_REGION:"#osep-sidecol",BLOCKS_IN_REGION:"#osep-sidecol .block",PAGE_WRAPPER:"#osep-pagewrapper",BLOCK_REGION_CONTAINER:"#osep-sidecol-container"},init:function(){g.editing=a("body.editing").length>0,g.editing&&(a("body").on("submit","form.oustudyplan-combine",function(a){a.preventDefault(),g.combine(this)}),a("body").on("submit","form.oustudyplan-split",function(a){a.preventDefault(),g.split(this)}),a("body").on("submit","form.oustudyplan-delete",function(a){a.preventDefault(),g.del(this)}),a("body").on("submit","form.oustudyplan-insert",function(a){a.preventDefault(),g.insert(this)}),a("body").on("click",'a.editing_delete[href*="/oustudyplan/deletecm.php?id="]',function(a){a.preventDefault(),g.deleteCm(this)}),a("body").on("click","a.oustudyplan-undeletecm",function(a){a.preventDefault(),g.undeleteCm(this)}),a("body").on("mousedown","a.oustudyplan-movesection",function(a){a.preventDefault(),g.startSectionDrag(a,this)}),a("body").on("click","a.oustudyplan-movesection",function(a){a.preventDefault(),g.sectionAccessibleMove(this)}),a("body").on("click",".oustudyplan-movesectiondialogue ul a",function(a){a.preventDefault(),g.sectionAccessibleMoveTo(this)}),a("body").on("submit","form.oustudyplan-hidesection",function(a){a.preventDefault(),g.clickHideSection(this)}),a("body").on("mouseover mouseout","form.oustudyplan-insert input",function(b){var c=a(b.target).closest("li.oustudyplan-insert");c.toggleClass("oustudyplan-insert-mouseover oustudyplan-insert-mouseout")}),a('.modtype_repeatactivity .activityinstance a[href="#"],.modtype_oustudyplansubpage .activityinstance a[href="#"]').click(function(a){a.preventDefault(),g.notifyString("notpossibletomoveinsideitself")}),g.updateDeleteIcons(),setInterval(g.updateDeleteIcons,500)),0!==a(g.SELECTORS.BLOCKS_IN_REGION).length&&0!==a(g.SELECTORS.SECOND_COLUMN).length&&g.moveBlockRegionToColumn(),a("form.oustudyplan-allweeks").on("submit",function(a){a.preventDefault(),g.toggleAllWeeks(),g.updateExpandCollapseAll()}),a("body").on("click","a.oustudyplan-expand",function(a){a.preventDefault(),g.expandSection(this,!1,!0)}),a("body").on("click","a.oustudyplan-collapse",function(a){a.preventDefault(),g.collapseSection(this,!1,!0)}),a("#oustudyplan-expandall").on("click",function(a){a.preventDefault(),g.expandAll(!0)}),a("#oustudyplan-collapseall").on("click",function(a){a.preventDefault(),g.expandAll(!1)}),0===a("a.oustudyplan-expand").length&&a(".oustudyplan-expandall").css("display","none"),g.updateExpandCollapseAll(),g.supportsTransitions="transition"in document.body.style,g.sectionNumber=g.getSectionNumber(),g.sectionNumber&&g.displaySection()},getSectionNumber:function(){var a=document.URL,b=a.split("#"),c="";return!(b.length<2)&&(c=b[1].match(/section-(\d+)/),null!==c&&c[1])},displaySection:function(){var b=a("li#section-"+g.sectionNumber).filter(":hidden").length,c=a(".oustudyplan-mainsections").hasClass("oustudyplan-currentweeks");b&&c&&g.toggleAllWeeks(),g.expandSection("a#oustudyplan-expand-"+g.sectionNumber,!1,!1),a("a#oustudyplan-collapse-"+g.sectionNumber).focus(),a("li#section-"+g.sectionNumber)[0].scrollIntoView()},doAjax:function(c,d){M.util.js_pending("oustudyplan-ajaxprogress"),b.fade(),a("body").append('<div id="oustudyplan-ajaxprogress"></div>');var e=a("#oustudyplan-ajaxprogress");e.addClass("showing");var f=a.ajax(c),h=function(){g.supportsTransitions?(e.on("transitionend",function(){e.remove(),M.util.js_complete("oustudyplan-ajaxprogress")}),e.removeClass("showing")):(e.remove(),M.util.js_complete("oustudyplan-ajaxprogress"))};f.done(function(a){h(),d(a)}),f.fail(function(a,b,c){h(),g.ajaxError(a,b,c)})},combine:function(a){g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/combine.php",method:"POST",data:{sesskey:M.cfg.sesskey,combine:1,section:a.section.value,ajax:1}},g.combineDone)},combineDone:function(b){a("#section-"+b.removed.number).remove(),a("#oustudyplan-beforesection"+b.removed.id).remove(),a("#section-"+b.section.number).replaceWith(b.section.html),a("#oustudyplan-beforesection"+b.section.id).replaceWith(b.section.beforehtml),g.addedSection("#section-"+b.section.number),g.updateSectionNumbers(b.section.number,-1);for(var c=0;c<b.alsochanged.length;c++){var d=b.alsochanged[c];a("#section-"+d.number).replaceWith(d.html),g.addedSection("#section-"+d.number)}g.updateLastSectionId(),g.notifyString("combinedsection")},updateSectionNumbers:function(b,c){var d=/^section-([0-9]+)$/;a("li").each(function(){var a=d.exec(this.id);if(a){var e=Number(a[1]);e>b&&(this.id="section-"+(e+c))}})},split:function(a){g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/combine.php",method:"POST",data:{sesskey:M.cfg.sesskey,combine:0,section:a.section.value,ajax:1}},g.splitDone)},splitDone:function(b){g.updateSectionNumbers(b.existingsection.number,b.newsections.length),a("#section-"+b.existingsection.number).replaceWith(b.existingsection.html),g.addedSection("#section-"+b.existingsection.number);for(var c="",d=0;d<b.newsections.length;d++)c+=b.newsections[d].beforehtml,c+=b.newsections[d].html;for(a(c).insertAfter("#section-"+b.existingsection.number),d=0;d<b.newsections.length;d++)g.addedSection("#section-"+b.newsections[d].number);for(d=0;d<b.alsochanged.length;d++){var e=b.alsochanged[d];a("#section-"+e.number).replaceWith(e.html),a("#oustudyplan-beforesection"+e.id).replaceWith(e.beforehtml),g.addedSection("#section-"+e.number)}g.updateLastSectionId(),g.notifyString("splitsection")},del:function(a){g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/delete.php",method:"POST",data:{sesskey:M.cfg.sesskey,section:a.section.value,ajax:1}},g.delDone)},delDone:function(b){var c=a(g.SELECTORS.SECTION_PREFIX+b.deletedsection.number),d=c.closest("ul");c.remove(),a("#oustudyplan-beforesection"+b.deletedsection.id).remove(),g.updateSectionNumbers(b.deletedsection.number,-1);for(var e=0;e<b.alsochanged.length;e++){var f=b.alsochanged[e];a("#section-"+f.number).replaceWith(f.html),a("#oustudyplan-beforesection"+f.id).replaceWith(f.beforehtml),g.addedSection("#section-"+f.number)}d.hasClass(g.CSS.CLASS.SECOND_COLUMN)&&0===d.find(g.SELECTORS.SECTIONS).length&&g.replaceColumnWithPlaceholder(d,g.CSS.CLASS.PLACEHOLDER),g.updateLastSectionId(),g.notifyString("deletedsection")},updateLastSectionId:function(){var b=a("#oustudyplan-lastinsert").prev().prev(".oustudyplan-insert"),c=b.attr("id").replace(/^oustudyplan-beforesection/,"");a("#oustudyplan-lastinsert input[name=aftersection]").attr("value",c),0!==a(g.SELECTORS.PLACEHOLDER).length?a(g.SELECTORS.LAST_INSERT_SECOND+g.SELECTORS.AFTERSECTION_SUFFIX).attr("value",c):0!==a(g.SELECTORS.SECOND_COLUMN).length&&(b=a(g.SELECTORS.LAST_INSERT_SECOND).prev().prev(g.SELECTORS.INSERT),c=b.attr("id").replace(/^oustudyplan-beforesection/,""),a(g.SELECTORS.LAST_INSERT_SECOND+g.SELECTORS.AFTERSECTION_SUFFIX).attr("value",c))},insert:function(a){var b={sesskey:M.cfg.sesskey,ajax:1};a.beforesection?b.beforesection=a.beforesection.value:b.aftersection=a.aftersection.value,a.howmany&&(b.howmany=a.howmany.value),a.secondcolumn&&(b.secondcolumn=a.secondcolumn.value),g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/insert.php",method:"POST",data:b},g.insertDone)},insertDone:function(b){for(var c=b.newsection.length,d=0!==a(g.SELECTORS.COLUMN_WRAPPER).length,e=0;e<c;e++){g.updateSectionNumbers(b.newsection[e].number-1,1);var f="#section-"+(b.newsection[e].number+1);if(d)if(b.newsection[e].secondcolumn){if(0===a(g.SELECTORS.SECOND_COLUMN).length){var h=a(g.SELECTORS.PLACEHOLDER);g.replacePlaceholderWithColumn(h,g.CSS.CLASS.COLUMN+" "+g.CSS.CLASS.SECOND_COLUMN)}f=g.SELECTORS.SECOND_COLUMN+" "+f}else f=g.SELECTORS.FIRST_COLUMN+" "+f;var i=a(f).prev();i.length||(f=d&&b.newsection[e].secondcolumn?g.SELECTORS.LAST_INSERT_SECOND:g.SELECTORS.LAST_INSERT,i=a(f)),i.before(b.newsection[e].beforehtml),i.before(b.newsection[e].html),g.addedSection("#section-"+b.newsection[e].number)}for(var j=0;j<b.alsochanged.length;j++){var k=b.alsochanged[j];a("#section-"+k.number).replaceWith(k.html),a("#oustudyplan-beforesection"+k.id).replaceWith(k.beforehtml),g.addedSection("#section-"+k.number)}g.updateLastSectionId(),1==c?g.notifyString("insertedsection"):g.notifyString("insertedsections",c)},addedSection:function(b){var c=a(b);if(!c.length)throw new Error("No such section: "+b);var d=a('<li><ul id="oustudyplan-processing"/></li>');d.insertBefore(c),a("#oustudyplan-processing").append(c),M.course.coursebase.invoke_function("setup_for_section","#oustudyplan-processing"),c.insertBefore(d),d.remove(),M.core.actionmenu&&M.core.actionmenu.newDOMNode(Y.one(b))},updateDeleteIcons:function(){a("form.oustudyplan-delete").each(function(){var b=a(this).closest(g.SELECTORS.SECTIONS),c=b.has(g.SELECTORS.ACTIVITY).length,d=b.closest("ul"),e=d.children(g.SELECTORS.SECTIONS).length;!c&&(e>1||d.hasClass(g.CSS.CLASS.SECOND_COLUMN))?a(this).addClass("oustudyplan-shown"):a(this).removeClass("oustudyplan-shown")})},toggleAllWeeks:function(){M.util.js_pending("format_oustudyplan_allweeksanim"),M.util.js_pending("format_oustudyplan_allweeksajax");var b=a("form.oustudyplan-allweeks button[value=1]"),c=a("form.oustudyplan-allweeks button[value=0]"),d=!b.prop("disabled");b.prop("disabled",d),b.html(M.util.get_string(d?"showingx":"showx","format_oustudyplan",b.data("visiblelabel"))),c.prop("disabled",!d),c.html(M.util.get_string(d?"showx":"showingx","format_oustudyplan",c.data("visiblelabel"))),d?c.focus():b.focus();var e=a(".oustudyplan-mainsections");e.animate({opacity:0},100,function(){d?(e.removeClass("oustudyplan-currentweeks"),e.addClass("oustudyplan-allweeks")):(e.removeClass("oustudyplan-allweeks"),e.addClass("oustudyplan-currentweeks")),g.updateExpandCollapseAll(),e.animate({opacity:1},100,function(){M.util.js_complete("format_oustudyplan_allweeksanim")})});var f=a.ajax({url:M.cfg.wwwroot+"/course/format/oustudyplan/allweeks.php",method:"POST",data:{sesskey:M.cfg.sesskey,ajax:1,course:a(".oustudyplan-expandall").data("courseid"),all:d?1:0}});f.fail(function(a,b,c){g.ajaxError(a,b,c)}).always(function(){M.util.js_complete("format_oustudyplan_allweeksajax")})},deleteCm:function(b){var c=/oustudyplan\/deletecm\.php\?id=([0-9]{1,9})$/.exec(b.href),d=a("#module-"+c[1]),h=d.attr("class");if(h.indexOf("useroptions")>=0){var i='<div class="confirmation-buttons form-inline"><input type="button" class="btn btn-primary m-r-1 yes-button" value="'+M.util.get_string("notification_yes","format_oustudyplan")+'"><input type="button" class="btn btn-secondary m-r-1 no-button" value="'+M.util.get_string("notification_no","format_oustudyplan")+'"></div>',j={headerContent:M.util.get_string("notification_confirm","format_oustudyplan"),bodyContent:M.util.get_string("notification_deletedgroup","format_oustudyplan"),footerContent:i,centered:!0,constrain:!0,focused:!0,modal:!0,zIndex:100001,responsive:!0,draggable:!0,width:"400px"};j.done=function(b){b.show(),a(".no-button").click(function(a){a.preventDefault(),b.hide()}),a(".yes-button").click(function(a){a.preventDefault(),g.deleteActivity(c),f.call([{methodname:"mod_useroptions_update_deletegroupandgrouping",args:{cmid:c[1]},done:b.hide()}]),b.hide()})},e.makeDialogue(j,!0)}else g.deleteActivity(c)},deleteActivity:function(a){g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/deletecm.php",method:"POST",data:{sesskey:M.cfg.sesskey,id:a[1],ajax:1}},g.deleteCmDone)},deleteCmDone:function(b){var c,d=a("#module-"+b.deletedcmid);d.remove();for(var e=0;e<b.otherdeletedcmids.length;e++)c=a("#module-"+b.otherdeletedcmids[e]),c&&c.remove();g.notify(g.getDeleteMessage("notification_deletedcm","notification_deletedcmplus",b.otherdeletedcmids.length)+' <a class="oustudyplan-undeletecm" href="#" data-cmid="'+b.deletedcmid+'">'+M.util.get_string("notification_undo","format_oustudyplan")+"</a>")},getDeleteMessage:function(a,b,c){return c>0?M.util.get_string(b,"format_oustudyplan",c):M.util.get_string(a,"format_oustudyplan")},undeleteCm:function(a){var b=a.getAttribute("data-cmid");g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/undeletecm.php",method:"POST",data:{sesskey:M.cfg.sesskey,id:b,ajax:1}},g.undeleteCmDone)},undeleteCmDone:function(b){var c,d;a("#section-"+b.section.number).replaceWith(b.section.html),g.addedSection("#section-"+b.section.number);for(var e=0;e<b.othersections.length;e++)c=b.othersections[e],d=a("#section-"+c.number),d&&(d.replaceWith(c.html),g.addedSection("#section-"+c.number));g.notify(g.getDeleteMessage("notification_undeletedcm","notification_undeletedcmplus",b.numotherundeleted))},expandSection:function(b,d,e){var f=a(b).closest(".section");if(f.hasClass("oustudyplan-collapsed")){d||M.util.js_pending("format_oustudyplan_expandajax"),M.util.js_pending("format_oustudyplan_expandanim-"+b.id);var h=function(){g.updateExpandCollapseAll(),M.util.js_complete("format_oustudyplan_expandanim-"+b.id)},i=f.find(".oustudyplan-sectionupper").height();f.removeClass("oustudyplan-collapsed"),d||(a(b).next().focus(),g.ajaxStoreExpanded(!0,f.data("sectionnum"))),e?c.openClose(f,!0,{closedHeight:i,after:h}):(f.css("max-height",""),h())}},collapseSection:function(b,d,e){var f=a(b).closest(".section");if(!f.hasClass("oustudyplan-collapsed")){d||M.util.js_pending("format_oustudyplan_expandajax"),M.util.js_pending("format_oustudyplan_expandanim"+b.id);var h=function(){f.css("max-height",""),f.addClass("oustudyplan-collapsed"),d||(a(b).prev().focus(),g.ajaxStoreExpanded(!1,f.data("sectionnum"))),g.updateExpandCollapseAll(),M.util.js_complete("format_oustudyplan_expandanim"+b.id)};if(e){var i=f.find(".oustudyplan-sectionupper").height();c.openClose(f,!1,{closedHeight:i,after:h})}else h()}},expandAll:function(b){M.util.js_pending("format_oustudyplan_expandajax");var c,d=b?"expand":"collapse",e=a("a.oustudyplan-"+d);a(".oustudyplan-currentweeks").length&&(c=e.filter(function(){return a(this).closest("li.section.current, li.section.oustudyplan-nearcurrent").length>0})),g.ajaxStoreExpanded(b,null),e.each(function(a,d){var e=!c||c.index(d)!==-1;b?g.expandSection(d,!0,e):g.collapseSection(d,!0,e)}),g.updateExpandCollapseAll()},updateExpandCollapseAll:function(){var b,c=a(".oustudyplan-currentweeks, .oustudyplan-allweeks").length>0;b=c?a(".oustudyplan-currentweeks li.section.current.oustudyplan-collapsed,.oustudyplan-currentweeks li.section.oustudyplan-nearcurrent.oustudyplan-collapsed,.oustudyplan-allweeks li.section.oustudyplan-collapsed").length:a(".oustudyplan-mainsections li.section.oustudyplan-collapsed").length;var d=b>0,e=d?"expand":"collapse",f=d?"collapse":"expand",g=document.activeElement.id==="oustudyplan-"+f+"all",h=a("#oustudyplan-"+e+"all");h.css("display","block"),g&&h.focus(),a("#oustudyplan-"+f+"all").css("display","none")},notifyString:function(a,b){"undefined"==typeof b?g.notify(M.util.get_string("notification_"+a,"format_oustudyplan")):g.notify(M.util.get_string("notification_"+a,"format_oustudyplan",b))},notify:function(a){b.alert(a)},ajaxError:function(a,b){0!==a.status&&window.alert("Dynamic change attempt failed: "+b+". Try reloading the page.")},ajaxStoreExpanded:function(b,c){var d=null===c,e=a.ajax({url:M.cfg.wwwroot+"/course/format/oustudyplan/expanded.php",method:"POST",data:{sesskey:M.cfg.sesskey,course:a(".oustudyplan-expandall").data("courseid"),section:c,all:d,expanded:b}});e.fail(function(a,b,c){g.ajaxError(a,b,c)}).always(function(){M.util.js_complete("format_oustudyplan_expandajax")})},startSectionDrag:function(b,c){g.previousSectionIdList=g.getSectionIdList(),g.previousSectionColumnList=g.getSectionColumnIdList(),g.sectionDraggingStartTime=(new Date).getTime();var e,f=a(c).closest(".oustudyplan-sectionupper"),h=a("h3",f);e=h.hasClass("accesshide")?a('<h3 class="oustudyplan-untitledsection">'+h.prop("innerHTML")+"</h3>"):h.clone();var i=a('<div class="oustudyplan-sectiondragproxy" ><img src="'+M.util.image_url("i/move_2d")+'" /></div>');i.append(e),a(document.body).append(i),i.css({position:"absolute",top:"0",left:"0"});var j=f.find(".oustudyplan-movesection img").offset(),k=i.find("img").first().offset();i.css({top:j.top-k.top,left:j.left-k.left});var l=a(c).closest("li.section");l.addClass("oustudyplan-dragsource"),g.sectionDragging=l,g.sectionOriginalIndex=-1,a("ul.oustudyplan > li.section").each(function(a,b){b===l[0]&&(g.sectionOriginalIndex=a)}),g.sectionNewIndex=g.sectionOriginalIndex,d.start(b,i,g.sectionDragMove,g.sectionDragEnd)},sectionDragMove:function(b,c){var d,e=0!==a(g.SELECTORS.COLUMN_WRAPPER).length;if(!e||(d=a(g.SELECTORS.FIRST_COLUMN_SECTIONS),1!==d.length||g.sectionDragging.attr("id")!==d.attr("id"))){var f=a(g.SELECTORS.ALL_SECTIONS),h=a(g.SELECTORS.PLACEHOLDER),i=!1;f=f.add(h);for(var j=0,k=0;k<f.length;k++){var l=a(f[k]),m=l.offset().top,n=l.outerHeight(),o=l.offset().left,p=o+l.outerWidth(),q=b>o&&b<p;if(k<g.sectionNewIndex){if(e&&l.get(0)==d.last().get(0)&&c<m+n&&c>m+n/2&&q){j=k+1,i=!0;break}if(c<m+n/2&&q){j=k;break}j=k+1}else if(k>g.sectionNewIndex&&q){if(c<m+n/2){j=k-1,e&&l.get(0)==a(g.SELECTORS.SECOND_COLUMN_SECTIONS).first().get(0)&&(i=!0);break}j=k}}(g.sectionNewIndex!==j||i)&&(g.sectionNewIndex=g.internalMoveSection(g.sectionNewIndex,j,i))}},internalMoveSection:function(b,c,d){var e,f=a(g.SELECTORS.ALL_SECTIONS),h=f.prev(),i=0!==a(g.SELECTORS.COLUMN_WRAPPER).length,j=a(g.SELECTORS.SECOND_COLUMN);if(i){var k=a(g.SELECTORS.FIRST_COLUMN);0===j.length&&c===f.length&&(g.replacePlaceholderWithColumn(a(g.SELECTORS.PLACEHOLDER),g.CSS.CLASS.COLUMN+" "+g.CSS.CLASS.SECOND_COLUMN),j=a(g.SELECTORS.SECOND_COLUMN));var l=b<k.find(g.SELECTORS.SECTIONS).length?k:j,m=c<k.find(g.SELECTORS.SECTIONS).length?k:j;if(l!==m){var n,o,p;l===k?(n=l.find(g.SELECTORS.SECTIONS).last(),p=m.find("li").first(),c===f.length&&c--):(n=l.find(g.SELECTORS.SECTIONS).first(),p=m.find("li").last()),o=n.prev(),p.before(o).before(n)}}if(c>b){for(e=b;e<c;e++)a(h[e]).after(f[e+1]);a(h[c]).after(f[b])}else{for(e=c;e<b;e++)a(h[e+1]).after(f[e]);a(h[c]).after(f[b])}if(i){if(d){f=a(g.SELECTORS.ALL_SECTIONS);var q=f.eq(c),r=q.prev(),s=q.parent().siblings().first(),t=null;s.is(g.SELECTORS.FIRST_COLUMN)&&r.is(":first-child")?t=s.find("li").last():s.hasClass(g.CSS.CLASS.SECOND_COLUMN)&&q.is(g.SELECTORS.SECOND_LAST_CHILD)&&(t=s.find("li").first()),null!==t&&t.before(r).before(q)}0!==j.length&&0===j.children(g.SELECTORS.SECTIONS).length&&g.replaceColumnWithPlaceholder(j,g.SELECTORS.PLACEHOLDER.substr(1))}return c},getSectionIdList:function(){var b=a.map(a("ul.oustudyplan > li.section"),function(b){return a(b).data("sectionid")});return b.join(",")},getSectionColumnIdList:function(){var b=a.map(a(g.SELECTORS.FIRST_COLUMN_SECTIONS),function(b){return a(b).data("sectionid")}),c=a.map(a(g.SELECTORS.SECOND_COLUMN_SECTIONS),function(b){return a(b).data("sectionid")});return{first:b.join(","),second:c.join(",")}},sectionDragEnd:function(a,b){var c=g.getSectionIdList(),d=g.getSectionColumnIdList();c===g.previousSectionIdList&&d===g.previousSectionColumnList||g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/reorder.php",method:"POST",data:{sesskey:M.cfg.sesskey,sectionids:c,firstcolsectionids:d.first,secondcolsectionids:d.second,moved:g.sectionDragging.data("sectionid")}},g.reorderDone);var e=g.sectionDragging;g.sectionDragging.removeClass("oustudyplan-dragsource"),g.sectionDragging=null;var f=(new Date).getTime()-g.sectionDraggingStartTime;if(f<g.CLICK_TIME){var h=e.find("a.oustudyplan-movesection"),i=h.offset();a>=i.left&&b>=i.top&&a<i.left+h.outerWidth()&&b<i.top+h.outerHeight()&&g.sectionAccessibleMove(h)}},reorderDone:function(b){if(!b.ok)return void g.ajaxError({status:1},"Error reordering sections");var c;for(c=0;c<b.changed.length;c++){var d=b.changed[c],e=a("ul.oustudyplan > li.section[data-sectionid="+d.id+"]");if(!e.length)throw new Error("No such section id: "+d.id);e.replaceWith(d.html)}for(c=0;c<b.changed.length;c++)g.addedSection("#section-"+b.changed[c].number);g.updateLastSectionId(),g.updateInsertButtons(),g.notifyString("movedsection")},updateInsertButtons:function(){a("li.oustudyplan-insert").each(function(){var b=a(this),c=b.find("input[name=beforesection]"),d=b.find("input[name=aftersection]"),e=b.next(g.SELECTORS.SECTIONS),f=null;if(e.length)f=e.data("sectionid"),b.prop("id","oustudyplan-beforesection"+f),d.length&&d.remove(),c.length||(c=a('<input type="hidden" name="beforesection"/>'),b.find("input[type=image]").before(c)),c.prop("value",f);else{var h;h=b.parent(g.SELECTORS.SECOND_COLUMN+", "+g.SELECTORS.PLACEHOLDER).length>0?g.SELECTORS.LAST_INSERT_SECOND.substr(1):g.SELECTORS.LAST_INSERT.substr(1),b.prop("id",h),c.length&&c.remove(),d.length||(d=a('<input type="hidden" name="aftersection"/>'),b.find("input[type=image]").before(d)),d.prop("value",b.prev().data("sectionid"))}})},sectionAccessibleMove:function(b){var c,d=0!==a(g.SELECTORS.COLUMN_WRAPPER).length;c=a(d?g.SELECTORS.FIRST_COLUMN_SECTIONS:g.SELECTORS.ALL_SECTIONS);var f=a(g.SELECTORS.SECOND_COLUMN_SECTIONS);if(!(c.length<=1&&0===f.length)){var h=a(b).closest("ul.oustudyplan > li.section"),i=[],j=0;if(c.each(function(b,e){var f=null;if(j=b,h.get(0)===e)return!0;var k,l=0===a(e).prevAll("#"+h.attr("id")).length,m={text:null,newIndex:b,colShift:!1};c.first().get(0)===e?(m.text=M.util.get_string("move_start","format_oustudyplan"),c.last().get(0)===e&&d&&l&&(f={text:M.util.get_string("move_endfirstcolumn","format_oustudyplan"),newIndex:b+1,colShift:!0})):c.last().get(0)===e?d?l?(k=a(e).prevAll(g.SELECTORS.SECTIONS).first().find(g.SELECTORS.SECTION_NAME).prop("innerHTML"),m.text=M.util.get_string("move_aftersection","format_oustudyplan",k),f={text:M.util.get_string("move_endfirstcolumn","format_oustudyplan"),newIndex:b+1,colShift:!0}):(m.text=M.util.get_string("move_endfirstcolumn","format_oustudyplan"),h.parent().hasClass("oustudyplan-secondcolumn")&&(m.colShift=!0)):m.text=M.util.get_string("move_end","format_oustudyplan"):(k=l?a(e).prevAll(g.SELECTORS.SECTIONS).first().find(g.SELECTORS.SECTION_NAME).prop("innerHTML"):a(e).find(g.SELECTORS.SECTION_NAME).prop("innerHTML"),m.text=M.util.get_string("move_aftersection","format_oustudyplan",k)),i.push(m),null!==f&&i.push(f)}),d)if(0===a(g.SELECTORS.SECOND_COLUMN).length){var k={text:M.util.get_string("move_secondcolumn","format_oustudyplan"),newIndex:j+1,colShift:!1};i.push(k)}else{var l;l=j,f.each(function(b,c){var d=null;if(l++,h.get(0)===c)return!0;var e=0===a(c).nextAll("#"+h.attr("id")).length,j={text:null,newIndex:l,colShift:!1};if(f.first().get(0)===c)if(j.text=M.util.get_string("move_secondcolumn","format_oustudyplan"),e){var k=a(c).find(g.SELECTORS.SECTION_NAME).prop("innerHTML");d={text:M.util.get_string("move_aftersection","format_oustudyplan",k),newIndex:l,colShift:!1},j.colShift=!0,j.newIndex=l-1}else j.newIndex=l;else if(f.last().get(0)===c)j.text=M.util.get_string("move_endsecondcolumn","format_oustudyplan");else{var m;m=e?a(c).find(g.SELECTORS.SECTION_NAME).prop("innerHTML"):a(c).prevAll(".section").first().find(g.SELECTORS.SECTION_NAME).prop("innerHTML"),j.text=M.util.get_string("move_aftersection","format_oustudyplan",m)}i.push(j),null!==d&&i.push(d)})}var m='<ul data-movesectionid="'+h.data("sectionid")+'">';i.forEach(function(a){m+='<li><a href="#" data-newindex="'+a.newIndex+'" data-colshift="'+a.colShift+'">'+a.text+"</a></li>"}),m+="</ul>";var n={headerContent:a(b).find("img").attr("alt"),bodyContent:m,centered:!0,constrain:!0,focused:!0,modal:!0,extraClasses:["oustudyplan-movesectiondialogue"],responsive:!0,draggable:!0,width:"600px"};n.done=function(b){b.show(),e.makeDestroyOnClose(b),b.shouldResizeFullscreen()&&e.makeFullResponsiveHeight(b),a(".oustudyplan-movesectiondialogue ul > li:first-child > a").focus(),a(".oustudyplan-movesectiondialogue").data("oustudyplan-dialogueref",b)},e.makeDialogue(n,!0)}},sectionAccessibleMoveTo:function(b){var c=a(b).data("newindex"),d=a(b).data("colshift")===!0,e=a(b).closest("ul").data("movesectionid"),f=a(".section[data-sectionid="+e+"]"),h=f.prevAll("li.section").length;f.parent().hasClass(g.CSS.CLASS.SECOND_COLUMN)&&(h+=f.parent().siblings().first().children(g.SELECTORS.SECTIONS).length),g.internalMoveSection(h,c,d);var i=g.getSectionColumnIdList();a(".oustudyplan-movesectiondialogue").data("oustudyplan-dialogueref").destroy(),g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/reorder.php",method:"POST",data:{sesskey:M.cfg.sesskey,sectionids:g.getSectionIdList(),firstcolsectionids:i.first,secondcolsectionids:i.second,moved:e}},g.reorderDone)},clickHideSection:function(b){var c=a(b).closest(".section"),d=a("input[name=hide]",b).length?1:0;g.doAjax({url:M.cfg.wwwroot+"/course/format/oustudyplan/sectionhide.php",method:"POST",data:{sesskey:M.cfg.sesskey,sectionid:c.data("sectionid"),hide:d}},function(a){return a.ok?(c.replaceWith(a.section.html),g.addedSection("#section-"+a.section.number),void g.notifyString(d?"hiddensection":"shownsection")):void g.ajaxError({status:1},"Error changing section visibility")})},toggleColumnPlaceholder:function(a,b){if(0===a.length)throw new Error("Got empty toggleFrom element");var c=a.find(g.SELECTORS.LAST_INSERT_SECOND);c.detach(),a.replaceWith(b),b.append(c)},replaceColumnWithPlaceholder:function(b,c){g.removeBlockRegionFromColumn(),g.toggleColumnPlaceholder(b,a('<div class="'+c+'"></div>'))},replacePlaceholderWithColumn:function(b,c){g.toggleColumnPlaceholder(b,a('<ul class="'+c+'"></ul>')),g.moveBlockRegionToColumn()},moveBlockRegionToColumn:function(){a(g.SELECTORS.SECOND_COLUMN).append('<li id="'+g.CSS.ID.BLOCK_REGION_CONTAINER+'"></li>'),a(g.SELECTORS.BLOCK_REGION).detach().appendTo(a(g.SELECTORS.BLOCK_REGION_CONTAINER))},removeBlockRegionFromColumn:function(){a(g.SELECTORS.BLOCK_REGION).detach().prependTo(a(g.SELECTORS.PAGE_WRAPPER)),a(g.SELECTORS.BLOCK_REGION_CONTAINER).remove()}};return g});
define('format_oustudyplan/tutorials', ["jquery","core/ajax"],function(a,b){var c=!1,d={init:function(c,e){var f=a("body:not(.editing) .oustudyplan-mainsections:first");f.length&&(M.util.js_pending("format_oustudyplan_getevents"),b.call([{methodname:"format_oustudyplan_get_tutorial_events",args:{courseid:c,userid:e},done:function(a){a.fault?window.require(["core/notification"],function(b){var c={message:a.fault,type:"error"};b.addNotification(c),M.util.js_complete("format_oustudyplan_getevents")}):a.sections?(a.warning&&window.require(["core/notification"],function(b){var c={message:a.warning,type:"error"};b.addNotification(c)}),d.addEvents(a.sections)):M.util.js_complete("format_oustudyplan_getevents")},fail:function(a,b,c){window.console.log(b+" "+c),M.util.js_complete("format_oustudyplan_getevents")}}]))},addEvents:function(b){if(!c){c=!0;for(var d=0;d<b.length;d++){var e=b[d].num;if(e===-1){var f=a("#region-main .oustudyplan-upper + .oustudyplan-events:first");f.length?f.find("ul").append(a(a.parseHTML(b[d].html)).find("li")):a("#region-main .oustudyplan-upper").after(b[d].html)}else{var g=a(".oustudyplan-mainsections ul.oustudyplan li#section-"+e+":first");if(g.length){var h=g.find("div.content > div.oustudyplan-events:first");if(h.length){var i=a(a.parseHTML(b[d].html));h.find("ul:first").append(i.find("li"))}else g.find("div.content").append(b[d].html),g.find(".oustudyplan-sectionright").length&&!g.find(".oustudyplan-sectionright .oustudyplan-expandcollapse").length&&g.find(".oustudyplan-sectionright:first").append(b[d].expand)}}}M.util.js_complete("format_oustudyplan_getevents")}}};return d});
define('format_oustudyplan/areamenus', ["jquery","theme_osep/animations","theme_osep/responsive"],function(a,b,c){var d={buttonCopy:null,currentMenu:null,windowWidth:0,init:function(){a(".oustudyplan-headerstripe").on("click","li.oustudyplan-hasmenu .oustudyplan-navlink",d.menuLinkClick).on("mouseover","li.oustudyplan-hasmenu .oustudyplan-navlink",d.menuLinkOver).on("mouseover",".oustudyplan-menu",d.menuOver),a("#oustudyplan-hamburger").on("click","li.oustudyplan-hasmenu .oustudyplan-navlink",d.menuLinkClick),c.addWidthListener(d.responsiveWidthChange),d.windowWidth=a(window).width(),a(window).on("resize",d.resizeDuringMenu)},menuLinkOver:function(b){var e=a(b.currentTarget).closest("li").children(".oustudyplan-menu");"mobile"!==c.getWidthCategory()&&d.openDesktop(e)},menuOver:function(b){!d.currentMenu||"hiding"!==d.currentMenu.data("menuState");var e=a(b.currentTarget).closest("ul.oustudyplan-menu");"mobile"!==c.getWidthCategory()&&d.openDesktop(e)},menuLinkClick:function(b){b.preventDefault();var e=a(b.currentTarget).closest("li").children(".oustudyplan-menu");"showing"===e.data("menuState")||"shown"===e.data("menuState")?"mobile"===c.getWidthCategory()?d.closeMobile(e):d.closeDesktop(e):"mobile"===c.getWidthCategory()?d.openMobile(e):d.openDesktop(e,!0)},openDesktop:function(c,e){if("showing"!==c.data("menuState")&&"shown"!==c.data("menuState")){d.currentMenu&&d.currentMenu[0]!==c[0]&&d.closeDesktop(d.currentMenu),d.currentMenu=c;var f=c.closest("li"),g=f.children("a"),h=g.find("img").attr("src"),i=h.replace("chevron_down","chevron_up");g.find("img").attr("src",i);var j=g.position(),k=a("#osep-pagewrapper"),l=350;if(k.length){var m=k.offset().left+k.innerWidth(),n=g.offset().left;m-n<l&&(l=parseInt(m-n))}c.css({display:"block",opacity:0,left:j.left,top:g.outerHeight(),minWidth:g.outerWidth(),maxWidth:l}),c.data("menuState")||(c.on("keydown","> li > .oustudyplan-menuitem",function(a){d.menuKeyDown(a,c)}),c.on("mouseout",function(a){d.mousePossiblyLeaving(a)}));var o=c.closest(".oustudyplan-headerstripe");d.buttonCopy=a('<div id="oustudyplan-menubuttoncopy" tabindex="0"/>'),f.hasClass("oustudyplan-selected")&&d.buttonCopy.addClass("oustudyplan-selected"),d.buttonCopy.append(g.html());var p=g.outerWidth()+1;d.buttonCopy.css({left:g.offset().left,top:o.offset().top,width:p,height:o.outerHeight()}),d.buttonCopy.on("mouseout",function(a){d.mousePossiblyLeaving(a)}),d.buttonCopy.on("keydown",function(a){d.buttonCopyKeyDown(a,c)}),a(document.body).append(d.buttonCopy),e&&d.buttonCopy.focus(),c.data("menuState","showing"),b.fade(c,1,{after:function(){"showing"===c.data("menuState")&&c.data("menuState","shown")}})}},buttonCopyKeyDown:function(a,b){switch(a.which){case 13:case 27:return a.preventDefault(),void d.closeDesktop(b)}d.handleNavigationKeys(a,function(){b.find("li > .oustudyplan-menuitem").last().focus()},function(){b.find("li > .oustudyplan-menuitem").first().focus()})},menuKeyDown:function(b,c){if(27===b.which)return b.preventDefault(),void d.closeDesktop(c);var e=a(b.currentTarget).closest("li");d.handleNavigationKeys(b,function(){e.prev().length>0?e.prev().first().children(".oustudyplan-menuitem").focus():d.buttonCopy.focus()},function(){e.next().length>0?e.next().first().children(".oustudyplan-menuitem").focus():d.buttonCopy.focus()})},handleNavigationKeys:function(a,b,c){38==a.which||9==a.which&&a.shiftKey?(a.preventDefault(),b()):(40===a.which||9===a.which&&!a.shiftKey)&&(a.preventDefault(),c())},mousePossiblyLeaving:function(a){!d.currentMenu||d.containsOrSelf(d.currentMenu,a.relatedTarget)||d.containsOrSelf(d.buttonCopy,a.relatedTarget)||d.closeDesktop(d.currentMenu)},containsOrSelf:function(b,c){var d=b[0];return d===c||a.contains(d,c)},closeDesktop:function(c){if(c.data("menuState")&&"hiding"!==c.data("menuState")){var e=c.closest("li"),f=e.children("a");c[0]===d.currentMenu[0]&&(document.activeElement&&(a(document.activeElement).parents().is(c)||a(document.activeElement).is(d.buttonCopy))&&f.focus(),d.buttonCopy.remove(),d.buttonCopy=null,d.currentMenu=null),c.data("menuState","hiding");var g=f.find("img").attr("src"),h=g.replace("chevron_up","chevron_down");f.find("img").attr("src",h),b.fade(c,0,{after:function(){"hiding"===c.data("menuState")&&(c.css({display:"",opacity:"",left:"",top:""}),c.removeData("menuState"))}})}},resizeDuringMenu:function(){a(window).width()!=d.windowWidth&&d.currentMenu&&"mobile"!==c.getWidthCategory()&&d.closeDesktop(d.currentMenu),d.windowWidth=a(window).width()},responsiveWidthChange:function(b,c){"mobile"===c&&a("li.oustudyplan-open > .oustudyplan-menu").each(function(){var b=a(this);b.removeData("menuState"),b.closest("li").removeClass("oustudyplan-open"),b.css("display","")})},openMobile:function(c){a("li.oustudyplan-open > .oustudyplan-menu").each(function(){var b=a(this);d.closeMobile(b)}),c.data("menuState","showing"),b.openClose(c,!0,{after:function(){c.data("menuState","shown");var a=c.closest("li.oustudyplan-hasmenu");a.addClass("oustudyplan-open")}})},closeMobile:function(a){a.data("menuState","hiding"),b.openClose(a,!1,{after:function(){a.removeData("menuState");var b=a.closest("li.oustudyplan-hasmenu");b.removeClass("oustudyplan-open"),a.css("display","")}})}};return d});
define('format_oustudyplan/studenthomedata', ["jquery","core/ajax"],function(a,b){var c={init:function(a,d){M.util.js_pending("format_oustudyplan_studenthomedata"),b.call([{methodname:"format_oustudyplan_get_studenthome_data",args:{courseid:a,userid:d},done:function(a){c.fillTutor(a),c.insertExams(a),M.util.js_complete("format_oustudyplan_studenthomedata")},fail:function(){M.util.js_complete("format_oustudyplan_studenthomedata"),window.require(["core/notification"],function(a){var b={message:M.util.get_string("errorloadingtutor","format_oustudyplan"),type:"error"};a.addNotification(b)})}}])},fillTutor:function(b){var c=a(".block_oucontacttutor > .content");if(c.length){var d=a(".oucontacttutor-name",c);d.text(b.tutorname);var e=a("a",c);if(b.tutorlinktitle){e.attr("href",b.tutorlinkurl);var f=a(".oucontacttutor-linktitle",e);f.text(b.tutorlinktitle),a("div.block_oucontacttutor").show()}else e.remove()}},insertExams:function(b){var d=a("body:not(.editing) .oustudyplan-mainsections:first");if(d.length){var e=JSON.parse(b.examevents);e.fault?window.require(["core/notification"],function(a){var b={message:e.fault,type:"error"};a.addNotification(b)}):e.sections&&c.addEvents(e.sections)}},addEvents:function(b){for(var c=0;c<b.length;c++){var d=b[c].num;if(d===-1){var e=a("#region-main .oustudyplan-upper + .oustudyplan-events:first");e.length?e.find("ul").append(a(a.parseHTML(b[c].html)).find("li")):a("#region-main .oustudyplan-upper").after(b[c].html)}else{var f=a(".oustudyplan-mainsections ul.oustudyplan li#section-"+d+":first");if(f.length){var g=f.find("div.content > div.oustudyplan-events:first");if(g.length){var h=a(a.parseHTML(b[c].html));g.find("ul:first").append(h.find("li"))}else f.find("div.content").append(b[c].html),f.find(".oustudyplan-sectionright").length&&!f.find(".oustudyplan-sectionright .oustudyplan-expandcollapse").length&&f.find(".oustudyplan-sectionright:first").append(b[c].expand);b[c].html.indexOf(' class="oustudyplan-assessmentevent"')!=-1&&f.addClass("oustudyplan-hasassessmentevents")}}}}};return c});
define('format_oustudyplan/eventshelper', ["jquery","core/str"],function(a,b){var c={SELECTORS:{VIEW_ALL_PAST_EVENTS_LINK:"#viewallpastevents",VIEW_ALL_UPCOMING_EVENTS_LINK:"#viewallupcomingevents",ACCESS_BOOKED_EVENTS:"#viewallupcomingevents span",ACCESS_PAST_EVENTS:"#viewallpastevents span",BODY_TABLE_PAST_EVENTS:"#tablepastevents > tbody",BODY_TABLE_UPCOMING_EVENTS:"#tableupcomingevents > tbody"},init:function(){var d,e,f,g,h,i;b.get_string("tutorials_table_expand_all","format_oustudyplan").done(function(a){d=a}),b.get_string("tutorials_table_collapsed_all","format_oustudyplan").done(function(a){e=a}),b.get_string("tutorials_collapse_past_events","format_oustudyplan").done(function(a){h=a}),b.get_string("tutorials_view_past_events","format_oustudyplan").done(function(a){i=a}),b.get_string("tutorials_collapse_booked_events","format_oustudyplan").done(function(a){f=a}),b.get_string("tutorials_view_booked_events","format_oustudyplan").done(function(a){g=a}),a(c.SELECTORS.VIEW_ALL_PAST_EVENTS_LINK).click(function(){c.showHideEventsTable(c.SELECTORS.VIEW_ALL_PAST_EVENTS_LINK,c.SELECTORS.BODY_TABLE_PAST_EVENTS,d,e,c.SELECTORS.ACCESS_PAST_EVENTS,i,h)}),a(c.SELECTORS.VIEW_ALL_UPCOMING_EVENTS_LINK).click(function(){c.showHideEventsTable(c.SELECTORS.VIEW_ALL_UPCOMING_EVENTS_LINK,c.SELECTORS.BODY_TABLE_UPCOMING_EVENTS,d,e,c.SELECTORS.ACCESS_BOOKED_EVENTS,g,f)})},showHideEventsTable:function(b,c,d,e,f,g,h){M.util.js_pending("format_oustudyplan_eventshelper");var i=a(b).find("span");a(b).hasClass("expanded")?(a(c).hide(),a(b).removeClass("expanded").addClass("collapsed"),a(b).text(d),a(b).append(i),a(f).text(g)):(a(c).show(),a(b).removeClass("collapsed").addClass("expanded"),a(b).text(e),a(b).append(i),a(f).text(h)),M.util.js_complete("format_oustudyplan_eventshelper")}};return c});
define('format_oustudyplan/lastviewedstructurecontent', ["jquery"],function(a){var b={ALL_WEEK:a('form.oustudyplan-allweeks div button[value="1"]'),SECTION_LINK:a("a#oustudyplan-last-viewed-section")},c={init:function(){c.addEvent()},addEvent:function(){b.SECTION_LINK.length>0&&b.SECTION_LINK.on("click",function(){var c=a(this).attr("href"),d=c.split("#");if(d.length>1){var e=d[1];!a("#"+e).length||a("#"+e).hasClass("oustudyplan-nearcurrent")||a("#"+e).hasClass("current")||(b.ALL_WEEK.click(),setTimeout(function(){document.getElementById(e).scrollIntoView()},200))}})}};return c});
define('format_ousubject/editmode', ["jquery","theme_osep/animations","core/str","core/modal_factory"],function(a,b,c,d){var e={handlers:[],init:function(){a(".ousubject-editbutton > a").on("click",e.buttonClick),a(".ousubject-movebutton > a").on("click",e.moveButtonClick),a(".ousubject-yourmodules-editbutton > a").on("click",e.buttonClick);var b=a("#ousubject-yourlinks .ousubject-movebutton > a");b.css("display","none")},requestNotification:function(a){e.handlers.push(a)},buttonClick:function(b){if(b.preventDefault(),a(".aliasbar-enabled").length>0)return void e.showAliasMessage();var c,d=a(this).parents("#ousubject-yourlinks"),f=a(this).parents("#ousubject-leftupper > .ousubject-yourmodules");d.length>0?(c=d,M.util.js_pending("format_ousubject_editmode")):f.length>0&&(c=f);var g=a(c.find("> .ousubject-heading > .helptooltip")),h=a(c.find(".ousubject-movebutton")),i=a(h.find("> a"));c.hasClass("ousubject-editmode")?(g.css("display","inline"),c.removeClass("ousubject-editmode"),e.callHandlers(!1),h.one("transitionend",function(){i.css("display","none"),M.util.js_complete("format_ousubject_editmode")}),c.find("button.dashboardboxes-addnewlink").attr("disabled",!1),c.find("#ousubject-region1 a").removeClass("ousubject_disabled_button"),c.find("#ousubject-region1 a").not(".block_currentmodules-tab.disabled button").removeAttr("tabindex"),a(".block_currentmodules, .block_viewstudyweek-current-week").on("click",".cmheadingbox",function(b){var c=a(b.target).closest(".cm-miniheader").find(".currentmodules-websitelink > a");a(c).get(0).click()})):(c.addClass("ousubject-editmode"),e.callHandlers(!0),setTimeout(function(){i.css("display","inline-block")},0),g.one("transitionend",function(){g.css("display","none"),M.util.js_complete("format_ousubject_editmode")}),a(".dashboardboxes-userlink-box > button").prop("disabled",!0),c.find("#ousubject-region1 a").not(".button-editmodules a.modulesboxes-movelink").addClass("ousubject_disabled_button"),c.find("#ousubject-region1 a").not(".button-editmodules a.modulesboxes-movelink").attr("tabindex",-1),c.find("button.dashboardboxes-addnewlink").attr("disabled","disabled"),a(".block_currentmodules").off("click"))},moveButtonClick:function(c){c.preventDefault();var d,e=a("#ousubject-yourlinks"),f=a("#ousubject-region3");e.hasClass("ousubject-upper")?(M.util.set_user_preference("format_ousubject_dashboardposition","lower"),d=function(){e.removeClass("ousubject-upper"),f.detach(),f.insertBefore(e)}):(M.util.set_user_preference("format_ousubject_dashboardposition","upper"),d=function(){e.addClass("ousubject-upper"),f.detach(),f.insertAfter(e)});var g=function(){d(),b.fadeIn(e,.2),b.fadeIn(f,.2)},h=0,i=function(){h++,2===h&&g()};b.fadeOut(e,.2,{after:i,noDisplayNone:!0}),b.fadeOut(f,.2,{after:i,noDisplayNone:!0})},callHandlers:function(a){for(var b=0;b<e.handlers.length;b++)e.handlers[b](a)},showAliasMessage:function(){M.util.js_pending("ousubject-editmode-alias-message"),c.get_strings([{key:"cannotedittitle",component:"format_ousubject"},{key:"cannoteditmessage",component:"format_ousubject"}]).then(function(a){return d.create({type:d.types.CANCEL,title:a[0],body:a[1]})}).then(function(a){a.show(),M.util.js_complete("ousubject-editmode-alias-message")})}};return e});
define('format_ousubject/dialogcloser', ["jquery"],function(a){var b={dialogCloseButton:null,gotState:!1,checkingUntil:null,CHECK_PERIOD:1e4,scrollOnDialogOpen:null,preventPopState:!1,lastPath:"",lastHash:"",init:function(){history.pushState&&(a(window).on("click keypress",function(){null===b.checkingUntil&&setTimeout(b.periodicCheck,250),b.checkingUntil=Date.now()+b.CHECK_PERIOD}),a(window).on("popstate",function(a){window.setTimeout(function(){b.popState(a)},1)}),a("a").on("click",b.clickInternalLink),history.state&&(b.gotState=!0))},periodicCheck:function(){b.checkDialog(),Date.now()<b.checkingUntil?setTimeout(b.periodicCheck,250):b.checkingUntil=null},checkDialog:function(){var c=a(".moodle-dialogue-wrap .closebutton:visible, .modal-header > .close:visible");c.length&&!b.dialogCloseButton?(b.dialogCloseButton=c,b.scrollOnDialogOpen=a(window).scrollTop(),b.gotState?history.replaceState({dialog:!0},""):(history.pushState({dialog:!0},""),b.gotState=!0)):!c.length&&b.dialogCloseButton&&(b.dialogCloseButton=null,history.replaceState({dialog:!1},""))},clickInternalLink:function(a){""!==a.target.hash&&(b.preventPopState=!0,window.setTimeout(function(){b.preventPopState=!1},250)),b.lastHash=a.target.hash},popState:function(c){if(c.originalEvent.state&&(c.originalEvent.state.dialog&&!b.dialogCloseButton&&history.replaceState({dialog:!1},""),b.gotState=!0),null===c.originalEvent.state)if(b.dialogCloseButton)b.dialogCloseButton.click(),b.dialogCloseButton=null,history.pushState({dialog:!1},""),setTimeout(function(){a(window).scrollTop(b.scrollOnDialogOpen),b.scrollOnDialogOpen=null},0);else{if(b.preventPopState)return;if(""===b.lastPath)b.lastPath=window.location.pathname;else if(b.lastPath===window.location.pathname)return;if(b.lastHash&&b.lastHash!==window.location.hash)return;history.back()}}};return b});
define('format_ousubject/blockform', ["jquery","core/templates","core/fragment","core/ajax","local_loadingstatus/loading"],function(a,b,c,d,e){var f={editableBlocks:{freelearning:{collapsible:!0,replaceContent:!1,fields:["config_numitems","config_searchterms"]},news:{collapsible:!0,replaceContent:!1,fields:["config_feedurls"]},socialmedia:{collapsible:!1,replaceContent:!0,fields:["config_type","config_name","config_widget"]}},contextId:null,currentEditableBlock:null,promisedForms:[],saveIndicator:null,init:function(b){e.start("format_ousubject_blockforms",M.util.get_string("blockformsloading","format_ousubject"));var c=M.util.get_string("savingchanges","format_ousubject");f.saveIndicator=a('<img src="'+M.util.image_url("i/loading_small")+'" alt="'+c+'"/>'),M.util.js_pending("format_ousubject_blockforms"),f.contextId=b,a(".block-region.yui3-dd-drop").each(f.disableDragDrop);for(var d in f.editableBlocks)if(f.editableBlocks.hasOwnProperty(d)){var g=a(".block.block_"+d);f.currentEditableBlock=f.editableBlocks[d],g.length>0&&g.each(f.getBlockForm)}a.when(f.promisedForms).done(function(){e.finish("format_ousubject_blockforms")}).always(function(){M.util.js_complete("format_ousubject_blockforms")})},disableDragDrop:function(b,c){var d=a(c),e=d.children().detach(),f=d.clone();e.appendTo(f),d.replaceWith(f)},getBlockForm:function(d,g){g=a(g);var h;if(f.currentEditableBlock.replaceContent)h=g.find(".content");else if(h=g.find(".ousubject-blockform-container"),0===h.length){var i=g.find(".footer");0===i.length&&(i=a('<div class="footer"></div>'),g.append(i)),h=a('<div class="ousubject-blockform-container"></div>'),i.append(h)}h.attr("aria-live","polite");var j={blockinstanceid:a(g).data("instanceid"),collapsible:f.currentEditableBlock.collapsible,fields:f.currentEditableBlock.fields.join(",")},k=c.loadFragment("format_ousubject","block_form",f.contextId,j);f.promisedForms.push(k),k.done(function(a,c){b.replaceNodeContents(h,a,c),h.find("form").on("submit",f.submitBlockForm)}).fail(function(){var a=M.util.get_string("blockformsloadingerror","format_ousubject",g.data("block"));e.error("format_ousubject_blockforms",a)})},submitBlockForm:function(d){d.preventDefault(),M.util.js_pending("format_ousubject_submitblockform");var e=a(this);e.find("span.error").remove();var g=e.find('[name="bui_editid"]').val(),h=e.find('[name="submitbutton"]');h.prop("disabled",!0);var i=e.find(".ousubject-blockform-status");i.html(f.saveIndicator);var j=e.serialize(),k=f.editableBlocks[e.closest(".block").data("block")],l={blockinstanceid:g,collapsible:k.collapsible,fields:k.fields.join(","),datastring:j},m=c.loadFragment("format_ousubject","block_form",f.contextId,l).done();m.done(function(a,c){if(0===a.length)i.html(M.util.get_string("changessaved","moodle")),e.on("change","input, select, textarea",f.clearStatus),M.core_formchangechecker.reset_form_dirty_state();else{var d;d=k.replaceContent?e.closest(".content"):e.closest(".ousubject-blockform-container"),b.replaceNodeContents(d,a,c),d.find("form").on("submit",f.submitBlockForm)}}).fail(function(a){i.html(a.message)}).always(function(){M.util.js_complete("format_ousubject_submitblockform"),h.prop("disabled",!1)})},clearStatus:function(b){var c=a(b.target).closest("form"),d=c.find(".ousubject-blockform-status");d.html(""),c.off("change","input, select, textarea",f.clearStatus)}};return f});
define('format_ousubject/imageresize', ["jquery"],function(a){var b={init:function(){a(".ousubject-bannerresize").on("click",b.resizeimage)},resizeimage:function(){a("#ousubject-topimage").hasClass("ousubject-minimisedtopimage")?(M.util.set_user_preference("format_ousubject_minimisedtopimage","n"),a("#ousubject-summary").hide(),a("#ousubject-topimage, #ousubject-spacerimage").toggleClass("ousubject-minimisedtopimage"),setTimeout(function(){a("#ousubject-summary").show()},450)):(M.util.set_user_preference("format_ousubject_minimisedtopimage","y"),a("#ousubject-topimage, #ousubject-spacerimage").toggleClass("ousubject-minimisedtopimage"))}};return b});
define('format_studyplan/tutorials', ["jquery","core/ajax"],function(a,b){var c={init:function(c,d,e){var f=a(".studyplanweeks:first");f.length&&b.call([{methodname:"format_studyplan_get_tutorials",args:{courseid:c,debug:d,alias:e},fail:function(a){return a},done:function(b){if(b.tutorials.length){var c;if(b.topicseventshtml.length){var d=a(".studyplanupcoming:first");if(!d.length){var e=a(".studyplan-format:first");e.prepend(b.topicseventshtml),d=a(".studyplanupcoming")}var f;for(c=d.find("ul.studyplanevents:first"),f=0;f<b.tutorials.length;f++)c.append(b.tutorials[f].html)}else{var g,h,i,j,k,l,m,n={};for(g=0;g<b.tutorials.length;g++)n[b.tutorials[g].section]||(n[b.tutorials[g].section]=[]),n[b.tutorials[g].section].push(g);for(g in n)if(i=a("#section-"+g+":first"),l=!0,i.length){if(j=n[g].length,k=i.find(".studyplancontent .studyplanevents-outer:first"),k.length)for(l=!1,c=k.find("ul.studyplanevents:first"),h=0;h<n[g].length;h++)c.append(b.tutorials[n[g][h]].html);if(l)for(m=i.find(".studyplancontent .studyplanactivities:first"),m.after(b.eventhtml),c=i.find("ul.studyplanevents:first"),h=0;h<n[g].length;h++)c.append(b.tutorials[n[g][h]].html)}}}}}])}};return c});
define('report_competency/grading_popup', ["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(b,c){this._regionSelector=b,this._userCompetencySelector=c,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return h.prototype._handleClick=function(c){var f=a(c.target).closest(this._userCompetencySelector),g=a(f).data("competencyid"),h=a(f).data("courseid"),i=a(f).data("userid");e.debug("Clicked on cell: competencyId="+g+", courseId="+h+", userId="+i);var j=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:i,competencyid:g,courseid:h}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:i,competencyid:g,courseid:h}}]);a.when.apply(a,j).then(function(a){this._contextLoaded.bind(this)(a)}.bind(this))["catch"](b.exception)},h.prototype._contextLoaded=function(a){var d=this;a.displayuser=!0,f.render("tool_lp/user_competency_summary_in_course",a).done(function(a,e){c.get_string("usercompetencysummary","report_competency").done(function(b){new g(b,a,f.runTemplateJS.bind(f,e),d._refresh.bind(d),(!0))}).fail(b.exception)}).fail(b.exception)},h.prototype._refresh=function(){var c=a(this._regionSelector),e=c.data("courseid"),f=c.data("userid");d.call([{methodname:"report_competency_data_for_report",args:{courseid:e,userid:f},done:this._pageContextLoaded.bind(this),fail:b.exception}])},h.prototype._pageContextLoaded=function(a){var c=this;f.render("report_competency/report",a).done(function(a,b){f.replaceNode(c._regionSelector,a,b)}).fail(b.exception)},h.prototype._regionSelector=null,h.prototype._userCompetencySelector=null,h});
define('report_competency/user_course_navigation', ["jquery"],function(a){var b=function(b,c,d,e){this._baseUrl=c,this._userId=d+"",this._courseId=e,a(b).on("change",this._userChanged.bind(this))};return b.prototype._userChanged=function(b){var c=a(b.target).val(),d="?user="+c+"&id="+this._courseId;document.location=this._baseUrl+d},b.prototype._userId=null,b.prototype._courseId=null,b.prototype._baseUrl=null,b});
define('report_customsql/reportcategories', ["jquery"],function(a){var b={init:function(){a("body").on("click",".csql_category h2",b.expandCollapse),a(".csql_expandcollapseall").on("click",b.expandCollapseAll),b.updateExpandCollapseAll()},expandCollapse:function(c){var d=a(c.target).closest(".csql_category");d.length&&(d.hasClass("csql_categoryhidden")?d.removeClass("csql_categoryhidden").addClass("csql_categoryshown"):d.removeClass("csql_categoryshown").addClass("csql_categoryhidden"),c.preventDefault(),b.updateExpandCollapseAll())},expandCollapseAll:function(c){0===a(".csql_categoryshown").length?(a(".csql_category").removeClass("csql_categoryhidden"),a(".csql_category").addClass("csql_categoryshown")):(a(".csql_category").removeClass("csql_categoryshown"),a(".csql_category").addClass("csql_categoryhidden")),c.preventDefault(),b.updateExpandCollapseAll()},updateExpandCollapseAll:function(){var b=a(".csql_expandcollapseall");0===a(".csql_categoryshown").length?b.text(b.data("expandalltext")):b.text(b.data("collapsealltext"))}};return b});
define('report_insights/actions', ["jquery","core/ajax","core/notification"],function(a,b,c){return{init:function(d){a("a[data-prediction-methodname][data-prediction-id="+d+"]").on("click",function(e){e.preventDefault();var f=a(e.currentTarget),g=f.attr("data-prediction-methodname"),h=f.closest("tr");if(h.length>0){var i=b.call([{methodname:g,args:{predictionid:d}}])[0];i.done(function(){h[0].remove(),a(".insights-list tr").length<2&&(document.referrer?window.location.assign(document.referrer):window.location.reload(!0))}).fail(c.exception)}})}}});
define('report_progress/completion_override', ["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],function(a,b,c,d,e,f,g,h){var i,j,k=function(a,b){return a>0?"i/completion-"+b+"-y-override":"i/completion-"+b+"-n-override"},l=function(a){h.render("core/loading",{}).then(function(c){return j.append(c),b.call([{methodname:"core_completion_override_activity_completion_status",args:a}])[0]}).then(function(b){var d=b.state>0?1:0,e=d?"completion-y-override":"completion-n-override";c.get_string(e,"completion",i).then(function(a){var b={state:a,date:"",user:j.attr("data-userfullname"),activity:j.attr("data-activityname")};return c.get_string("progress-title","completion",b)}).then(function(a){var b=j.attr("data-completiontracking");return h.renderPix(k(d,b),"core",a)}).then(function(b){var c=d>0?0:1;j.find(".loading-icon").remove(),j.data("changecompl",a.userid+"-"+a.cmid+"-"+c),j.attr("data-changecompl",a.userid+"-"+a.cmid+"-"+c),j.children("img").replaceWith(b)})["catch"](f.exception)})["catch"](f.exception)},m=function(b,g){g.originalEvent.preventDefault(),g.originalEvent.stopPropagation(),b.preventDefault(),b.stopPropagation(),j=a(b.currentTarget);var h=j.data("changecompl").split("-"),i={userid:h[0],cmid:h[1],newstate:h[2]},k=1==i.newstate?"completion-y":"completion-n";c.get_strings([{key:k,component:"completion"}]).then(function(a){return c.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:a[0]}])}).then(function(a){return d.create({type:d.types.CONFIRM,title:a[0],body:a[1]})}).then(function(a){a.getRoot().on(e.yes,function(){l(i)}),a.getRoot().on(e.hidden,function(){j.focus(),a.destroy()}),a.show()})["catch"](f.exception)},n=function(b){i=b,a("#completion-progress a.changecompl").each(function(a,b){g.define(b,[g.events.activate])}),a("#completion-progress").on(g.events.activate,"a.changecompl",function(a,b){m(a,b)})};return{init:n}});
define('gradingform_guide/comment_chooser', ["jquery","core/templates","core/notification","core/yui"],function(a,b,c){return{initialise:function(d,e,f,g){function h(b,c){var e="<label>"+M.util.get_string("insertcomment","gradingform_guide")+"</label>",g="comment-chooser-"+d+"-cancel",h='<button id="'+g+'">'+M.util.get_string("cancel","moodle")+"</button>",i=new M.core.dialogue({modal:!0,headerContent:e,bodyContent:b,footerContent:h,focusAfterHide:"#"+f,id:"comments-chooser-dialog-"+d});a("#"+g).click(function(){i.hide()}),a.each(c,function(b,c){var e="#comment-option-"+d+"-"+c.id;a(e).click(function(){var b=a("#"+f),d=b.val();""!==a.trim(d)&&(d+="\n"),d+=c.description,b.val(d),i.hide()}),a(document).off("keypress",e).on("keypress",e,function(){var b=event.which||event.keyCode;13!=b&&32!=b||a(e).click()})}),i.after("visibleChange",function(a){a.prevVal&&!a.newVal&&this.destroy()},i),i.show()}function i(){var a={criterionId:d,comments:g};b.render("gradingform_guide/comment_chooser",a).done(function(a){h(a,g)}).fail(c.exception)}a("#"+e).click(function(a){a.preventDefault(),i()})}}});
define('tool_analytics/log_info', ["jquery","core/str","core/modal_factory","core/notification"],function(a,b,c,d){return{loadInfo:function(e,f){var g=a('[data-model-log-id="'+e+'"]');b.get_string("loginfo","tool_analytics").then(function(b){var d=a("<ul>");return f.forEach(function(a){d.append("<li>"+a+"</li>")}),d.append("</ul>"),c.create({title:b,body:d.html(),large:!0},g)})["catch"](d.exception)}}});
define('tool_analytics/model', ["jquery","core/str","core/log","core/notification","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={clear:{title:{key:"clearpredictions",component:"tool_analytics"},body:{key:"clearmodelpredictions",component:"tool_analytics"}}},h=function(b){return a(b.closest("tr")[0]).find("span.target-name").text()};return{confirmAction:function(i,j){a('[data-action-id="'+i+'"]').on("click",function(i){i.preventDefault();var k=a(i.currentTarget);if("undefined"==typeof g[j])return void c.error('Action "'+j+'" is not allowed.');var l=[g[j].title,g[j].body];l[1].param=h(k);var m=b.get_strings(l),n=e.create({type:e.types.SAVE_CANCEL});a.when(m,n).then(function(a,b){return b.setTitle(a[0]),b.setBody(a[1]),b.setSaveButtonText(a[0]),b.getRoot().on(f.save,function(){window.location.href=k.attr("href")}),b.show(),b}).fail(d.exception)})}}});
define('tool_dataprivacy/add_category', ["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g){var h={CATEGORY_LINK:'[data-add-element="category"]'},i=function(a){this.contextId=a;var c=[{key:"addcategory",component:"tool_dataprivacy"},{key:"save",component:"admin"}];this.strings=b.get_strings(c),this.registerEventListeners()};return i.prototype.contextId=0,i.prototype.strings=0,i.prototype.registerEventListeners=function(){var b=a(h.CATEGORY_LINK);b.on("click",function(){return this.strings.then(function(a){e.create({type:e.types.SAVE_CANCEL,title:a[0],body:""},b).done(function(b){this.setupFormModal(b,a[1])}.bind(this))}.bind(this)).fail(d.exception)}.bind(this))},i.prototype.getBody=function(a){var b=null;return"undefined"!=typeof a&&(b={jsonformdata:JSON.stringify(a)}),g.loadFragment("tool_dataprivacy","addcategory_form",this.contextId,b)},i.prototype.setupFormModal=function(a,b){a.setLarge(),a.setSaveButtonText(b),a.getRoot().on(f.hidden,this.destroy.bind(this)),a.setBody(this.getBody()),a.getRoot().on(f.save,this.submitForm.bind(this)),a.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=a,a.show()},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();c.call([{methodname:"tool_dataprivacy_create_category_form",args:{jsonformdata:JSON.stringify(b)},done:function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this),fail:d.exception}])},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy()},i.prototype.removeListeners=function(){a(h.CATEGORY_LINK).off("click")},{getInstance:function(a){return new i(a)}}});
define('tool_dataprivacy/add_purpose', ["jquery","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(a,b,c,d,e,f,g){var h={PURPOSE_LINK:'[data-add-element="purpose"]'},i=function(a){this.contextId=a;var c=[{key:"addpurpose",component:"tool_dataprivacy"},{key:"save",component:"admin"}];this.strings=b.get_strings(c),this.registerEventListeners()};return i.prototype.contextId=0,i.prototype.strings=0,i.prototype.registerEventListeners=function(){var b=a(h.PURPOSE_LINK);b.on("click",function(){return this.strings.then(function(a){e.create({type:e.types.SAVE_CANCEL,title:a[0],body:""},b).done(function(b){this.setupFormModal(b,a[1])}.bind(this))}.bind(this)).fail(d.exception)}.bind(this))},i.prototype.getBody=function(a){var b=null;return"undefined"!=typeof a&&(b={jsonformdata:JSON.stringify(a)}),g.loadFragment("tool_dataprivacy","addpurpose_form",this.contextId,b)},i.prototype.setupFormModal=function(a,b){a.setLarge(),a.setSaveButtonText(b),a.getRoot().on(f.hidden,this.destroy.bind(this)),a.setBody(this.getBody()),a.getRoot().on(f.save,this.submitForm.bind(this)),a.getRoot().on("submit","form",this.submitFormAjax.bind(this)),this.modal=a,a.show()},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();c.call([{methodname:"tool_dataprivacy_create_purpose_form",args:{jsonformdata:JSON.stringify(b)},done:function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this),fail:d.exception}])},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy()},i.prototype.removeListeners=function(){a(h.PURPOSE_LINK).off("click")},{getInstance:function(a){return new i(a)}}});
define('tool_dataprivacy/categoriesactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={DELETE:'[data-action="deletecategory"]'},h=function(){this.registerEvents()};return h.prototype.registerEvents=function(){a(g.DELETE).click(function(g){g.preventDefault();var h=a(this).data("id"),i=a(this).data("name"),j=[{key:"deletecategory",component:"tool_dataprivacy"},{key:"deletecategorytext",component:"tool_dataprivacy",param:i},{key:"delete"}];d.get_strings(j).then(function(d){var g=d[0],i=d[1],j=d[2];return e.create({title:g,body:i,type:e.types.SAVE_CANCEL}).then(function(d){return d.setSaveButtonText(j),d.getRoot().on(f.save,function(){var d={methodname:"tool_dataprivacy_delete_category",args:{id:h}};b.call([d])[0].done(function(b){b.result?a('tr[data-categoryid="'+h+'"]').remove():c.addNotification({message:b.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d})}).done(function(a){a.show()}).fail(c.exception)})},{init:function(){return new h}}});
define('tool_dataprivacy/data_deletion', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){function g(a){var g=[{key:"confirm",component:"moodle"},{key:"confirmcontextdeletion",component:"tool_dataprivacy"}],h="tool_dataprivacy_confirm_contexts_for_deletion",i="";d.get_strings(g).then(function(a){i=a[0];var b=a[1];return e.create({title:i,body:b,type:e.types.SAVE_CANCEL})}).then(function(d){return d.setSaveButtonText(i),d.getRoot().on(f.save,function(){var d={ids:a},e={methodname:h,args:d};b.call([e])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d}).done(function(a){a.show()}).fail(c.exception)}var h={MARK_FOR_DELETION:'[data-action="markfordeletion"]',SELECT_ALL:'[data-action="selectall"]'},i={SELECTCONTEXT:".selectcontext"},j=function(){this.registerEvents()};return j.prototype.registerEvents=function(){a(h.MARK_FOR_DELETION).click(function(b){b.preventDefault();var c=[];a(i.SELECTCONTEXT).each(function(){var b=a(this);b.is(":checked")&&c.push(b.val())}),g(c)}),a(h.SELECT_ALL).change(function(b){b.preventDefault();var c=a(this);c.is(":checked")?a(i.SELECTCONTEXT).attr("checked","checked"):a(i.SELECTCONTEXT).removeAttr("checked")})},j});
define('tool_dataprivacy/data_registry', ["jquery","core/str","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","tool_dataprivacy/add_purpose","tool_dataprivacy/add_category"],function(a,b,c,d,e,f,g,h,i,j){var k={TREE_NODES:"[data-context-tree-node=1]",FORM_CONTAINER:"#context-form-container"},l=function(a,b,c){this.systemContextId=a,this.currentContextLevel=b,this.currentContextId=c,this.init()};return l.prototype.systemContextId=0,l.prototype.currentContextLevel=0,l.prototype.currentContextId=0,l.prototype.addpurpose=null,l.prototype.addcategory=null,l.prototype.init=function(){this.addpurpose=i.getInstance(this.systemContextId),this.addcategory=j.getInstance(this.systemContextId);var a=[{key:"changessaved",component:"moodle"},{key:"contextpurposecategorysaved",component:"tool_dataprivacy"},{key:"noblockstoload",component:"tool_dataprivacy"},{key:"noactivitiestoload",component:"tool_dataprivacy"},{key:"nocoursestoload",component:"tool_dataprivacy"}];this.strings=b.get_strings(a),this.registerEventListeners(),this.currentContextId?this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this)):this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this))},l.prototype.registerEventListeners=function(){a(k.TREE_NODES).on("click",function(b){b.preventDefault();var c=a(b.currentTarget);a(k.TREE_NODES).removeClass("active"),c.addClass("active");var d=c.data("contextlevel"),e=c.data("contextid");if(d)window.history.pushState({},null,"?contextlevel="+d),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextLevel=d,this.loadForm("contextlevel_form",[this.currentContextLevel],this.submitContextLevelFormAjax.bind(this));else if(e)window.history.pushState({},null,"?contextid="+e),this.addpurpose.removeListeners(),this.addcategory.removeListeners(),this.currentContextId=e,this.loadForm("context_form",[this.currentContextId],this.submitContextFormAjax.bind(this));else{var f=c.data("expandcontextid"),g=c.data("expandelement"),h=c.data("expanded");g&&(h?this.collapse(c):!c.data("loaded")&&f&&g?(c.find("> i").removeClass("fa-plus"),c.find("> i").addClass("fa-circle-o-notch fa-spin"),this.loadExtra(c,f,g)):this.expand(c))}}.bind(this))},l.prototype.removeListeners=function(){a(k.TREE_NODES).off("click")},l.prototype.loadForm=function(b,c,f){this.clearForm();var g=h.loadFragment("tool_dataprivacy",b,this.systemContextId,c);g.done(function(b,c){a(k.FORM_CONTAINER).html(b),e.runTemplateJS(c),this.addpurpose.registerEventListeners(),this.addcategory.registerEventListeners(),a(k.FORM_CONTAINER).on("submit","form",f)}.bind(this)).fail(d.exception)},l.prototype.clearForm=function(){Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),a(k.FORM_CONTAINER).off("submit","form")},l.prototype.submitForm=function(b){b.preventDefault(),a(k.FORM_CONTAINER).find("form").submit()},l.prototype.submitContextLevelFormAjax=function(a){this.submitFormAjax(a,"tool_dataprivacy_set_contextlevel_form")},l.prototype.submitContextFormAjax=function(a){this.submitFormAjax(a,"tool_dataprivacy_set_context_form")},l.prototype.submitFormAjax=function(b,e){b.preventDefault();var f=a(k.FORM_CONTAINER).find("form").serialize();return this.strings.then(function(a){c.call([{methodname:e,args:{jsonformdata:JSON.stringify(f)},done:function(){d.alert(a[0],a[1])},fail:d.exception}])})["catch"](d.exception)},l.prototype.loadExtra=function(a,b,f){c.call([{methodname:"tool_dataprivacy_tree_extra_branches",args:{contextid:b,element:f},done:function(b){return 0==b.branches.length?void this.noElements(a,f):void e.render("tool_dataprivacy/context_tree_branches",b).then(function(b){a.after(b),this.removeListeners(),this.registerEventListeners(),this.expand(a),a.data("loaded",1)}.bind(this)).fail(d.exception)}.bind(this),fail:d.exception}])},l.prototype.noElements=function(a,b){a.data("expandcontextid",""),a.data("expandelement",""),this.strings.then(function(c){var d=2;"module"==b?d=3:"course"==b&&(d=4),a.text(c[d])}).fail(d.exception)},l.prototype.collapse=function(a){a.data("expanded",0),a.siblings("nav").addClass("hidden"),a.find("> i").removeClass("fa-minus"),a.find("> i").addClass("fa-plus")},l.prototype.expand=function(a){a.data("expanded",1),a.siblings("nav").removeClass("hidden"),a.find("> i").removeClass("fa-plus"),a.find("> i").removeClass("fa-circle-o-notch fa-spin"),a.find("> i").addClass("fa-minus")},{init:function(a,b,c){return new l(a,b,c)}}});
define('tool_dataprivacy/data_request_modal', ["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","tool_dataprivacy/events"],function(a,b,c,d,e,f){var g=!1,h={APPROVE_BUTTON:'[data-action="approve"]',DENY_BUTTON:'[data-action="deny"]',COMPLETE_BUTTON:'[data-action="complete"]'},i=function(a){d.call(this,a)};return i.TYPE="tool_dataprivacy-data_request",i.prototype=Object.create(d.prototype),i.prototype.constructor=i,i.prototype.registerEventListeners=function(){d.prototype.registerEventListeners.call(this),this.getModal().on(c.events.activate,h.APPROVE_BUTTON,function(b,c){var d=a.Event(f.approve);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,h.DENY_BUTTON,function(b,c){var d=a.Event(f.deny);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this)),this.getModal().on(c.events.activate,h.COMPLETE_BUTTON,function(b,c){var d=a.Event(f.complete);this.getRoot().trigger(d,this),d.isDefaultPrevented()||(this.hide(),c.originalEvent.preventDefault())}.bind(this))},g||(e.register(i.TYPE,i,"tool_dataprivacy/data_request_modal"),g=!0),i});
define('tool_dataprivacy/effective_retention_period', ["jquery"],function(a){var b={PURPOSE_SELECT:"#id_purposeid",RETENTION_FIELD_BOOST:"#id_error_retention_current",RETENTION_FIELD_CLEAN:"#fitem_id_retention_current [data-fieldtype=static]"},c=function(a){this.purposeRetentionPeriods=a,this.registerEventListeners()},d=function(){a(b.PURPOSE_SELECT).off("change")};return c.prototype.purposeRetentionPeriods=[],c.prototype.registerEventListeners=function(){a(b.PURPOSE_SELECT).on("change",function(c){var d=a(c.currentTarget).val(),e=this.purposeRetentionPeriods[d],f=a(b.RETENTION_FIELD_CLEAN);if(f.length>0)f.text(e);else{var g=a(b.RETENTION_FIELD_BOOST),h=g.siblings();h.length>0&&h.text(e)}}.bind(this))},{init:function(a){return d(),new c(a)}}});
define('tool_dataprivacy/events', [],function(){return{approve:"tool_dataprivacy-data_request:approve",bulkApprove:"tool_dataprivacy-data_request:bulk_approve",deny:"tool_dataprivacy-data_request:deny",bulkDeny:"tool_dataprivacy-data_request:bulk_deny",complete:"tool_dataprivacy-data_request:complete"}});
define('tool_dataprivacy/expand_contract', ["jquery","core/url","core/str"],function(a,b,c){var d=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),e=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>');return{expandCollapse:function(a,b){a.hasClass("hide")?(a.removeClass("hide"),a.addClass("visible"),a.attr("aria-expanded",!0),b.find(":header i.fa").removeClass("fa-plus-square"),b.find(":header i.fa").addClass("fa-minus-square"),b.find(":header img.icon").attr("src",d.attr("src"))):(a.removeClass("visible"),a.addClass("hide"),a.attr("aria-expanded",!1),b.find(":header i.fa").removeClass("fa-minus-square"),b.find(":header i.fa").addClass("fa-plus-square"),b.find(":header img.icon").attr("src",e.attr("src")))},expandCollapseAll:function(b){var f="visible"==b?"hide":"visible",g="visible"==b,h="visible"==b?"fa-plus-square":"fa-minus-square",i="visible"==b?"fa-minus-square":"fa-plus-square",j="visible"==b?d.attr("src"):e.attr("src");a("."+f).each(function(){a(this).removeClass(f),a(this).addClass(b),a(this).attr("aria-expanded",g)}),a(".tool_dataprivacy-expand-all").data("visibilityState",f),c.get_string(f,"tool_dataprivacy").then(function(b){a(".tool_dataprivacy-expand-all").html(b)})["catch"](Notification.exception),a(":header i.fa").each(function(){a(this).removeClass(h),a(this).addClass(i)}),a(":header img.icon").each(function(){a(this).attr("src",j)})}}});
define('tool_dataprivacy/form-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h;h=b.call([{methodname:"tool_dataprivacy_get_users",args:{query:e}}]),h[0].then(function(b){var d=[],e=0;return a.each(b,function(a,b){d.push(c.render("tool_dataprivacy/form-user-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b,function(a,b){b._label=c[e],e++}),f(b)})}).fail(g)}}});
define('tool_dataprivacy/myrequestactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d,e,f,g){function h(a){var e={methodname:"tool_dataprivacy_contact_dpo",args:{message:a}},f="success";b.call([e])[0].then(function(a){return a.result?d.get_string("requestsubmitted","tool_dataprivacy"):(f="error",a.warnings.join("<br>"))}).done(function(a){c.addNotification({message:a,type:f})}).fail(c.exception)}var i={CANCEL_REQUEST:'[data-action="cancel"]',CONTACT_DPO:'[data-action="contactdpo"]'},j=function(){this.registerEvents()};return j.prototype.registerEvents=function(){a(i.CANCEL_REQUEST).click(function(g){g.preventDefault();var h=a(this).data("requestid"),i=[{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}];d.get_strings(i).then(function(a){var d=a[0],g=a[1];return e.create({title:d,body:g,type:e.types.SAVE_CANCEL}).then(function(a){return a.setSaveButtonText(d),a.getRoot().on(f.save,function(){var a={requestid:h},d={methodname:"tool_dataprivacy_cancel_data_request",args:a};b.call([d])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a})}).done(function(a){a.show()}).fail(c.exception)}),a(i.CONTACT_DPO).click(function(b){b.preventDefault();var i=a(this).data("replytoemail"),j=[{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}],k="";d.get_strings(j).then(function(a){var b=a[0];k=a[1];var c={replytoemail:i};return e.create({title:b,body:g.render("tool_dataprivacy/contact_dpo",c),type:e.types.SAVE_CANCEL,large:!0})}).done(function(b){b.setSaveButtonText(k),b.getRoot().on(f.save,function(b){var c=a("#message").val().trim();0===c.length?(b.preventDefault(),a('[data-region="messageinput"]').addClass("has-danger notifyproblem"),a("#id_error_message").removeAttr("hidden")):h(c)}),b.getRoot().on(f.hidden,function(){b.destroy()}),b.show()}).fail(c.exception)})},{init:function(){return new j}}});
define('tool_dataprivacy/purposesactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g={DELETE:'[data-action="deletepurpose"]'},h=function(){this.registerEvents()};return h.prototype.registerEvents=function(){a(g.DELETE).click(function(g){g.preventDefault();var h=a(this).data("id"),i=a(this).data("name"),j=[{key:"deletepurpose",component:"tool_dataprivacy"},{key:"deletepurposetext",component:"tool_dataprivacy",param:i},{key:"delete"}];d.get_strings(j).then(function(d){var g=d[0],i=d[1],j=d[2];return e.create({title:g,body:i,type:e.types.SAVE_CANCEL}).then(function(d){return d.setSaveButtonText(j),d.getRoot().on(f.save,function(){var d={methodname:"tool_dataprivacy_delete_purpose",args:{id:h}};b.call([d])[0].done(function(b){b.result?a('tr[data-purposeid="'+h+'"]').remove():c.addNotification({message:b.warnings[0].message,type:"error"})}).fail(c.exception)}),d.getRoot().on(f.hidden,function(){d.destroy()}),d})}).done(function(a){a.show()}).fail(c.exception)})},{init:function(){return new h}}});
define('tool_dataprivacy/request_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={REQUEST_FILTERS:"#request-filters"},f=function(){var f=[{key:"filter",component:"moodle"},{key:"nofiltersapplied",component:"moodle"}];c.get_strings(f).then(function(a){var c=a[0],d=a[1];return b.enhance(e.REQUEST_FILTERS,!1,"",c,!1,!0,d,!0)}).fail(d.exception);var g=a(e.REQUEST_FILTERS).val();a(e.REQUEST_FILTERS).on("change",function(){var b=a(this).val();g.join(",")!==b.join(",")&&(0===b.length&&a("#filters-cleared").val(1),a(this.form).submit())})};return{init:function(){f()}}});
define('tool_dataprivacy/requestactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","tool_dataprivacy/data_request_modal","tool_dataprivacy/events"],function(a,b,c,d,e,f,g,h,i){function j(a){return{wsfunction:"tool_dataprivacy_approve_data_request",wsparams:{requestid:a}}}function k(a){return{wsfunction:"tool_dataprivacy_bulk_approve_data_requests",wsparams:{requestids:a}}}function l(a){return{wsfunction:"tool_dataprivacy_deny_data_request",wsparams:{requestid:a}}}function m(a){return{wsfunction:"tool_dataprivacy_bulk_deny_data_requests",wsparams:{requestids:a}}}function n(a){return{wsfunction:"tool_dataprivacy_mark_complete",wsparams:{requestid:a}}}function o(a,b){var g=[];switch(a){case i.approve:g=[{key:"approverequest",component:"tool_dataprivacy"},{key:"confirmapproval",component:"tool_dataprivacy"}];break;case i.bulkApprove:g=[{key:"bulkapproverequests",component:"tool_dataprivacy"},{key:"confirmbulkapproval",component:"tool_dataprivacy"}];break;case i.deny:g=[{key:"denyrequest",component:"tool_dataprivacy"},{key:"confirmdenial",component:"tool_dataprivacy"}];break;case i.bulkDeny:g=[{key:"bulkdenyrequests",component:"tool_dataprivacy"},{key:"confirmbulkdenial",component:"tool_dataprivacy"}];break;case i.complete:g=[{key:"markcomplete",component:"tool_dataprivacy"},{key:"confirmcompletion",component:"tool_dataprivacy"}]}var h="";d.get_strings(g).then(function(a){h=a[0];var b=a[1];return e.create({title:h,body:b,type:e.types.SAVE_CANCEL})}).then(function(a){a.setSaveButtonText(h),a.getRoot().on(f.save,function(){p(b.wsfunction,b.wsparams)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show()})["catch"](c.exception)}function p(a,d){var e={methodname:a,args:d};b.call([e])[0].done(function(a){a.result?window.location.reload():c.addNotification({message:a.warnings[0].message,type:"error"})}).fail(c.exception)}var q={APPROVE_REQUEST:'[data-action="approve"]',DENY_REQUEST:'[data-action="deny"]',VIEW_REQUEST:'[data-action="view"]',MARK_COMPLETE:'[data-action="complete"]',CHANGE_BULK_ACTION:'[id="bulk-action"]',CONFIRM_BULK_ACTION:'[id="confirm-bulk-action"]',SELECT_ALL:'[data-action="selectall"]'},r={APPROVE:1,DENY:2},s={SELECT_REQUEST:".selectrequests"},t=function(){this.registerEvents()};return t.prototype.registerEvents=function(){a(q.VIEW_REQUEST).click(function(d){d.preventDefault();var k=a(this).data("requestid"),m={requestid:k},n={methodname:"tool_dataprivacy_get_data_request",args:m},q=b.call([n]);a.when(q[0]).then(function(a){return a.result?a.result:(c.addNotification({message:a.warnings[0].message,type:"error"}),!1)}).then(function(a){var b=g.render("tool_dataprivacy/request_details",a),c={approvedeny:a.approvedeny,canmarkcomplete:a.canmarkcomplete};return e.create({title:a.typename,body:b,type:h.TYPE,large:!0,templateContext:c})}).then(function(a){a.getRoot().on(i.approve,function(){o(i.approve,j(k))}),a.getRoot().on(i.deny,function(){o(i.deny,l(k))}),a.getRoot().on(i.complete,function(){var a={requestid:k};p("tool_dataprivacy_mark_complete",a)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show()})["catch"](c.exception)}),a(q.APPROVE_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.approve,j(c))}),a(q.DENY_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.deny,l(c))}),a(q.MARK_COMPLETE).click(function(b){b.preventDefault();var c=a(this).data("requestid");o(i.complete,n(c))}),a(q.CONFIRM_BULK_ACTION).click(function(){var b=[],e="",f={},g=[{key:"selectbulkaction",component:"tool_dataprivacy"},{key:"selectdatarequests",component:"tool_dataprivacy"},{key:"ok"}],h=parseInt(a("#bulk-action").val());if(h!=r.APPROVE&&h!=r.DENY)return void d.get_strings(g).done(function(a){c.alert("",a[0],a[2])}).fail(c.exception);if(a(".selectrequests:checked").each(function(){b.push(a(this).val())}),b.length<1)return void d.get_strings(g).done(function(a){c.alert("",a[1],a[2])}).fail(c.exception);switch(h){case r.APPROVE:e=i.bulkApprove,f=k(b);break;case r.DENY:e=i.bulkDeny,f=m(b)}o(e,f)}),a(q.SELECT_ALL).change(function(b){b.preventDefault();var c=a(this).is(":checked");a(s.SELECT_REQUEST).prop("checked",c)})},t});
define('tool_dataprivacy/defaultsactions', ["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d,e,f,g){function h(b,d,h,j,k,l,m,n){null!==h&&l.forEach(function(a){a.id===h&&(a.selected=!0)}),null!==j&&m.forEach(function(a){a.id===j&&(a.selected=!0)});var o={contextlevel:d,categoryoptions:l,purposeoptions:m};null!==n&&n.length&&(null===k?o.newactivitydefaults=!0:n.forEach(function(a){k===a.name&&(a.selected=!0)}),o.modemodule=!0,o.activityoptions=n),e.create({title:b,body:g.render("tool_dataprivacy/category_purpose_form",o),type:e.types.SAVE_CANCEL,large:!0}).then(function(b){return b.getRoot().on(f.save,function(){var b=a("#activity"),c="undefined"!=typeof b?b.val():null,d=a("#override"),e="undefined"!=typeof d&&d.is(":checked");i(a("#contextlevel").val(),a("#category").val(),a("#purpose").val(),c,e)}),b.getRoot().on(f.hidden,function(){b.destroy()}),b.show(),b})["catch"](c.exception)}function i(a,c,d,e,f){var g={methodname:"tool_dataprivacy_set_context_defaults",args:{contextlevel:a,category:c,purpose:d,override:f,activity:e}};b.call([g])[0].done(function(a){a.result&&window.location.reload()})}var j={EDIT_LEVEL_DEFAULTS:'[data-action="edit-level-defaults"]',NEW_ACTIVITY_DEFAULTS:'[data-action="new-activity-defaults"]',EDIT_ACTIVITY_DEFAULTS:'[data-action="edit-activity-defaults"]',DELETE_ACTIVITY_DEFAULTS:'[data-action="delete-activity-defaults"]'},k=-1,l=function(){this.registerEvents()};return l.prototype.registerEvents=function(){a(j.EDIT_LEVEL_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=f.data("category"),j=f.data("purpose"),k=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}}],l=b.call(k),m=d.get_string("editdefaults","tool_dataprivacy",a("#defaults-header").text());a.when(l[0],l[1],m).then(function(a,b,c){var d=a.options,e=b.options;return h(c,g,i,j,null,d,e,null),!0})["catch"](c.exception)}),a(j.NEW_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{nodefaults:!0}}],j=b.call(i),k=d.get_string("addnewdefaults","tool_dataprivacy");a.when(j[0],j[1],j[2],k).then(function(a,b,c,d){var e=a.options,f=b.options,i=c.options;return h(d,g,null,null,null,e,f,i),!0})["catch"](c.exception)}),a(j.EDIT_ACTIVITY_DEFAULTS).click(function(e){e.preventDefault();var f=a(this),g=f.data("contextlevel"),i=f.data("category"),j=f.data("purpose"),k=f.data("activityname"),l=[{methodname:"tool_dataprivacy_get_category_options",args:{}},{methodname:"tool_dataprivacy_get_purpose_options",args:{}},{methodname:"tool_dataprivacy_get_activity_options",args:{}}],m=b.call(l),n=d.get_string("editmoduledefaults","tool_dataprivacy");a.when(m[0],m[1],m[2],n).then(function(a,b,c,d){var e=a.options,f=b.options,l=c.options;return h(d,g,i,j,k,e,f,l),!0})["catch"](c.exception)}),a(j.DELETE_ACTIVITY_DEFAULTS).click(function(b){b.preventDefault();var h=a(this),j=h.data("contextlevel"),l=h.data("activityname"),m=h.data("activitydisplayname"),n=k,o=k;e.create({title:d.get_string("deletedefaults","tool_dataprivacy",m),body:g.render("tool_dataprivacy/delete_activity_defaults",{activityname:m}),type:e.types.SAVE_CANCEL,large:!0}).then(function(a){return a.setSaveButtonText(d.get_string("delete")),a.getRoot().on(f.save,function(){i(j,n,o,l,!1)}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show(),!0})["catch"](c.exception)})},{init:function(){return new l}}});
define('tool_lp/actionselector', ["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","tool_lp/event_base"],function(a,b,c,d,e,f){var g=function(a,b,c,d,e){var g=this;f.prototype.constructor.apply(this,[]),g._title=a,g._message=b,g._actions=c,g._confirm=d,g._cancel=e,g._selectedValue=null,g._reset()};return g.prototype=Object.create(f.prototype),g.prototype._selectedValue=null,g.prototype._popup=null,g.prototype._title=null,g.prototype._message=null,g.prototype._actions=null,g.prototype._confirm=null,g.prototype._cancel=null,g.prototype._afterRender=function(){var b=this;b._find('[data-action="action-selector-confirm"]').attr("disabled","disabled"),b._find('[data-region="action-selector-radio-buttons"]').change(function(){b._selectedValue=a("input[type='radio']:checked").val(),b._find('[data-action="action-selector-confirm"]').removeAttr("disabled"),b._refresh.bind(b)}),b._find('[data-action="action-selector-cancel"]').click(function(a){a.preventDefault(),b.close()}),b._find('[data-action="action-selector-confirm"]').click(function(a){a.preventDefault(),b._selectedValue.length&&(b._trigger("save",{action:b._selectedValue}),b.close())})},g.prototype.close=function(){var a=this;a._popup.close(),a._reset()},g.prototype.display=function(){var a=this;return a._render().then(function(b){a._popup=new e(a._title,b,a._afterRender.bind(a))}).fail(b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._refresh=function(){var a=this;return a._render().then(function(b){a._find('[data-region="action-selector"]').replaceWith(b),a._afterRender()})},g.prototype._render=function(){var a=this,b=[];for(var c in a._actions)b.push(a._actions[c]);var e={message:a._message,choices:b,confirm:a._confirm,cancel:a._cancel};return d.render("tool_lp/action_selector",e)},g.prototype._reset=function(){this._popup=null,this._selectedValue=""},g});
define('tool_lp/competencies', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/competencypicker","tool_lp/dragdrop-reorder"],function(a,b,c,d,e,f,g){var h=function(b,c,d){this.itemid=b,this.itemtype=c,this.pageContextId=d,this.pickerInstance=null,a('[data-region="actions"] button').prop("disabled",!1),this.registerEvents(),this.registerDragDrop()};return h.prototype.registerDragDrop=function(){var a=this;e.get_string("movecompetency","tool_lp").done(function(b){g.dragdrop("movecompetency",b,{identifier:"movecompetency",component:"tool_lp"},{identifier:"movecompetencyafter",component:"tool_lp"},"drag-samenode","drag-parentnode","drag-handlecontainer",function(b,c){a.handleDrop(b,c)})}).fail(b.exception)},h.prototype.handleDrop=function(d,e){var f=a(d).data("id"),g=a(e).data("id"),h=this,i=[];if("course"==h.itemtype)i=c.call([{methodname:"core_competency_reorder_course_competency",args:{courseid:h.itemid,competencyidfrom:f,competencyidto:g}}]);else if("template"==h.itemtype)i=c.call([{methodname:"core_competency_reorder_template_competency",args:{templateid:h.itemid,competencyidfrom:f,competencyidto:g}}]);else{if("plan"!=h.itemtype)return;i=c.call([{methodname:"core_competency_reorder_plan_competency",args:{planid:h.itemid,competencyidfrom:f,competencyidto:g}}])}i[0].fail(b.exception)},h.prototype.pickCompetency=function(){var e,g,h,i,j=this;j.pickerInstance||("template"!==j.itemtype&&"course"!==j.itemtype||(i="parents"),j.pickerInstance=new f(j.pageContextId,(!1),i),j.pickerInstance.on("save",function(f,i){var k=i.competencyIds;"course"===j.itemtype?(e=[],a.each(k,function(a,b){e.push({methodname:"core_competency_add_competency_to_course",args:{courseid:j.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:j.itemid}}),g="tool_lp/course_competencies_page",h="coursecompetenciespage"):"template"===j.itemtype?(e=[],a.each(k,function(a,b){e.push({methodname:"core_competency_add_competency_to_template",args:{templateid:j.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:j.itemid,pagecontext:{contextid:j.pageContextId}}}),g="tool_lp/template_competencies_page",h="templatecompetenciespage"):"plan"===j.itemtype&&(e=[],a.each(k,function(a,b){e.push({methodname:"core_competency_add_competency_to_plan",args:{planid:j.itemid,competencyid:b}})}),e.push({methodname:"tool_lp_data_for_plan_page",args:{planid:j.itemid}}),g="tool_lp/plan_page",h="plan-page"),c.call(e)[e.length-1].then(function(a){return d.render(g,a)}).then(function(b,c){a('[data-region="'+h+'"]').replaceWith(b),d.runTemplateJS(c)})["catch"](b.exception)})),j.pickerInstance.display()},h.prototype.doDelete=function(e){var f=this,g=[],h="",i="";"course"==f.itemtype?(g=c.call([{methodname:"core_competency_remove_competency_from_course",args:{courseid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:f.itemid}}]),h="tool_lp/course_competencies_page",i="coursecompetenciespage"):"template"==f.itemtype?(g=c.call([{methodname:"core_competency_remove_competency_from_template",args:{templateid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_template_competencies_page",args:{templateid:f.itemid,pagecontext:{contextid:f.pageContextId}}}]),h="tool_lp/template_competencies_page",i="templatecompetenciespage"):"plan"==f.itemtype&&(g=c.call([{methodname:"core_competency_remove_competency_from_plan",args:{planid:f.itemid,competencyid:e}},{methodname:"tool_lp_data_for_plan_page",args:{planid:f.itemid}}]),h="tool_lp/plan_page",i="plan-page"),g[1].done(function(c){d.render(h,c).done(function(b,c){a('[data-region="'+i+'"]').replaceWith(b),d.runTemplateJS(c)}).fail(b.exception)}).fail(b.exception)},h.prototype.deleteHandler=function(a){var d,f=this,g=[];if("course"==f.itemtype)d="unlinkcompetencycourse";else if("template"==f.itemtype)d="unlinkcompetencytemplate";else{if("plan"!=f.itemtype)return;d="unlinkcompetencyplan"}g=c.call([{methodname:"core_competency_read_competency",args:{id:a}}]),g[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:d,component:"tool_lp",param:c.shortname},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(c){b.confirm(c[0],c[1],c[2],c[3],function(){f.doDelete(a)})}).fail(b.exception)}).fail(b.exception)},h.prototype.registerEvents=function(){var e=this;"course"==e.itemtype&&a('[data-region="coursecompetenciespage"]').on("change",'select[data-field="ruleoutcome"]',function(f){var g=[],h="tool_lp/course_competencies_page",i="coursecompetenciespage",j=a(f.target).data("id"),k=a(f.target).val();g=c.call([{methodname:"core_competency_set_course_competency_ruleoutcome",args:{coursecompetencyid:j,ruleoutcome:k}},{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:e.itemid}}]),g[1].done(function(c){d.render(h,c).done(function(b,c){a('[data-region="'+i+'"]').replaceWith(b),d.runTemplateJS(c)}).fail(b.exception)}).fail(b.exception)}),a('[data-region="actions"] button').click(function(a){a.preventDefault(),e.pickCompetency()}),a('[data-action="delete-competency-link"]').click(function(b){b.preventDefault();var c=a(b.target).closest("[data-id]").data("id");e.deleteHandler(c)})},h});
define('tool_lp/competency_outcomes', ["jquery","core/str"],function(a,b){var c=0,d=1,e=2,f=3;return{NONE:c,EVIDENCE:d,COMPLETE:e,RECOMMEND:f,getAll:function(){var a=this;return b.get_strings([{key:"competencyoutcome_none",component:"tool_lp"},{key:"competencyoutcome_evidence",component:"tool_lp"},{key:"competencyoutcome_recommend",component:"tool_lp"},{key:"competencyoutcome_complete",component:"tool_lp"}]).then(function(b){var c={};return c[a.NONE]={code:a.NONE,name:b[0]},c[a.EVIDENCE]={code:a.EVIDENCE,name:b[1]},c[a.RECOMMEND]={code:a.RECOMMEND,name:b[2]},c[a.COMPLETE]={code:a.COMPLETE,name:b[3]},c})},getString:function(b){var c=this,d=c.getAll();return d.then(function(c){return"undefined"==typeof c[b]?a.Deferred().reject().promise():c[b].name})}}});
define('tool_lp/competency_plan_navigation', ["jquery"],function(a){var b=function(b,c,d,e,f){this._baseUrl=c,this._userId=d+"",this._competencyId=e+"",this._planId=f,this._ignoreFirstCompetency=!0,a(b).on("change",this._competencyChanged.bind(this))};return b.prototype._competencyChanged=function(b){if(this._ignoreFirstCompetency)return void(this._ignoreFirstCompetency=!1);var c=a(b.target).val(),d="?userid="+this._userId+"&planid="+this._planId+"&competencyid="+c;document.location=this._baseUrl+d},b.prototype._competencyId=null,b.prototype._userId=null,b.prototype._planId=null,b.prototype._baseUrl=null,b.prototype._ignoreFirstCompetency=null,b});
define('tool_lp/competency_rule', ["jquery"],function(a){var b=function(b){this._eventNode=a("<div>"),this._ready=a.Deferred(),this._tree=b};return b.prototype._competency=null,b.prototype._eventNode=null,b.prototype._ready=null,b.prototype._tree=null,b.prototype.canConfig=function(){return this._tree.hasChildren(this._competency.id)},b.prototype.getConfig=function(){return null},b.prototype.getType=function(){throw new Error("Not implemented")},b.prototype.init=function(){return this._load()},b.prototype.injectTemplate=function(){return a.Deferred().reject().promise()},b.prototype.isValid=function(){return!1},b.prototype._load=function(){return a.when()},b.prototype.on=function(a,b){this._eventNode.on(a,b)},b.prototype.setTargetCompetency=function(a){this._competency=a},b.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},b.prototype._triggerChange=function(){this._trigger("change",this)},b});
define('tool_lp/competency_rule_all', ["jquery","core/str","tool_lp/competency_rule"],function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=Object.create(c.prototype),d.prototype.getType=function(){return"core_competency\\competency_rule_all"},d.prototype.isValid=function(){return!0},d});
define('tool_lp/competency_rule_points', ["jquery","core/str","core/templates","tool_lp/competency_rule"],function(a,b,c,d){var e=function(){d.apply(this,arguments)};return e.prototype=Object.create(d.prototype),e.prototype._container=null,e.prototype._templateLoaded=!1,e.prototype.getConfig=function(){return JSON.stringify({base:{points:this._getRequiredPoints()},competencies:this._getCompetenciesConfig()})},e.prototype._getCompetenciesConfig=function(){var b=[];return this._container.find("[data-competency]").each(function(){var c=a(this),d=c.data("competency"),e=parseInt(c.find('[name="points"]').val(),10),f=c.find('[name="required"]').prop("checked");b.push({id:d,points:e,required:f?1:0})}),b},e.prototype._getRequiredPoints=function(){return parseInt(this._container.find('[name="requiredpoints"]').val()||1,10)},e.prototype.getType=function(){return"core_competency\\competency_rule_points"},e.prototype.injectTemplate=function(b){var d,e=this,f=this._tree.getChildren(this._competency.id),g={base:{points:2},competencies:[]};if(this._templateLoaded=!1,e._competency.ruletype==e.getType())try{g=JSON.parse(e._competency.ruleconfig)}catch(h){}return d={requiredpoints:g&&g.base?g.base.points:2,competency:e._competency,children:[]},a.each(f,function(b,c){var e={id:c.id,shortname:c.shortname,required:!1,points:0};g&&a.each(g.competencies,function(a,b){b.id==e.id&&(e.required=!!b.required,e.points=b.points)}),d.children.push(e)}),c.render("tool_lp/competency_rule_points",d).then(function(a){e._container=b,b.html(a),b.find("input").change(function(){e._triggerChange()}),e._templateLoaded=!0,e._triggerChange()})},e.prototype.isValid=function(){if(!this._templateLoaded)return!1;var b=this._getRequiredPoints(),c=0,d=!0;return a.each(this._getCompetenciesConfig(),function(a,b){b.points<0&&(d=!1),c+=b.points}),d=d&&c>=b},e});
define('tool_lp/competencyactions', ["jquery","core/url","core/templates","core/notification","core/str","core/ajax","tool_lp/dragdrop-reorder","tool_lp/tree","tool_lp/dialogue","tool_lp/menubar","tool_lp/competencypicker","tool_lp/competency_outcomes","tool_lp/competencyruleconfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s,t=null,u=null,v=null,w=null,x=function(){var c=a('[data-region="competencyactions"]').data("competency"),f={competencyframeworkid:t.getCompetencyFrameworkId(),pagecontextid:n};null!==c&&(f.parentid=c.id);var g=function(){var c=a.param(f);window.location=b.relativeUrl("/admin/tool/lp/editcompetency.php?"+c)};null!==c&&t.hasRule(c.id)?e.get_strings([{key:"confirm",component:"moodle"},{key:"addingcompetencywillresetparentrule",component:"tool_lp",param:c.shortname},{key:"yes",component:"core"},{key:"no",component:"core"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],g)}).fail(d.exception):g()},y=function(){var b=a('[data-region="filtercompetencies"]').data("frameworkid"),c=f.call([{methodname:"core_competency_set_parent_competency",args:{competencyid:u,parentid:v}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(E).fail(d.exception)},z=function(){if(v="undefined"==typeof v?0:v,v!=u){var a=t.getCompetency(v)||{},b=t.getCompetency(u)||{},c="movecompetencywillresetrules",f=!1;b.parentid!=v&&(a.path&&a.path.indexOf("/"+b.id+"/")>=0&&(c="movecompetencytochildofselfwillresetrules",f=f||t.hasRule(b.id)),f=f||t.hasRule(a.id)||t.hasRule(b.parentid),f?e.get_strings([{key:"confirm",component:"moodle"},{key:c,component:"tool_lp"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],y)}).fail(d.exception):y())}},A=function(b){var c=a(b.getContent()),d=c.find("[data-enhance=movetree]"),e=new h(d,(!1));e.on("selectionchanged",function(b,c){var d=c.selected;v=a(d).data("id")}),d.show(),c.on("click",'[data-action="move"]',function(){b.close(),z()}),c.on("click",'[data-action="cancel"]',function(){b.close()})},B=function(a,b){var c;for(c=0;c<b.length;c++)b[c].parentid==a.id&&(a.haschildren=!0,b[c].children=[],b[c].haschildren=!1,a.children[a.children.length]=b[c],B(b[c],b))},C=function(b){b.preventDefault();var g=a('[data-region="competencyactions"]').data("competency");u=g.id;var h=f.call([{methodname:"core_competency_search_competencies",args:{competencyframeworkid:g.competencyframeworkid,searchtext:""}},{methodname:"core_competency_read_competency_framework",args:{id:g.competencyframeworkid}}]);a.when.apply(null,h).done(function(a,b){var f,h=[];for(f=0;f<a.length;f++){var j=a[f];"0"==j.parentid&&(j.children=[],j.haschildren=0,h[h.length]=j,B(j,a))}e.get_strings([{key:"movecompetency",component:"tool_lp",param:g.shortname},{key:"move",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(a){var e={framework:b,competencies:h};c.render("tool_lp/competencies_move_tree",e).done(function(b){new i(a[0],b,A)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},D=function(){var c=a('[data-region="competencyactions"]').data("competency"),d={competencyframeworkid:t.getCompetencyFrameworkId(),id:c.id,parentid:c.parentid,pagecontextid:n},e=a.param(d);window.location=b.relativeUrl("/admin/tool/lp/editcompetency.php?"+e)},E=function(b){c.render("tool_lp/manage_competencies_page",b).done(function(b,d){a('[data-region="managecompetencies"]').replaceWith(b),c.runTemplateJS(d)}).fail(d.exception)},F=function(b){b.preventDefault();var c=a('[data-region="filtercompetencies"]').data("frameworkid"),e=f.call([{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:c,search:a('[data-region="filtercompetencies"] input').val()}}]);e[0].done(E).fail(d.exception)},G=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_move_up_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(E).fail(d.exception)},H=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_move_down_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[1].done(E).fail(d.exception)},I=function(){var b=a('[data-region="competencyactions"]').data("competency"),g=f.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:b.id}}]);g[0].done(function(a){var b={courses:a};c.render("tool_lp/linked_courses_summary",b).done(function(a){e.get_string("linkedcourses","tool_lp").done(function(b){new i(b,a,A)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},J=function(){q=a('[data-region="competencyactions"]').data("competency"),o||(o=new k(n,q.competencyframeworkid),o.on("save",function(b,e){var g=e.competencyIds,h=[];a.each(g,function(a,b){h.push({methodname:"core_competency_add_related_competency",args:{competencyid:b,relatedcompetencyid:q.id}})}),h.push({methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:q.id}});var i=f.call(h);i[h.length-1].then(function(a){return c.render("tool_lp/related_competencies",a)}).then(function(b,d){a('[data-region="relatedcompetencies"]').replaceWith(b),c.runTemplateJS(d),U()})["catch"](d.exception)})),o.setDisallowedCompetencyIDs([q.id]),o.display()},K=function(b){b.preventDefault(),q=a('[data-region="competencyactions"]').data("competency"),p.setTargetCompetencyId(q.id),p.display()},L=function(a,b){var c={id:q.id,shortname:q.shortname,idnumber:q.idnumber,description:q.description,descriptionformat:q.descriptionformat,ruletype:b.ruletype,ruleoutcome:b.ruleoutcome,ruleconfig:b.ruleconfig},e=f.call([{methodname:"core_competency_update_competency",args:{competency:c}}]);e[0].then(function(a){a&&(q.ruletype=b.ruletype,q.ruleoutcome=b.ruleoutcome,q.ruleconfig=b.ruleconfig,X(q))})["catch"](d.exception)},M=function(){var b=a('[data-region="competencyactions"]').data("competency"),c=f.call([{methodname:"core_competency_delete_competency",args:{id:b.id}},{methodname:"tool_lp_data_for_competencies_manage_page",args:{competencyframeworkid:b.competencyframeworkid,search:a('[data-region="filtercompetencies"] input').val()}}]);c[0].done(function(a){a===!1&&e.get_strings([{key:"competencycannotbedeleted",component:"tool_lp",param:b.shortname},{key:"cancel",component:"moodle"}]).done(function(a){d.alert(null,a[0])}).fail(d.exception)}).fail(d.exception),c[1].done(E).fail(d.exception)},N=function(){var b=a('[data-region="competencyactions"]').data("competency"),c="deletecompetency";t.hasRule(b.parentid)&&(c="deletecompetencyparenthasrule"),e.get_strings([{key:"confirm",component:"moodle"},{key:c,component:"tool_lp",param:b.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],M)}).fail(d.exception)},O=function(b){b.originalEvent.dataTransfer.setData("text",a(b.target).parent().data("id"))},P=function(a){a.originalEvent.dataTransfer.dropEffect="move",a.preventDefault()},Q=function(b){b.preventDefault(),a(this).addClass("currentdragtarget")},R=function(b){b.preventDefault(),a(this).removeClass("currentdragtarget")},S=function(b){b.preventDefault(),u=b.originalEvent.dataTransfer.getData("text"),v=a(b.target).parent().data("id"),a(this).removeClass("currentdragtarget"),z()},T=function(b){b.preventDefault();var e=this.id.substr(11),g=a('[data-region="competencyactions"]').data("competency"),h=f.call([{methodname:"core_competency_remove_related_competency",args:{relatedcompetencyid:e,competencyid:g.id}},{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:g.id}}]);h[1].done(function(b){c.render("tool_lp/related_competencies",b).done(function(b){a('[data-region="relatedcompetencies"]').replaceWith(b),U()}).fail(d.exception)}).fail(d.exception)},U=function(){a('[data-action="deleterelation"]').on("click",T)},V=function(a){a.id!==w&&(w=a.id,f.call([{methodname:"core_competency_competency_viewed",args:{id:a.id}}]))},W=function(a){var b=r[a];return b||(b="competency"),b},X=function(b){var e=a.Deferred().resolve().promise(),g={};g.competency=b,g.showdeleterelatedaction=!0,g.showrelatedcompetencies=!0,g.showrule=!1,b.ruleoutcome!=l.NONE&&(e=l.getString(b.ruleoutcome).then(function(c){var d;return a.each(s,function(a,c){c.type==b.ruletype&&(d=c.name)}),[c,d]})),e.then(function(a){return"undefined"!=typeof a&&(g.showrule=!0,g.rule={outcome:a[0],type:a[1]}),g}).then(function(a){return c.render("tool_lp/competency_summary",a)}).then(function(b){return a('[data-region="competencyinfo"]').html(b),a('[data-action="deleterelation"]').on("click",T),c.render("tool_lp/loading",{})}).then(function(a,d){return c.replaceNodeContents('[data-region="relatedcompetencies"]',a,d),f.call([{methodname:"tool_lp_data_for_related_competencies_section",args:{competencyid:b.id}}])[0]}).then(function(a){return c.render("tool_lp/related_competencies",a)}).then(function(b,d){a('[data-region="relatedcompetencies"]').replaceWith(b),c.runTemplateJS(d),U()})["catch"](d.exception)},Y=function(a){return e.get_string("taxonomy_add_"+W(a),"tool_lp")},Z=function(a){return e.get_string("taxonomy_selected_"+W(a),"tool_lp")},$=function(b,c){var e=c.selected,f=a(e).data("id"),g=a('[data-region="competencyactions"] [data-action="add"]'),h=a('[data-region="competencyactionsmenu"]'),i=a('[data-region="selected-competency"]'),k=0,l=1;if(j.closeAll(),"undefined"==typeof f)a('[data-region="competencyinfo"]').html(e.clone().children().remove().end().text()),a('[data-region="competencyactions"]').data("competency",null),h.hide();else{var m=t.getCompetency(f);k=t.getCompetencyLevel(f),l=k+1,h.show(),a('[data-region="competencyactions"]').data("competency",m),X(m),V(m)}return Z(k).then(function(a){i.text(a)})["catch"](d.exception),Y(l).then(function(a){g.show().find('[data-region="term"]').text(a)})["catch"](d.exception),b.preventDefault(),!1},_=function(a){var b=a.split(",");return b.unshift(""),delete b[0],b};return{init:function(b,c,d,e){t=b,n=c,r=_(d),s=e,a('[data-region="competencyactions"] [data-action="add"]').on("click",x),j.enhance(".competencyactionsmenu",{'[data-action="edit"]':D,'[data-action="delete"]':N,'[data-action="move"]':C,'[data-action="moveup"]':G,'[data-action="movedown"]':H,'[data-action="linkedcourses"]':I,'[data-action="relatedcompetencies"]':J.bind(this),'[data-action="competencyrules"]':K.bind(this)}),a('[data-region="competencyactionsmenu"]').hide(),a('[data-region="competencyactions"] [data-action="add"]').hide(),a('[data-region="filtercompetencies"]').on("submit",F);var f=a('[data-region="managecompetencies"] [data-enhance="tree"]');f.on("dragstart","li>span",O).on("dragover","li>span",P).on("dragenter","li>span",Q).on("dragleave","li>span",R).on("drop","li>span",S),b.on("selectionchanged",$),p=new m(t,s),p.on("save",L.bind(this))}}});
define('tool_lp/competencydialogue', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/dialogue"],function(a,b,c,d,e,f){var g,h=function(){};return h.prototype.triggerCompetencyViewedEvent=function(a){c.call([{methodname:"core_competency_competency_viewed",args:{id:a}}])},h.prototype.showDialogue=function(a,c){var e=this.getCompetencyDataPromise(a,c),g=this;e.done(function(c){d.render("tool_lp/competency_summary",c).done(function(b){g.triggerCompetencyViewedEvent(a),new f(c.competency.shortname,b)}).fail(b.exception)}).fail(b.exception)},h.prototype.showDialogueFromData=function(a){var c=this;d.render("tool_lp/competency_summary",a).done(function(b){c.triggerCompetencyViewedEvent(a.id),new f(a.shortname,b,c.enhanceDialogue)}).fail(b.exception)},h.prototype.clickEventHandler=function(b){var c=b.data.compdialogue,d=a(b.currentTarget),e=d.data("id"),f=!d.data("excluderelated"),g=d.data("includecourses");c.showDialogue(e,{includerelated:f,includecourses:g}),b.preventDefault()},h.prototype.getCompetencyDataPromise=function(a,d){var e=c.call([{methodname:"tool_lp_data_for_competency_summary",args:{competencyid:a,includerelated:d.includerelated||!1,includecourses:d.includecourses||!1}}]);return e[0].then(function(a){return a}).fail(b.exception)},{init:function(){"undefined"==typeof g&&(g=new h,a("body").delegate('[data-action="competency-dialogue"]',"click",{compdialogue:g},g.clickEventHandler.bind(g)))}}});
define('tool_lp/competencypicker', ["jquery","core/notification","core/ajax","core/templates","tool_lp/dialogue","core/str","tool_lp/tree"],function(a,b,c,d,e,f,g){var h=function(b,c,d,e){var f=this;f._eventNode=a("<div></div>"),f._frameworks=[],f._reset(),f._pageContextId=b,f._pageContextIncludes=d||"children",f._multiSelect="undefined"==typeof e||e===!0,c&&(f._frameworkId=c,f._singleFramework=!0)};return h.prototype._competencies=null,h.prototype._disallowedCompetencyIDs=null,h.prototype._eventNode=null,h.prototype._frameworks=null,h.prototype._frameworkId=null,h.prototype._pageContextId=null,h.prototype._pageContextIncludes=null,h.prototype._popup=null,h.prototype._searchText="",h.prototype._selectedCompetencies=null,h.prototype._singleFramework=!1,h.prototype._multiSelect=!0,h.prototype._onlyVisible=!0,h.prototype._afterRender=function(){var c=this,d=new g(c._find("[data-enhance=linktree]"),c._multiSelect);c._find("[data-enhance=linktree]").show(),d.on("selectionchanged",function(b,d){var e=d.selected;b.preventDefault();var f=[];a.each(e,function(b,d){var e=a(d).data("id"),g=!0;"undefined"==typeof e?g=!1:a.each(c._disallowedCompetencyIDs,function(a,b){b==e&&(g=!1)}),g&&f.push(e)}),c._selectedCompetencies=f,c._selectedCompetencies.length?c._find('[data-region="competencylinktree"] [data-action="add"]').removeAttr("disabled"):c._find('[data-region="competencylinktree"] [data-action="add"]').attr("disabled","disabled")}),c._singleFramework||c._find('[data-action="chooseframework"]').change(function(d){c._frameworkId=a(d.target).val(),c._loadCompetencies().then(c._refresh.bind(c))["catch"](b.exception)}),c._find('[data-region="filtercompetencies"] button').click(function(b){return b.preventDefault(),a(b.target).attr("disabled","disabled"),c._searchText=c._find('[data-region="filtercompetencies"] input').val()||"",c._refresh().always(function(){a(b.target).removeAttr("disabled")})}),c._find('[data-region="competencylinktree"] [data-action="cancel"]').click(function(a){a.preventDefault(),c.close()}),c._find('[data-region="competencylinktree"] [data-action="add"]').click(function(a){a.preventDefault(),c._selectedCompetencies.length&&(c._multiSelect?c._trigger("save",{competencyIds:c._selectedCompetencies}):c._trigger("save",{competencyId:c._selectedCompetencies[0]}),c.close())});var e=c._selectedCompetencies.slice(0);a.each(e,function(a,b){var e=c._find("[data-id="+b+"]");e.length&&(d.toggleItem(e),d.updateFocus(e))})},h.prototype.close=function(){var a=this;a._popup.close(),a._reset()},h.prototype.display=function(){var c=this;return a.when(f.get_string("competencypicker","tool_lp"),c._render()).then(function(a,b){c._popup=new e(a,b[0],c._afterRender.bind(c))})["catch"](b.exception)},h.prototype._fetchCompetencies=function(a,d){var e=this;return c.call([{methodname:"core_competency_search_competencies",args:{searchtext:d,competencyframeworkid:a}}])[0].done(function(a){function b(a,c){for(var d=0;d<c.length;d++)c[d].parentid==a.id&&(a.haschildren=!0,c[d].children=[],c[d].haschildren=!1,a.children[a.children.length]=c[d],b(c[d],c))}var c,d,f=[];for(c=0;c<a.length;c++)d=a[c],"0"==d.parentid&&(d.children=[],d.haschildren=0,f[f.length]=d,b(d,a));e._competencies=f}).fail(b.exception)},h.prototype._find=function(b){return a(this._popup.getContent()).find(b)},h.prototype._getFramework=function(b){var c;return a.each(this._frameworks,function(a,d){if(d.id==b)return void(c=d)}),c},h.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._frameworkId,this._searchText)},h.prototype._loadFrameworks=function(){var d,e=this;return e._frameworks.length>0?a.when():(d=e._singleFramework?c.call([{methodname:"core_competency_read_competency_framework",args:{id:this._frameworkId}}])[0].then(function(a){return[a]}):c.call([{methodname:"core_competency_list_competency_frameworks",args:{sort:"shortname",context:{contextid:e._pageContextId},includes:e._pageContextIncludes,onlyvisible:e._onlyVisible}}])[0],d.done(function(a){e._frameworks=a}).fail(b.exception))},h.prototype.on=function(a,b){this._eventNode.on(a,b)},h.prototype._preRender=function(){var b=this;return b._loadFrameworks().then(function(){return!b._frameworkId&&b._frameworks.length>0&&(b._frameworkId=b._frameworks[0].id),b._frameworkId?b._loadCompetencies():(b._frameworks=[],a.when())})},h.prototype._refresh=function(){var a=this;return a._render().then(function(b){a._find('[data-region="competencylinktree"]').replaceWith(b),a._afterRender()})},h.prototype._render=function(){var b=this;return b._preRender().then(function(){b._singleFramework||a.each(b._frameworks,function(a,c){c.id==b._frameworkId?c.selected=!0:c.selected=!1});var c={competencies:b._competencies,framework:b._getFramework(b._frameworkId),frameworks:b._frameworks,search:b._searchText,singleFramework:b._singleFramework};return d.render("tool_lp/competency_picker",c)})},h.prototype._reset=function(){this._competencies=[],this._disallowedCompetencyIDs=[],this._popup=null,this._searchText="",this._selectedCompetencies=[]},h.prototype.setDisallowedCompetencyIDs=function(a){this._disallowedCompetencyIDs=a},h.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},h});
define('tool_lp/competencypicker_user_plans', ["jquery","core/notification","core/ajax","core/templates","core/str","tool_lp/tree","tool_lp/competencypicker"],function(a,b,c,d,e,f,g){var h=function(a,b,c){g.prototype.constructor.apply(this,[1,!1,"self",c]),this._userId=a,this._plans=[],b&&(this._planId=b,this._singlePlan=!0)};return h.prototype=Object.create(g.prototype),h.prototype._plans=null,h.prototype._planId=null,h.prototype._singlePlan=!1,h.prototype._userId=null,h.prototype._afterRender=function(){var c=this;g.prototype._afterRender.apply(c,arguments),c._singlePlan||c._find('[data-action="chooseplan"]').change(function(d){c._planId=a(d.target).val(),c._loadCompetencies().then(c._refresh.bind(c))["catch"](b.exception)})},h.prototype._fetchCompetencies=function(a,d){var e=this;return c.call([{methodname:"core_competency_list_plan_competencies",args:{id:a}}])[0].done(function(a){var b,c,f=[];for(b=0;b<a.length;b++)c=a[b].competency,c.shortname.toLowerCase().indexOf(d.toLowerCase())<0||(c.children=[],c.haschildren=0,f.push(c));e._competencies=f}).fail(b.exception)},h.prototype._getPlan=function(b){var c;return a.each(this._plans,function(a,d){if(d.id==b)return void(c=d)}),c},h.prototype._loadCompetencies=function(){return this._fetchCompetencies(this._planId,this._searchText)},h.prototype._loadPlans=function(){var d,e=this;return e._plans.length>0?a.when():(d=e._singlePlan?c.call([{methodname:"core_competency_read_plan",args:{id:this._planId}}])[0].then(function(a){return[a]}):c.call([{methodname:"core_competency_list_user_plans",args:{userid:e._userId}}])[0],d.done(function(a){e._plans=a}).fail(b.exception))},h.prototype._preRender=function(){var b=this;return b._loadPlans().then(function(){return!b._planId&&b._plans.length>0&&(b._planId=b._plans[0].id),b._planId?b._loadCompetencies():(b._plans=[],a.when())})},h.prototype._render=function(){var b=this;return b._preRender().then(function(){b._singlePlan||a.each(b._plans,function(a,c){c.id==b._planId?c.selected=!0:c.selected=!1});var c={competencies:b._competencies,plan:b._getPlan(b._planId),plans:b._plans,search:b._searchText,singlePlan:b._singlePlan};return d.render("tool_lp/competency_picker_user_plans",c)})},h});
define('tool_lp/competencyruleconfig', ["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/competency_outcomes","core/str"],function(a,b,c,d,e,f){var g=function(b,c){this._eventNode=a("<div></div>"),this._tree=b,this._rulesModules=c,this._setUp()};return g.prototype._competency=null,g.prototype._eventNode=null,g.prototype._outcomesOption=null,g.prototype._popup=null,g.prototype._ready=null,g.prototype._rules=null,g.prototype._rulesModules=null,g.prototype._tree=null,g.prototype._afterChange=function(){this._isValid()?this._find('[data-action="save"]').prop("disabled",!1):this._find('[data-action="save"]').prop("disabled",!0)},g.prototype._afterRuleConfigChange=function(a,b){b==this._getRule()&&this._afterChange()},g.prototype._afterRender=function(){var a=this;a._find('[name="outcome"]').on("change",function(){a._switchedOutcome()}).trigger("change"),a._find('[name="rule"]').on("change",function(){a._switchedRule()}).trigger("change"),a._find('[data-action="save"]').on("click",function(){a._trigger("save",a._getConfig()),a.close()}),a._find('[data-action="cancel"]').on("click",function(){a.close()})},g.prototype.canBeConfigured=function(){var b=!1;return a.each(this._rules,function(a,c){if(c.canConfig())return void(b=!0)}),b},g.prototype.close=function(){this._popup.close(),this._popup=null},g.prototype.display=function(){var c=this;return!!c._competency&&a.when(f.get_string("competencyrule","tool_lp"),c._render()).then(function(a,b){c._popup=new d(a,b[0],c._afterRender.bind(c))}).fail(b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._getApplicableOutcomesOptions=function(){var b=this,c=[];return a.each(b._outcomesOption,function(a,d){c.push({code:d.code,name:d.name,selected:d.code==b._competency.ruleoutcome})}),c},g.prototype._getApplicableRulesOptions=function(){var b=this,c=[];return a.each(b._rules,function(a,d){d.canConfig()&&c.push({name:b._getRuleName(d.getType()),type:d.getType(),selected:d.getType()==b._competency.ruletype})}),c},g.prototype._getConfig=function(){var a=this._getRule();return{ruletype:a?a.getType():null,ruleconfig:a?a.getConfig():null,ruleoutcome:this._getOutcome()}},g.prototype._getOutcome=function(){return this._find('[name="outcome"]').val()},g.prototype._getRule=function(){var b,c=this._find('[name="rule"]').val();return a.each(this._rules,function(a,d){if(d.getType()==c)return void(b=d)}),b},g.prototype._getRuleName=function(b){var c,d=this;return a.each(d._rulesModules,function(a,d){if(d.type==b)return void(c=d.name)}),c},g.prototype._initOutcomes=function(){var a=this;return e.getAll().then(function(b){a._outcomesOption=b})},g.prototype._initRules=function(){var b=this,c=[];return a.each(b._rules,function(d,e){var f=e.init().then(function(){e.setTargetCompetency(b._competency),e.on("change",b._afterRuleConfigChange.bind(b))},function(){return b._rules.splice(d,1),a.when()});c.push(f)}),a.when.apply(a.when,c)},g.prototype._isValid=function(){var a=this._getOutcome(),b=this._getRule();return a==e.NONE||!!b&&b.isValid()},g.prototype.on=function(a,b){this._eventNode.on(a,b)},g.prototype._preRender=function(){return this.ready()},g.prototype.ready=function(){return this._ready.promise()},g.prototype._render=function(){var a=this;return this._preRender().then(function(){var b;a.canBeConfigured()?(b={},b.outcomes=a._getApplicableOutcomesOptions(),b.rules=a._getApplicableRulesOptions()):b=!1;var d={competencyshortname:a._competency.shortname,config:b};return c.render("tool_lp/competency_rule_config",d)})},g.prototype.setTargetCompetencyId=function(b){var c=this;c._competency=c._tree.getCompetency(b),a.each(c._rules,function(a,b){b.setTargetCompetency(c._competency)})},g.prototype._setUp=function(){var b=this,c=[],d=[];b._ready=a.Deferred(),b._rules=[],a.each(b._rulesModules,function(a,b){d.push(b.amd)}),require(d,function(){a.each(arguments,function(a,c){var d=new c(b._tree);b._rules.push(d)}),c.push(b._initRules()),c.push(b._initOutcomes()),a.when.apply(a.when,c).always(function(){b._ready.resolve()})})},g.prototype._switchedOutcome=function(){var a=this,b=a._getOutcome();return b==e.NONE?(a._find('[data-region="rule-type"]').hide().find('[name="rule"]').val(-1),a._find('[data-region="rule-config"]').empty().hide(),void a._afterChange()):(a._find('[data-region="rule-type"]').show(),a._find('[data-region="rule-config"]').show(),void a._afterChange())},g.prototype._switchedRule=function(){var a=this,b=a._find('[data-region="rule-config"]'),c=a._getRule();return c?void c.injectTemplate(b).then(function(){b.show()}).always(function(){a._afterChange()})["catch"](function(){b.empty().hide()}):(b.empty().hide(),void a._afterChange())},g.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},g});
define('tool_lp/competencytree', ["core/ajax","core/notification","core/templates","tool_lp/tree","tool_lp/competency_outcomes","jquery"],function(a,b,c,d,e,f){var g={},h=0,i="",j="",k="",l=!1,m=function(a,b){var c=0,d=!1;for(a.haschildren=!1,a.children=[],c=0;c<b.length;c++)d=b[c],d.parentid==a.id&&(a.haschildren=!0,a.children.push(d),m(d,b))},n=function(b){var e=f.Deferred();return c.render("tool_lp/loading",{}).done(function(n,o){c.replaceNodeContents(f(j),n,o);var p=a.call([{methodname:"core_competency_search_competencies",args:{searchtext:b,competencyframeworkid:h}}]);p[0].done(function(a){g={};var b=0;for(b=0;b<a.length;b++)g[a[b].id]=a[b];var h=[],n=!1;for(b=0;b<a.length;b++)n=a[b],0===parseInt(n.parentid,10)&&(h.push(n),m(n,a));var o={shortname:i,canmanage:l,competencies:h};c.render("tool_lp/competencies_tree_root",o).done(function(a,b){c.replaceNodeContents(f(j),f(a).html(),b);var h=new d(j,(!1));if(k){var i=f(j).find("[data-id="+k+"]");i.length&&(h.selectItem(i),h.updateFocus(i))}e.resolve(g)}).fail(e.reject)}).fail(e.reject)}),e.promise()},o=function(a,b){var c=b.selected;k=c.attr("data-id")};return{init:function(a,c,d,e,f){h=a,i=c,l=f,j=e,n(d).fail(b.exception),this.on("selectionchanged",o)},on:function(a,b){f(j).on(a,b)},getChildren:function(a){var b=[];return f.each(g,function(c,d){d.parentid==a&&b.push(d)}),b},getCompetencyFrameworkId:function(){return h},getCompetency:function(a){return g[a]},getCompetencyLevel:function(a){var b=this.getCompetency(a),c=b.path.replace(/^\/|\/$/g,"").split("/").length;return c},hasChildren:function(a){return this.getChildren(a).length>0},hasRule:function(a){var b=this.getCompetency(a);return!!b&&(b.ruleoutcome!=e.OUTCOME_NONE&&b.ruletype)},reloadCompetencies:function(){return n("").fail(b.exception)},listCompetencies:function(){return g}}});
define('tool_lp/course_competency_settings', ["jquery","core/notification","tool_lp/dialogue","core/str","core/ajax","core/templates"],function(a,b,c,d,e,f){var g=function(b){a(b).on("click",this.configureSettings.bind(this))};return g.prototype._dialogue=null,g.prototype.configureSettings=function(e){var g=a(e.target).closest("a").data("courseid"),h=a(e.target).closest("a").data("pushratingstouserplans"),i={courseid:g,settings:{pushratingstouserplans:h}};e.preventDefault(),f.render("tool_lp/course_competency_settings",i).done(function(a){d.get_string("configurecoursecompetencysettings","tool_lp").done(function(b){this._dialogue=new c(b,a,this.addListeners.bind(this))}.bind(this)).fail(b.exception)}.bind(this)).fail(b.exception)},g.prototype.addListeners=function(){var a=this._find('[data-action="save"]');a.on("click",this.saveSettings.bind(this));var b=this._find('[data-action="cancel"]');b.on("click",this.cancelChanges.bind(this))},g.prototype.cancelChanges=function(a){a.preventDefault(),this._dialogue.close()},g.prototype._find=function(b){return a('[data-region="coursecompetencysettings"]').find(b)},g.prototype.saveSettings=function(a){a.preventDefault();var c=this._find('input[name="pushratingstouserplans"]:checked').val(),d=this._find('input[name="courseid"]').val(),f={pushratingstouserplans:c};e.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:d,settings:f}}])[0].done(function(){this.refreshCourseCompetenciesPage()}.bind(this)).fail(b.exception)},g.prototype.refreshCourseCompetenciesPage=function(){var c=this._find('input[name="courseid"]').val();e.call([{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:c}}])[0].done(function(c){f.render("tool_lp/course_competencies_page",c).done(function(b,c){a('[data-region="coursecompetenciespage"]').replaceWith(b),f.runTemplateJS(c),this._dialogue.close()}.bind(this)).fail(b.exception)}.bind(this)).fail(b.exception)},g});
define('tool_lp/dialogue', ["core/yui"],function(a){var b=function(b,c,d,e,f){this.yuiDialogue=null;var g=this;"undefined"==typeof f&&(f=!1),a.use("moodle-core-notification","timers",function(){var h="480px";f&&(h="800px"),g.yuiDialogue=new M.core.dialogue({headerContent:b,bodyContent:c,draggable:!0,visible:!1,center:!0,modal:!0,width:h}),g.yuiDialogue.after("visibleChange",function(b){b.newVal?"undefined"!=typeof d&&a.soon(function(){d(g),g.yuiDialogue.centerDialogue()}):"undefined"!=typeof e&&a.soon(function(){e(g)})}),g.yuiDialogue.show()})};return b.prototype.close=function(){this.yuiDialogue.hide(),this.yuiDialogue.destroy()},b.prototype.getContent=function(){return this.yuiDialogue.bodyNode.getDOMNode()},b});
define('tool_lp/dragdrop-reorder', ["core/str","core/yui"],function(a,b){var c=null,d=function(a){var b=a.drag.get("node"),c=a.drop.get("node");this.callback(b.getDOMNode(),c.getDOMNode())};return{dragdrop:function(e,f,g,h,i,j,k,l){a.get_strings([{key:"emptydragdropregion",component:"moodle"},{key:"movecontent",component:"moodle"},{key:"tocontent",component:"moodle"}]).done(function(){b.use("moodle-tool_lp-dragdrop-reorder",function(){var a={callback:l};c&&c.destroy(),c=M.tool_lp.dragdrop_reorder({group:e,dragHandleText:f,sameNodeText:g,parentNodeText:h,sameNodeClass:i,parentNodeClass:j,dragHandleInsertClass:k,callback:b.bind(d,a)})})})}}});
define('tool_lp/event_base', ["jquery"],function(a){var b=function(){this._eventNode=a("<div></div>")};return b.prototype._eventNode=null,b.prototype.on=function(a,b){this._eventNode.on(a,b)},b.prototype._trigger=function(a,b){this._eventNode.trigger(a,[b])},b});
define('tool_lp/evidence_delete', ["jquery","core/notification","core/ajax","core/str","core/log"],function(a,b,c,d,e){var f={},g=function(g,h){"undefined"==typeof f[g]&&(f[g]=a("body").delegate(g,"click",function(f){var g=a(f.currentTarget).parents(h);if(!g.length||g.length>1)return void e.error("None or too many evidence container were found.");var i=g.data("id");return i?(f.preventDefault(),f.stopPropagation(),void d.get_strings([{key:"confirm",component:"moodle"},{key:"areyousure",component:"moodle"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){b.confirm(a[0],a[1],a[2],a[3],function(){var a=c.call([{methodname:"core_competency_delete_evidence",args:{id:i}}]);a[0].then(function(){g.remove()}).fail(b.exception)})}).fail(b.exception)):void e.error("Evidence ID was not found.")}))};return{register:g}});
define('tool_lp/form-cohort-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i=parseInt(a(d).data("contextid"),10),j=a(d).data("includes");h=b.call([{methodname:"tool_lp_search_cohorts",args:{query:e,context:{contextid:i},includes:j}}]),h[0].then(function(b){var d=[],e=0;return a.each(b.cohorts,function(a,b){d.push(c.render("tool_lp/form-cohort-selector-suggestion",b))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b.cohorts,function(a,b){b._label=c[e],e++}),f(b.cohorts)})})["catch"](g)}}});
define('tool_lp/form-user-selector', ["jquery","core/ajax","core/templates"],function(a,b,c){return{processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d},transport:function(d,e,f,g){var h,i=a(d).data("capability");"undefined"==typeof i&&(i=""),h=b.call([{methodname:"tool_lp_search_users",args:{query:e,capability:i}}]),h[0].then(function(b){var d=[],e=0;return a.each(b.users,function(b,e){var f=e,g=[];a.each(["idnumber","email","phone1","phone2","department","institution"],function(a,b){"undefined"!=typeof e[b]&&""!==e[b]&&(f.hasidentity=!0,g.push(e[b]))}),f.identity=g.join(", "),d.push(c.render("tool_lp/form-user-selector-suggestion",f))}),a.when.apply(a.when,d).then(function(){var c=arguments;a.each(b.users,function(a,b){b._label=c[e],e++}),f(b.users)})})["catch"](g)}}});
define('tool_lp/frameworkactions', ["jquery","core/templates","core/ajax","core/notification","core/str"],function(a,b,c,d,e){var f=0,g=0,h=function(c,d){a('[data-region="managecompetencies"]').replaceWith(c),b.runTemplateJS(d)},i=function(a){b.render("tool_lp/manage_competency_frameworks_page",a).done(h).fail(d.exception)},j=function(b){b.preventDefault(),g=a(this).attr("data-frameworkid");var e=c.call([{methodname:"core_competency_duplicate_competency_framework",args:{id:g}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:f}}}]);e[1].done(i).fail(d.exception)},k=function(){var a=c.call([{methodname:"core_competency_delete_competency_framework",args:{id:g}},{methodname:"tool_lp_data_for_competency_frameworks_manage_page",args:{pagecontext:{contextid:f}}}]);a[0].done(function(a){if(a===!1){var b=c.call([{methodname:"core_competency_read_competency_framework",args:{id:g}}]);b[0].done(function(a){e.get_strings([{key:"frameworkcannotbedeleted",component:"tool_lp",param:a.shortname},{key:"cancel",component:"moodle"}]).done(function(a){d.alert(null,a[0])}).fail(d.exception)})}}).fail(d.exception),a[1].done(i).fail(d.exception)},l=function(b){b.preventDefault();var f=a(this).attr("data-frameworkid");g=f;var h=c.call([{methodname:"core_competency_read_competency_framework",args:{id:g}}]);h[0].done(function(a){e.get_strings([{key:"confirm",component:"moodle"},{key:"deletecompetencyframework",component:"tool_lp",param:a.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],k)}).fail(d.exception)}).fail(d.exception)};return{deleteHandler:l,duplicateHandler:j,init:function(a){f=a}}});
define('tool_lp/frameworks_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(c,d){var e={context:{contextid:c}};return a.extend(e,"undefined"==typeof d?{}:d),b.call([{methodname:"core_competency_list_competency_frameworks",args:e}])[0]},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.id,label:b.shortname+" "+b.idnumber})}),d},transport:function(b,d,e){var f=a(b),g=f.data("contextid"),h=f.data("onlyvisible");if(!g)throw new Error("The attribute data-contextid is required on "+b);this.list(g,{query:d,onlyvisible:h}).then(e)["catch"](c.exception)}}});
define('tool_lp/grade_dialogue', ["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str"],function(a,b,c,d,e,f){var g=function(a){e.prototype.constructor.apply(this,[]),this._ratingOptions=a};return g.prototype=Object.create(e.prototype),g.prototype._popup=null,g.prototype._ratingOptions=null,g.prototype._afterRender=function(){var b=this._find('[data-action="rate"]'),c=this._find('[name="rating"]'),d=this._find('[name="comment"]');this._find('[data-action="cancel"]').click(function(a){a.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),c.change(function(){var c=a(this);c.val()?b.prop("disabled",!1):b.prop("disabled",!0)}).change(),b.click(function(a){a.preventDefault();var b=c.val();b&&(this._trigger("rated",{rating:b,note:d.val()}),this.close())}.bind(this))},g.prototype.close=function(){this._popup.close(),this._popup=null},g.prototype.display=function(){return this._render().then(function(a){return f.get_string("rate","tool_lp").then(function(b){this._popup=new d(b,a,this._afterRender.bind(this))}.bind(this))}.bind(this)).fail(b.exception)},g.prototype._find=function(b){return a(this._popup.getContent()).find(b)},g.prototype._render=function(){var a={cangrade:this._canGrade,ratings:this._ratingOptions};return c.render("tool_lp/competency_grader",a)},g});
define('tool_lp/grade_user_competency_inline', ["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues"],function(a,b,c,d,e,f,g){var h=function(b,c,d,e,g,h,i){f.prototype.constructor.apply(this,[]);var j=a(b);if(!j.length)throw new Error("Could not find the trigger");this._scaleId=c,this._competencyId=d,this._userId=e,this._planId=g,this._courseId=h,this._chooseStr=i,this._setUp(),j.click(function(a){a.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId})};return h.prototype=Object.create(f.prototype),h.prototype._setUp=function(){var a=[],d=this,f=g.get_values(d._scaleId);f.done(function(f){a.push({value:"",name:d._chooseStr});for(var g=0;g<f.length;g++){var h=f[g];a.push({value:h.id,name:h.name})}d._dialogue=new e(a),d._dialogue.on("rated",function(a,e){var f=d._args;f.grade=e.rating,f.note=e.note,c.call([{methodname:d._methodName,args:f,done:function(a){d._trigger("competencyupdated",{args:f,evidence:a})},fail:b.exception}])})}).fail(b.exception)},h.prototype._scaleId=null,h.prototype._competencyId=null,h.prototype._userId=null,h.prototype._planId=null,h.prototype._courseId=null,h.prototype._chooseStr=null,h.prototype._dialogue=null,h});
define('tool_lp/menubar', ["jquery"],function(a){var b=!1,c=!1,d=function(){a(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),c=!1},e=function(a,b){this.menuRoot=a,this.handlers=b,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()};return e.prototype.openSubMenu=function(a){this.setOpenDirection(),d(),a.attr("aria-hidden","false"),c=!0},e.prototype.addEventListeners=function(){var e=this;b===!1&&(a(document).click(function(){c&&d()}),b=!0),this.subMenuItems.mouseenter(function(){return a(this).addClass("menu-hover"),!0}),this.subMenuItems.mouseout(function(){return a(this).removeClass("menu-hover"),!0}),this.allItems.click(function(b){return e.handleClick(a(this),b)}),this.allItems.keydown(function(b){return e.handleKeyDown(a(this),b)}),this.allItems.focus(function(){return e.handleFocus(a(this))}),this.allItems.blur(function(){return e.handleBlur(a(this))})},e.prototype.handleClick=function(b,c){c.stopPropagation();var d=b.parent();if(d.is(".tool-lp-menu"))"true"==b.children("ul").first().attr("aria-hidden")?this.openSubMenu(b.children("ul").first()):b.children("ul").first().attr("aria-hidden","true");else{this.allItems.removeClass("menu-hover menu-focus"),this.activeItem=null,this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true");var e=b.find("a").first(),f=new a.Event("click");f.target=e;var g=!1;this.handlers&&a.each(this.handlers,function(c,d){if(!g&&b.find(c).length>0){var h=a.proxy(d,e);g=h(f)===!1||f.isDefaultPrevented()}}),g||"#"===e.attr("href")||(window.location.href=e.attr("href"))}return!1},e.prototype.handleFocus=function(a){if(null===this.activeItem)this.activeItem=a;else if(a[0]!=this.activeItem[0])return!0;var b=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");if(this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),b.addClass("menu-focus"),this.isChildOpen===!0){var c=a.parent();c.is(".tool-lp-menu")&&"true"==a.attr("aria-haspopup")&&this.openSubMenu(a.children("ul").first())}return!0},e.prototype.handleBlur=function(a){return a.removeClass("menu-focus"),!0},e.prototype.setOpenDirection=function(){var b=this.menuRoot.offset(),c=a(document.body).hasClass("dir-rtl"),d=!0,e=this.rootMenus.outerHeight(),f=this.rootMenus.outerWidth(),g=this.rootMenus.find("ul.tool-lp-sub-menu");g.css("margin-right",""),g.css("margin-left",""),g.css("margin-top",""),g.attr("aria-hidden",!1);var h=g.outerWidth(),i=g.outerHeight(),j=null,k=null,l=null,m=b.top-a(window).scrollTop();m+i>a(window).height()&&(j=i+e,g.css("margin-top","-"+j+"px")),c?b.left-h<0&&(k=h-f,g.css("margin-right","-"+k+"px")):b.left+h>a(window).width()&&(l=h-f,g.css("margin-left","-"+l+"px")),d?this.menuRoot.addClass("tool-lp-menu-open-left"):this.menuRoot.removeClass("tool-lp-menu-open-left")},e.prototype.handleKeyDown=function(a,b){if(b.altKey||b.ctrlKey)return!0;switch(b.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var c=a.parent();return c.is(".tool-lp-menu")?a.children("ul").first().attr("aria-hidden","true"):(this.activeItem=c.parent(),this.isChildOpen=!1,this.activeItem.focus(),c.attr("aria-hidden","true")),b.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return this.handleClick(a,b);case this.keys.left:return this.activeItem=this.moveToPrevious(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(a),this.activeItem.focus(),b.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(a),this.activeItem.focus(),b.stopPropagation(),!1}return!0},e.prototype.moveToNext=function(a){var b=a.parent(),c=b.children("li"),d=c.length,e=c.index(a),f=null,g=null;if(b.is(".tool-lp-menu"))f=e<d-1?a.next():c.first(),"true"==a.attr("aria-haspopup")&&(g=a.children("ul").first(),"false"==g.attr("aria-hidden")&&(g.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===f.attr("aria-haspopup")&&this.isChildOpen===!0&&(g=f.children("ul").first(),this.openSubMenu(g));else if("true"==a.attr("aria-haspopup"))g=a.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g);else{var h=null,i=null;h=a.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu"),h.attr("aria-hidden","true"),h.find("li").removeClass("menu-focus"),h.last().parent().removeClass("menu-focus"),i=h.last().parent(),e=this.rootMenus.index(i),f=e<this.rootMenus.length-1?i.next():this.rootMenus.first(),f.addClass("menu-focus"),"true"==f.attr("aria-haspopup")&&(g=f.children("ul").first(),f=g.children("li").first(),this.openSubMenu(g),this.isChildOpen=!0)}return f},e.prototype.moveToPrevious=function(a){var b=a.parent(),c=b.children("li"),d=c.index(a),e=null,f=null;if(b.is(".tool-lp-menu"))e=d>0?a.prev():c.last(),"true"==a.attr("aria-haspopup")&&(f=a.children("ul").first(),"false"==f.attr("aria-hidden")&&(f.attr("aria-hidden","true"),this.isChildOpen=!0)),a.removeClass("menu-focus"),"true"===e.attr("aria-haspopup")&&this.isChildOpen===!0&&(f=e.children("ul").first(),this.openSubMenu(f));else{var g=b.parent(),h=g.parent();h.is(".tool-lp-menu")?(b.attr("aria-hidden","true"),a.removeClass("menu-focus"),g.removeClass("menu-focus"),d=this.rootMenus.index(g),e=d>0?g.prev():this.rootMenus.last(),e.addClass("menu-focus"),"true"==e.attr("aria-haspopup")&&(f=e.children("ul").first(),this.openSubMenu(f),this.isChildOpen=!0,e=f.children("li").first())):(e=b.parent(),b.attr("aria-hidden","true"),a.removeClass("menu-focus"))}return e},e.prototype.moveDown=function(a,b){var c=a.parent(),d=c.children("li").not(".separator"),e=d.length,f=d.index(a),g=null,h=null;if(c.is(".tool-lp-menu"))return"true"!=a.attr("aria-haspopup")?a:(h=a.children("ul").first(),g=h.children("li").first(),this.openSubMenu(h),g);if(b){var i=!1,j=f+1;for(j==e&&(j=0);j!=f;){var k=d.eq(j).html().charAt(0);if(k.toLowerCase()==b){i=!0;break}j+=1,j==e&&(j=0)}return i===!0?(g=d.eq(j),a.removeClass("menu-focus"),g):a}return g=f<e-1?d.eq(f+1):d.first(),a.removeClass("menu-focus"),g},e.prototype.moveUp=function(a){var b=a.parent(),c=b.children("li").not(".separator"),d=c.index(a),e=null;return b.is(".tool-lp-menu")?a:(e=d>0?c.eq(d-1):c.last(),a.removeClass("menu-focus"),e)},e.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu"),this.subMenuItems.addClass("dropdown-item")},{enhance:function(b,c){a(b).each(function(b,d){var f=a(d);f.data("menubarEnhanced")!==!0&&(new e(f,c),f.data("menubarEnhanced",!0))})},closeAll:d}});
define('tool_lp/parentcompetency_form', ["jquery","core/ajax","core/str","tool_lp/competencypicker","core/templates","core/notification"],function(a,b,c,d,e,f){var g=function(a,b,c,d,e){this.buttonSelector=a,this.inputHiddenSelector=b,this.staticElementSelector=c,this.frameworkId=d,this.pageContextId=e,this.registerEvents()};return g.prototype.buttonSelector=null,g.prototype.inputHiddenSelector=null,g.prototype.staticElementSelector=null,g.prototype.frameworkId=null,g.prototype.pageContextId=null,g.prototype.setParent=function(d){var e=this;0!==d.competencyId?b.call([{methodname:"core_competency_read_competency",args:{id:d.competencyId}}])[0].done(function(b){a(e.staticElementSelector).html(b.shortname),a(e.inputHiddenSelector).val(b.id)}).fail(f.exception):c.get_string("competencyframeworkroot","tool_lp").then(function(b){a(e.staticElementSelector).html(b),a(e.inputHiddenSelector).val(d.competencyId)}).fail(f.exception)},g.prototype.registerEvents=function(){var b=this;a(b.buttonSelector).on("click",function(a){a.preventDefault();var c=new d(b.pageContextId,b.frameworkId,"self",(!1));c._render=function(){var a=this;return a._preRender().then(function(){var b={competencies:a._competencies,framework:a._getFramework(a._frameworkId),frameworks:a._frameworks,search:a._searchText,singleFramework:a._singleFramework};return e.render("tool_lp/competency_picker_competencyform",b)})},c.on("save",function(a,c){b.setParent(c)}),c.display()})},{init:function(a,b,c,d,e){new g(a,b,c,d,e)}}});
define('tool_lp/planactions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(a){if(this._type=a,"plan"===a)this._region='[data-region="plan-page"]',this._planNode='[data-region="plan-page"]',this._template="tool_lp/plan_page",this._contextMethod="tool_lp_data_for_plan_page";else{if("plans"!==a)throw new TypeError("Unexpected type.");this._region='[data-region="plans"]',this._planNode='[data-region="plan-node"]',this._template="tool_lp/plans_page",this._contextMethod="tool_lp_data_for_plans_page"}};return h.prototype._contextMethod=null,h.prototype._planNode=null,h.prototype._region=null,h.prototype._template=null,h.prototype._type=null,h.prototype._getContextArgs=function(a){var b=this,c={};return"plan"===b._type?c={planid:a.id}:"plans"===b._type&&(c={userid:a.userid}),c},h.prototype.refresh=function(b){var c=this._findPlanData(a(b));this._callAndRefresh([],c)},h.prototype._renderView=function(c){var d=this;return b.render(d._template,c).then(function(c,e){a(d._region).replaceWith(c),b.runTemplateJS(e)})},h.prototype._callAndRefresh=function(b,e){var f="tool_lp/planactions:_callAndRefresh-"+Math.floor(Math.random()*Math.floor(1e3));M.util.js_pending(f);var g=this;return b.push({methodname:g._contextMethod,args:g._getContextArgs(e)}),a.when.apply(a,c.call(b)).then(function(){return g._renderView(arguments[arguments.length-1])}).fail(d.exception).always(function(){return M.util.js_complete(f)})},h.prototype._doDelete=function(a){var b=this,c=[{methodname:"core_competency_delete_plan",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.deletePlan=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"deleteplan",component:"tool_lp",param:b.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doDelete(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doReopenPlan=function(a){var b=this,c=[{methodname:"core_competency_reopen_plan",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.reopenPlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"reopenplanconfirm",component:"tool_lp",param:c.name},{key:"reopenplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doReopenPlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doCompletePlan=function(a){var b=this,c=[{methodname:"core_competency_complete_plan",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.completePlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"completeplanconfirm",component:"tool_lp",param:c.name},{key:"completeplan",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doCompletePlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doUnlinkPlan=function(a){var b=this,c=[{methodname:"core_competency_unlink_plan_from_template",args:{planid:a.id}}];b._callAndRefresh(c,a)},h.prototype.unlinkPlan=function(a){var b=this,f=c.call([{methodname:"core_competency_read_plan",args:{id:a.id}}]);f[0].done(function(c){e.get_strings([{key:"confirm",component:"moodle"},{key:"unlinkplantemplateconfirm",component:"tool_lp",param:c.name},{key:"unlinkplantemplate",component:"tool_lp"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){b._doUnlinkPlan(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._doRequestReview=function(a){var b=[{methodname:"core_competency_plan_request_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.requestReview=function(a){this._doRequestReview(a)},h.prototype._doCancelReviewRequest=function(a){var b=[{methodname:"core_competency_plan_cancel_review_request",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.cancelReviewRequest=function(a){this._doCancelReviewRequest(a)},h.prototype._doStartReview=function(a){var b=[{methodname:"core_competency_plan_start_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.startReview=function(a){this._doStartReview(a)},h.prototype._doStopReview=function(a){var b=[{methodname:"core_competency_plan_stop_review",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.stopReview=function(a){this._doStopReview(a)},h.prototype._doApprove=function(a){var b=[{methodname:"core_competency_approve_plan",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.approve=function(a){this._doApprove(a)},h.prototype._doUnapprove=function(a){var b=[{methodname:"core_competency_unapprove_plan",args:{id:a.id}}];this._callAndRefresh(b,a)},h.prototype.unapprove=function(a){this._doUnapprove(a)},h.prototype._showLinkedCoursesHandler=function(f){f.preventDefault();var h=a(f.target).data("id"),i=c.call([{methodname:"tool_lp_list_courses_using_competency",args:{id:h}}]);i[0].done(function(a){var c={courses:a};b.render("tool_lp/linked_courses_summary",c).done(function(a){e.get_string("linkedcourses","tool_lp").done(function(b){new g(b,a)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)},h.prototype._eventHandler=function(b,c){c.preventDefault();var d=this._findPlanData(a(c.target));this[b](d)},h.prototype._findPlanData=function(b){var c,d=b.parentsUntil(a(this._region).parent(),this._planNode);if(1!=d.length)throw new Error("The plan node was not located.");if(c=d.data(),"undefined"==typeof c||"undefined"==typeof c.id)throw new Error("Plan data could not be found.");return c},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="plan-delete"]':this._eventHandler.bind(this,"deletePlan"),'[data-action="plan-complete"]':this._eventHandler.bind(this,"completePlan"),'[data-action="plan-reopen"]':this._eventHandler.bind(this,"reopenPlan"),'[data-action="plan-unlink"]':this._eventHandler.bind(this,"unlinkPlan"),'[data-action="plan-request-review"]':this._eventHandler.bind(this,"requestReview"),'[data-action="plan-cancel-review-request"]':this._eventHandler.bind(this,"cancelReviewRequest"),'[data-action="plan-start-review"]':this._eventHandler.bind(this,"startReview"),'[data-action="plan-stop-review"]':this._eventHandler.bind(this,"stopReview"),'[data-action="plan-approve"]':this._eventHandler.bind(this,"approve"),'[data-action="plan-unapprove"]':this._eventHandler.bind(this,"unapprove")})},h.prototype.registerEvents=function(){var b=a(this._region);b.find('[data-action="plan-delete"]').click(this._eventHandler.bind(this,"deletePlan")),b.find('[data-action="plan-complete"]').click(this._eventHandler.bind(this,"completePlan")),b.find('[data-action="plan-reopen"]').click(this._eventHandler.bind(this,"reopenPlan")),b.find('[data-action="plan-unlink"]').click(this._eventHandler.bind(this,"unlinkPlan")),b.find('[data-action="plan-request-review"]').click(this._eventHandler.bind(this,"requestReview")),b.find('[data-action="plan-cancel-review-request"]').click(this._eventHandler.bind(this,"cancelReviewRequest")),b.find('[data-action="plan-start-review"]').click(this._eventHandler.bind(this,"startReview")),b.find('[data-action="plan-stop-review"]').click(this._eventHandler.bind(this,"stopReview")),b.find('[data-action="plan-approve"]').click(this._eventHandler.bind(this,"approve")),b.find('[data-action="plan-unapprove"]').click(this._eventHandler.bind(this,"unapprove")),b.find('[data-action="find-courses-link"]').click(this._showLinkedCoursesHandler.bind(this))},h});
define('tool_lp/scaleconfig', ["jquery","core/notification","core/templates","core/ajax","tool_lp/dialogue","tool_lp/scalevalues"],function(a,b,c,d,e,f){var g=function(b,c,d){this.selectSelector=b,this.inputSelector=c,this.triggerSelector=d,this.originalscaleid=a(b).val(),a(b).on("change",this.scaleChangeHandler.bind(this)).change(),a(d).click(this.showConfig.bind(this))};return g.prototype.selectSelector=null,g.prototype.inputSelector=null,g.prototype.triggerSelector=null,g.prototype.scalevalues=null,g.prototype.originalscaleid=0,g.prototype.scaleid=0,g.prototype.popup=null,g.prototype.showConfig=function(){var d=this;if(this.scaleid=a(this.selectSelector).val(),!(this.scaleid<=0)){var f=a(this.selectSelector).find("option:selected").text();this.getScaleValues(this.scaleid).done(function(){var a={scalename:f,scales:d.scalevalues};c.render("tool_lp/scale_configuration_page",a).done(function(a){new e(f,a,d.initScaleConfig.bind(d))}).fail(b.exception)}).fail(b.exception)}},g.prototype.retrieveOriginalScaleConfig=function(){var b=a(this.inputSelector).val();if(""!==b){var c=a.parseJSON(b),d=c.shift();if(d.scaleid===this.originalscaleid)return c}return""},g.prototype.initScaleConfig=function(b){this.popup=b;var c=a(b.getContent());if(this.originalscaleid===this.scaleid){var d=this.retrieveOriginalScaleConfig();""!==d&&d.forEach(function(a){1===a.scaledefault&&c.find('[data-field="tool_lp_scale_default_'+a.id+'"]').attr("checked",!0),1===a.proficient&&c.find('[data-field="tool_lp_scale_proficient_'+a.id+'"]').attr("checked",!0)})}c.on("click",'[data-action="close"]',function(){this.setScaleConfig(),b.close()}.bind(this)),c.on("click",'[data-action="cancel"]',function(){b.close()})},g.prototype.setScaleConfig=function(){var b=a(this.popup.getContent()),c=[{scaleid:this.scaleid}];this.scalevalues.forEach(function(a){var d=0,e=0;b.find('[data-field="tool_lp_scale_default_'+a.id+'"]').is(":checked")&&(d=1),b.find('[data-field="tool_lp_scale_proficient_'+a.id+'"]').is(":checked")&&(e=1),(d||e)&&c.push({id:a.id,scaledefault:d,proficient:e})});var d=JSON.stringify(c);a(this.inputSelector).val(d),this.originalscaleid=this.scaleid},g.prototype.getScaleValues=function(a){return f.get_values(a).then(function(a){return this.scalevalues=a,a}.bind(this))},g.prototype.scaleChangeHandler=function(b){a(b.target).val()<=0?a(this.triggerSelector).prop("disabled",!0):a(this.triggerSelector).prop("disabled",!1)},{init:function(a,b,c){return new g(a,b,c)}}});
define('tool_lp/scalevalues', ["jquery","core/ajax"],function(a,b){var c=[];return{get_values:function(d){var e=a.Deferred();return"undefined"==typeof c[d]?b.call([{methodname:"core_competency_get_scale_values",args:{scaleid:d},done:function(a){c[d]=a,e.resolve(a)},fail:e.reject}]):e.resolve(c[d]),e.promise()}}});
define('tool_lp/templateactions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/actionselector"],function(a,b,c,d,e,f){var g=0,h=0,i=!0,j=function(c,d){a('[data-region="managetemplates"]').replaceWith(c),b.runTemplateJS(d)},k=function(a){b.render("tool_lp/manage_templates_page",a).done(j).fail(d.exception)},l=function(){var a=c.call([{methodname:"core_competency_delete_template",args:{id:h,deleteplans:i}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:g}}}]);a[1].done(k).fail(d.exception)},m=function(b){b.preventDefault(),h=a(this).attr("data-templateid");var e=c.call([{methodname:"core_competency_duplicate_template",args:{id:h}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:g}}}]);e[1].done(k).fail(d.exception)},n=function(b){b.preventDefault();var g=a(this).attr("data-templateid");h=g,i=!0;var j=c.call([{methodname:"core_competency_read_template",args:{id:h}},{methodname:"core_competency_template_has_related_data",args:{id:h}}]);j[0].done(function(a){j[1].done(function(b){b?e.get_strings([{key:"deletetemplate",component:"tool_lp",param:a.shortname},{key:"deletetemplatewithplans",component:"tool_lp"},{key:"deleteplans",component:"tool_lp"},{key:"unlinkplanstemplate",component:"tool_lp"},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){var b=[{text:a[2],value:"delete"},{text:a[3],value:"unlink"}],c=new f(a[0],a[1],b,a[4],a[5]);c.display(),c.on("save",function(a,b){"delete"!=b.action&&(i=!1),l()})}).fail(d.exception):e.get_strings([{key:"confirm",component:"moodle"},{key:"deletetemplate",component:"tool_lp",param:a.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],l)}).fail(d.exception)}).fail(d.exception)}).fail(d.exception)};return{deleteHandler:n,duplicateHandler:m,init:function(a){g=a}}});
define('tool_lp/tree', ["jquery","core/url","core/log"],function(a,b,c){var d=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),e=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>'),f=function(b,c){this.treeRoot=a(b),this.multiSelect="undefined"==typeof c||c===!0,this.items=this.treeRoot.find("li"),this.expandAll=this.items.length<20,this.parents=this.treeRoot.find("li:has(ul)"),c&&this.treeRoot.attr("aria-multiselectable","true"),this.items.attr("aria-selected","false"),this.visibleItems=null,this.activeItem=null,this.lastActiveItem=null,this.keys={tab:9,enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,eight:56,asterisk:106},this.init(),this.bindEventHandlers()};return f.prototype.init=function(){this.parents.attr("aria-expanded","true"),this.parents.prepend(d.clone()),this.items.attr("role","tree-item"),this.items.attr("tabindex","-1"),this.parents.attr("role","group"),this.treeRoot.attr("role","tree"),this.visibleItems=this.treeRoot.find("li");var b=this;this.expandAll||(this.parents.each(function(){b.collapseGroup(a(this))}),this.expandGroup(this.parents.first()))},f.prototype.expandGroup=function(a){var b=a.children("ul");b.show().attr("aria-hidden","false"),a.attr("aria-expanded","true"),a.children("img").attr("src",d.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},f.prototype.collapseGroup=function(a){var b=a.children("ul");b.hide().attr("aria-hidden","true"),a.attr("aria-expanded","false"),a.children("img").attr("src",e.attr("src")),this.visibleItems=this.treeRoot.find("li:visible")},f.prototype.toggleGroup=function(a){"true"==a.attr("aria-expanded")?this.collapseGroup(a):this.expandGroup(a)},f.prototype.triggerChange=function(){var a=this.items.filter("[aria-selected=true]");this.multiSelect||(a=a.first()),this.treeRoot.trigger("selectionchanged",{selected:a})},f.prototype.multiSelectItem=function(b){if(this.multiSelect){if(null!==this.lastActiveItem){for(var c=this.visibleItems.index(this.lastActiveItem),d=this.visibleItems.index(this.activeItem),e=null;c<d;)e=a(this.visibleItems.get(c)),e.attr("aria-selected","true"),c++;for(;c>d;)e=a(this.visibleItems.get(c)),e.attr("aria-selected","true"),c--}}else this.items.attr("aria-selected","false");b.attr("aria-selected","true"),this.triggerChange()},f.prototype.selectItem=function(a){for(var b=a.parent();"tree"!=b.attr("role");)b=b.parent(),"false"==b.attr("aria-expanded")&&this.expandGroup(b),b=b.parent();this.items.attr("aria-selected","false"),a.attr("aria-selected","true"),this.triggerChange()},f.prototype.toggleItem=function(a){if(!this.multiSelect)return void this.selectItem(a);var b=a.attr("aria-selected");b="true"===b?"false":"true",a.attr("aria-selected",b),this.triggerChange()},f.prototype.updateFocus=function(a){this.lastActiveItem=this.activeItem,this.activeItem=a;for(var b=a.parent();"tree"!=b.attr("role");)b=b.parent(),"false"==b.attr("aria-expanded")&&this.expandGroup(b),b=b.parent();this.items.attr("tabindex","-1"),a.attr("tabindex",0)},f.prototype.handleKeyDown=function(b,c){var d=this.visibleItems.index(b),e=null,f=c.shiftKey||c.ctrlKey||c.metaKey||c.altKey,g=this;switch(c.keyCode){case this.keys.home:return e=this.parents.first(),e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e),c.stopPropagation(),!1;case this.keys.end:return e=this.visibleItems.last(),e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e),c.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return c.shiftKey?this.multiSelectItem(b):c.metaKey||c.ctrlKey?this.toggleItem(b):this.selectItem(b),c.stopPropagation(),!1;case this.keys.left:if(b.has("ul")&&"true"==b.attr("aria-expanded"))this.collapseGroup(b);else{var h=b.parent(),i=h.parent();i.is("li")&&(i.focus(),c.shiftKey?this.multiSelectItem(i):f||this.selectItem(i))}return c.stopPropagation(),!1;case this.keys.right:return b.has("ul")&&"false"==b.attr("aria-expanded")?this.expandGroup(b):(e=b.children("ul").children("li").first(),e.length>0&&(e.focus(),c.shiftKey?this.multiSelectItem(e):f||this.selectItem(e))),c.stopPropagation(),!1;case this.keys.up:if(d>0){var j=this.visibleItems.eq(d-1);j.focus(),c.shiftKey?this.multiSelectItem(j):f||this.selectItem(j)}return c.stopPropagation(),!1;case this.keys.down:if(d<this.visibleItems.length-1){var k=this.visibleItems.eq(d+1);k.focus(),c.shiftKey?this.multiSelectItem(k):f||this.selectItem(k)}return c.stopPropagation(),!1;case this.keys.asterisk:return this.parents.each(function(){g.expandGroup(a(this))}),c.stopPropagation(),!1;case this.keys.eight:return c.shiftKey&&(this.parents.each(function(){g.expandGroup(a(this))}),c.stopPropagation()),!1}return!0},f.prototype.handleKeyPress=function(a,b){if(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)return!0;switch(b.keyCode){case this.keys.tab:return!0;case this.keys.enter:case this.keys.home:case this.keys.end:case this.keys.left:case this.keys.right:case this.keys.up:case this.keys.down:return b.stopPropagation(),!1;default:var c=String.fromCharCode(b.which),d=!1,e=this.visibleItems.index(a),f=this.visibleItems.length,g=e+1;for(g==f&&(g=0);g!=e;){var h=this.visibleItems.eq(g),i=h.text().charAt(0);if(h.has("ul")&&(i=h.find("span").text().charAt(0)),i.toLowerCase()==c){d=!0;break}g+=1,g==f&&(g=0)}return d===!0&&this.updateFocus(this.visibleItems.eq(g)),b.stopPropagation(),!1}return!0},f.prototype.on=function(a,b){"selectionchanged"!==a?c.warning('Invalid custom event name for tree. Only "selectionchanged" is supported.'):this.treeRoot.on(a,b)},f.prototype.handleDblClick=function(a,b){return!!(b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(this.updateFocus(a),this.toggleGroup(a),b.stopPropagation(),!1)},f.prototype.handleExpandCollapseClick=function(a,b){return this.toggleGroup(a),b.stopPropagation(),!1},f.prototype.handleClick=function(a,b){return b.shiftKey?this.multiSelectItem(a):b.metaKey||b.ctrlKey?this.toggleItem(a):this.selectItem(a),this.updateFocus(a),b.stopPropagation(),!1},f.prototype.handleBlur=function(){return!0},f.prototype.handleFocus=function(a){return this.updateFocus(a),!0},f.prototype.bindEventHandlers=function(){var b=this;this.parents.dblclick(function(c){return b.handleDblClick(a(this),c)}),this.items.click(function(c){return b.handleClick(a(this),c)}),this.items.children("img").click(function(c){return b.handleExpandCollapseClick(a(this).parent(),c)}),this.items.keydown(function(c){return b.handleKeyDown(a(this),c)}),this.items.keypress(function(c){return b.handleKeyPress(a(this),c)}),this.items.focus(function(c){return b.handleFocus(a(this),c)}),this.items.blur(function(c){return b.handleBlur(a(this),c)})},f});
define('tool_lp/user_competency_course_navigation', ["jquery"],function(a){var b=function(b,c,d,e,f,g){this._baseUrl=d,this._userId=e+"",this._competencyId=f+"",this._courseId=g,a(b).on("change",this._userChanged.bind(this)),a(c).on("change",this._competencyChanged.bind(this))};return b.prototype._userChanged=function(b){var c=a(b.target).val(),d="?userid="+c+"&courseid="+this._courseId+"&competencyid="+this._competencyId;document.location=this._baseUrl+d},b.prototype._competencyChanged=function(b){var c=a(b.target).val(),d="?userid="+this._userId+"&courseid="+this._courseId+"&competencyid="+c;document.location=this._baseUrl+d},b.prototype._competencyId=null,b.prototype._userId=null,b.prototype._courseId=null,b.prototype._baseUrl=null,b.prototype._ignoreFirstCompetency=null,b});
define('tool_lp/user_competency_info', ["jquery","core/notification","core/ajax","core/templates"],function(a,b,c,d){var e=function(a,b,c,d,e,f){this._rootElement=a,this._competencyId=b,this._userId=c,this._planId=d,this._courseId=e,this._valid=!0,this._displayuser="undefined"!=typeof f&&f,this._planId?(this._methodName="tool_lp_data_for_user_competency_summary_in_plan",this._args={competencyid:this._competencyId,planid:this._planId},this._templateName="tool_lp/user_competency_summary_in_plan"):this._courseId?(this._methodName="tool_lp_data_for_user_competency_summary_in_course",this._args={userid:this._userId,competencyid:this._competencyId,courseid:this._courseId},this._templateName="tool_lp/user_competency_summary_in_course"):(this._methodName="tool_lp_data_for_user_competency_summary",this._args={userid:this._userId,competencyid:this._competencyId},this._templateName="tool_lp/user_competency_summary")};return e.prototype.reload=function(){var a=this,e=[];this._valid&&(e=c.call([{methodname:this._methodName,args:this._args}]),e[0].done(function(c){a._displayuser&&(c.displayuser=!0),d.render(a._templateName,c).done(function(b,c){d.replaceNode(a._rootElement,b,c)}).fail(b.exception)}).fail(b.exception))},e.prototype._rootElement=null,e.prototype._courseId=null,e.prototype._valid=null,e.prototype._planId=null,e.prototype._competencyId=null,e.prototype._userId=null,e.prototype._methodName=null,e.prototype._args=null,e.prototype._templateName=null,e.prototype._displayuser=!1,e});
define('tool_lp/user_competency_plan_popup', ["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f){var g=function(b,c,d){this._regionSelector=b,this._userCompetencySelector=c,this._planId=d,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return g.prototype._handleClick=function(c){c.preventDefault();var e=a(c.target).closest("tr"),f=a(e).data("competencyid"),g=a(e).data("userid"),h=this._planId,i=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_plan",args:{competencyid:f,planid:h},done:this._contextLoaded.bind(this),fail:b.exception}]);i[0].then(function(a){var b="core_competency_user_competency_viewed_in_plan";return a.plan.iscompleted&&(b="core_competency_user_competency_plan_viewed"),d.call([{methodname:b,args:{competencyid:f,userid:g,planid:h}}])[0]})["catch"](b.exception)},g.prototype._contextLoaded=function(a){var d=this;e.render("tool_lp/user_competency_summary_in_plan",a).done(function(a,g){c.get_string("usercompetencysummary","report_competency").done(function(b){new f(b,a,e.runTemplateJS.bind(e,g),d._refresh.bind(d),(!0))}).fail(b.exception)}).fail(b.exception)},g.prototype._refresh=function(){var a=this._planId;d.call([{methodname:"tool_lp_data_for_plan_page",args:{planid:a},done:this._pageContextLoaded.bind(this),fail:b.exception}])},g.prototype._pageContextLoaded=function(a){var c=this;e.render("tool_lp/plan_page",a).done(function(a,b){e.replaceNode(c._regionSelector,a,b)}).fail(b.exception)},g.prototype._regionSelector=null,g.prototype._userCompetencySelector=null,g.prototype._planId=null,g});
define('tool_lp/user_competency_workflow', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/event_base"],function(a,b,c,d,e,f,g){var h=function(){g.prototype.constructor.apply(this,[])};return h.prototype=Object.create(g.prototype),h.prototype._nodeSelector='[data-node="user-competency"]',h.prototype._cancelReviewRequest=function(a){var b={methodname:"core_competency_user_competency_cancel_review_request",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-request-cancelled",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.cancelReviewRequest=function(a){this._cancelReviewRequest(a)},h.prototype._cancelReviewRequestHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.cancelReviewRequest(c)},h.prototype._requestReview=function(a){var b={methodname:"core_competency_user_competency_request_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-requested",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.requestReview=function(a){this._requestReview(a)},h.prototype._requestReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.requestReview(c)},h.prototype._startReview=function(a){var b={methodname:"core_competency_user_competency_start_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-started",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.startReview=function(a){this._startReview(a)},h.prototype._startReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.startReview(c)},h.prototype._stopReview=function(a){var b={methodname:"core_competency_user_competency_stop_review",args:{userid:a.userid,competencyid:a.competencyid}};c.call([b])[0].then(function(){this._trigger("review-stopped",a),this._trigger("status-changed",a)}.bind(this))["catch"](function(){this._trigger("error-occured",a)}.bind(this))},h.prototype.stopReview=function(a){this._stopReview(a)},h.prototype._stopReviewHandler=function(b){b.preventDefault();var c=this._findUserCompetencyData(a(b.target));this.stopReview(c)},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this)})},h.prototype._findUserCompetencyData=function(a){var b,c=a.parents(this._nodeSelector);if(1!=c.length)throw new Error("The evidence node was not located.");if(b=c.data(),"undefined"==typeof b||"undefined"==typeof b.userid||"undefined"==typeof b.competencyid)throw new Error("User competency data could not be found.");return b},h.prototype.enhanceMenubar=function(a){f.enhance(a,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this),'[data-action="start-review"]':this._startReviewHandler.bind(this),'[data-action="stop-review"]':this._stopReviewHandler.bind(this)})},h.prototype.registerEvents=function(b){var c=a(b);c.find('[data-action="request-review"]').click(this._requestReviewHandler.bind(this)),c.find('[data-action="cancel-review-request"]').click(this._cancelReviewRequestHandler.bind(this)),c.find('[data-action="start-review"]').click(this._startReviewHandler.bind(this)),c.find('[data-action="stop-review"]').click(this._stopReviewHandler.bind(this))},h});
define('tool_lp/user_evidence_actions', ["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/competencypicker_user_plans"],function(a,b,c,d,e,f,g){var h=function(a){if(this._type=a,"evidence"===a)this._region='[data-region="user-evidence-page"]',this._evidenceNode='[data-region="user-evidence-page"]',this._template="tool_lp/user_evidence_page",this._contextMethod="tool_lp_data_for_user_evidence_page";else{if("list"!==a)throw new TypeError("Unexpected type.");this._region='[data-region="user-evidence-list"]',this._evidenceNode='[data-region="user-evidence-node"]',this._template="tool_lp/user_evidence_list_page",this._contextMethod="tool_lp_data_for_user_evidence_list_page"}};return h.prototype._contextMethod=null,h.prototype._evidenceNode=null,h.prototype._region=null,h.prototype._template=null,h.prototype._type=null,h.prototype._getContextArgs=function(a){var b=this,c={};return"evidence"===b._type?c={id:a.id}:"list"===b._type&&(c={userid:a.userid}),c},h.prototype._renderView=function(c){var d=this;return b.render(d._template,c).then(function(c,e){b.replaceNode(a(d._region),c,e)})},h.prototype._callAndRefresh=function(b,e){var f=this;return b.push({methodname:f._contextMethod,args:f._getContextArgs(e)}),a.when.apply(a.when,c.call(b)).then(function(){return f._renderView(arguments[arguments.length-1])}).fail(d.exception)},h.prototype._doDelete=function(a){var b=this,c=[{methodname:"core_competency_delete_user_evidence",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.deleteEvidence=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_user_evidence",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"deleteuserevidence",component:"tool_lp",param:b.name},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doDelete(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._deleteEvidenceHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.deleteEvidence(c)},h.prototype._doCreateUserEvidenceCompetency=function(b,c){var d=this,e=[];a.each(c,function(a,c){e.push({methodname:"core_competency_create_user_evidence_competency",args:{userevidenceid:b.id,competencyid:c}})}),d._callAndRefresh(e,b)},h.prototype.createUserEvidenceCompetency=function(a){var b=this,c=new g(a.userid);c.on("save",function(c,d){var e=d.competencyIds;b._doCreateUserEvidenceCompetency(a,e,d.requestReview)}),c.display()},h.prototype._createUserEvidenceCompetencyHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.createUserEvidenceCompetency(c)},h.prototype._doDeleteUserEvidenceCompetency=function(a,b){var c=this,d=[];d.push({methodname:"core_competency_delete_user_evidence_competency",args:{userevidenceid:a.id,competencyid:b}}),c._callAndRefresh(d,a)},h.prototype.deleteUserEvidenceCompetency=function(a,b){this._doDeleteUserEvidenceCompetency(a,b)},h.prototype._deleteUserEvidenceCompetencyHandler=function(b){var c=this._findEvidenceData(a(b.currentTarget)),d=a(b.currentTarget).data("id");b.preventDefault(),this.deleteUserEvidenceCompetency(c,d)},h.prototype._doReviewUserEvidenceCompetencies=function(a){var b=this,c=[{methodname:"core_competency_request_review_of_user_evidence_linked_competencies",args:{id:a.id}}];b._callAndRefresh(c,a)},h.prototype.reviewUserEvidenceCompetencies=function(a){var b,f=this;b=c.call([{methodname:"core_competency_read_user_evidence",args:{id:a.id}}]),b[0].done(function(b){e.get_strings([{key:"confirm",component:"moodle"},{key:"sendallcompetenciestoreview",component:"tool_lp",param:b.name},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){f._doReviewUserEvidenceCompetencies(a)})}).fail(d.exception)}).fail(d.exception)},h.prototype._reviewUserEvidenceCompetenciesHandler=function(b){b.preventDefault();var c=this._findEvidenceData(a(b.target));this.reviewUserEvidenceCompetencies(c)},h.prototype._findEvidenceData=function(b){var c,d=b.parentsUntil(a(this._region).parent(),this._evidenceNode);if(1!=d.length)throw new Error("The evidence node was not located.");if(c=d.data(),"undefined"==typeof c||"undefined"==typeof c.id)throw new Error("Evidence data could not be found.");return c},h.prototype.enhanceMenubar=function(a){var b=this;f.enhance(a,{'[data-action="user-evidence-delete"]':b._deleteEvidenceHandler.bind(b),'[data-action="link-competency"]':b._createUserEvidenceCompetencyHandler.bind(b),'[data-action="send-competencies-review"]':b._reviewUserEvidenceCompetenciesHandler.bind(b)})},h.prototype.registerEvents=function(){var b=a(this._region),c=this;b.find('[data-action="user-evidence-delete"]').click(c._deleteEvidenceHandler.bind(c)),b.find('[data-action="link-competency"]').click(c._createUserEvidenceCompetencyHandler.bind(c)),b.find('[data-action="delete-competency-link"]').click(c._deleteUserEvidenceCompetencyHandler.bind(c)),b.find('[data-action="send-competencies-review"]').click(c._reviewUserEvidenceCompetenciesHandler.bind(c))},h});
define('tool_policy/acceptances_filter', ["jquery","core/form-autocomplete","core/str","core/notification"],function(a,b,c,d){var e={UNIFIED_FILTERS:"#unified-filters"},f=function(){var f=[{key:"filterplaceholder",component:"tool_policy"},{key:"nofiltersapplied",component:"tool_policy"}];M.util.js_pending("acceptances_filter_datasource"),c.get_strings(f).done(function(a){var c=a[0],f=a[1];b.enhance(e.UNIFIED_FILTERS,!0,"tool_policy/acceptances_filter_datasource",c,!1,!0,f,!0).then(function(){M.util.js_complete("acceptances_filter_datasource")}).fail(d.exception)}).fail(d.exception);var g=a(e.UNIFIED_FILTERS).val();a(e.UNIFIED_FILTERS).on("change",function(){var b=a(this).val(),c=[],d=[],e=!1;if(a.each(b,function(a,b){var f=b.split(":",2);if(2!==f.length)return d.push(b),!0;var g=f[0],h=f[1];return"undefined"!=typeof c[g]&&(e=!0),c[g]=h,!0}),e){var f=[];for(var h in c)f.push(h+":"+c[h]);f=f.concat(d),a(this).val(f)}g.join(",")!=b.join(",")&&this.form.submit()})},g=function(){return a(e.UNIFIED_FILTERS).closest("form")};return{init:function(){f()},getForm:function(){return g()}}});
define('tool_policy/acceptances_filter_datasource', ["jquery","core/ajax","core/notification"],function(a,b,c){return{list:function(b,c){var d=[],e=a(b),f=a(b).data("originaloptionsjson"),g=e.val();a.each(f,function(b,e){return""!==a.trim(c)&&e.label.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())===-1||(a.inArray(e.value,g)>-1||(d.push(e),!0))});var h=new a.Deferred;return h.resolve(d),h.promise()},processResults:function(b,c){var d=[];return a.each(c,function(a,b){d.push({value:b.value,label:b.label})}),d},transport:function(a,b,d){this.list(a,b).then(d)["catch"](c.exception)}}});
define('tool_policy/acceptmodal', ["jquery","core/str","core/modal_factory","core/modal_events","core/notification","core/fragment","core/ajax","core/yui"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(a){this.contextid=a,this.init()};return i.prototype.modal=null,i.prototype.contextid=-1,i.prototype.stringKeys=[{key:"consentdetails",component:"tool_policy"},{key:"iagreetothepolicy",component:"tool_policy"},{key:"selectusersforconsent",component:"tool_policy"},{key:"ok"},{key:"revokedetails",component:"tool_policy"},{key:"irevokethepolicy",component:"tool_policy"}],i.prototype.currentTrigger=null,i.prototype.triggers={SINGLE:"a[data-action=acceptmodal]",BULK:"input[data-action=acceptmodal]"},i.prototype.init=function(){a(this.triggers.SINGLE).on("click",function(b){b.preventDefault(),this.currentTrigger=a(b.currentTarget);var c=a(b.currentTarget).attr("href"),d=c.slice(c.indexOf("?")+1);this.showFormModal(d)}.bind(this)),a(this.triggers.BULK).on("click",function(c){c.preventDefault(),this.currentTrigger=a(c.currentTarget);var d=a(c.currentTarget).closest("form");if(d.find('input[type=checkbox][name="userids[]"]:checked').length){var f=d.serialize();this.showFormModal(f)}else b.get_strings(this.stringKeys).done(function(a){e.alert("",a[2],a[3])})}.bind(this))},i.prototype.showFormModal=function(a){for(var d,f=a.split("&"),g=0;g<f.length;g++){var h=f[g].split("=");"action"==h[0]&&(d=h[1])}b.get_strings(this.stringKeys).done(function(b){var e,f;"revoke"==d?(e=b[4],f=b[5]):(e=b[0],f=b[1]),c.create({type:c.types.SAVE_CANCEL,title:e,body:""}).done(function(b){this.modal=b,this.setupFormModal(a,f)}.bind(this))}.bind(this)).fail(e.exception)},i.prototype.setupFormModal=function(a,b){var c=this.modal;c.setLarge(),c.setSaveButtonText(b),c.getRoot().on(d.hidden,this.destroy.bind(this)),c.setBody(this.getBody(a)),c.getRoot().on(d.save,this.submitForm.bind(this)),c.getRoot().on("submit","form",this.submitFormAjax.bind(this)),c.show()},i.prototype.getBody=function(a){"undefined"==typeof a&&(a={});var b={jsonformdata:JSON.stringify(a)};return f.loadFragment("tool_policy","accept_on_behalf",this.contextid,b)},i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize(),c=g.call([{methodname:"tool_policy_submit_accept_on_behalf",args:{jsonformdata:JSON.stringify(b)}}]);c[0].done(function(a){a.validationerrors?this.modal.setBody(this.getBody(b)):this.close()}.bind(this)).fail(e.exception)},i.prototype.submitForm=function(a){a.preventDefault(),this.modal.getRoot().find("form").submit()},i.prototype.close=function(){this.destroy(),document.location.reload()},i.prototype.destroy=function(){h.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.modal.destroy(),this.currentTrigger.focus()},{getInstance:function(a){return new i(a)}}});
define('tool_policy/jquery-eu-cookie-law-popup', ["jquery"],function(a){window.console||(window.console={}),window.console.log||(window.console.log=function(){}),a.fn.euCookieLawPopup=function(){var b=this;b.params={cookiePolicyUrl:"http://www.wimagguc.com/?cookie-policy",popupPosition:"top",colorStyle:"default",compactStyle:!1,popupTitle:"This website is using cookies",popupText:"We use cookies to ensure that we give you the best experience on our website. If you continue without changing your settings, we'll assume that you are happy to receive all cookies on this website.",buttonContinueTitle:"Continue",buttonLearnmoreTitle:"Learn&nbsp;more",buttonLearnmoreOpenInNewWindow:!0,agreementExpiresInDays:30,autoAcceptCookiePolicy:!1,htmlMarkup:null},b.vars={INITIALISED:!1,HTML_MARKUP:null,COOKIE_NAME:"EU_COOKIE_LAW_CONSENT"};var c=function(c,d,e){if(c){var f=a(c).attr("class")?a(c).attr("class"):"";f.indexOf("eupopup-top")>-1?b.params.popupPosition="top":f.indexOf("eupopup-fixedtop")>-1?b.params.popupPosition="fixedtop":f.indexOf("eupopup-bottomright")>-1?b.params.popupPosition="bottomright":f.indexOf("eupopup-bottomleft")>-1?b.params.popupPosition="bottomleft":f.indexOf("eupopup-bottom")>-1?b.params.popupPosition="bottom":f.indexOf("eupopup-block")>-1&&(b.params.popupPosition="block"),f.indexOf("eupopup-color-default")>-1?b.params.colorStyle="default":f.indexOf("eupopup-color-inverse")>-1&&(b.params.colorStyle="inverse"),f.indexOf("eupopup-style-compact")>-1&&(b.params.compactStyle=!0)}d&&(b.params.htmlMarkup=d),e&&("undefined"!=typeof e.cookiePolicyUrl&&(b.params.cookiePolicyUrl=e.cookiePolicyUrl),"undefined"!=typeof e.popupPosition&&(b.params.popupPosition=e.popupPosition),"undefined"!=typeof e.colorStyle&&(b.params.colorStyle=e.colorStyle),"undefined"!=typeof e.popupTitle&&(b.params.popupTitle=e.popupTitle),"undefined"!=typeof e.popupText&&(b.params.popupText=e.popupText),"undefined"!=typeof e.buttonContinueTitle&&(b.params.buttonContinueTitle=e.buttonContinueTitle),"undefined"!=typeof e.buttonLearnmoreTitle&&(b.params.buttonLearnmoreTitle=e.buttonLearnmoreTitle),"undefined"!=typeof e.buttonLearnmoreOpenInNewWindow&&(b.params.buttonLearnmoreOpenInNewWindow=e.buttonLearnmoreOpenInNewWindow),"undefined"!=typeof e.agreementExpiresInDays&&(b.params.agreementExpiresInDays=e.agreementExpiresInDays),"undefined"!=typeof e.autoAcceptCookiePolicy&&(b.params.autoAcceptCookiePolicy=e.autoAcceptCookiePolicy),"undefined"!=typeof e.htmlMarkup&&(b.params.htmlMarkup=e.htmlMarkup))},d=function(){if(b.params.htmlMarkup)return b.params.htmlMarkup;var a='<div class="eupopup-container eupopup-container-'+b.params.popupPosition+(b.params.compactStyle?" eupopup-style-compact":"")+" eupopup-color-"+b.params.colorStyle+'"><div class="eupopup-head">'+b.params.popupTitle+'</div><div class="eupopup-body">'+b.params.popupText+'</div><div class="eupopup-buttons"><a href="#" class="eupopup-button eupopup-button_1">'+b.params.buttonContinueTitle+'</a><a href="'+b.params.cookiePolicyUrl+'"'+(b.params.buttonLearnmoreOpenInNewWindow?" target=_blank ":"")+' class="eupopup-button eupopup-button_2">'+b.params.buttonLearnmoreTitle+'</a><div class="clearfix"></div></div><a href="#" class="eupopup-closebutton">x</a></div>';return a},e=function(c){var d=new Date,e=24*b.params.agreementExpiresInDays*60*60*1e3;d.setTime(d.getTime()+e);var f="expires="+d.toGMTString();document.cookie=b.vars.COOKIE_NAME+"="+c+"; "+f+";path=/",a(document).trigger("user_cookie_consent_changed",{consent:c})},f=function(){for(var a=!1,c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();0==e.indexOf(b.vars.COOKIE_NAME)&&(a=e.substring(b.vars.COOKIE_NAME.length+1,e.length))}return a},g=function(){a(".eupopup-container").animate({opacity:0,height:0},200,function(){a(".eupopup-container").hide(0)})},h={init:function(h){c(a(".eupopup").first(),a(".eupopup-markup").html(),h),f()||b.vars.INITIALISED||(b.vars.INITIALISED=!0,b.vars.HTML_MARKUP=d(),a(".eupopup-block").length>0?a(".eupopup-block").append(b.vars.HTML_MARKUP):a("BODY").append(b.vars.HTML_MARKUP),a(".eupopup-button_1").click(function(){return e(!0),g(),!1}),a(".eupopup-closebutton").click(function(){return e(!0),g(),!1}),a(".eupopup-container").show(),b.params.autoAcceptCookiePolicy&&e(!0))}};return h}});
define('tool_policy/managedocsactions', ["jquery","core/log","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){"use strict";function g(a){this.base=a,this.initEvents()}var h={LINKS:"[data-action]",MAKE_CURRENT:'[data-action="makecurrent"]',INACTIVATE:'[data-action="inactivate"]',DELETE:'[data-action="delete"]'};return g.prototype.initEvents=function(){var g=this;g.base.on("click",h.LINKS,function(g){g.stopPropagation();var i,j,k=a(g.currentTarget);if(k.is(h.MAKE_CURRENT))i=d.get_strings([{key:"activating",component:"tool_policy"},{key:"activateconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"activateconfirmyes",component:"tool_policy"}]);else if(k.is(h.INACTIVATE))i=d.get_strings([{key:"inactivating",component:"tool_policy"},{key:"inactivatingconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"inactivatingconfirmyes",component:"tool_policy"}]);else{if(!k.is(h.DELETE))return void b.error("unknown action type detected","tool_policy/managedocsactions");i=d.get_strings([{key:"deleting",component:"tool_policy"},{key:"deleteconfirm",component:"tool_policy",param:{name:k.closest("[data-policy-name]").attr("data-policy-name"),revision:k.closest("[data-policy-revision]").attr("data-policy-revision")}},{key:"delete",component:"core"}])}g.preventDefault(),i.then(function(a){return j=a,e.create({title:j[0],body:j[1],type:e.types.SAVE_CANCEL})}).then(function(a){return a.setSaveButtonText(j[2]),a.getRoot().on(f.save,function(){window.location.href=k.attr("href")+"&sesskey="+c.sesskey+"&confirm=1"}),a.getRoot().on(f.hidden,function(){a.destroy()}),a.show(),!0})["catch"](function(a){return b.error(a),!1})})},{init:function(b){var c=a(document.getElementById(b));if(c.length)return new g(c);throw new Error("managedocsactions: Invalid base element identifier")}}});
define('tool_policy/policyactions', ["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],function(a,b,c,d,e){var f={VIEW_POLICY:'[data-action="view"]'},g=function(){this.registerEvents()};return g.prototype.registerEvents=function(){a(f.VIEW_POLICY).click(function(f){f.preventDefault();var g=a(this).data("versionid"),h=a(this).data("behalfid"),i={versionid:g,behalfid:h},j={methodname:"tool_policy_get_policy_version",args:i},k=a.Deferred(),l=a.Deferred(),m=d.create({title:k,body:l,large:!0}).then(function(a){return a.getRoot().on(e.hidden,function(){a.destroy()}),a}).then(function(a){return a.show(),a})["catch"](c.exception),n=b.call([j]);a.when(n[0]).then(function(a){if(a.result.policy)return k.resolve(a.result.policy.name),l.resolve(a.result.policy.content),a;throw new Error(a.warnings[0].message)})["catch"](function(a){return m.then(function(a){return a.hide(),a.destroy(),a})["catch"](c.exception),c.addNotification({message:a,type:"error"})})})},{init:function(){return new g}}});
define('tool_templatelibrary/display', ["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],function(a,b,c,d,e,f,g){var h=function(a,b){if(!a)return!1;var c="@template "+b,d=0,e=[];if(e=a.match(/{{!([\s\S]*?)}}/g),null!==e)for(d=0;d<e.length;d++){var f=e[d],g=f.indexOf(c);if(g!==-1){var h=g+c.length+1;return f=f.substr(h,f.length-2-h)}}return!1},i=function(b,f,i){g.get_string("templateselected","tool_templatelibrary",b).done(function(b){a('[data-region="displaytemplateheader"]').text(b)}).fail(d.exception);var j=h(f,b);j===!1&&(j=h(i,b)),j&&(f=j),a('[data-region="displaytemplatesource"]').text(f);var k=f.match(/Example context \(json\):([\s\S]*)/),l=!1;if(k){var m=k[1].trim();try{l=a.parseJSON(m)}catch(n){c.debug("Could not parse json example context for template."),c.debug(n)}}l?e.render(b,l).done(function(b,c){e.replaceNodeContents(a('[data-region="displaytemplateexample"]'),b,c)}).fail(d.exception):g.get_string("templatehasnoexample","tool_templatelibrary").done(function(b){a('[data-region="displaytemplateexample"]').text(b)}).fail(d.exception)},j=function(c){var e=c.split("/"),g=e.shift(),h=e.shift(),j=b.call([{methodname:"core_output_load_template",args:{component:g,template:h,themename:f.theme,includecomments:!0}},{methodname:"tool_templatelibrary_load_canonical_template",args:{component:g,template:h}}],!0,!1);a.when.apply(a,j).done(function(a,b){i(c,a,b)}).fail(d.exception)};return a('[data-region="list-templates"]').on("click","[data-templatename]",function(b){var c=a(this).data("templatename");b.preventDefault(),j(c)}),{}});
define('tool_templatelibrary/search', ["jquery","core/ajax","core/log","core/notification","core/templates","core/config"],function(a,b,c,d,e,f){var g=function(b){e.render("tool_templatelibrary/search_results",{templates:b}).done(function(b,c){e.replaceNode(a('[data-region="searchresults"]'),b,c)}).fail(d.exception)},h=function(c){var e=a('[data-field="component"]').val(),f=a('[data-field="search"]').val();document.location.hash=f,b.call([{methodname:"tool_templatelibrary_list_templates",args:{component:e,search:f,themename:c},done:g,fail:d.exception}],!0,!1)},i=null,j=function(a,b){null!==i&&window.clearTimeout(i),i=window.setTimeout(function(){a(),i=null},b)},k=function(){j(h.bind(this,f.theme),400)};return a('[data-region="list-templates"]').on("change",'[data-field="component"]',k),a('[data-region="list-templates"]').on("input",'[data-field="search"]',k),a('[data-field="search"]').val(document.location.hash.replace("#","")),h(f.theme),{}});
define('tool_usertours/managesteps', ["jquery","core/str","core/notification"],function(a,b,c){var d={removeStep:function(d){d.preventDefault(),b.get_strings([{key:"confirmstepremovaltitle",component:"tool_usertours"},{key:"confirmstepremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(b){c.confirm(b[0],b[1],b[2],b[3],a.proxy(function(){window.location=a(this).attr("href")},d.currentTarget))})},setup:function(){a("body").delegate('[data-action="delete"]',"click",d.removeStep)}};return{setup:d.setup}});
define('tool_usertours/managetours', ["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){var e={removeTour:function(b){b.preventDefault(),c.get_strings([{key:"confirmtourremovaltitle",component:"tool_usertours"},{key:"confirmtourremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],a.proxy(function(){window.location=a(this).attr("href")},b.currentTarget))})},setup:function(){a("body").delegate('[data-action="delete"]',"click",e.removeTour)}};return{setup:e.setup}});
!function(a,b){"function"==typeof define&&define.amd?define('tool_usertours/tour', ["jquery","core/popper"],function(c,d){return a.Tour=b(c,d)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery"),require("popper.js")):a.Tour=b(a.$,a.Popper)}(this,function(a,b){"use strict";function c(a){this.init(a)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return c.prototype.tourName,c.prototype.storageKey,c.prototype.storage,c.prototype.originalConfiguration,c.prototype.listeners,c.prototype.eventHandlers,c.prototype.steps,c.prototype.currentStepNode,c.prototype.currentStepNumber,c.prototype.currentStepPopper,c.prototype.currentStepConfig,c.prototype.templateContent,c.prototype.init=function(a){this.eventHandlers={},this.reset(),this.originalConfiguration=a||{},this.configure.apply(this,arguments);try{this.storage=window.sessionStorage,this.storageKey="tourstate_"+this.tourName}catch(b){this.storage=!1,this.storageKey=""}return this},c.prototype.reset=function(){return this.hide(),this.eventHandlers=[],this.resetStepListeners(),this.originalConfiguration={},this.steps=[],this.currentStepNumber=0,this},c.prototype.configure=function(a){var b=this;return"object"===("undefined"==typeof a?"undefined":d(a))&&("undefined"!=typeof a.tourName&&(this.tourName=a.tourName),a.eventHandlers&&!function(){var c=void 0;for(c in a.eventHandlers)a.eventHandlers[c].forEach(function(a){this.addEventHandler(c,a)},b)}(),this.resetStepDefaults(!0),"object"===d(a.steps)&&(this.steps=a.steps),"undefined"!=typeof a.template&&(this.templateContent=a.template)),this.checkMinimumRequirements(),this},c.prototype.checkMinimumRequirements=function(){if(!this.tourName)throw new Error("Tour Name required");if(!this.steps||!this.steps.length)throw new Error("Steps must be specified")},c.prototype.resetStepDefaults=function(a){return"undefined"==typeof a&&(a=!0),this.stepDefaults={},a&&"undefined"!=typeof this.originalConfiguration.stepDefaults?this.setStepDefaults(this.originalConfiguration.stepDefaults):this.setStepDefaults({}),this},c.prototype.setStepDefaults=function(b){return this.stepDefaults||(this.stepDefaults={}),a.extend(this.stepDefaults,{element:"",placement:"top",delay:0,moveOnClick:!1,moveAfterTime:0,orphan:!1,direction:1},b),this},c.prototype.getCurrentStepNumber=function(){return parseInt(this.currentStepNumber,10)},c.prototype.setCurrentStepNumber=function(a){if(this.currentStepNumber=a,this.storage)try{this.storage.setItem(this.storageKey,a)}catch(b){b.code===DOMException.QUOTA_EXCEEDED_ERR&&this.storage.removeItem(this.storageKey)}},c.prototype.getNextStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a+1;b<=this.steps.length;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b++}return null},c.prototype.getPreviousStepNumber=function(a){"undefined"==typeof a&&(a=this.getCurrentStepNumber());for(var b=a-1;b>=0;){if(this.isStepPotentiallyVisible(this.getStepConfig(b)))return b;b--}return null},c.prototype.isLastStep=function(a){var b=this.getNextStepNumber(a);return null===b},c.prototype.isFirstStep=function(a){var b=this.getPreviousStepNumber(a);return null===b},c.prototype.isStepPotentiallyVisible=function(a){return!!a&&(!!this.isStepActuallyVisible(a)||(!("undefined"==typeof a.orphan||!a.orphan)||!("undefined"==typeof a.delay||!a.delay)))},c.prototype.isStepActuallyVisible=function(a){if(!a)return!1;var b=this.getStepTarget(a);return!!(b&&b.length&&b.is(":visible"))&&!!b.length},c.prototype.next=function(){return this.gotoStep(this.getNextStepNumber())},c.prototype.previous=function(){return this.gotoStep(this.getPreviousStepNumber(),-1)},c.prototype.gotoStep=function(a,b){if(a<0)return this.endTour();var c=this.getStepConfig(a);return null===c?this.endTour():this._gotoStep(c,b)},c.prototype._gotoStep=function(a,b){if(!a)return this.endTour();if("undefined"!=typeof a.delay&&a.delay&&!a.delayed)return a.delayed=!0,window.setTimeout(this._gotoStep.bind(this),a.delay,a,b),this;if(!a.orphan&&!this.isStepActuallyVisible(a)){var c=b==-1?"getPreviousStepNumber":"getNextStepNumber";return this.gotoStep(this[c](a.stepNumber),b)}return this.hide(),this.fireEventHandlers("beforeRender",a),this.renderStep(a),this.fireEventHandlers("afterRender",a),this},c.prototype.getStepConfig=function(b){if(null===b||b<0||b>=this.steps.length)return null;var c=this.normalizeStepConfig(this.steps[b]);return c=a.extend(c,{stepNumber:b})},c.prototype.normalizeStepConfig=function(b){return"undefined"!=typeof b.reflex&&"undefined"==typeof b.moveAfterClick&&(b.moveAfterClick=b.reflex),"undefined"!=typeof b.element&&"undefined"==typeof b.target&&(b.target=b.element),"undefined"!=typeof b.content&&"undefined"==typeof b.body&&(b.body=b.content),b=a.extend({},this.stepDefaults,b),b=a.extend({},{attachTo:b.target,attachPoint:"after"},b),b.attachTo&&(b.attachTo=a(b.attachTo).first()),b},c.prototype.getStepTarget=function(b){return b.target?a(b.target):null},c.prototype.fireEventHandlers=function(a,b){return"undefined"==typeof this.eventHandlers[a]?this:(this.eventHandlers[a].forEach(function(a){a.call(this,b)},this),this)},c.prototype.addEventHandler=function(a,b){return"undefined"==typeof this.eventHandlers[a]&&(this.eventHandlers[a]=[]),this.eventHandlers[a].push(b),this},c.prototype.processStepListeners=function(b){if(this.listeners.push({node:this.currentStepNode,args:["click",'[data-role="next"]',a.proxy(this.next,this)]},{node:this.currentStepNode,args:["click",'[data-role="previous"]',a.proxy(this.previous,this)]},{node:this.currentStepNode,args:["click",'[data-role="end"]',a.proxy(this.endTour,this)]},{node:a('[data-flexitour="backdrop"]'),args:["click",a.proxy(this.hide,this)]},{node:a("body"),args:["keydown",a.proxy(this.handleKeyDown,this)]}),b.moveOnClick){var c=this.getStepTarget(b);this.listeners.push({node:c,args:["click",a.proxy(function(b){0===a(b.target).parents('[data-flexitour="container"]').length&&window.setTimeout(a.proxy(this.next,this),500)},this)]})}return this.listeners.forEach(function(a){a.node.on.apply(a.node,a.args)}),this},c.prototype.resetStepListeners=function(){return this.listeners&&this.listeners.forEach(function(a){a.node.off.apply(a.node,a.args)}),this.listeners=[],this},c.prototype.renderStep=function(b){this.currentStepConfig=b,this.setCurrentStepNumber(b.stepNumber);var c=a(this.getTemplateContent());return c.find('[data-placeholder="title"]').html(b.title),c.find('[data-placeholder="body"]').html(b.body),this.isFirstStep(b.stepNumber)?c.find('[data-role="previous"]').prop("disabled",!0):c.find('[data-role="previous"]').prop("disabled",!1),this.isLastStep(b.stepNumber)?c.find('[data-role="next"]').prop("disabled",!0):c.find('[data-role="next"]').prop("disabled",!1),c.find('[data-role="previous"]').attr("role","button"),c.find('[data-role="next"]').attr("role","button"),c.find('[data-role="end"]').attr("role","button"),b.template=c,this.addStepToPage(b),this.processStepListeners(b),this},c.prototype.getTemplateContent=function(){return a(this.templateContent).clone()},c.prototype.addStepToPage=function(c){var d=(c.template,a('<span data-flexitour="container"></span>').html(c.template).hide()),e=a("body, html").stop(!0,!0);if(this.isStepActuallyVisible(c)){var f=this.getStepTarget(c);f.data("flexitour","target");var g=this.calculateZIndex(f);g&&(c.zIndex=g+1),c.zIndex&&d.css("zIndex",c.zIndex+1),this.positionBackdrop(c),a(document.body).append(d),this.currentStepNode=d,this.currentStepNode.css({top:0,left:0}),e.animate({scrollTop:this.calculateScrollTop(c)}).promise().then(function(){this.positionStep(c),this.revealStep(c)}.bind(this))}else c.orphan&&(c.isOrphan=!0,c.attachTo=a("body").first(),c.attachPoint="append",this.positionBackdrop(c),d.addClass("orphan"),a(document.body).append(d),this.currentStepNode=d,this.currentStepNode.offset(this.calculateStepPositionInPage()),this.currentStepNode.css("position","fixed"),this.currentStepPopper=new b(a("body"),this.currentStepNode[0],{removeOnDestroy:!0,placement:c.placement+"-start",arrowElement:'[data-role="arrow"]',modifiers:{hide:{enabled:!1},applyStyle:{onLoad:null,enabled:!1}}}),this.revealStep(c));return this},c.prototype.revealStep=function(b){return this.currentStepNode.fadeIn("",a.proxy(function(){this.announceStep(b),this.currentStepNode.focus(),window.setTimeout(a.proxy(function(){this.currentStepNode&&this.currentStepNode.focus()},this),100)},this)),this},c.prototype.announceStep=function(a){var b="tour-step-"+this.tourName+"-"+a.stepNumber;this.currentStepNode.attr("id",b);var c=this.currentStepNode.find('[data-placeholder="body"]').first();c.attr("id",b+"-body"),c.attr("role","document");var d=this.currentStepNode.find('[data-placeholder="title"]').first();d.attr("id",b+"-title"),d.attr("aria-labelledby",b+"-body"),this.currentStepNode.attr("role","dialog"),this.currentStepNode.attr("tabindex",0),this.currentStepNode.attr("aria-labelledby",b+"-title"),this.currentStepNode.attr("aria-describedby",b+"-body");var e=this.getStepTarget(a);return e&&(e.attr("tabindex")||e.attr("tabindex",0),e.data("original-describedby",e.attr("aria-describedby")).attr("aria-describedby",b+"-body")),this.accessibilityShow(a),this},c.prototype.handleKeyDown=function(b){var c="a[href], link[href], [draggable=true], [contenteditable=true], :input:enabled, [tabindex], button:enabled";switch(b.keyCode){case 27:this.endTour();break;case 9:(function(){if(this.currentStepConfig.hasBackdrop){var d=a(document.activeElement),e=this.getStepTarget(this.currentStepConfig),f=a(c),g=a('span[data-flexitour="container"]'),h=void 0;e&&(f=f.filter(function(a,b){return null!=e&&(e.has(b).length||g.has(b).length||e.is(b)||g.is(b))})),f.each(function(a,b){if(d.is(b))return h=a,!1});var i=void 0,j=void 0,k=void 0;if(void 0!=h){var l=1;b.shiftKey&&(l=-1),i=h;do i+=l,j=a(f[i]);while(j.length&&j.is(":disabled")||j.is(":hidden"));j.length?(k=j.closest(e).length,k=k||j.closest(this.currentStepNode).length):k=!1}k?j.focus():b.shiftKey?this.currentStepNode.find(c).last().focus():this.currentStepConfig.isOrphan?this.currentStepNode.focus():e.focus(),b.preventDefault()}}).call(this)}},c.prototype.startTour=function(a){if(this.storage&&"undefined"==typeof a){var b=this.storage.getItem(this.storageKey);if(b){var c=parseInt(b,10);c<=this.steps.length&&(a=c)}}return"undefined"==typeof a&&(a=this.getCurrentStepNumber()),this.fireEventHandlers("beforeStart",a),this.gotoStep(a),this.fireEventHandlers("afterStart",a),this},c.prototype.restartTour=function(){return this.startTour(0)},c.prototype.endTour=function(){if(this.fireEventHandlers("beforeEnd"),this.currentStepConfig){var a=this.getStepTarget(this.currentStepConfig);a&&(a.attr("tabindex")||a.attr("tabindex","-1"),a.focus())}return this.hide(!0),this.fireEventHandlers("afterEnd"),this},c.prototype.hide=function(b){if(this.fireEventHandlers("beforeHide"),this.currentStepNode&&this.currentStepNode.length&&(this.currentStepNode.hide(),this.currentStepPopper&&this.currentStepPopper.destroy()),this.currentStepConfig){var c=this.getStepTarget(this.currentStepConfig);c&&(c.data("original-labelledby")&&c.attr("aria-labelledby",c.data("original-labelledby")),c.data("original-describedby")&&c.attr("aria-describedby",c.data("original-describedby")),c.data("original-tabindex")&&c.attr("tabindex",c.data("tabindex"))),this.currentStepConfig=null}var d=0;if(b&&(d=400),a('[data-flexitour="step-background"]').remove(),a('[data-flexitour="step-backdrop"]').removeAttr("data-flexitour"),a('[data-flexitour="backdrop"]').fadeOut(d,function(){a(this).remove()}),this.currentStepNode&&this.currentStepNode.length){var e=this.currentStepNode.attr("id");if(e){var f='[aria-describedby="'+e+'-body"]';a(f).removeAttr("tabindex"),a(f).removeAttr("aria-describedby")}}return this.resetStepListeners(),this.accessibilityHide(),this.fireEventHandlers("afterHide"),this.currentStepNode=null,this.currentStepPopper=null,this},c.prototype.show=function(){var a=this.getCurrentStepNumber();return this.gotoStep(a)},c.prototype.getStepContainer=function(){return a(this.currentStepNode)},c.prototype.calculateScrollTop=function(b){var c=a(window).scrollTop(),d=a(window).height(),e=this.getStepTarget(b);return c="top"===b.placement?e.offset().top-d/2:"bottom"===b.placement?e.offset().top+e.height()-d/2:e.height()<=.8*d?e.offset().top-(d-e.height())/2:e.offset().top-.2*d,c=Math.max(0,c),c=Math.min(a(document).height()-d,c),Math.ceil(c)},c.prototype.calculateStepPositionInPage=function(){var b=a(window).height(),c=this.currentStepNode.height(),d=a(window).width(),e=this.currentStepNode.width();return{top:Math.ceil((b-c)/2),left:Math.ceil((d-e)/2)}},c.prototype.positionStep=function(c){var d=this.currentStepNode;if(!d||!d.length)return this;var e=void 0;switch(c.placement){case"left":e=["left","right","top","bottom"];break;case"right":e=["right","left","top","bottom"];break;case"top":e=["top","bottom","right","left"];break;case"bottom":e=["bottom","top","right","left"];break;default:e="flip"}var f=this.getStepTarget(c),g={placement:c.placement+"-start",removeOnDestroy:!0,modifiers:{flip:{behaviour:e},arrow:{element:'[data-role="arrow"]'}},onCreate:function(a){h(a)},onUpdate:function(a){h(a)}},h=function(b){var c=b.placement.split("-")[0],d=["left","right"].indexOf(c)!==-1,e=b.instance.popper.querySelector('[data-role="arrow"]'),f=a(b.instance.popper.querySelector('[data-role="flexitour-step"]'));if(d){var g=parseFloat(window.getComputedStyle(e).height),h=parseFloat(window.getComputedStyle(e).top),i=parseFloat(window.getComputedStyle(b.instance.popper).height),j=parseFloat(window.getComputedStyle(b.instance.popper).top),k=parseFloat(f.css("borderTopWidth")),l=2*parseFloat(f.css("borderTopLeftRadius")),m=h+g/2,n=i+j-k-l,o=j+k+l;if(m>=n||m<=o){var p=0;p=m>i/2?n-g:o+g,a(e).css("top",p)}}else{var q=parseFloat(window.getComputedStyle(e).width),r=parseFloat(window.getComputedStyle(e).left),s=parseFloat(window.getComputedStyle(b.instance.popper).width),t=parseFloat(window.getComputedStyle(b.instance.popper).left),u=parseFloat(f.css("borderTopWidth")),v=2*parseFloat(f.css("borderTopLeftRadius")),w=r+q/2,x=s+t-u-v,y=t+u+v;if(w>=x||w<=y){var z=0;z=w>s/2?x-q:y+q,a(e).css("left",z)}}},i=a('[data-flexitour="step-background"]');return i.length&&(f=i),this.currentStepPopper=new b(f,d[0],g),this},c.prototype.positionBackdrop=function(b){if(b.backdrop){this.currentStepConfig.hasBackdrop=!0;var c=a('<div data-flexitour="backdrop"></div>');if(b.zIndex?"append"===b.attachPoint?b.attachTo.append(c):c.insertAfter(b.attachTo):a("body").append(c),this.isStepActuallyVisible(b)){var d=a('<div data-flexitour="step-background"></div>'),e=this.getStepTarget(b),f=10,g=e;f&&(g=a("body")),d.css({width:e.outerWidth()+f+f,height:e.outerHeight()+f+f,left:e.offset().left-f,top:e.offset().top-f,backgroundColor:this.calculateInherittedBackgroundColor(g)}),e.offset().left<f&&d.css({width:e.outerWidth()+e.offset().left+f,left:e.offset().left}),e.offset().top<f&&d.css({height:e.outerHeight()+e.offset().top+f,top:e.offset().top});var h=e.css("borderRadius");h&&h!==a("body").css("borderRadius")&&d.css("borderRadius",h);var i=this.calculatePosition(e);"fixed"===i?d.css("top",0):"absolute"===i&&d.css("position","fixed");var j=d.clone();j.css({backgroundColor:c.css("backgroundColor"),opacity:c.css("opacity")}),j.attr("data-flexitour","step-background-fader"),b.zIndex?"append"===b.attachPoint?b.attachTo.append(d):(j.insertAfter(b.attachTo),d.insertAfter(b.attachTo)):(a("body").append(j),a("body").append(d)),e.attr("data-flexitour","step-backdrop"),b.zIndex&&(c.css("zIndex",b.zIndex),d.css("zIndex",b.zIndex+1),e.css("zIndex",b.zIndex+2)),j.fadeOut("2000",function(){a(this).remove()})}}return this},c.prototype.calculateZIndex=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("absolute"===c||"relative"===c||"fixed"===c){var d=parseInt(b.css("zIndex"),10);if(!isNaN(d)&&0!==d)return d}b=b.parent()}return 0},c.prototype.calculateInherittedBackgroundColor=function(b){var c=a("<div>").hide();a("body").append(c);var d=c.css("backgroundColor");for(c.remove(),b=a(b);b.length&&b[0]!==document;){var e=b.css("backgroundColor");if(e!==d)return e;b=b.parent()}return null},c.prototype.calculatePosition=function(b){for(b=a(b);b.length&&b[0]!==document;){var c=b.css("position");if("static"!==c)return c;b=b.parent()}return null},c.prototype.accessibilityShow=function(){var b="data-has-hidden",c="aria-hidden",d=function(a){var d=a.data("flexitour");if(d)switch(d){case"container":case"target":return}var e=a.attr(c);e||(a.attr(b,!0),a.attr(c,!0))};this.currentStepNode.siblings().each(function(b,c){d(a(c))}),this.currentStepNode.parentsUntil("body").siblings().each(function(b,c){d(a(c))})},c.prototype.accessibilityHide=function(){var b="data-has-hidden",c="aria-hidden",d=function(a){var d=a.attr(b);"undefined"!=typeof d&&(a.removeAttr(b),a.removeAttr(c))};a("["+b+"]").each(function(b,c){d(a(c))})},"object"===("undefined"==typeof exports?"undefined":d(exports))&&(module.exports=c),c});
define('tool_usertours/usertours', ["core/ajax","tool_usertours/tour","jquery","core/templates","core/str","core/log","core/notification"],function(a,b,c,d,e,f,g){var h={tourId:null,currentTour:null,context:null,init:function(a,b,d){h.tourId=a,h.context=d,"undefined"==typeof b&&(b=!0),b&&h.fetchTour(a),h.addResetLink(),c("body").on("click",'[data-action="tool_usertours/resetpagetour"]',function(a){a.preventDefault(),h.resetTourState(h.tourId)})},fetchTour:function(b){M.util.js_pending("admin_usertour_fetchTour"+b),c.when(a.call([{methodname:"tool_usertours_fetch_and_start_tour",args:{tourid:b,context:h.context,pageurl:window.location.href}}])[0],d.render("tool_usertours/tourstep",{})).then(function(a,c){return h.startBootstrapTour(b,c[0],a.tourconfig)}).always(function(){M.util.js_complete("admin_usertour_fetchTour"+b)}).fail(g.exception)},addResetLink:function(){var a;M.util.js_pending("admin_usertour_addResetLink"),a=c(c(".tool_usertours-resettourcontainer").length?".tool_usertours-resettourcontainer":c(".logininfo").length?".logininfo":c("footer").length?"footer":"body"),d.render("tool_usertours/resettour",{}).then(function(b,c){d.appendNodeContents(a,b,c)}).always(function(){M.util.js_complete("admin_usertour_addResetLink")}).fail()},startBootstrapTour:function(a,c,d){return h.currentTour&&(d.onEnd=null,h.currentTour.endTour(),delete h.currentTour),d.eventHandlers={afterEnd:[h.markTourComplete],afterRender:[h.markStepShown]},d.tourName=d.name,delete d.name,d.template=c,d.steps=d.steps.map(function(a){return"undefined"!=typeof a.element&&(a.target=a.element,delete a.element),"undefined"!=typeof a.reflex&&(a.moveOnClick=!!a.reflex,delete a.reflex),"undefined"!=typeof a.content&&(a.body=a.content,delete a.content),a}),h.currentTour=new b(d),h.currentTour.startTour()},markStepShown:function(){var b=this.getStepConfig(this.getCurrentStepNumber());c.when(a.call([{methodname:"tool_usertours_step_shown",args:{tourid:h.tourId,context:h.context,pageurl:window.location.href,stepid:b.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(f.error)},markTourComplete:function(){var b=this.getStepConfig(this.getCurrentStepNumber());c.when(a.call([{methodname:"tool_usertours_complete_tour",args:{tourid:h.tourId,context:h.context,pageurl:window.location.href,stepid:b.stepid,stepindex:this.getCurrentStepNumber()}}])[0]).fail(f.error)},resetTourState:function(b){c.when(a.call([{methodname:"tool_usertours_reset_tour",args:{tourid:b,context:h.context,pageurl:window.location.href}}])[0]).then(function(a){a.startTour&&h.fetchTour(a.startTour)}).fail(g.exception)}};return{init:h.init,resetTourState:h.resetTourState}});
define('theme_boost/alert', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var h=d(b),i=d(c),j=function(a){var b="alert",c="4.0.0",d="bs.alert",f=".".concat(d),h=".data-api",j=a.fn[b],k=150,l={DISMISS:'[data-dismiss="alert"]'},m={CLOSE:"close".concat(f),CLOSED:"closed".concat(f),CLICK_DATA_API:"click".concat(f).concat(h)},n={ALERT:"alert",FADE:"fade",SHOW:"show"},o=function(){function b(a){e(this,b),this._element=a}return g(b,[{key:"close",value:function(a){a=a||this._element;var b=this._getRootElement(a),c=this._triggerCloseEvent(b);c.isDefaultPrevented()||this._removeElement(b)}},{key:"dispose",value:function(){a.removeData(this._element,d),this._element=null}},{key:"_getRootElement",value:function(b){var c=i["default"].getSelectorFromElement(b),d=!1;return c&&(d=a(c)[0]),d||(d=a(b).closest(".".concat(n.ALERT))[0]),d}},{key:"_triggerCloseEvent",value:function(b){var c=a.Event(m.CLOSE);return a(b).trigger(c),c}},{key:"_removeElement",value:function(b){var c=this;return a(b).removeClass(n.SHOW),i["default"].supportsTransitionEnd()&&a(b).hasClass(n.FADE)?void a(b).one(i["default"].TRANSITION_END,function(a){return c._destroyElement(b,a)}).emulateTransitionEnd(k):void this._destroyElement(b)}},{key:"_destroyElement",value:function(b){a(b).detach().trigger(m.CLOSED).remove()}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var e=a(this),f=e.data(d);f||(f=new b(this),e.data(d,f)),"close"===c&&f[c](this)})}},{key:"_handleDismiss",value:function(a){return function(b){b&&b.preventDefault(),a.close(this)}}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(m.CLICK_DATA_API,l.DISMISS,o._handleDismiss(new o)),a.fn[b]=o._jQueryInterface,a.fn[b].Constructor=o,a.fn[b].noConflict=function(){return a.fn[b]=j,o._jQueryInterface},o}(h["default"]);a["default"]=j});
define('theme_boost/button', ["exports","jquery"],function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var g=c(b),h=function(a){var b="button",c="4.0.0",e="bs.button",g=".".concat(e),h=".data-api",i=a.fn[b],j={ACTIVE:"active",BUTTON:"btn",FOCUS:"focus"},k={DATA_TOGGLE_CARROT:'[data-toggle^="button"]',DATA_TOGGLE:'[data-toggle="buttons"]',INPUT:"input",ACTIVE:".active",BUTTON:".btn"},l={CLICK_DATA_API:"click".concat(g).concat(h),FOCUS_BLUR_DATA_API:"focus".concat(g).concat(h," ")+"blur".concat(g).concat(h)},m=function(){function b(a){d(this,b),this._element=a}return f(b,[{key:"toggle",value:function(){var b=!0,c=!0,d=a(this._element).closest(k.DATA_TOGGLE)[0];if(d){var e=a(this._element).find(k.INPUT)[0];if(e){if("radio"===e.type)if(e.checked&&a(this._element).hasClass(j.ACTIVE))b=!1;else{var f=a(d).find(k.ACTIVE)[0];f&&a(f).removeClass(j.ACTIVE)}if(b){if(e.hasAttribute("disabled")||d.hasAttribute("disabled")||e.classList.contains("disabled")||d.classList.contains("disabled"))return;e.checked=!a(this._element).hasClass(j.ACTIVE),a(e).trigger("change")}e.focus(),c=!1}}c&&this._element.setAttribute("aria-pressed",!a(this._element).hasClass(j.ACTIVE)),b&&a(this._element).toggleClass(j.ACTIVE)}},{key:"dispose",value:function(){a.removeData(this._element,e),this._element=null}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var d=a(this).data(e);d||(d=new b(this),a(this).data(e,d)),"toggle"===c&&d[c]()})}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(l.CLICK_DATA_API,k.DATA_TOGGLE_CARROT,function(b){b.preventDefault();var c=b.target;a(c).hasClass(j.BUTTON)||(c=a(c).closest(k.BUTTON)),m._jQueryInterface.call(a(c),"toggle")}).on(l.FOCUS_BLUR_DATA_API,k.DATA_TOGGLE_CARROT,function(b){var c=a(b.target).closest(k.BUTTON)[0];a(c).toggleClass(j.FOCUS,/^focus(in)?$/.test(b.type))}),a.fn[b]=m._jQueryInterface,a.fn[b].Constructor=m,a.fn[b].noConflict=function(){return a.fn[b]=i,m._jQueryInterface},m}(g["default"]);a["default"]=h});
define('theme_boost/carousel', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="carousel",c="4.0.0",d="bs.carousel",h=".".concat(d),j=".data-api",l=a.fn[b],m=600,n=37,o=39,p=500,q={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0},r={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean"},s={NEXT:"next",PREV:"prev",LEFT:"left",RIGHT:"right"},t={SLIDE:"slide".concat(h),SLID:"slid".concat(h),KEYDOWN:"keydown".concat(h),MOUSEENTER:"mouseenter".concat(h),MOUSELEAVE:"mouseleave".concat(h),TOUCHEND:"touchend".concat(h),LOAD_DATA_API:"load".concat(h).concat(j),CLICK_DATA_API:"click".concat(h).concat(j)},u={CAROUSEL:"carousel",ACTIVE:"active",SLIDE:"slide",RIGHT:"carousel-item-right",LEFT:"carousel-item-left",NEXT:"carousel-item-next",PREV:"carousel-item-prev",ITEM:"carousel-item"},v={ACTIVE:".active",ACTIVE_ITEM:".active.carousel-item",ITEM:".carousel-item",NEXT_PREV:".carousel-item-next, .carousel-item-prev",INDICATORS:".carousel-indicators",DATA_SLIDE:"[data-slide], [data-slide-to]",DATA_RIDE:'[data-ride="carousel"]'},w=function(){function j(b,c){g(this,j),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this._config=this._getConfig(c),this._element=a(b)[0],this._indicatorsElement=a(this._element).find(v.INDICATORS)[0],this._addEventListeners()}return i(j,[{key:"next",value:function(){this._isSliding||this._slide(s.NEXT)}},{key:"nextWhenVisible",value:function(){!document.hidden&&a(this._element).is(":visible")&&"hidden"!==a(this._element).css("visibility")&&this.next()}},{key:"prev",value:function(){this._isSliding||this._slide(s.PREV)}},{key:"pause",value:function(b){b||(this._isPaused=!0),a(this._element).find(v.NEXT_PREV)[0]&&k["default"].supportsTransitionEnd()&&(k["default"].triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}},{key:"cycle",value:function(a){a||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}},{key:"to",value:function(b){var c=this;this._activeElement=a(this._element).find(v.ACTIVE_ITEM)[0];var d=this._getItemIndex(this._activeElement);if(!(b>this._items.length-1||b<0)){if(this._isSliding)return void a(this._element).one(t.SLID,function(){return c.to(b)});if(d===b)return this.pause(),void this.cycle();var e=b>d?s.NEXT:s.PREV;this._slide(e,this._items[b])}}},{key:"dispose",value:function(){a(this._element).off(h),a.removeData(this._element,d),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null}},{key:"_getConfig",value:function(a){return a=f({},q,a),k["default"].typeCheckConfig(b,a,r),a}},{key:"_addEventListeners",value:function(){var b=this;this._config.keyboard&&a(this._element).on(t.KEYDOWN,function(a){return b._keydown(a)}),"hover"===this._config.pause&&(a(this._element).on(t.MOUSEENTER,function(a){return b.pause(a)}).on(t.MOUSELEAVE,function(a){return b.cycle(a)}),"ontouchstart"in document.documentElement&&a(this._element).on(t.TOUCHEND,function(){b.pause(),b.touchTimeout&&clearTimeout(b.touchTimeout),b.touchTimeout=setTimeout(function(a){return b.cycle(a)},p+b._config.interval)}))}},{key:"_keydown",value:function(a){if(!/input|textarea/i.test(a.target.tagName))switch(a.which){case n:a.preventDefault(),this.prev();break;case o:a.preventDefault(),this.next()}}},{key:"_getItemIndex",value:function(b){return this._items=a.makeArray(a(b).parent().find(v.ITEM)),this._items.indexOf(b)}},{key:"_getItemByDirection",value:function(a,b){var c=a===s.NEXT,d=a===s.PREV,e=this._getItemIndex(b),f=this._items.length-1,g=d&&0===e||c&&e===f;if(g&&!this._config.wrap)return b;var h=a===s.PREV?-1:1,i=(e+h)%this._items.length;return i===-1?this._items[this._items.length-1]:this._items[i]}},{key:"_triggerSlideEvent",value:function(b,c){var d=this._getItemIndex(b),e=this._getItemIndex(a(this._element).find(v.ACTIVE_ITEM)[0]),f=a.Event(t.SLIDE,{relatedTarget:b,direction:c,from:e,to:d});return a(this._element).trigger(f),f}},{key:"_setActiveIndicatorElement",value:function(b){if(this._indicatorsElement){a(this._indicatorsElement).find(v.ACTIVE).removeClass(u.ACTIVE);var c=this._indicatorsElement.children[this._getItemIndex(b)];c&&a(c).addClass(u.ACTIVE)}}},{key:"_slide",value:function(b,c){var d,e,f,g=this,h=a(this._element).find(v.ACTIVE_ITEM)[0],i=this._getItemIndex(h),j=c||h&&this._getItemByDirection(b,h),l=this._getItemIndex(j),n=Boolean(this._interval);if(b===s.NEXT?(d=u.LEFT,e=u.NEXT,f=s.LEFT):(d=u.RIGHT,e=u.PREV,f=s.RIGHT),j&&a(j).hasClass(u.ACTIVE))return void(this._isSliding=!1);var o=this._triggerSlideEvent(j,f);if(!o.isDefaultPrevented()&&h&&j){this._isSliding=!0,n&&this.pause(),this._setActiveIndicatorElement(j);var p=a.Event(t.SLID,{relatedTarget:j,direction:f,from:i,to:l});k["default"].supportsTransitionEnd()&&a(this._element).hasClass(u.SLIDE)?(a(j).addClass(e),k["default"].reflow(j),a(h).addClass(d),a(j).addClass(d),a(h).one(k["default"].TRANSITION_END,function(){a(j).removeClass("".concat(d," ").concat(e)).addClass(u.ACTIVE),a(h).removeClass("".concat(u.ACTIVE," ").concat(e," ").concat(d)),g._isSliding=!1,setTimeout(function(){return a(g._element).trigger(p)},0)}).emulateTransitionEnd(m)):(a(h).removeClass(u.ACTIVE),a(j).addClass(u.ACTIVE),this._isSliding=!1,a(this._element).trigger(p)),n&&this.cycle()}}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),g=f({},q,a(this).data());"object"===e(b)&&(g=f({},g,b));var h="string"==typeof b?b:g.slide;if(c||(c=new j(this,g),a(this).data(d,c)),"number"==typeof b)c.to(b);else if("string"==typeof h){if("undefined"==typeof c[h])throw new TypeError('No method named "'.concat(h,'"'));c[h]()}else g.interval&&(c.pause(),c.cycle())})}},{key:"_dataApiClickHandler",value:function(b){var c=k["default"].getSelectorFromElement(this);if(c){var e=a(c)[0];if(e&&a(e).hasClass(u.CAROUSEL)){var g=f({},a(e).data(),a(this).data()),h=this.getAttribute("data-slide-to");h&&(g.interval=!1),j._jQueryInterface.call(a(e),g),h&&a(e).data(d).to(h),b.preventDefault()}}}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return q}}]),j}();return a(document).on(t.CLICK_DATA_API,v.DATA_SLIDE,w._dataApiClickHandler),a(window).on(t.LOAD_DATA_API,function(){a(v.DATA_RIDE).each(function(){var b=a(this);w._jQueryInterface.call(b,b.data())})}),a.fn[b]=w._jQueryInterface,a.fn[b].Constructor=w,a.fn[b].noConflict=function(){return a.fn[b]=l,w._jQueryInterface},w}(j["default"]);a["default"]=l});
define('theme_boost/collapse', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="collapse",c="4.0.0",d="bs.collapse",h=".".concat(d),j=".data-api",l=a.fn[b],m=600,n={toggle:!0,parent:""},o={toggle:"boolean",parent:"(string|element)"},p={SHOW:"show".concat(h),SHOWN:"shown".concat(h),HIDE:"hide".concat(h),HIDDEN:"hidden".concat(h),CLICK_DATA_API:"click".concat(h).concat(j)},q={SHOW:"show",COLLAPSE:"collapse",COLLAPSING:"collapsing",COLLAPSED:"collapsed"},r={WIDTH:"width",HEIGHT:"height"},s={ACTIVES:".show, .collapsing",DATA_TOGGLE:'[data-toggle="collapse"]'},t=function(){function h(b,c){g(this,h),this._isTransitioning=!1,this._element=b,this._config=this._getConfig(c),this._triggerArray=a.makeArray(a('[data-toggle="collapse"][href="#'.concat(b.id,'"],')+'[data-toggle="collapse"][data-target="#'.concat(b.id,'"]')));for(var d=a(s.DATA_TOGGLE),e=0;e<d.length;e++){var f=d[e],i=k["default"].getSelectorFromElement(f);null!==i&&a(i).filter(b).length>0&&(this._selector=i,this._triggerArray.push(f))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}return i(h,[{key:"toggle",value:function(){a(this._element).hasClass(q.SHOW)?this.hide():this.show()}},{key:"show",value:function(){var b=this;if(!this._isTransitioning&&!a(this._element).hasClass(q.SHOW)){var c,e;if(this._parent&&(c=a.makeArray(a(this._parent).find(s.ACTIVES).filter('[data-parent="'.concat(this._config.parent,'"]'))),0===c.length&&(c=null)),!(c&&(e=a(c).not(this._selector).data(d),e&&e._isTransitioning))){var f=a.Event(p.SHOW);if(a(this._element).trigger(f),!f.isDefaultPrevented()){c&&(h._jQueryInterface.call(a(c).not(this._selector),"hide"),e||a(c).data(d,null));var g=this._getDimension();a(this._element).removeClass(q.COLLAPSE).addClass(q.COLLAPSING),this._element.style[g]=0,this._triggerArray.length>0&&a(this._triggerArray).removeClass(q.COLLAPSED).attr("aria-expanded",!0),this.setTransitioning(!0);var i=function(){a(b._element).removeClass(q.COLLAPSING).addClass(q.COLLAPSE).addClass(q.SHOW),b._element.style[g]="",b.setTransitioning(!1),a(b._element).trigger(p.SHOWN)};if(!k["default"].supportsTransitionEnd())return void i();var j=g[0].toUpperCase()+g.slice(1),l="scroll".concat(j);a(this._element).one(k["default"].TRANSITION_END,i).emulateTransitionEnd(m),this._element.style[g]="".concat(this._element[l],"px")}}}}},{key:"hide",value:function(){var b=this;if(!this._isTransitioning&&a(this._element).hasClass(q.SHOW)){var c=a.Event(p.HIDE);if(a(this._element).trigger(c),!c.isDefaultPrevented()){var d=this._getDimension();if(this._element.style[d]="".concat(this._element.getBoundingClientRect()[d],"px"),k["default"].reflow(this._element),a(this._element).addClass(q.COLLAPSING).removeClass(q.COLLAPSE).removeClass(q.SHOW),this._triggerArray.length>0)for(var e=0;e<this._triggerArray.length;e++){var f=this._triggerArray[e],g=k["default"].getSelectorFromElement(f);if(null!==g){var h=a(g);h.hasClass(q.SHOW)||a(f).addClass(q.COLLAPSED).attr("aria-expanded",!1)}}this.setTransitioning(!0);var i=function(){b.setTransitioning(!1),a(b._element).removeClass(q.COLLAPSING).addClass(q.COLLAPSE).trigger(p.HIDDEN)};return this._element.style[d]="",k["default"].supportsTransitionEnd()?void a(this._element).one(k["default"].TRANSITION_END,i).emulateTransitionEnd(m):void i()}}}},{key:"setTransitioning",value:function(a){this._isTransitioning=a}},{key:"dispose",value:function(){a.removeData(this._element,d),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}},{key:"_getConfig",value:function(a){return a=f({},n,a),a.toggle=Boolean(a.toggle),k["default"].typeCheckConfig(b,a,o),a}},{key:"_getDimension",value:function(){var b=a(this._element).hasClass(r.WIDTH);return b?r.WIDTH:r.HEIGHT}},{key:"_getParent",value:function(){var b=this,c=null;k["default"].isElement(this._config.parent)?(c=this._config.parent,"undefined"!=typeof this._config.parent.jquery&&(c=this._config.parent[0])):c=a(this._config.parent)[0];var d='[data-toggle="collapse"][data-parent="'.concat(this._config.parent,'"]');return a(c).find(d).each(function(a,c){b._addAriaAndCollapsedClass(h._getTargetFromElement(c),[c])}),c}},{key:"_addAriaAndCollapsedClass",value:function(b,c){if(b){var d=a(b).hasClass(q.SHOW);c.length>0&&a(c).toggleClass(q.COLLAPSED,!d).attr("aria-expanded",d)}}}],[{key:"_getTargetFromElement",value:function(b){var c=k["default"].getSelectorFromElement(b);return c?a(c)[0]:null}},{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this),g=c.data(d),i=f({},n,c.data(),"object"===e(b)&&b);if(!g&&i.toggle&&/show|hide/.test(b)&&(i.toggle=!1),g||(g=new h(this,i),c.data(d,g)),"string"==typeof b){if("undefined"==typeof g[b])throw new TypeError('No method named "'.concat(b,'"'));g[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return n}}]),h}();return a(document).on(p.CLICK_DATA_API,s.DATA_TOGGLE,function(b){"A"===b.currentTarget.tagName&&b.preventDefault();var c=a(this),e=k["default"].getSelectorFromElement(this);a(e).each(function(){var b=a(this),e=b.data(d),f=e?"toggle":c.data();t._jQueryInterface.call(b,f)})}),a.fn[b]=t._jQueryInterface,a.fn[b].Constructor=t,a.fn[b].noConflict=function(){return a.fn[b]=l,t._jQueryInterface},t}(j["default"]);a["default"]=l});
define('theme_boost/drawer', ["jquery","core/custom_interaction_events","core/log"],function(a,b,c){var d={TOGGLE_REGION:'[data-region="drawer-toggle"]',TOGGLE_ACTION:'[data-action="toggle-drawer"]',TOGGLE_TARGET:"aria-controls",TOGGLE_SIDE:"left",BODY:"body",SECTION:'.list-group-item[href*="#section-"]'},e=function(){a(d.TOGGLE_REGION).length||c.debug("Page is missing a drawer region"),a(d.TOGGLE_ACTION).length||c.debug("Page is missing a drawer toggle link"),a(d.TOGGLE_REGION).each(function(b,c){var e=a(c).find(d.TOGGLE_ACTION),f=e.attr("aria-controls"),g=a(document.getElementById(f)),h="false"==e.attr("aria-expanded"),i=e.attr("data-side"),j=a(d.BODY);g.on("mousewheel DOMMouseScroll",this.preventPageScroll),h?e.attr("aria-expanded","false"):(j.addClass("drawer-open-"+i),e.attr("aria-expanded","true"))}.bind(this)),this.registerEventListeners();var b=a(document).width()<768;b&&this.closeAll()};return e.prototype.closeAll=function(){a(d.TOGGLE_REGION).each(function(b,c){var e=a(c).find(d.TOGGLE_ACTION),f=e.attr("data-side"),g=a(d.BODY),h=e.attr("aria-controls"),i=a(document.getElementById(h)),j=e.attr("data-preference");e.attr("aria-expanded","false"),g.removeClass("drawer-open-"+f),i.attr("aria-hidden","true"),i.addClass("closed"),M.util.set_user_preference(j,"false")})},e.prototype.toggleDrawer=function(b){var c=a(b.target).closest("[data-action=toggle-drawer]"),e=c.attr("aria-controls"),f=a(document.getElementById(e)),g=a(d.BODY),h=c.attr("data-side"),i=c.attr("data-preference");g.addClass("drawer-ease");var j="true"==c.attr("aria-expanded");j?(g.removeClass("drawer-open-"+h),c.attr("aria-expanded","false"),f.attr("aria-hidden","true"),f.addClass("closed"),M.util.set_user_preference(i,"false")):(c.attr("aria-expanded","true"),f.attr("aria-hidden","false"),f.focus(),g.addClass("drawer-open-"+h),f.removeClass("closed"),M.util.set_user_preference(i,"true"))},e.prototype.preventPageScroll=function(b){var c=b.wheelDelta||b.originalEvent&&b.originalEvent.wheelDelta||-b.originalEvent.detail,d=this.scrollTop+a(this).outerHeight()-this.scrollHeight>=0,e=this.scrollTop<=0;(c<0&&d||c>0&&e)&&b.preventDefault()},e.prototype.registerEventListeners=function(){a(d.TOGGLE_ACTION).each(function(c,d){b.define(a(d),[b.events.activate]),a(d).on(b.events.activate,function(a,b){this.toggleDrawer(b.originalEvent),b.originalEvent.preventDefault()}.bind(this))}.bind(this)),a(d.SECTION).click(function(){var b=a(document).width()<768;b&&this.closeAll()}.bind(this))},{init:function(){return new e}}});
define('theme_boost/dropdown', ["exports","jquery","core/popper","./util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(a){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function g(){return g=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},g.apply(this,arguments)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function j(a,b,c){return b&&i(a.prototype,b),c&&i(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var k=e(b),l=e(c),m=e(d),n=function(a){var b="dropdown",c="4.0.0",d="bs.dropdown",e=".".concat(d),i=".data-api",k=a.fn[b],n=27,o=32,p=9,q=38,r=40,s=3,t=new RegExp("".concat(q,"|").concat(r,"|").concat(n)),u={HIDE:"hide".concat(e),HIDDEN:"hidden".concat(e),SHOW:"show".concat(e),SHOWN:"shown".concat(e),CLICK:"click".concat(e),CLICK_DATA_API:"click".concat(e).concat(i),KEYDOWN_DATA_API:"keydown".concat(e).concat(i),KEYUP_DATA_API:"keyup".concat(e).concat(i)},v={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},w={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled)"},x={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},y={offset:0,flip:!1,boundary:"scrollParent"},z={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)"},A=function(){function i(a,b){h(this,i),this._element=a,this._popper=null,this._config=this._getConfig(b),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}return j(i,[{key:"toggle",value:function(){if(!this._element.disabled&&!a(this._element).hasClass(v.DISABLED)){var b=i._getParentFromElement(this._element),c=a(this._menu).hasClass(v.SHOW);if(i._clearMenus(),!c){var d={relatedTarget:this._element},e=a.Event(u.SHOW,d);if(a(b).trigger(e),!e.isDefaultPrevented()){if(!this._inNavbar){if("undefined"==typeof l["default"])throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");var f=this._element;a(b).hasClass(v.DROPUP)&&(a(this._menu).hasClass(v.MENULEFT)||a(this._menu).hasClass(v.MENURIGHT))&&(f=b),"scrollParent"!==this._config.boundary&&a(b).addClass(v.POSITION_STATIC),this._popper=new l["default"](f,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===a(b).closest(w.NAVBAR_NAV).length&&a("body").children().on("mouseover",null,a.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),a(this._menu).toggleClass(v.SHOW),a(b).toggleClass(v.SHOW).trigger(a.Event(u.SHOWN,d))}}}}},{key:"dispose",value:function(){a.removeData(this._element,d),a(this._element).off(e),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"update",value:function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}},{key:"_addEventListeners",value:function(){var b=this;a(this._element).on(u.CLICK,function(a){a.preventDefault(),a.stopPropagation(),b.toggle()})}},{key:"_getConfig",value:function(c){return c=g({},this.constructor.Default,a(this._element).data(),c),m["default"].typeCheckConfig(b,c,this.constructor.DefaultType),c}},{key:"_getMenuElement",value:function(){if(!this._menu){var b=i._getParentFromElement(this._element);this._menu=a(b).find(w.MENU)[0]}return this._menu}},{key:"_getPlacement",value:function(){var b=a(this._element).parent(),c=x.BOTTOM;return b.hasClass(v.DROPUP)?(c=x.TOP,a(this._menu).hasClass(v.MENURIGHT)&&(c=x.TOPEND)):b.hasClass(v.DROPRIGHT)?c=x.RIGHT:b.hasClass(v.DROPLEFT)?c=x.LEFT:a(this._menu).hasClass(v.MENURIGHT)&&(c=x.BOTTOMEND),c}},{key:"_detectNavbar",value:function(){return a(this._element).closest(".navbar").length>0}},{key:"_getPopperConfig",value:function(){var a=this,b={};"function"==typeof this._config.offset?b.fn=function(b){return b.offsets=g({},b.offsets,a._config.offset(b.offsets)||{}),b}:b.offset=this._config.offset;var c={placement:this._getPlacement(),modifiers:{offset:b,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return c}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),e="object"===f(b)?b:null;if(c||(c=new i(this,e),a(this).data(d,c)),"string"==typeof b){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"_clearMenus",value:function(b){if(!b||b.which!==s&&("keyup"!==b.type||b.which===p))for(var c=a.makeArray(a(w.DATA_TOGGLE)),e=0;e<c.length;e++){var f=i._getParentFromElement(c[e]),g=a(c[e]).data(d),h={relatedTarget:c[e]};if(g){var j=g._menu;if(a(f).hasClass(v.SHOW)&&!(b&&("click"===b.type&&/input|textarea/i.test(b.target.tagName)||"keyup"===b.type&&b.which===p)&&a.contains(f,b.target))){var k=a.Event(u.HIDE,h);a(f).trigger(k),k.isDefaultPrevented()||("ontouchstart"in document.documentElement&&a("body").children().off("mouseover",null,a.noop),c[e].setAttribute("aria-expanded","false"),a(j).removeClass(v.SHOW),a(f).removeClass(v.SHOW).trigger(a.Event(u.HIDDEN,h)))}}}}},{key:"_getParentFromElement",value:function(b){var c,d=m["default"].getSelectorFromElement(b);return d&&(c=a(d)[0]),c||b.parentNode}},{key:"_dataApiKeydownHandler",value:function(b){if((/input|textarea/i.test(b.target.tagName)?!(b.which===o||b.which!==n&&(b.which!==r&&b.which!==q||a(b.target).closest(w.MENU).length)):t.test(b.which))&&(b.preventDefault(),b.stopPropagation(),!this.disabled&&!a(this).hasClass(v.DISABLED))){var c=i._getParentFromElement(this),d=a(c).hasClass(v.SHOW);if(!d&&(b.which!==n||b.which!==o)||d&&(b.which===n||b.which===o)){if(b.which===n){var e=a(c).find(w.DATA_TOGGLE)[0];a(e).trigger("focus")}return void a(this).trigger("click")}var f=a(c).find(w.VISIBLE_ITEMS).get();if(0!==f.length){var g=f.indexOf(b.target);b.which===q&&g>0&&g--,b.which===r&&g<f.length-1&&g++,g<0&&(g=0),f[g].focus()}}}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return y}},{key:"DefaultType",get:function(){return z}}]),i}();return a(document).on(u.KEYDOWN_DATA_API,w.DATA_TOGGLE,A._dataApiKeydownHandler).on(u.KEYDOWN_DATA_API,w.MENU,A._dataApiKeydownHandler).on("".concat(u.CLICK_DATA_API," ").concat(u.KEYUP_DATA_API),A._clearMenus).on(u.CLICK_DATA_API,w.DATA_TOGGLE,function(b){b.preventDefault(),b.stopPropagation(),A._jQueryInterface.call(a(this),"toggle")}).on(u.CLICK_DATA_API,w.FORM_CHILD,function(a){a.stopPropagation()}),a.fn[b]=A._jQueryInterface,a.fn[b].Constructor=A,a.fn[b].noConflict=function(){return a.fn[b]=k,A._jQueryInterface},A}(k["default"],l["default"]);a["default"]=n});
define('theme_boost/form-display-errors', ["jquery","core/event"],function(a,b){return{enhance:function(c){var d=document.getElementById(c);a(d).on(b.Events.FORM_FIELD_VALIDATION,function(b,c){b.preventDefault();var e=a(d).closest(".form-group"),f=e.find(".form-control-feedback");"TEXTAREA"==a(d).prop("tagName")&&e.find("[contenteditable]")&&(d=e.find("[contenteditable]")),""!==c?(e.addClass("has-danger"),e.data("client-validation-error",!0),a(d).addClass("is-invalid"),a(d).attr("aria-describedby",f.attr("id")),a(d).attr("aria-invalid",!0),f.attr("tabindex",0),f.html(c),f.is(":visible")||(f.show(),f.focus())):e.data("client-validation-error")===!0&&(e.removeClass("has-danger"),e.data("client-validation-error",!1),a(d).removeClass("is-invalid"),a(d).removeAttr("aria-describedby"),a(d).attr("aria-invalid",!1),f.hide())})}}});
define('theme_boost/loader', ["jquery","./tether","core/event"],function(a,b,c){return window.jQuery=a,window.Tether=b,require(["theme_boost/aria","theme_boost/util","theme_boost/alert","theme_boost/button","theme_boost/carousel","theme_boost/collapse","theme_boost/dropdown","theme_boost/modal","theme_boost/scrollspy","theme_boost/tab","theme_boost/tooltip","theme_boost/popover"],function(b){a("body").popover({trigger:"focus",selector:"[data-toggle=popover][data-trigger!=hover]"}),a("html").popover({container:"body",selector:"[data-toggle=popover][data-trigger=hover]",trigger:"hover",delay:{hide:500}}),c.getLegacyEvents().done(function(b){a(document).on(b.FILTER_CONTENT_UPDATED,function(){a("body").popover({selector:'[data-toggle="popover"]',trigger:"focus"})})}),b.init()}),{}});
define('theme_boost/modal', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="modal",c="4.0.0",d="bs.modal",h=".".concat(d),j=".data-api",l=a.fn[b],m=300,n=150,o=27,p={backdrop:!0,keyboard:!0,focus:!0,show:!0},q={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},r={HIDE:"hide".concat(h),HIDDEN:"hidden".concat(h),SHOW:"show".concat(h),SHOWN:"shown".concat(h),FOCUSIN:"focusin".concat(h),RESIZE:"resize".concat(h),CLICK_DISMISS:"click.dismiss".concat(h),KEYDOWN_DISMISS:"keydown.dismiss".concat(h),MOUSEUP_DISMISS:"mouseup.dismiss".concat(h),MOUSEDOWN_DISMISS:"mousedown.dismiss".concat(h),CLICK_DATA_API:"click".concat(h).concat(j)},s={SCROLLBAR_MEASURER:"modal-scrollbar-measure",BACKDROP:"modal-backdrop",OPEN:"modal-open",FADE:"fade",SHOW:"show"},t={DIALOG:".modal-dialog",DATA_TOGGLE:'[data-toggle="modal"]',DATA_DISMISS:'[data-dismiss="modal"]',FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"},u=function(){function j(b,c){g(this,j),this._config=this._getConfig(c),this._element=b,this._dialog=a(b).find(t.DIALOG)[0],this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._originalBodyPadding=0,this._scrollbarWidth=0}return i(j,[{key:"toggle",value:function(a){return this._isShown?this.hide():this.show(a)}},{key:"show",value:function(b){var c=this;if(!this._isTransitioning&&!this._isShown){k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE)&&(this._isTransitioning=!0);var d=a.Event(r.SHOW,{relatedTarget:b});a(this._element).trigger(d),this._isShown||d.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),a(document.body).addClass(s.OPEN),this._setEscapeEvent(),this._setResizeEvent(),a(this._element).on(r.CLICK_DISMISS,t.DATA_DISMISS,function(a){return c.hide(a)}),a(this._dialog).on(r.MOUSEDOWN_DISMISS,function(){a(c._element).one(r.MOUSEUP_DISMISS,function(b){a(b.target).is(c._element)&&(c._ignoreBackdropClick=!0)})}),this._showBackdrop(function(){return c._showElement(b)}))}}},{key:"hide",value:function(b){var c=this;if(b&&b.preventDefault(),!this._isTransitioning&&this._isShown){var d=a.Event(r.HIDE);if(a(this._element).trigger(d),this._isShown&&!d.isDefaultPrevented()){this._isShown=!1;var e=k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE);e&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),a(document).off(r.FOCUSIN),a(this._element).removeClass(s.SHOW),a(this._element).off(r.CLICK_DISMISS),a(this._dialog).off(r.MOUSEDOWN_DISMISS),e?a(this._element).one(k["default"].TRANSITION_END,function(a){return c._hideModal(a)}).emulateTransitionEnd(m):this._hideModal()}}}},{key:"dispose",value:function(){a.removeData(this._element,d),a(window,document,this._element,this._backdrop).off(h),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._scrollbarWidth=null}},{key:"handleUpdate",value:function(){this._adjustDialog()}},{key:"_getConfig",value:function(a){return a=f({},p,a),k["default"].typeCheckConfig(b,a,q),a}},{key:"_showElement",value:function(b){var c=this,d=k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.scrollTop=0,d&&k["default"].reflow(this._element),a(this._element).addClass(s.SHOW),this._config.focus&&this._enforceFocus();var e=a.Event(r.SHOWN,{relatedTarget:b}),f=function(){c._config.focus&&c._element.focus(),c._isTransitioning=!1,a(c._element).trigger(e)};d?a(this._dialog).one(k["default"].TRANSITION_END,f).emulateTransitionEnd(m):f()}},{key:"_enforceFocus",value:function(){var b=this;a(document).off(r.FOCUSIN).on(r.FOCUSIN,function(c){document!==c.target&&b._element!==c.target&&0===a(b._element).has(c.target).length&&b._element.focus()})}},{key:"_setEscapeEvent",value:function(){var b=this;this._isShown&&this._config.keyboard?a(this._element).on(r.KEYDOWN_DISMISS,function(a){a.which===o&&(a.preventDefault(),b.hide())}):this._isShown||a(this._element).off(r.KEYDOWN_DISMISS)}},{key:"_setResizeEvent",value:function(){var b=this;this._isShown?a(window).on(r.RESIZE,function(a){return b.handleUpdate(a)}):a(window).off(r.RESIZE)}},{key:"_hideModal",value:function(){var b=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._isTransitioning=!1,this._showBackdrop(function(){a(document.body).removeClass(s.OPEN),b._resetAdjustments(),b._resetScrollbar(),a(b._element).trigger(r.HIDDEN)})}},{key:"_removeBackdrop",value:function(){this._backdrop&&(a(this._backdrop).remove(),this._backdrop=null)}},{key:"_showBackdrop",value:function(b){var c=this,d=a(this._element).hasClass(s.FADE)?s.FADE:"";if(this._isShown&&this._config.backdrop){var e=k["default"].supportsTransitionEnd()&&d;if(this._backdrop=document.createElement("div"),this._backdrop.className=s.BACKDROP,d&&a(this._backdrop).addClass(d),a(this._backdrop).appendTo(document.body),a(this._element).on(r.CLICK_DISMISS,function(a){return c._ignoreBackdropClick?void(c._ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"===c._config.backdrop?c._element.focus():c.hide()))}),e&&k["default"].reflow(this._backdrop),a(this._backdrop).addClass(s.SHOW),!b)return;if(!e)return void b();a(this._backdrop).one(k["default"].TRANSITION_END,b).emulateTransitionEnd(n)}else if(!this._isShown&&this._backdrop){a(this._backdrop).removeClass(s.SHOW);var f=function(){c._removeBackdrop(),b&&b()};k["default"].supportsTransitionEnd()&&a(this._element).hasClass(s.FADE)?a(this._backdrop).one(k["default"].TRANSITION_END,f).emulateTransitionEnd(n):f()}else b&&b()}},{key:"_adjustDialog",value:function(){var a=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&a&&(this._element.style.paddingLeft="".concat(this._scrollbarWidth,"px")),this._isBodyOverflowing&&!a&&(this._element.style.paddingRight="".concat(this._scrollbarWidth,"px"))}},{key:"_resetAdjustments",value:function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}},{key:"_checkScrollbar",value:function(){var a=document.body.getBoundingClientRect();this._isBodyOverflowing=a.left+a.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}},{key:"_setScrollbar",value:function(){var b=this;if(this._isBodyOverflowing){a(t.FIXED_CONTENT).each(function(c,d){var e=a(d)[0].style.paddingRight,f=a(d).css("padding-right");a(d).data("padding-right",e).css("padding-right","".concat(parseFloat(f)+b._scrollbarWidth,"px"))}),a(t.STICKY_CONTENT).each(function(c,d){var e=a(d)[0].style.marginRight,f=a(d).css("margin-right");a(d).data("margin-right",e).css("margin-right","".concat(parseFloat(f)-b._scrollbarWidth,"px"))}),a(t.NAVBAR_TOGGLER).each(function(c,d){var e=a(d)[0].style.marginRight,f=a(d).css("margin-right");a(d).data("margin-right",e).css("margin-right","".concat(parseFloat(f)+b._scrollbarWidth,"px"))});var c=document.body.style.paddingRight,d=a("body").css("padding-right");a("body").data("padding-right",c).css("padding-right","".concat(parseFloat(d)+this._scrollbarWidth,"px"))}}},{key:"_resetScrollbar",value:function(){a(t.FIXED_CONTENT).each(function(b,c){var d=a(c).data("padding-right");"undefined"!=typeof d&&a(c).css("padding-right",d).removeData("padding-right")}),a("".concat(t.STICKY_CONTENT,", ").concat(t.NAVBAR_TOGGLER)).each(function(b,c){var d=a(c).data("margin-right");"undefined"!=typeof d&&a(c).css("margin-right",d).removeData("margin-right")});var b=a("body").data("padding-right");"undefined"!=typeof b&&a("body").css("padding-right",b).removeData("padding-right")}},{key:"_getScrollbarWidth",value:function(){var a=document.createElement("div");a.className=s.SCROLLBAR_MEASURER,document.body.appendChild(a);var b=a.getBoundingClientRect().width-a.clientWidth;return document.body.removeChild(a),b}}],[{key:"_jQueryInterface",value:function(b,c){return this.each(function(){var g=a(this).data(d),h=f({},j.Default,a(this).data(),"object"===e(b)&&b);if(g||(g=new j(this,h),a(this).data(d,g)),"string"==typeof b){if("undefined"==typeof g[b])throw new TypeError('No method named "'.concat(b,'"'));g[b](c)}else h.show&&g.show(c)})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return p}}]),j}();return a(document).on(r.CLICK_DATA_API,t.DATA_TOGGLE,function(b){var c,e=this,g=k["default"].getSelectorFromElement(this);g&&(c=a(g)[0]);var h=a(c).data(d)?"toggle":f({},a(c).data(),a(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||b.preventDefault();var i=a(c).one(r.SHOW,function(b){b.isDefaultPrevented()||i.one(r.HIDDEN,function(){a(e).is(":visible")&&e.focus()})});u._jQueryInterface.call(a(c),h,this)}),a.fn[b]=u._jQueryInterface,a.fn[b].Constructor=u,a.fn[b].noConflict=function(){return a.fn[b]=l,u._jQueryInterface},u}(j["default"]);a["default"]=l});
define('theme_boost/popover', ["exports","jquery","./tooltip"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),a}function i(a,b){if(b&&("object"===e(b)||"function"==typeof b))return b;if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function j(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(){return k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},k.apply(this,arguments)}Object.defineProperty(a,"__esModule",{value:!0});var l=d(b),m=d(c),n=function(a){var b="popover",c="4.0.0",d="bs.popover",g=".".concat(d),l=a.fn[b],n="bs-popover",o=new RegExp("(^|\\s)".concat(n,"\\S+"),"g"),p=k({},m["default"].Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),q=k({},m["default"].DefaultType,{content:"(string|element|function)"}),r={FADE:"fade",SHOW:"show"},s={TITLE:".popover-header",CONTENT:".popover-body"},t={HIDE:"hide".concat(g),HIDDEN:"hidden".concat(g),SHOW:"show".concat(g),SHOWN:"shown".concat(g),INSERTED:"inserted".concat(g),CLICK:"click".concat(g),FOCUSIN:"focusin".concat(g),FOCUSOUT:"focusout".concat(g),MOUSEENTER:"mouseenter".concat(g),MOUSELEAVE:"mouseleave".concat(g)},u=function(k){function l(){return f(this,l),i(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return j(l,k),h(l,[{key:"isWithContent",value:function(){return this.getTitle()||this._getContent()}},{key:"addAttachmentClass",value:function(b){a(this.getTipElement()).addClass("".concat(n,"-").concat(b))}},{key:"getTipElement",value:function(){return this.tip=this.tip||a(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var b=a(this.getTipElement());this.setElementContent(b.find(s.TITLE),this.getTitle());var c=this._getContent();"function"==typeof c&&(c=c.call(this.element)),this.setElementContent(b.find(s.CONTENT),c),b.removeClass("".concat(r.FADE," ").concat(r.SHOW))}},{key:"_getContent",value:function(){return this.element.getAttribute("data-content")||this.config.content}},{key:"_cleanTipClass",value:function(){var b=a(this.getTipElement()),c=b.attr("class").match(o);null!==c&&c.length>0&&b.removeClass(c.join(""))}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),f="object"===e(b)?b:null;if((c||!/destroy|hide/.test(b))&&(c||(c=new l(this,f),a(this).data(d,c)),"string"==typeof b)){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return p}},{key:"NAME",get:function(){return b}},{key:"DATA_KEY",get:function(){return d}},{key:"Event",get:function(){return t}},{key:"EVENT_KEY",get:function(){return g}},{key:"DefaultType",get:function(){return q}}]),l}(m["default"]);return a.fn[b]=u._jQueryInterface,a.fn[b].Constructor=u,a.fn[b].noConflict=function(){return a.fn[b]=l,u._jQueryInterface},u}(l["default"]);a["default"]=n});
define('theme_boost/scrollspy', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var j=d(b),k=d(c),l=function(a){var b="scrollspy",c="4.0.0",d="bs.scrollspy",h=".".concat(d),j=".data-api",l=a.fn[b],m={offset:10,method:"auto",target:""},n={offset:"number",method:"string",target:"(string|element)"},o={ACTIVATE:"activate".concat(h),SCROLL:"scroll".concat(h),LOAD_DATA_API:"load".concat(h).concat(j)},p={DROPDOWN_ITEM:"dropdown-item",DROPDOWN_MENU:"dropdown-menu",ACTIVE:"active"},q={DATA_SPY:'[data-spy="scroll"]',ACTIVE:".active",NAV_LIST_GROUP:".nav, .list-group",NAV_LINKS:".nav-link",NAV_ITEMS:".nav-item",LIST_ITEMS:".list-group-item",DROPDOWN:".dropdown",DROPDOWN_ITEMS:".dropdown-item",DROPDOWN_TOGGLE:".dropdown-toggle"},r={OFFSET:"offset",POSITION:"position"},s=function(){function j(b,c){var d=this;g(this,j),this._element=b,this._scrollElement="BODY"===b.tagName?window:b,this._config=this._getConfig(c),this._selector="".concat(this._config.target," ").concat(q.NAV_LINKS,",")+"".concat(this._config.target," ").concat(q.LIST_ITEMS,",")+"".concat(this._config.target," ").concat(q.DROPDOWN_ITEMS),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,a(this._scrollElement).on(o.SCROLL,function(a){return d._process(a)}),this.refresh(),this._process()}return i(j,[{key:"refresh",value:function(){var b=this,c=this._scrollElement===this._scrollElement.window?r.OFFSET:r.POSITION,d="auto"===this._config.method?c:this._config.method,e=d===r.POSITION?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight();var f=a.makeArray(a(this._selector));f.map(function(b){var c,f=k["default"].getSelectorFromElement(b);if(f&&(c=a(f)[0]),c){var g=c.getBoundingClientRect();if(g.width||g.height)return[a(c)[d]().top+e,f]}return null}).filter(function(a){return a}).sort(function(a,b){return a[0]-b[0]}).forEach(function(a){b._offsets.push(a[0]),b._targets.push(a[1])})}},{key:"dispose",value:function(){a.removeData(this._element,d),a(this._scrollElement).off(h),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}},{key:"_getConfig",value:function(c){if(c=f({},m,c),"string"!=typeof c.target){var d=a(c.target).attr("id");d||(d=k["default"].getUID(b),a(c.target).attr("id",d)),c.target="#".concat(d)}return k["default"].typeCheckConfig(b,c,n),c}},{key:"_getScrollTop",value:function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}},{key:"_getScrollHeight",value:function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}},{key:"_getOffsetHeight",value:function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}},{key:"_process",value:function(){var a=this._getScrollTop()+this._config.offset,b=this._getScrollHeight(),c=this._config.offset+b-this._getOffsetHeight();if(this._scrollHeight!==b&&this.refresh(),a>=c){var d=this._targets[this._targets.length-1];return void(this._activeTarget!==d&&this._activate(d))}if(this._activeTarget&&a<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var e=this._offsets.length;e--;){var f=this._activeTarget!==this._targets[e]&&a>=this._offsets[e]&&("undefined"==typeof this._offsets[e+1]||a<this._offsets[e+1]);f&&this._activate(this._targets[e])}}},{key:"_activate",value:function(b){this._activeTarget=b,this._clear();var c=this._selector.split(",");c=c.map(function(a){return"".concat(a,'[data-target="').concat(b,'"],')+"".concat(a,'[href="').concat(b,'"]')});var d=a(c.join(","));d.hasClass(p.DROPDOWN_ITEM)?(d.closest(q.DROPDOWN).find(q.DROPDOWN_TOGGLE).addClass(p.ACTIVE),d.addClass(p.ACTIVE)):(d.addClass(p.ACTIVE),d.parents(q.NAV_LIST_GROUP).prev("".concat(q.NAV_LINKS,", ").concat(q.LIST_ITEMS)).addClass(p.ACTIVE),d.parents(q.NAV_LIST_GROUP).prev(q.NAV_ITEMS).children(q.NAV_LINKS).addClass(p.ACTIVE)),a(this._scrollElement).trigger(o.ACTIVATE,{relatedTarget:b})}},{key:"_clear",value:function(){a(this._selector).filter(q.ACTIVE).removeClass(p.ACTIVE)}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),f="object"===e(b)&&b;if(c||(c=new j(this,f),a(this).data(d,c)),"string"==typeof b){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return m}}]),j}();return a(window).on(o.LOAD_DATA_API,function(){for(var b=a.makeArray(a(q.DATA_SPY)),c=b.length;c--;){var d=a(b[c]);s._jQueryInterface.call(d,d.data())}}),a.fn[b]=s._jQueryInterface,a.fn[b].Constructor=s,a.fn[b].noConflict=function(){return a.fn[b]=l,s._jQueryInterface},s}(j["default"]);a["default"]=l});
define('theme_boost/tab', ["exports","jquery","./util"],function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var h=d(b),i=d(c),j=function(a){var b="tab",c="4.0.0",d="bs.tab",f=".".concat(d),h=".data-api",j=a.fn[b],k=150,l={HIDE:"hide".concat(f),HIDDEN:"hidden".concat(f),SHOW:"show".concat(f),SHOWN:"shown".concat(f),CLICK_DATA_API:"click".concat(f).concat(h)},m={DROPDOWN_MENU:"dropdown-menu",ACTIVE:"active",DISABLED:"disabled",FADE:"fade",SHOW:"show"},n={DROPDOWN:".dropdown",NAV_LIST_GROUP:".nav, .list-group",ACTIVE:".active",ACTIVE_UL:"> li > .active",DATA_TOGGLE:'[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',DROPDOWN_TOGGLE:".dropdown-toggle",DROPDOWN_ACTIVE_CHILD:"> .dropdown-menu .active"},o=function(){function b(a){e(this,b),this._element=a}return g(b,[{key:"show",value:function(){var b=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&a(this._element).hasClass(m.ACTIVE)||a(this._element).hasClass(m.DISABLED))){var c,d,e=a(this._element).closest(n.NAV_LIST_GROUP)[0],f=i["default"].getSelectorFromElement(this._element);if(e){var g="UL"===e.nodeName?n.ACTIVE_UL:n.ACTIVE;d=a.makeArray(a(e).find(g)),d=d[d.length-1]}var h=a.Event(l.HIDE,{relatedTarget:this._element}),j=a.Event(l.SHOW,{relatedTarget:d});if(d&&a(d).trigger(h),a(this._element).trigger(j),!j.isDefaultPrevented()&&!h.isDefaultPrevented()){f&&(c=a(f)[0]),this._activate(this._element,e);var k=function(){var c=a.Event(l.HIDDEN,{relatedTarget:b._element}),e=a.Event(l.SHOWN,{relatedTarget:d});a(d).trigger(c),a(b._element).trigger(e)};c?this._activate(c,c.parentNode,k):k()}}}},{key:"dispose",value:function(){a.removeData(this._element,d),this._element=null}},{key:"_activate",value:function(b,c,d){var e,f=this;e="UL"===c.nodeName?a(c).find(n.ACTIVE_UL):a(c).children(n.ACTIVE);var g=e[0],h=d&&i["default"].supportsTransitionEnd()&&g&&a(g).hasClass(m.FADE),j=function(){return f._transitionComplete(b,g,d)};g&&h?a(g).one(i["default"].TRANSITION_END,j).emulateTransitionEnd(k):j()}},{key:"_transitionComplete",value:function(b,c,d){if(c){a(c).removeClass("".concat(m.SHOW," ").concat(m.ACTIVE));var e=a(c.parentNode).find(n.DROPDOWN_ACTIVE_CHILD)[0];e&&a(e).removeClass(m.ACTIVE),"tab"===c.getAttribute("role")&&c.setAttribute("aria-selected",!1)}if(a(b).addClass(m.ACTIVE),"tab"===b.getAttribute("role")&&b.setAttribute("aria-selected",!0),i["default"].reflow(b),a(b).addClass(m.SHOW),b.parentNode&&a(b.parentNode).hasClass(m.DROPDOWN_MENU)){var f=a(b).closest(n.DROPDOWN)[0];f&&a(f).find(n.DROPDOWN_TOGGLE).addClass(m.ACTIVE),b.setAttribute("aria-expanded",!0)}d&&d()}}],[{key:"_jQueryInterface",value:function(c){return this.each(function(){var e=a(this),f=e.data(d);if(f||(f=new b(this),e.data(d,f)),"string"==typeof c){if("undefined"==typeof f[c])throw new TypeError('No method named "'.concat(c,'"'));f[c]()}})}},{key:"VERSION",get:function(){return c}}]),b}();return a(document).on(l.CLICK_DATA_API,n.DATA_TOGGLE,function(b){b.preventDefault(),o._jQueryInterface.call(a(this),"show")}),a.fn[b]=o._jQueryInterface,a.fn[b].Constructor=o,a.fn[b].noConflict=function(){return a.fn[b]=j,o._jQueryInterface},o}(h["default"]);a["default"]=j});
!function(a,b){"function"==typeof define&&define.amd?define('theme_boost/tether', b):"object"==typeof exports?module.exports=b(require,exports,module):a.Tether=b()}(this,function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){var b=a.getBoundingClientRect(),c={};for(var d in b)c[d]=b[d];if(a.ownerDocument!==document){var f=a.ownerDocument.defaultView.frameElement;if(f){var g=e(f);c.top+=g.top,c.bottom+=g.top,c.left+=g.left,c.right+=g.left}}return c}function f(a){var b=getComputedStyle(a)||{},c=b.position,d=[];if("fixed"===c)return[a];for(var e=a;(e=e.parentNode)&&e&&1===e.nodeType;){var f=void 0;try{f=getComputedStyle(e)}catch(g){}if("undefined"==typeof f||null===f)return d.push(e),d;var h=f,i=h.overflow,j=h.overflowX,k=h.overflowY;/(auto|scroll)/.test(i+k+j)&&("absolute"!==c||["relative","absolute","fixed"].indexOf(f.position)>=0)&&d.push(e)}return d.push(a.ownerDocument.body),a.ownerDocument!==document&&d.push(a.ownerDocument.defaultView),d}function g(){z&&document.body.removeChild(z),z=null}function h(a){var b=void 0;a===document?(b=document,a=document.documentElement):b=a.ownerDocument;var c=b.documentElement,d=e(a),f=C();return d.top-=f.top,d.left-=f.left,"undefined"==typeof d.width&&(d.width=document.body.scrollWidth-d.left-d.right),"undefined"==typeof d.height&&(d.height=document.body.scrollHeight-d.top-d.bottom),d.top=d.top-c.clientTop,d.left=d.left-c.clientLeft,d.right=b.body.clientWidth-d.width-d.left,d.bottom=b.body.clientHeight-d.height-d.top,d}function i(a){return a.offsetParent||document.documentElement}function j(){var a=document.createElement("div");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");k(b.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;c===d&&(d=b.clientWidth),document.body.removeChild(b);var e=c-d;return{width:e,height:e}}function k(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=[];return Array.prototype.push.apply(b,arguments),b.slice(1).forEach(function(b){if(b)for(var c in b)({}).hasOwnProperty.call(b,c)&&(a[c]=b[c])}),a}function l(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.remove(b)});else{var c=new RegExp("(^| )"+b.split(" ").join("|")+"( |$)","gi"),d=o(a).replace(c," ");p(a,d)}}function m(a,b){if("undefined"!=typeof a.classList)b.split(" ").forEach(function(b){b.trim()&&a.classList.add(b)});else{l(a,b);var c=o(a)+(" "+b);p(a,c)}}function n(a,b){if("undefined"!=typeof a.classList)return a.classList.contains(b);var c=o(a);return new RegExp("(^| )"+b+"( |$)","gi").test(c)}function o(a){return a.className instanceof a.ownerDocument.defaultView.SVGAnimatedString?a.className.baseVal:a.className}function p(a,b){a.setAttribute("class",b)}function q(a,b,c){c.forEach(function(c){b.indexOf(c)===-1&&n(a,c)&&l(a,c)}),b.forEach(function(b){n(a,b)||m(a,b)})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function r(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function s(a,b){var c=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return a+c>=b&&b>=a-c}function t(){return"undefined"!=typeof performance&&"undefined"!=typeof performance.now?performance.now():+new Date}function u(){for(var a={top:0,left:0},b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return c.forEach(function(b){var c=b.top,d=b.left;"string"==typeof c&&(c=parseFloat(c,10)),"string"==typeof d&&(d=parseFloat(d,10)),a.top+=c,a.left+=d}),a}function v(a,b){return"string"==typeof a.left&&a.left.indexOf("%")!==-1&&(a.left=parseFloat(a.left,10)/100*b.width),"string"==typeof a.top&&a.top.indexOf("%")!==-1&&(a.top=parseFloat(a.top,10)/100*b.height),a}function w(a,b){return"scrollParent"===b?b=a.scrollParents[0]:"window"===b&&(b=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),b===document&&(b=b.documentElement),"undefined"!=typeof b.nodeType&&!function(){var a=b,c=h(b),d=c,e=getComputedStyle(b);if(b=[d.left,d.top,c.width+d.left,c.height+d.top],a.ownerDocument!==document){var f=a.ownerDocument.defaultView;b[0]+=f.pageXOffset,b[1]+=f.pageYOffset,b[2]+=f.pageXOffset,b[3]+=f.pageYOffset}W.forEach(function(a,c){a=a[0].toUpperCase()+a.substr(1),"Top"===a||"Left"===a?b[c]+=parseFloat(e["border"+a+"Width"]):b[c]-=parseFloat(e["border"+a+"Width"])})}(),b}var x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),y=void 0;"undefined"==typeof y&&(y={modules:[]});var z=null,A=function(){var a=0;return function(){return++a}}(),B={},C=function(){var a=z;a||(a=document.createElement("div"),a.setAttribute("data-tether-id",A()),k(a.style,{top:0,left:0,position:"absolute"}),document.body.appendChild(a),z=a);var b=a.getAttribute("data-tether-id");return"undefined"==typeof B[b]&&(B[b]=e(a),E(function(){delete B[b]})),B[b]},D=[],E=function(a){D.push(a)},F=function(){for(var a=void 0;a=D.pop();)a()},G=function(){function a(){d(this,a)}return x(a,[{key:"on",value:function(a,b,c){var d=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];"undefined"==typeof this.bindings&&(this.bindings={}),"undefined"==typeof this.bindings[a]&&(this.bindings[a]=[]),this.bindings[a].push({handler:b,ctx:c,once:d})}},{key:"once",value:function(a,b,c){this.on(a,b,c,!0)}},{key:"off",value:function(a,b){if("undefined"!=typeof this.bindings&&"undefined"!=typeof this.bindings[a])if("undefined"==typeof b)delete this.bindings[a];else for(var c=0;c<this.bindings[a].length;)this.bindings[a][c].handler===b?this.bindings[a].splice(c,1):++c}},{key:"trigger",value:function(a){if("undefined"!=typeof this.bindings&&this.bindings[a]){for(var b=0,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];for(;b<this.bindings[a].length;){var f=this.bindings[a][b],g=f.handler,h=f.ctx,i=f.once,j=h;"undefined"==typeof j&&(j=this),g.apply(j,d),i?this.bindings[a].splice(b,1):++b}}}}]),a}();y.Utils={getActualBoundingClientRect:e,getScrollParents:f,getBounds:h,getOffsetParent:i,extend:k,addClass:m,removeClass:l,hasClass:n,updateClasses:q,defer:E,flush:F,uniqueId:A,Evented:G,getScrollBarSize:j,removeUtilElements:g};var H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),I=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}};if("undefined"==typeof y)throw new Error("You must include the utils.js file before tether.js");var J=y.Utils,f=J.getScrollParents,h=J.getBounds,i=J.getOffsetParent,k=J.extend,m=J.addClass,l=J.removeClass,q=J.updateClasses,E=J.defer,F=J.flush,j=J.getScrollBarSize,g=J.removeUtilElements,K=function(){if("undefined"==typeof document)return"";for(var a=document.createElement("div"),b=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],c=0;c<b.length;++c){var d=b[c];if(void 0!==a.style[d])return d}}(),L=[],M=function(){L.forEach(function(a){a.position(!1)}),F()};!function(){var a=null,b=null,c=null,d=function e(){return"undefined"!=typeof b&&b>16?(b=Math.min(b-16,250),void(c=setTimeout(e,250))):void("undefined"!=typeof a&&t()-a<10||(null!=c&&(clearTimeout(c),c=null),a=t(),M(),b=t()-a))};"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener&&["resize","scroll","touchmove"].forEach(function(a){window.addEventListener(a,d)})}();var N={center:"center",left:"right",right:"left"},O={middle:"middle",top:"bottom",bottom:"top"},P={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},Q=function(a,b){var c=a.left,d=a.top;return"auto"===c&&(c=N[b.left]),"auto"===d&&(d=O[b.top]),{left:c,top:d}},R=function(a){var b=a.left,c=a.top;return"undefined"!=typeof P[a.left]&&(b=P[a.left]),"undefined"!=typeof P[a.top]&&(c=P[a.top]),{left:b,top:c}},S=function(a){var b=a.split(" "),c=H(b,2),d=c[0],e=c[1];return{top:d,left:e}},T=S,U=function(a){function b(a){var c=this;d(this,b),I(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.position=this.position.bind(this),L.push(this),this.history=[],this.setOptions(a,!1),y.modules.forEach(function(a){"undefined"!=typeof a.initialize&&a.initialize.call(c)}),this.position()}return r(b,a),x(b,[{key:"getClass",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=this.options.classes;return"undefined"!=typeof b&&b[a]?this.options.classes[a]:this.options.classPrefix?this.options.classPrefix+"-"+a:a}},{key:"setOptions",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]||arguments[1],d={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"};this.options=k(d,a);var e=this.options,g=e.element,h=e.target,i=e.targetModifier;if(this.element=g,this.target=h,this.targetModifier=i,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(function(a){if("undefined"==typeof b[a])throw new Error("Tether Error: Both element and target must be defined");"undefined"!=typeof b[a].jquery?b[a]=b[a][0]:"string"==typeof b[a]&&(b[a]=document.querySelector(b[a]))}),m(this.element,this.getClass("element")),this.options.addTargetClasses!==!1&&m(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=T(this.options.targetAttachment),this.attachment=T(this.options.attachment),this.offset=S(this.options.offset),this.targetOffset=S(this.options.targetOffset),"undefined"!=typeof this.scrollParents&&this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=f(this.target),this.options.enabled!==!1&&this.enable(c)}},{key:"getTargetBounds",value:function(){if("undefined"==typeof this.targetModifier)return h(this.target);if("visible"===this.targetModifier){if(this.target===document.body)return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};var a=h(this.target),b={height:a.height,width:a.width,top:a.top,left:a.left};return b.height=Math.min(b.height,a.height-(pageYOffset-a.top)),b.height=Math.min(b.height,a.height-(a.top+a.height-(pageYOffset+innerHeight))),b.height=Math.min(innerHeight,b.height),b.height-=2,b.width=Math.min(b.width,a.width-(pageXOffset-a.left)),b.width=Math.min(b.width,a.width-(a.left+a.width-(pageXOffset+innerWidth))),b.width=Math.min(innerWidth,b.width),b.width-=2,b.top<pageYOffset&&(b.top=pageYOffset),b.left<pageXOffset&&(b.left=pageXOffset),b}if("scroll-handle"===this.targetModifier){var a=void 0,c=this.target;c===document.body?(c=document.documentElement,a={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):a=h(c);var d=getComputedStyle(c),e=c.scrollWidth>c.clientWidth||[d.overflow,d.overflowX].indexOf("scroll")>=0||this.target!==document.body,f=0;e&&(f=15);var g=a.height-parseFloat(d.borderTopWidth)-parseFloat(d.borderBottomWidth)-f,b={width:15,height:.975*g*(g/c.scrollHeight),left:a.left+a.width-parseFloat(d.borderLeftWidth)-15},i=0;g<408&&this.target===document.body&&(i=-11e-5*Math.pow(g,2)-.00727*g+22.58),this.target!==document.body&&(b.height=Math.max(b.height,24));var j=this.target.scrollTop/(c.scrollHeight-g);return b.top=j*(g-b.height-i)+a.top+parseFloat(d.borderTopWidth),this.target===document.body&&(b.height=Math.max(b.height,24)),b}}},{key:"clearCache",value:function(){this._cache={}}},{key:"cache",value:function(a,b){return"undefined"==typeof this._cache&&(this._cache={}),"undefined"==typeof this._cache[a]&&(this._cache[a]=b.call(this)),this._cache[a]}},{key:"enable",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]||arguments[0];this.options.addTargetClasses!==!1&&m(this.target,this.getClass("enabled")),m(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParents.forEach(function(b){b!==a.target.ownerDocument&&b.addEventListener("scroll",a.position)}),b&&this.position()}},{key:"disable",value:function(){var a=this;l(this.target,this.getClass("enabled")),l(this.element,this.getClass("enabled")),this.enabled=!1,"undefined"!=typeof this.scrollParents&&this.scrollParents.forEach(function(b){b.removeEventListener("scroll",a.position)})}},{key:"destroy",value:function(){var a=this;this.disable(),L.forEach(function(b,c){b===a&&L.splice(c,1)}),0===L.length&&g()}},{key:"updateAttachClasses",value:function(a,b){var c=this;a=a||this.attachment,b=b||this.targetAttachment;var d=["left","top","bottom","right","middle","center"];"undefined"!=typeof this._addAttachClasses&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),"undefined"==typeof this._addAttachClasses&&(this._addAttachClasses=[]);var e=this._addAttachClasses;a.top&&e.push(this.getClass("element-attached")+"-"+a.top),a.left&&e.push(this.getClass("element-attached")+"-"+a.left),b.top&&e.push(this.getClass("target-attached")+"-"+b.top),b.left&&e.push(this.getClass("target-attached")+"-"+b.left);var f=[];d.forEach(function(a){f.push(c.getClass("element-attached")+"-"+a),f.push(c.getClass("target-attached")+"-"+a)}),E(function(){"undefined"!=typeof c._addAttachClasses&&(q(c.element,c._addAttachClasses,f),c.options.addTargetClasses!==!1&&q(c.target,c._addAttachClasses,f),delete c._addAttachClasses)})}},{key:"position",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]||arguments[0];if(this.enabled){this.clearCache();var c=Q(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,c);var d=this.cache("element-bounds",function(){return h(a.element)}),e=d.width,f=d.height;if(0===e&&0===f&&"undefined"!=typeof this.lastSize){var g=this.lastSize;e=g.width,f=g.height}else this.lastSize={width:e,height:f};var k=this.cache("target-bounds",function(){return a.getTargetBounds()}),l=k,m=v(R(this.attachment),{width:e,height:f}),n=v(R(c),l),o=v(this.offset,{width:e,height:f}),p=v(this.targetOffset,l);m=u(m,o),n=u(n,p);for(var q=k.left+n.left-m.left,r=k.top+n.top-m.top,s=0;s<y.modules.length;++s){var t=y.modules[s],w=t.position.call(this,{left:q,top:r,targetAttachment:c,targetPos:k,elementPos:d,offset:m,targetOffset:n,manualOffset:o,manualTargetOffset:p,scrollbarSize:B,attachment:this.attachment});if(w===!1)return!1;"undefined"!=typeof w&&"object"==typeof w&&(r=w.top,q=w.left)}var x={page:{top:r,left:q},viewport:{top:r-pageYOffset,bottom:pageYOffset-r-f+innerHeight,left:q-pageXOffset,right:pageXOffset-q-e+innerWidth}},z=this.target.ownerDocument,A=z.defaultView,B=void 0;return z.body.scrollWidth>A.innerWidth&&(B=this.cache("scrollbar-size",j),x.viewport.bottom-=B.height),z.body.scrollHeight>A.innerHeight&&(B=this.cache("scrollbar-size",j),x.viewport.right-=B.width),["","static"].indexOf(z.body.style.position)!==-1&&["","static"].indexOf(z.body.parentElement.style.position)!==-1||(x.page.bottom=z.body.scrollHeight-r-f,x.page.right=z.body.scrollWidth-q-e),"undefined"!=typeof this.options.optimizations&&this.options.optimizations.moveElement!==!1&&"undefined"==typeof this.targetModifier&&!function(){var b=a.cache("target-offsetparent",function(){return i(a.target)}),c=a.cache("target-offsetparent-bounds",function(){return h(b)}),d=getComputedStyle(b),e=c,f={};if(["Top","Left","Bottom","Right"].forEach(function(a){f[a.toLowerCase()]=parseFloat(d["border"+a+"Width"])}),c.right=z.body.scrollWidth-c.left-e.width+f.right,c.bottom=z.body.scrollHeight-c.top-e.height+f.bottom,x.page.top>=c.top+f.top&&x.page.bottom>=c.bottom&&x.page.left>=c.left+f.left&&x.page.right>=c.right){var g=b.scrollTop,j=b.scrollLeft;x.offset={top:x.page.top-c.top+g-f.top,left:x.page.left-c.left+j-f.left}}}(),this.move(x),this.history.unshift(x),this.history.length>3&&this.history.pop(),b&&F(),!0}}},{key:"move",value:function(a){var b=this;if("undefined"!=typeof this.element.parentNode){var c={};for(var d in a){c[d]={};for(var e in a[d]){for(var f=!1,g=0;g<this.history.length;++g){var h=this.history[g];if("undefined"!=typeof h[d]&&!s(h[d][e],a[d][e])){f=!0;break}}f||(c[d][e]=!0)}}var j={top:"",left:"",right:"",bottom:""},l=function(a,c){var d="undefined"!=typeof b.options.optimizations,e=d?b.options.optimizations.gpu:null;if(e!==!1){var f=void 0,g=void 0;a.top?(j.top=0,f=c.top):(j.bottom=0,f=-c.bottom),a.left?(j.left=0,g=c.left):(j.right=0,g=-c.right),j[K]="translateX("+Math.round(g)+"px) translateY("+Math.round(f)+"px)","msTransform"!==K&&(j[K]+=" translateZ(0)")}else a.top?j.top=c.top+"px":j.bottom=c.bottom+"px",a.left?j.left=c.left+"px":j.right=c.right+"px"},m=!1;if((c.page.top||c.page.bottom)&&(c.page.left||c.page.right)?(j.position="absolute",l(c.page,a.page)):(c.viewport.top||c.viewport.bottom)&&(c.viewport.left||c.viewport.right)?(j.position="fixed",l(c.viewport,a.viewport)):"undefined"!=typeof c.offset&&c.offset.top&&c.offset.left?!function(){j.position="absolute";var d=b.cache("target-offsetparent",function(){return i(b.target)});i(b.element)!==d&&E(function(){b.element.parentNode.removeChild(b.element),d.appendChild(b.element)}),l(c.offset,a.offset),m=!0}():(j.position="absolute",l({top:!0,left:!0},a.page)),!m){for(var n=!0,o=this.element.parentNode;o&&1===o.nodeType&&"BODY"!==o.tagName;){if("static"!==getComputedStyle(o).position){n=!1;break}o=o.parentNode}n||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}var p={},q=!1;for(var e in j){var r=j[e],t=this.element.style[e];t!==r&&(q=!0,p[e]=r)}q&&E(function(){k(b.element.style,p)})}}}]),b}(G);U.modules=[],y.position=M;var V=k(U,y),H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),J=y.Utils,h=J.getBounds,k=J.extend,q=J.updateClasses,E=J.defer,W=["left","top","right","bottom"];y.modules.push({position:function(a){var b=this,c=a.top,d=a.left,e=a.targetAttachment;if(!this.options.constraints)return!0;var f=this.cache("element-bounds",function(){return h(b.element)}),g=f.height,i=f.width;if(0===i&&0===g&&"undefined"!=typeof this.lastSize){var j=this.lastSize;i=j.width,g=j.height}var l=this.cache("target-bounds",function(){return b.getTargetBounds()}),m=l.height,n=l.width,o=[this.getClass("pinned"),this.getClass("out-of-bounds")];this.options.constraints.forEach(function(a){var b=a.outOfBoundsClass,c=a.pinnedClass;b&&o.push(b),c&&o.push(c)}),o.forEach(function(a){["left","top","right","bottom"].forEach(function(b){o.push(a+"-"+b)})});var p=[],r=k({},e),s=k({},this.attachment);return this.options.constraints.forEach(function(a){var f=a.to,h=a.attachment,j=a.pin;"undefined"==typeof h&&(h="");var k=void 0,l=void 0;if(h.indexOf(" ")>=0){var o=h.split(" "),q=H(o,2);l=q[0],k=q[1]}else k=l=h;var t=w(b,f);"target"!==l&&"both"!==l||(c<t[1]&&"top"===r.top&&(c+=m,r.top="bottom"),c+g>t[3]&&"bottom"===r.top&&(c-=m,r.top="top")),"together"===l&&("top"===r.top&&("bottom"===s.top&&c<t[1]?(c+=m,r.top="bottom",c+=g,s.top="top"):"top"===s.top&&c+g>t[3]&&c-(g-m)>=t[1]&&(c-=g-m,r.top="bottom",s.top="bottom")),"bottom"===r.top&&("top"===s.top&&c+g>t[3]?(c-=m,r.top="top",c-=g,s.top="bottom"):"bottom"===s.top&&c<t[1]&&c+(2*g-m)<=t[3]&&(c+=g-m,r.top="top",s.top="top")),"middle"===r.top&&(c+g>t[3]&&"top"===s.top?(c-=g,s.top="bottom"):c<t[1]&&"bottom"===s.top&&(c+=g,s.top="top"))),"target"!==k&&"both"!==k||(d<t[0]&&"left"===r.left&&(d+=n,r.left="right"),d+i>t[2]&&"right"===r.left&&(d-=n,r.left="left")),"together"===k&&(d<t[0]&&"left"===r.left?"right"===s.left?(d+=n,r.left="right",d+=i,s.left="left"):"left"===s.left&&(d+=n,r.left="right",d-=i,s.left="right"):d+i>t[2]&&"right"===r.left?"left"===s.left?(d-=n,r.left="left",d-=i,s.left="right"):"right"===s.left&&(d-=n,r.left="left",d+=i,s.left="left"):"center"===r.left&&(d+i>t[2]&&"left"===s.left?(d-=i,s.left="right"):d<t[0]&&"right"===s.left&&(d+=i,s.left="left"))),"element"!==l&&"both"!==l||(c<t[1]&&"bottom"===s.top&&(c+=g,s.top="top"),c+g>t[3]&&"top"===s.top&&(c-=g,s.top="bottom")),"element"!==k&&"both"!==k||(d<t[0]&&("right"===s.left?(d+=i,s.left="left"):"center"===s.left&&(d+=i/2,s.left="left")),d+i>t[2]&&("left"===s.left?(d-=i,s.left="right"):"center"===s.left&&(d-=i/2,s.left="right"))),"string"==typeof j?j=j.split(",").map(function(a){return a.trim()}):j===!0&&(j=["top","left","right","bottom"]),j=j||[];var u=[],v=[];c<t[1]&&(j.indexOf("top")>=0?(c=t[1],u.push("top")):v.push("top")),c+g>t[3]&&(j.indexOf("bottom")>=0?(c=t[3]-g,u.push("bottom")):v.push("bottom")),d<t[0]&&(j.indexOf("left")>=0?(d=t[0],u.push("left")):v.push("left")),d+i>t[2]&&(j.indexOf("right")>=0?(d=t[2]-i,u.push("right")):v.push("right")),u.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.pinnedClass?b.options.pinnedClass:b.getClass("pinned"),p.push(a),u.forEach(function(b){p.push(a+"-"+b)})}(),v.length&&!function(){var a=void 0;a="undefined"!=typeof b.options.outOfBoundsClass?b.options.outOfBoundsClass:b.getClass("out-of-bounds"),p.push(a),v.forEach(function(b){p.push(a+"-"+b)})}(),(u.indexOf("left")>=0||u.indexOf("right")>=0)&&(s.left=r.left=!1),(u.indexOf("top")>=0||u.indexOf("bottom")>=0)&&(s.top=r.top=!1),r.top===e.top&&r.left===e.left&&s.top===b.attachment.top&&s.left===b.attachment.left||(b.updateAttachClasses(s,r),b.trigger("update",{attachment:s,targetAttachment:r}))}),E(function(){b.options.addTargetClasses!==!1&&q(b.target,p,o),q(b.element,p,o)}),{top:c,left:d}}});var J=y.Utils,h=J.getBounds,q=J.updateClasses,E=J.defer;y.modules.push({position:function(a){var b=this,c=a.top,d=a.left,e=this.cache("element-bounds",function(){return h(b.element)}),f=e.height,g=e.width,i=this.getTargetBounds(),j=c+f,k=d+g,l=[];c<=i.bottom&&j>=i.top&&["left","right"].forEach(function(a){var b=i[a];b!==d&&b!==k||l.push(a)}),d<=i.right&&k>=i.left&&["top","bottom"].forEach(function(a){var b=i[a];b!==c&&b!==j||l.push(a)});var m=[],n=[],o=["left","top","right","bottom"];return m.push(this.getClass("abutted")),o.forEach(function(a){m.push(b.getClass("abutted")+"-"+a)}),l.length&&n.push(this.getClass("abutted")),l.forEach(function(a){n.push(b.getClass("abutted")+"-"+a)}),E(function(){b.options.addTargetClasses!==!1&&q(b.target,n,m),q(b.element,n,m)}),!0}});var H=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return y.modules.push({position:function(a){var b=a.top,c=a.left;if(this.options.shift){var d=this.options.shift;"function"==typeof this.options.shift&&(d=this.options.shift.call(this,{top:b,left:c}));var e=void 0,f=void 0;if("string"==typeof d){d=d.split(" "),d[1]=d[1]||d[0];var g=d,h=H(g,2);e=h[0],f=h[1],e=parseFloat(e,10),f=parseFloat(f,10)}else e=d.top,f=d.left;return b+=e,c+=f,{top:b,left:c}}}}),V});
define('theme_boost/tooltip', ["exports","jquery","core/popper","./util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(){return f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},f.apply(this,arguments)}function g(a){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function j(a,b,c){return b&&i(a.prototype,b),c&&i(a,c),a}Object.defineProperty(a,"__esModule",{value:!0});var k=e(b),l=e(c),m=e(d),n=function(a){var b="tooltip",c="4.0.0",d="bs.tooltip",e=".".concat(d),i=a.fn[b],k=150,n="bs-tooltip",o=new RegExp("(^|\\s)".concat(n,"\\S+"),"g"),p={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)"},q={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},r={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent"},s={SHOW:"show",OUT:"out"},t={HIDE:"hide".concat(e),HIDDEN:"hidden".concat(e),SHOW:"show".concat(e),SHOWN:"shown".concat(e),INSERTED:"inserted".concat(e),CLICK:"click".concat(e),FOCUSIN:"focusin".concat(e),FOCUSOUT:"focusout".concat(e),MOUSEENTER:"mouseenter".concat(e),MOUSELEAVE:"mouseleave".concat(e)},u={FADE:"fade",SHOW:"show"},v={TOOLTIP:".tooltip",TOOLTIP_INNER:".tooltip-inner",ARROW:".arrow"},w={HOVER:"hover",FOCUS:"focus",CLICK:"click",MANUAL:"manual"},x=function(){function i(a,b){if(h(this,i),"undefined"==typeof l["default"])throw new TypeError("Bootstrap tooltips require Popper.js (https://popper.js.org)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=a,this.config=this._getConfig(b),this.tip=null,this._setListeners()}return j(i,[{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"toggleEnabled",value:function(){this._isEnabled=!this._isEnabled}},{key:"toggle",value:function(b){if(this._isEnabled)if(b){var c=this.constructor.DATA_KEY,d=a(b.currentTarget).data(c);d||(d=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(c,d)),d._activeTrigger.click=!d._activeTrigger.click,d._isWithActiveTrigger()?d._enter(null,d):d._leave(null,d)}else{if(a(this.getTipElement()).hasClass(u.SHOW))return void this._leave(null,this);this._enter(null,this)}}},{key:"dispose",value:function(){clearTimeout(this._timeout),a.removeData(this.element,this.constructor.DATA_KEY),a(this.element).off(this.constructor.EVENT_KEY),a(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&a(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,null!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null}},{key:"show",value:function(){var b=this;if("none"===a(this.element).css("display"))throw new Error("Please use show on visible elements");var c=a.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){a(this.element).trigger(c);var d=a.contains(this.element.ownerDocument.documentElement,this.element);if(c.isDefaultPrevented()||!d)return;var e=this.getTipElement(),f=m["default"].getUID(this.constructor.NAME);e.setAttribute("id",f),this.element.setAttribute("aria-describedby",f),this.setContent(),this.config.animation&&a(e).addClass(u.FADE);var g="function"==typeof this.config.placement?this.config.placement.call(this,e,this.element):this.config.placement,h=this._getAttachment(g);this.addAttachmentClass(h);var j=this.config.container===!1?document.body:a(this.config.container);a(e).data(this.constructor.DATA_KEY,this),a.contains(this.element.ownerDocument.documentElement,this.tip)||a(e).appendTo(j),a(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new l["default"](this.element,e,{placement:h,modifiers:{offset:{offset:this.config.offset},flip:{behavior:this.config.fallbackPlacement},arrow:{element:v.ARROW},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(a){a.originalPlacement!==a.placement&&b._handlePopperPlacementChange(a)},onUpdate:function(a){b._handlePopperPlacementChange(a)}}),a(e).addClass(u.SHOW),"ontouchstart"in document.documentElement&&a("body").children().on("mouseover",null,a.noop);var k=function(){b.config.animation&&b._fixTransition();var c=b._hoverState;b._hoverState=null,a(b.element).trigger(b.constructor.Event.SHOWN),c===s.OUT&&b._leave(null,b)};m["default"].supportsTransitionEnd()&&a(this.tip).hasClass(u.FADE)?a(this.tip).one(m["default"].TRANSITION_END,k).emulateTransitionEnd(i._TRANSITION_DURATION):k()}}},{key:"hide",value:function(b){var c=this,d=this.getTipElement(),e=a.Event(this.constructor.Event.HIDE),f=function(){c._hoverState!==s.SHOW&&d.parentNode&&d.parentNode.removeChild(d),c._cleanTipClass(),c.element.removeAttribute("aria-describedby"),a(c.element).trigger(c.constructor.Event.HIDDEN),null!==c._popper&&c._popper.destroy(),b&&b()};a(this.element).trigger(e),e.isDefaultPrevented()||(a(d).removeClass(u.SHOW),"ontouchstart"in document.documentElement&&a("body").children().off("mouseover",null,a.noop),this._activeTrigger[w.CLICK]=!1,this._activeTrigger[w.FOCUS]=!1,this._activeTrigger[w.HOVER]=!1,m["default"].supportsTransitionEnd()&&a(this.tip).hasClass(u.FADE)?a(d).one(m["default"].TRANSITION_END,f).emulateTransitionEnd(k):f(),this._hoverState="")}},{key:"update",value:function(){null!==this._popper&&this._popper.scheduleUpdate()}},{key:"isWithContent",value:function(){return Boolean(this.getTitle())}},{key:"addAttachmentClass",value:function(b){a(this.getTipElement()).addClass("".concat(n,"-").concat(b))}},{key:"getTipElement",value:function(){return this.tip=this.tip||a(this.config.template)[0],this.tip}},{key:"setContent",value:function(){var b=a(this.getTipElement());this.setElementContent(b.find(v.TOOLTIP_INNER),this.getTitle()),b.removeClass("".concat(u.FADE," ").concat(u.SHOW))}},{key:"setElementContent",value:function(b,c){var d=this.config.html;"object"===g(c)&&(c.nodeType||c.jquery)?d?a(c).parent().is(b)||b.empty().append(c):b.text(a(c).text()):b[d?"html":"text"](c)}},{key:"getTitle",value:function(){var a=this.element.getAttribute("data-original-title");return a||(a="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),a}},{key:"_getAttachment",value:function(a){return q[a.toUpperCase()]}},{key:"_setListeners",value:function(){var b=this,c=this.config.trigger.split(" ");c.forEach(function(c){if("click"===c)a(b.element).on(b.constructor.Event.CLICK,b.config.selector,function(a){return b.toggle(a)});else if(c!==w.MANUAL){var d=c===w.HOVER?b.constructor.Event.MOUSEENTER:b.constructor.Event.FOCUSIN,e=c===w.HOVER?b.constructor.Event.MOUSELEAVE:b.constructor.Event.FOCUSOUT;a(b.element).on(d,b.config.selector,function(a){return b._enter(a)}).on(e,b.config.selector,function(a){return b._leave(a)})}a(b.element).closest(".modal").on("hide.bs.modal",function(){return b.hide()})}),this.config.selector?this.config=f({},this.config,{trigger:"manual",selector:""}):this._fixTitle()}},{key:"_fixTitle",value:function(){var a=g(this.element.getAttribute("data-original-title"));(this.element.getAttribute("title")||"string"!==a)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))}},{key:"_enter",value:function(b,c){var d=this.constructor.DATA_KEY;return c=c||a(b.currentTarget).data(d),c||(c=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(d,c)),b&&(c._activeTrigger["focusin"===b.type?w.FOCUS:w.HOVER]=!0),a(c.getTipElement()).hasClass(u.SHOW)||c._hoverState===s.SHOW?void(c._hoverState=s.SHOW):(clearTimeout(c._timeout),c._hoverState=s.SHOW,c.config.delay&&c.config.delay.show?void(c._timeout=setTimeout(function(){c._hoverState===s.SHOW&&c.show()},c.config.delay.show)):void c.show())}},{key:"_leave",value:function(b,c){var d=this.constructor.DATA_KEY;if(c=c||a(b.currentTarget).data(d),c||(c=new this.constructor(b.currentTarget,this._getDelegateConfig()),a(b.currentTarget).data(d,c)),b&&(c._activeTrigger["focusout"===b.type?w.FOCUS:w.HOVER]=!1),!c._isWithActiveTrigger())return clearTimeout(c._timeout),c._hoverState=s.OUT,c.config.delay&&c.config.delay.hide?void(c._timeout=setTimeout(function(){c._hoverState===s.OUT&&c.hide()},c.config.delay.hide)):void c.hide()}},{key:"_isWithActiveTrigger",value:function(){for(var a in this._activeTrigger)if(this._activeTrigger[a])return!0;return!1}},{key:"_getConfig",value:function(c){return c=f({},this.constructor.Default,a(this.element).data(),c),"number"==typeof c.delay&&(c.delay={show:c.delay,hide:c.delay}),"number"==typeof c.title&&(c.title=c.title.toString()),"number"==typeof c.content&&(c.content=c.content.toString()),m["default"].typeCheckConfig(b,c,this.constructor.DefaultType),c}},{key:"_getDelegateConfig",value:function(){var a={};if(this.config)for(var b in this.config)this.constructor.Default[b]!==this.config[b]&&(a[b]=this.config[b]);return a}},{key:"_cleanTipClass",value:function(){var b=a(this.getTipElement()),c=b.attr("class").match(o);null!==c&&c.length>0&&b.removeClass(c.join(""))}},{key:"_handlePopperPlacementChange",value:function(a){this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(a.placement))}},{key:"_fixTransition",value:function(){var b=this.getTipElement(),c=this.config.animation;null===b.getAttribute("x-placement")&&(a(b).removeClass(u.FADE),this.config.animation=!1,this.hide(),this.show(),this.config.animation=c)}}],[{key:"_jQueryInterface",value:function(b){return this.each(function(){var c=a(this).data(d),e="object"===g(b)&&b;if((c||!/dispose|hide/.test(b))&&(c||(c=new i(this,e),a(this).data(d,c)),"string"==typeof b)){if("undefined"==typeof c[b])throw new TypeError('No method named "'.concat(b,'"'));c[b]()}})}},{key:"VERSION",get:function(){return c}},{key:"Default",get:function(){return r}},{key:"NAME",get:function(){return b}},{key:"DATA_KEY",get:function(){return d}},{key:"Event",get:function(){return t}},{key:"EVENT_KEY",get:function(){return e}},{key:"DefaultType",get:function(){return p}}]),i}();return a.fn[b]=x._jQueryInterface,a.fn[b].Constructor=x,a.fn[b].noConflict=function(){return a.fn[b]=i,x._jQueryInterface},x}(k["default"],l["default"]);a["default"]=n});
define('theme_boost/util', ["exports","jquery"],function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0});var d=c(b),e=function(a){function b(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function c(){return{bindType:h.end,delegateType:h.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}}}function d(){return("undefined"==typeof window||!window.QUnit)&&{end:"transitionend"}}function e(b){var c=this,d=!1;return a(this).one(j.TRANSITION_END,function(){d=!0}),setTimeout(function(){d||j.triggerTransitionEnd(c)},b),this}function f(){h=d(),a.fn.emulateTransitionEnd=e,j.supportsTransitionEnd()&&(a.event.special[j.TRANSITION_END]=c())}function g(b){return b="function"==typeof a.escapeSelector?a.escapeSelector(b).substr(1):b.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")}var h=!1,i=1e6,j={TRANSITION_END:"bsTransitionEnd",getUID:function(a){do a+=~~(Math.random()*i);while(document.getElementById(a));return a},getSelectorFromElement:function(b){var c=b.getAttribute("data-target");c&&"#"!==c||(c=b.getAttribute("href")||""),"#"===c.charAt(0)&&(c=g(c));try{var d=a(document).find(c);return d.length>0?c:null}catch(e){return null}},reflow:function(a){return a.offsetHeight},triggerTransitionEnd:function(b){a(b).trigger(h.end)},supportsTransitionEnd:function(){return Boolean(h)},isElement:function(a){return(a[0]||a).nodeType},typeCheckConfig:function(a,c,d){for(var e in d)if(Object.prototype.hasOwnProperty.call(d,e)){var f=d[e],g=c[e],h=g&&j.isElement(g)?"element":b(g);if(!new RegExp(f).test(h))throw new Error("".concat(a.toUpperCase(),": ")+'Option "'.concat(e,'" provided type "').concat(h,'" ')+'but expected type "'.concat(f,'".'))}}};return f(),j}(d["default"]);a["default"]=e});
define('theme_boost/aria', ["jquery"],function(a){return{init:function(){var b=!1,c=function(){b=!0},d=function(){var a=b;return b=!1,a};a('[data-toggle="dropdown"]').keydown(function(b){var d,e=b.which||b.keyCode;38==e&&c(),27==e&&(d=a(b.target).attr("aria-expanded"),b.preventDefault(),"false"==d&&a(b.target).click()),32!=e&&13!=e||(b.preventDefault(),a(b.target).click())});var e=function(b){var c=function(){a(this).focus()}.bind(b);setTimeout(c,50)};a(".dropdown").on("shown.bs.dropdown",function(b){var c=a(b.target).find('[role="menu"]'),f=!1,g=!1;c&&(f=a(c).find('[role="menuitem"]')),f&&f.length>0&&(g=d()?f[f.length-1]:f[0]),g&&e(g)}),a('.dropdown [role="menu"] [role="menuitem"]').keypress(function(b){var c,d=String.fromCharCode(b.which||b.keyCode),f=a(b.target).closest('[role="menu"]'),g=0,h=!1;if(f&&(h=a(f).find('[role="menuitem"]')))for(d=d.toLowerCase(),g=0;g<h.length;g++)if(c=a(h[g]),0==c.text().trim().indexOf(d)||0==c.text().trim().indexOf(d.toUpperCase())){e(c);break}}),a('.dropdown [role="menu"] [role="menuitem"]').keydown(function(b){var c=b.which||b.keyCode,d=!1,f=a(b.target).closest('[role="menu"]'),g=0,h=!1;if(f&&(h=a(f).find('[role="menuitem"]'))){if(40==c){for(g=0;g<h.length-1;g++)h[g]==b.target&&(d=h[g+1]);d||(c=36)}if(38==c){for(g=1;g<h.length;g++)h[g]==b.target&&(d=h[g-1]);d||(c=35)}36==c&&(d=h[0]),35==c&&(d=h[h.length-1]),d&&(b.preventDefault(),e(d))}}),a(".dropdown").on("hidden.bs.dropdown",function(b){var c=a(b.target).find('[data-toggle="dropdown"]');c&&e(c)})}}});
define('theme_bootstrapbase/bootstrap', ["jquery"],function(a){function b(b){a(".dropdown-backdrop").remove(),a(k).each(function(){var d=c(a(this));void 0!=b&&0!=d.find(b).length||d.removeClass("open")})}function c(b){var c,d=b.attr("data-target");return d||(d=b.attr("href"),d=d&&/#/.test(d)&&d.replace(/.*(?=#[^\s]*$)/,"")),c=d&&a(d),c&&c.length||(c=b.parent()),c}function d(b,c){var d,e=a.proxy(this.process,this),f=a(a(b).is("body")?window:b);this.options=a.extend({},a.fn.scrollspy.defaults,c),this.$scrollElement=f.on("scroll.scroll-spy.data-api",e),this.selector=(this.options.target||(d=a(b).attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=a("body"),this.refresh(),this.process()}a(".h1").hide(),a(function(){a.support.transition=function(){var a=function(){var a,b=document.createElement("bootstrap"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(a in c)if(void 0!==b.style[a])return c[a]}();return a&&{end:a}}()});var e='[data-dismiss="alert"]',f=function(b){a(b).on("click",e,this.close)};f.prototype.close=function(b){function c(){d.trigger("closed").remove()}var d,e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,"")),d=a(f),b&&b.preventDefault(),d.length||(d=e.hasClass("alert")?e:e.parent()),d.trigger(b=a.Event("close")),b.isDefaultPrevented()||(d.removeClass("in"),a.support.transition&&d.hasClass("fade")?d.on(a.support.transition.end,c):c())};var g=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var c=a(this),d=c.data("alert");d||c.data("alert",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.alert.Constructor=f,a.fn.alert.noConflict=function(){return a.fn.alert=g,this},a(document).on("click.alert.data-api",e,f.prototype.close);var h=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.button.defaults,c)};h.prototype.setState=function(a){var b="disabled",c=this.$element,d=c.data(),e=c.is("input")?"val":"html";a+="Text",d.resetText||c.data("resetText",c[e]()),c[e](d[a]||this.options[a]),setTimeout(function(){"loadingText"==a?c.addClass(b).attr(b,b):c.removeClass(b).removeAttr(b)},0)},h.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');a&&a.find(".active").removeClass("active"),this.$element.toggleClass("active")};var g=a.fn.button;a.fn.button=function(b){return this.each(function(){var c=a(this),d=c.data("button"),e="object"==typeof b&&b;d||c.data("button",d=new h(this,e)),"toggle"==b?d.toggle():b&&d.setState(b)})},a.fn.button.defaults={loadingText:"loading..."},a.fn.button.Constructor=h,a.fn.button.noConflict=function(){return a.fn.button=g,this},a(document).on("click.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle")});var i=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};i.prototype={cycle:function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(b){var c=this.getActiveIndex(),d=this;if(!(b>this.$items.length-1||b<0))return this.sliding?this.$element.one("slid",function(){d.to(b)}):c==b?this.pause().cycle():this.slide(b>c?"next":"prev",a(this.$items[b]))},pause:function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){if(!this.sliding)return this.slide("next")},prev:function(){if(!this.sliding)return this.slide("prev")},slide:function(b,c){var d,e=this.$element.find(".item.active"),f=c||e[b](),g=this.interval,h="next"==b?"left":"right",i="next"==b?"first":"last",j=this;if(this.sliding=!0,g&&this.pause(),f=f.length?f:this.$element.find(".item")[i](),d=a.Event("slide",{relatedTarget:f[0],direction:h}),!f.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(j.$indicators.children()[j.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(d),d.isDefaultPrevented())return;f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),this.$element.one(a.support.transition.end,function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),j.sliding=!1,setTimeout(function(){j.$element.trigger("slid")},0)})}else{if(this.$element.trigger(d),d.isDefaultPrevented())return;e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return g&&this.cycle(),this}}};var g=a.fn.carousel;a.fn.carousel=function(b){return this.each(function(){var c=a(this),d=c.data("carousel"),e=a.extend({},a.fn.carousel.defaults,"object"==typeof b&&b),f="string"==typeof b?b:e.slide;d||c.data("carousel",d=new i(this,e)),"number"==typeof b?d.to(b):f?d[f]():e.interval&&d.pause().cycle()})},a.fn.carousel.defaults={interval:5e3,pause:"hover"},a.fn.carousel.Constructor=i,a.fn.carousel.noConflict=function(){return a.fn.carousel=g,this},a(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d,e=a(this),f=a(e.attr("data-target")||(c=e.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),g=a.extend({},f.data(),e.data());f.carousel(g),(d=e.attr("data-slide-to"))&&f.data("carousel").pause().to(d).cycle(),b.preventDefault()});var j=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.collapse.defaults,c),this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};j.prototype={constructor:j,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){var b,c,d,e;if(!this.transitioning&&!this.$element.hasClass("in")){if(b=this.dimension(),c=a.camelCase(["scroll",b].join("-")),d=this.$parent&&this.$parent.find("> .accordion-group > .in"),d&&d.length){if(e=d.data("collapse"),e&&e.transitioning)return;d.collapse("hide"),e||d.data("collapse",null)}this.$element[b](0),this.transition("addClass",a.Event("show"),"shown"),a.support.transition&&this.$element[b](this.$element[0][c])}},hide:function(){var b;!this.transitioning&&this.$element.hasClass("in")&&(b=this.dimension(),this.reset(this.$element[b]()),this.transition("removeClass",a.Event("hide"),"hidden"),this.$element[b](0))},reset:function(a){var b=this.dimension();return this.$element.removeClass("collapse")[b](a||"auto")[0].offsetWidth,this.$element[null!==a?"addClass":"removeClass"]("collapse"),this},transition:function(b,c,d){var e=this,f=function(){"show"==c.type&&e.reset(),e.transitioning=0,e.$element.trigger(d)};this.$element.trigger(c),c.isDefaultPrevented()||(this.transitioning=1,this.$element[b]("in"),a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,f):f())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var g=a.fn.collapse;a.fn.collapse=function(b){return this.each(function(){var c=a(this),d=c.data("collapse"),e=a.extend({},a.fn.collapse.defaults,c.data(),"object"==typeof b&&b);d||c.data("collapse",d=new j(this,e)),"string"==typeof b&&d[b]()})},a.fn.collapse.defaults={toggle:!0},a.fn.collapse.Constructor=j,a.fn.collapse.noConflict=function(){return a.fn.collapse=g,this},a(document).on("click.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e).data("collapse")?"toggle":d.data();d[a(e).hasClass("in")?"addClass":"removeClass"]("collapsed"),a(e).collapse(f)});var k="[data-toggle=dropdown]",l=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};l.prototype={constructor:l,toggle:function(d){var e,f,g=a(this);if(!g.is(".disabled, :disabled"))return e=c(g),f=e.hasClass("open"),b(g),f||"ontouchstart"in document.documentElement&&a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",b),e.toggleClass("open"),g.focus(),!1},keydown:function(b){var d,e,f,g,h;if(/(38|40|27)/.test(b.keyCode)&&(d=a(this),b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled"))){if(f=c(d),g=f.hasClass("open"),!g||g&&27==b.keyCode)return 27==b.which&&f.find(k).focus(),d.click();e=a("[role=menu] li:not(.divider):visible a",f),e.length&&(h=e.index(e.filter(":focus")),38==b.keyCode&&h>0&&h--,40==b.keyCode&&h<e.length-1&&h++,~h||(h=0),e.eq(h).focus())}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new l(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=l,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.dropdown.data-api",b).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",k,l.prototype.toggle).on("keydown.dropdown.data-api",k+", [role=menu]",l.prototype.keydown);var m=function(b,c){this.options=c,this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};m.prototype={constructor:m,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,c=a.Event("show");this.$element.trigger(c),this.isShown||c.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var c=a.support.transition&&b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body),b.$element.show(),c&&b.$element[0].offsetWidth,b.$element.addClass("in").attr("aria-hidden",!1),b.enforceFocus(),c?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]===a.target||b.$element.has(a.target).length||b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end),b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c),b.hideModal()})},hideModal:function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var g=a.fn.modal;a.fn.modal=function(b){return this.each(function(){var c=a(this),d=c.data("modal"),e=a.extend({},a.fn.modal.defaults,c.data(),"object"==typeof b&&b);d||c.data("modal",d=new m(this,e)),"string"==typeof b?d[b]():e.show&&d.show()})},a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},a.fn.modal.Constructor=m,a.fn.modal.noConflict=function(){return a.fn.modal=g,this},a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f).one("hide",function(){c.focus()})});var n=function(a,b){this.init("tooltip",a,b)};n.prototype={constructor:n,init:function(b,c,d){var e,f,g,h,i;for(this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,g=this.options.trigger.split(" "),i=g.length;i--;)h=g[i],"click"==h?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=h&&(e="hover"==h?"mouseenter":"focus",f="hover"==h?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c,d=a.fn[this.type].defaults,e={};return this._options&&a.each(this._options,function(a,b){d[a]!=b&&(e[a]=b)},this),c=a(b.currentTarget)[this.type](e).data(this.type),c.options.delay&&c.options.delay.show?(clearTimeout(this.timeout),c.hoverState="in",void(this.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show))):c.show()},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),c.options.delay&&c.options.delay.hide?(c.hoverState="out",void(this.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide))):c.hide()},show:function(){var b,c,d,e,f,g,h=a.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(h),h.isDefaultPrevented())return;switch(b=this.tip(),this.setContent(),this.options.animation&&b.addClass("fade"),f="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement,b.detach().css({top:0,left:0,display:"block"}),this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element),c=this.getPosition(),d=b[0].offsetWidth,e=b[0].offsetHeight,f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}this.applyPlacement(g,f),this.$element.trigger("shown")}},applyPlacement:function(a,b){var c,d,e,f,g=this.tip(),h=g[0].offsetWidth,i=g[0].offsetHeight;g.offset(a).addClass(b).addClass("in"),c=g[0].offsetWidth,d=g[0].offsetHeight,"top"==b&&d!=i&&(a.top=a.top+i-d,f=!0),"bottom"==b||"top"==b?(e=0,a.left<0&&(e=a.left*-2,a.left=0,g.offset(a),c=g[0].offsetWidth,d=g[0].offsetHeight),this.replaceArrow(e-h+c,c,"left")):this.replaceArrow(d-i,d,"top"),f&&g.offset(a)},replaceArrow:function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},hide:function(){function b(){var b=setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.detach()})}var c=this.tip(),d=a.Event("hide");if(this.$element.trigger(d),!d.isDefaultPrevented())return c.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?b():c.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){var c=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;c.tip().hasClass("in")?c.hide():c.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var g=a.fn.tooltip;a.fn.tooltip=function(b){return this.each(function(){var c=a(this),d=c.data("tooltip"),e="object"==typeof b&&b;d||c.data("tooltip",d=new n(this,e)),"string"==typeof b&&d[b]()})},a.fn.tooltip.Constructor=n,a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},a.fn.tooltip.noConflict=function(){return a.fn.tooltip=g,this};var o=function(a,b){this.init("popover",a,b)};o.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:o,setContent:function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,c=this.options;return a=("function"==typeof c.content?c.content.call(b[0]):c.content)||b.attr("data-content")},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var g=a.fn.popover;a.fn.popover=function(b){return this.each(function(){var c=a(this),d=c.data("popover"),e="object"==typeof b&&b;d||c.data("popover",d=new o(this,e)),"string"==typeof b&&d[b]()})},a.fn.popover.Constructor=o,a.fn.popover.defaults=a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),a.fn.popover.noConflict=function(){return a.fn.popover=g,this},d.prototype={constructor:d,refresh:function(){var b,c=this;this.offsets=a([]),this.targets=a([]),b=this.$body.find(this.selector).map(function(){var b=a(this),d=b.data("target")||b.attr("href"),e=/^#\w/.test(d)&&a(d);return e&&e.length&&[[e.position().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),d]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})},process:function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},activate:function(b){var c,d;this.activeTarget=b,a(this.selector).parent(".active").removeClass("active"),d=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',c=a(d).parent("li").addClass("active"),c.parent(".dropdown-menu").length&&(c=c.closest("li.dropdown").addClass("active")),c.trigger("activate")}};var g=a.fn.scrollspy;a.fn.scrollspy=function(b){return this.each(function(){var c=a(this),e=c.data("scrollspy"),f="object"==typeof b&&b;e||c.data("scrollspy",e=new d(this,f)),"string"==typeof b&&e[b]()})},a.fn.scrollspy.Constructor=d,a.fn.scrollspy.defaults={offset:10},a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=g,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})});var p=function(b){this.element=a(b)};p.prototype={constructor:p,show:function(){var b,c,d,e=this.element,f=e.closest("ul:not(.dropdown-menu)"),g=e.attr("data-target");g||(g=e.attr("href"),g=g&&g.replace(/.*(?=#[^\s]*$)/,"")),e.parent("li").hasClass("active")||(b=f.find(".active:last a")[0],d=a.Event("show",{relatedTarget:b}),e.trigger(d),d.isDefaultPrevented()||(c=a(g),this.activate(e.parent("li"),f),this.activate(c,c.parent(),function(){e.trigger({type:"shown",relatedTarget:b})})))},activate:function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e):e(),f.removeClass("in")}};var g=a.fn.tab;a.fn.tab=function(b){return this.each(function(){var c=a(this),d=c.data("tab");d||c.data("tab",d=new p(this)),"string"==typeof b&&d[b]()})},a.fn.tab.Constructor=p,a.fn.tab.noConflict=function(){return a.fn.tab=g,this},a(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")});var q=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=a(this.options.menu),this.shown=!1,this.listen()};q.prototype={constructor:q,select:function(){var a=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(a)).change(),this.hide()},updater:function(a){return a},show:function(){var b=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:b.top+b.height,left:b.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(b){var c;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(c=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source,c?this.process(c):this)},process:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length?this.render(b.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var b,c=[],d=[],e=[];b=a.shift();)b.toLowerCase().indexOf(this.query.toLowerCase())?~b.indexOf(this.query)?d.push(b):e.push(b):c.push(b);return c.concat(d,e)},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;return b=a(b).map(function(b,d){return b=a(c.options.item).attr("data-value",d),b.find("a").html(c.highlighter(d)),b[0]}),b.first().addClass("active"),this.$menu.html(b),this},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0])),d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last()),c.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]),this.move(b)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},focus:function(a){this.focused=!0},blur:function(a){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation(),a.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(b){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")},mouseleave:function(a){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var g=a.fn.typeahead;a.fn.typeahead=function(b){return this.each(function(){var c=a(this),d=c.data("typeahead"),e="object"==typeof b&&b;d||c.data("typeahead",d=new q(this,e)),"string"==typeof b&&d[b]()})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},a.fn.typeahead.Constructor=q,a.fn.typeahead.noConflict=function(){return a.fn.typeahead=g,this},a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);c.data("typeahead")||c.typeahead(c.data())});var r=function(b,c){this.options=a.extend({},a.fn.affix.defaults,c),this.$window=a(window).on("scroll.affix.data-api",a.proxy(this.checkPosition,this)).on("click.affix.data-api",a.proxy(function(){setTimeout(a.proxy(this.checkPosition,this),1)},this)),this.$element=a(b),this.checkPosition()};r.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b,c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.bottom,h=f.top,i="affix affix-top affix-bottom";"object"!=typeof f&&(g=h=f),"function"==typeof h&&(h=f.top()),"function"==typeof g&&(g=f.bottom()),b=!(null!=this.unpin&&d+this.unpin<=e.top)&&(null!=g&&e.top+this.$element.height()>=c-g?"bottom":null!=h&&d<=h&&"top"),this.affixed!==b&&(this.affixed=b,this.unpin="bottom"==b?e.top-d:null,this.$element.removeClass(i).addClass("affix"+(b?"-"+b:"")))}};var g=a.fn.affix;a.fn.affix=function(b){return this.each(function(){var c=a(this),d=c.data("affix"),e="object"==typeof b&&b;d||c.data("affix",d=new r(this,e)),"string"==typeof b&&d[b]()})},a.fn.affix.Constructor=r,a.fn.affix.defaults={offset:0},a.fn.affix.noConflict=function(){return a.fn.affix=g,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})});
define('theme_osep/backtotop', ["jquery"],function(a){var b={init:function(){a(window).on("scroll",function(){b.updatePosition()}),a("body").on("click","#osep-backtotop a",function(b){b.preventDefault(),a("html,body").animate({scrollTop:0},250,function(){a("#oustudyplan-hamburger a").focus()})}),b.updatePosition()},updatePosition:function(){var b=0,c=a("#osep-backtotop");if(!c.parents("iframe").length){var d=a(window);d.width()<768&&(b=Math.min(1,d.scrollTop()/300)),0===b?c.css("display","none"):(c.css("display","block"),c.css("opacity",b))}}};return b});
define('theme_osep/bottomtriangle', ["jquery"],function(a){var b={currentHeight:160,init:function(){setInterval(function(){var c=a("#osep-bottomclearer").offset().top-a("#osep-bottomimage").offset().top;c!==b.currentHeight&&(b.currentHeight=c,a("#osep-bottomimage").css("height",b.currentHeight+"px"))},100)}};return b});
define('theme_osep/leftblocks', ["jquery","theme_osep/animations","theme_osep/responsive","theme_osep/scrollto","theme_osep/focusable"],function(a,b,c,d){var e={NAVIGATION_FIXED_HEIGHT:70,FADER_MAX_OPACITY:.7,SLIDE_TIME:.5,VELOCITY_BUFFER_TIME:400,SWIPE_VELOCITY:20,WATCH_SIDE_COL_TIME:1500,WATCH_SIDE_COL_FREQUENCY:100,enableTouch:!1,currentTouch:null,touchStartX:null,latestTouches:[],touchStartY:null,touchLocked:null,moved:!1,navigationShowing:!1,focusedBefore:null,lockMargin:10,navigationScrollMode:"upper",watchingSideColSize:0,init:function(b){a("#osep-maincol").on("click","> .osep-mobilenavpull a",function(a){a.preventDefault(),e.slideTo(!0)}),a("#osep-sidecol").on("click","> .osep-mobilenavpull a",function(a){a.preventDefault(),e.slideTo(!1)}),a("#osep-sidecol").on("click",".osep-mobileclose > img",function(a){a.preventDefault(),e.slideTo(!1)}),e.enableTouch="mobile"===c.getWidthCategory(),e.updateEvents();var d=a("#osep-pagewrapper");d.on("touchstart",function(b){if(e.enableTouch){var c=b.originalEvent.changedTouches[0];if(e.navigationShowing){var d=a(b.target).closest("a");if(d.length&&0===d.closest(".osep-mobilenavpull").length)return}else{var f=parseInt(a("#region-main").css("padding-left"));if(c.clientX>=f)return}e.currentTouch=c.identifier,e.touchStartX=c.clientX,e.touchStartY=c.clientY,e.touchLocked=null}});var f=function(a){for(var b=0;b<a.originalEvent.changedTouches.length;b++){var c=a.originalEvent.changedTouches[b];if(c.identifier===e.currentTouch)return c}return null};d.on("touchmove",function(b){if(e.enableTouch){var c=f(b);if(c){var d=c.clientX-e.touchStartX,g=c.clientY-e.touchStartY;if(null===e.touchLocked&&(Math.abs(g)>e.lockMargin?e.touchLocked="y":Math.abs(d)>e.lockMargin&&(e.touchLocked="x")),e.discardOldTouches(),e.latestTouches.push({time:(new Date).getTime(),xOffset:d}),e.navigationShowing){var h=a("#osep-sidecol"),i=h.outerWidth();null===e.touchLocked||"x"===e.touchLocked?(e.setSlide(Math.max(1,i+d)),e.moved=!0):(e.setSlide(i),e.moved=!1)}else null===e.touchLocked||"x"===e.touchLocked?(e.setSlide(Math.max(1,d)),e.moved=!0):(e.setSlide(0),e.moved=!1);"x"===e.touchLocked&&b.preventDefault()}}}),d.on("touchend touchcancel",function(b){if(e.enableTouch){var c=f(b);if(e.currentTouch=null,!c||"x"!==e.touchLocked)return void(e.moved&&(e.slideTo(e.navigationShowing),e.moved=!1));var d=0;if(e.discardOldTouches(),e.latestTouches.length>=2){var g=e.latestTouches[0],h=e.latestTouches[e.latestTouches.length-1];d=1e3*(h.xOffset-g.xOffset)/Math.max(1,h.time-g.time)}if(d>e.SWIPE_VELOCITY&&!e.navigationShowing)e.slideTo(!0);else if(d<-e.SWIPE_VELOCITY&&e.navigationShowing)e.slideTo(!1);else{var i=a("#osep-sidecol"),j=i.outerWidth(),k=parseInt(i.css("left"));isNaN(k)&&(k=-j);var l=(k+j)/j;e.slideTo(l>.5)}e.moved=!1}}),c.addWidthListener(e.widthChanged),e.enableTouch&&(e.mobileScroll(),1===a(".block.oucontent-contents .content li").length&&(b=!1),b&&setTimeout(function(){e.slideTo(!0)},100))},calculateZIndex:function(){var b=a(".moodle-has-zindex"),c=1;return b.each(function(b,d){d=a(d);var e=d.css("z-index")?parseInt(d.css("z-index")):0;e>c&&(c=e)}),c},widthChanged:function(b,c){"mobile"===c&&(e.enableTouch=!1,e.setSlide(0),e.navigationShowing=!1,a("#osep-sidecol").css("display",""),a("#osep-sidecol-canscrollup, #osep-sidecol-canscrolldown").remove()),"mobile"===b&&(e.enableTouch=!0,e.updateSideScrollIndicator()),e.updateEvents()},discardOldTouches:function(){for(var a=(new Date).getTime();e.latestTouches.length>0&&e.latestTouches[0].time<a-e.VELOCITY_BUFFER_TIME;)e.latestTouches.shift()},setSlide:function(b){var c=a("#osep-leftscrollfader"),d=a("#osep-sidecol"),f=a("#osep-maincol > .osep-mobilenavpull");if(b>0){var g=d.outerWidth();b=Math.min(b,g);var h=b-g;if(d.css({display:"block",left:h}),!f.hasClass("osep-lifted")){var i=f.offset(),j=f.clone();j.css({position:"",top:"",opacity:""}),f.addClass("osep-lifted"),d.prepend(j);var k=j.offset();j.css("top",i.top-k.top+"px"),e.updateSideScrollIndicator()}c.length||(c=a('<div id="osep-leftscrollfader"></div>'),c.on("click",function(){e.slideTo(!1)}),c.appendTo(document.body));var l=Math.min(2*b/g,1)*e.FADER_MAX_OPACITY;c.css("opacity",l),c.css("z-index",e.calculateZIndex()+1)}else d.css({display:"none",left:""}),f.hasClass("osep-lifted")&&(f.removeClass("osep-lifted"),d.find("> .osep-mobilenavpull").remove()),c.length&&c.remove()},updateEvents:function(){e.enableTouch?(a(window).on("scroll",e.mobileScroll),a("#osep-sidecol > aside").on("scroll click keyup touchmove",e.actionOnSide),a(window).on("resize",e.mobileResize)):(a(window).off("scroll",e.mobileScroll),a("#osep-sidecol > aside").off("scroll click keyup touchmove",e.actionOnSide),a(window).off("resize",e.mobileResize),e.preventScroll(!1))},actionOnSide:function(){e.watchingSideColSize||setTimeout(e.updateSideScrollIndicator,e.WATCH_SIDE_COL_FREQUENCY),e.watchingSideColSize=(new Date).getTime()+e.WATCH_SIDE_COL_TIME},mobileResize:function(){e.navigationShowing&&(e.preventScroll(!1),e.preventScroll(!0)),e.actionOnSide()},updateSideScrollIndicator:function(){if(!e.enableTouch)return void(e.watchingSideColSize=0);var b=a("#osep-sidecol > aside"),c=b[0],d=!1,f=!1;c.scrollHeight>c.clientHeight&&(0===c.scrollTop?f=!0:(d=!0,c.scrollTop+c.clientHeight<c.scrollHeight-1&&(f=!0)));var g=a("#osep-sidecol-canscrollup");g.length||(g=a('<div id="osep-sidecol-canscrollup"></div>'),g.appendTo("#osep-sidecol")),d?g.addClass("osep-showing"):g.removeClass("osep-showing");var h=a("#osep-sidecol-canscrolldown");h.length||(h=a('<div id="osep-sidecol-canscrolldown"></div>'),h.appendTo("#osep-sidecol")),f?h.addClass("osep-showing"):h.removeClass("osep-showing");var i=(new Date).getTime();i>e.watchingSideColSize?e.watchingSideColSize=0:setTimeout(e.updateSideScrollIndicator,e.WATCH_SIDE_COL_FREQUENCY)},mobileScroll:function(){var b=a("#osep-pagewrapper"),c=a("#osep-maincol > .osep-mobilenavpull"),d=b.offset().top+b.outerHeight()-c.outerHeight()-e.NAVIGATION_FIXED_HEIGHT,f=b.offset().top-e.NAVIGATION_FIXED_HEIGHT-6,g=a(window).scrollTop();g>d?e.setNavigationScrollMode("lower"):g>f?e.setNavigationScrollMode("fixed"):e.setNavigationScrollMode("upper")},setNavigationScrollMode:function(b){if(e.navigationScrollMode!==b){var c=a("#osep-maincol > .osep-mobilenavpull");switch(e.navigationScrollMode=b,b){case"lower":c.css({position:"fixed",opacity:0,top:e.NAVIGATION_FIXED_HEIGHT});break;case"fixed":c.css({position:"fixed",opacity:1,top:e.NAVIGATION_FIXED_HEIGHT});break;case"upper":c.css({position:"",opacity:1,top:""})}}},handleKeydown:function(b){switch(b.keyCode){case 27:return void(e.navigationShowing&&(e.slideTo(!1),b.preventDefault()));case 9:break;default:return}var c=a("#osep-sidecol :focusable"),d=c.first()[0],f=c.last()[0];b.shiftKey&&b.target===d?(f.focus(),b.preventDefault()):b.shiftKey||b.target!==f||(d.focus(),b.preventDefault())},preventScroll:function(b){var c,d=a("body"),e=a("html");if(b){var f=d.css("width");c=window.pageYOffset,e.css({overflow:"hidden"}),d.css({position:"fixed",top:-c,"max-width":f})}else""!==d[0].style.top&&(c=-parseInt(d.css("top")),e.css({overflow:""}),d.css({position:"",top:"","max-width":""}),window.scrollTo(0,c))},slideTo:function(c,d){var f=a("#osep-sidecol"),g=f.outerWidth(),h=c?0:-g;c&&(e.focusedBefore=document.activeElement,f.css("z-index",e.calculateZIndex()+2));var i=function(){c||e.setSlide(0),e.navigationShowing!==c&&(e.navigationShowing=c,c?(f.find(".block .content :focusable").first().focus(),a(document.documentElement).on("keydown",e.handleKeydown),e.preventScroll(!0)):(e.focusedBefore&&e.focusedBefore.focus(),a(document.documentElement).off("keydown",e.handleKeydown),e.preventScroll(!1))),d&&d()},j=parseInt(f.css("left"));if(isNaN(j)&&(j=-g),j===h)return void i();c&&j==-g&&e.setSlide(1);var k,l,m,n;c?(k=(g-(g+j))/g,k<.5?l=!1:(l=!0,m=0,n=e.SLIDE_TIME*(k-.5))):(k=(g+j)/g,l=!0,k>.5?(m=e.SLIDE_TIME*(k-.5),n=e.SLIDE_TIME/2):(m=0,n=e.SLIDE_TIME*k));var o=e.SLIDE_TIME*k;M.util.js_pending("theme_osep/leftblocks-slideTo");var p=!1,q=!1,r=function(){p&&q&&(i(),M.util.js_complete("theme_osep/leftblocks-slideTo"))};if(b.slidePosition(f,{left:h},{after:function(){p=!0,r()},seconds:o}),l){var s=a("#osep-leftscrollfader");c||s.length||(q=!0),setTimeout(function(){c?b.fade(s,e.FADER_MAX_OPACITY,{seconds:n,after:function(){q=!0,r()}}):s.length&&b.fade(s,0,{seconds:n,after:function(){q=!0,r()}})},parseInt(1e3*m))}else q=!0},hideNav:function(a){var b=0;void 0!==a&&a.length>0&&(b=a.offset().top),e.slideTo(!1,function(){void 0!==a&&(M.util.js_pending("theme_osep/leftblocks-hideNav"),d.scrollToElement(b,a,"theme_osep/leftblocks-hideNav"))})}};return e});
define('theme_osep/oucontentmenu', ["jquery","theme_osep/animations","theme_osep/responsive","theme_osep/leftblocks"],function(a,b,c,d){var e={init:function(){a(".oucontent-contents .content > ul").on("click",".osep-expand",function(c){c.preventDefault(),c.stopPropagation(),d.actionOnSide();var e=a(this),f=a(".osep-collapse",e.closest("span")),g=e.closest("li").children("ul");b.openDownAndToggleLink(g,e,f)}),a(".oucontent-contents .content > ul").on("click",".osep-collapse",function(c){c.preventDefault(),c.stopPropagation(),d.actionOnSide();var e=a(this),f=a(".osep-expand",e.closest("span")),g=f.closest("li").children("ul");b.closeUpAndToggleLink(g,f,e)}),c.addWidthListener(function(a,b){"mobile"===a?e.addMobileFeatures():"mobile"===b&&e.removeMobileFeatures()}),"mobile"===c.getWidthCategory()&&e.addMobileFeatures();var f=a("#osep-maincol .oucontent-startpagebox");if(f.length){var g=f.clone(),h=g.children("div");h[0].removeChild(h[0].firstChild),h[0].removeChild(h[0].firstChild),h.prepend(document.createTextNode(M.util.get_string("mobile_autobookmark","theme_osep"))),a(".oucontent-contents .content").prepend(g)}},addMobileFeatures:function(){var b=a("#osep-sidecol .oucontent-contents li.oucontent-tree-current > span");b[0].tabIndex=0;var c=a("#osep-sidecol .oucontent-contents");c.on("click","li.oucontent-tree-current > span",function(a){a.stopPropagation(),d.hideNav()}),b.on("keydown",function(b){13===b.which&&a(document.activeElement).is("#osep-sidecol .oucontent-contents li.oucontent-tree-current > span")&&(b.stopPropagation(),d.hideNav())})},removeMobileFeatures:function(){var b=a("#osep-sidecol .oucontent-contents li.oucontent-tree-current > span");b[0].tabIndex="",b.off("click"),b.off("keypress")}};return e});
define('theme_osep/animations', [],function(){var a={DEFAULT_TIME:.4,HALF_TIME:.2,DEFAULT_SPEED:1e3,pendingAnimations:0,supportsTransitions:function(){return"transition"in document.body.style},animationStarted:function(){a.pendingAnimations++,1===a.pendingAnimations&&M.util.js_pending("theme_osep_animations")},animationFinished:function(){a.pendingAnimations--,0===a.pendingAnimations&&M.util.js_complete("theme_osep_animations")},fade:function(b,c,d){void 0===d&&(d={});var e=a.DEFAULT_TIME;if(d.seconds&&(e=d.seconds),!a.supportsTransitions())return b.css("opacity",c),void(d.after&&d.after());var f=b.css("opacity");return f==c?void(d.after&&d.after()):(a.animationStarted(),b.css("opacity",f),b.css("transition","opacity "+e+"s"),setTimeout(function(){b.css("opacity",c)},0),void b.one("transitionend",function(){d.after&&d.after(),b.css("transition",""),a.animationFinished()}))},fadeIn:function(b,c,d){b.inFadeIn||(void 0===c&&(c=a.DEFAULT_TIME),void 0===d&&(d={after:null,display:"block"}),b.css("display",d.display),a.supportsTransitions()?(a.animationStarted(),b.inFadeOut?(b.inFadeAfter&&(b.inFadeAfter(!1),a.animationFinished()),delete b.inFadeOut,b.css("opacity",1)):(b.css("opacity",0),b.css("opacity"),b.css("transition","opacity "+c+"s"),b.one("transitionend",function(){a.fadeEnd(b)}),setTimeout(function(){b.css("opacity",1)},0)),b.inFadeIn=!0,b.inFadeAfter=d.after):d.after&&d.after(!0))},fadeOut:function(b,c,d){b.inFadeOut||(void 0===c&&(c=a.DEFAULT_TIME),void 0===d&&(d={after:null}),a.supportsTransitions()?(a.animationStarted(),b.inFadeIn?(b.inFadeAfter&&(b.inFadeAfter(!1),a.animationFinished()),delete b.inFadeIn,b.css("opacity",0)):(b.css("transition","opacity "+c+"s"),setTimeout(function(){b.css("opacity",0)}),b.one("transitionend",function(){a.fadeEnd(b)})),b.inFadeOut=!0,b.inFadeAfter=d.after,d.noDisplayNone&&(b.inFadeAfterNoDisplayNone=!0)):(b.css("display","none"),d.after&&d.after(!0)))},fadeEnd:function(b){b.inFadeIn?(delete b.inFadeIn,b.css("transition","")):b.inFadeOut&&(b.inFadeAfterNoDisplayNone?delete b.inFadeAfterNoDisplayNone:(b.css("display","none"),b.css("opacity","")),b.css("transition",""),delete b.inFadeOut),a.animationFinished(),b.inFadeAfter&&b.inFadeAfter(!0)},slidePosition:function(b,c,d){if(void 0===d&&(d={}),!a.supportsTransitions)return b.css(c),void(d.after&&d.after());var e=!0,f={};if(void 0!==c.left&&(f.left=parseInt(b.css("left")),f.left!=c.left&&(e=!1)),void 0!==c.top&&(f.top=parseInt(b.css("top")),f.top!=c.top&&(e=!1)),e)return void(d.after&&d.after());var g;if(d.seconds)g=d.seconds;else{var h=a.DEFAULT_SPEED;d.speed&&(h=d.speed);var i;if(void 0!==f.left&&void 0!==f.top){var j=Math.pow(f.left-c.left,2),k=Math.pow(f.top-c.top,2);i=Math.sqrt(j+k)}else i=void 0!==f.left?Math.abs(f.left-c.left):Math.abs(f.top-c.top);g=i/h}b.data("inSlidePosition",!0),a.animationStarted(),b.css("transition","left "+g+"s, top "+g+"s"),setTimeout(function(){void 0!==c.left&&b.css("left",c.left+"px"),void 0!==c.top&&b.css("top",c.top+"px")},0),b.one("transitionend",function(){b.css("transition",""),b.removeData("inSlidePosition"),a.animationFinished(),d.after&&d.after(!0)})},openDown:function(b,c){return a.openClose(b,!0,{seconds:c})},closeUp:function(b,c){return a.openClose(b,!1,{seconds:c})},getDefaultOpenTime:function(b,c){return void 0===c&&(c=a.DEFAULT_TIME),Math.max(b/2e3,c)},openClose:function(b,c,d){return void 0===d&&(d={}),d.mode=c?"open":"close",(!b.data("inOpenClose")||b.data("inOpenClose").mode!==d.mode)&&(d.closedHeight||(d.closedHeight=0),a.animationStarted(),a.supportsTransitions()?(b.data("inOpenClose")?b.data("inOpenClose").after&&(b.data("inOpenClose").after(),a.animationFinished()):("open"===d.mode&&(0===d.closedHeight&&b.css("display","block"),b.css("max-height","")),b.data("originalHeight",b.height()),void 0===d.seconds&&(d.seconds=a.getDefaultOpenTime(b.data("originalHeight")-d.closedHeight)),"close"===d.mode?b.css("max-height",b.data("originalHeight")+"px"):b.css("max-height",d.closedHeight+"px"),b.css("max-height"),b.css("transition","max-height "+d.seconds+"s"),b.css("overflow","hidden"),b.one("transitionend",function(){a.openCloseEnd(b)})),b.data("inOpenClose",d),setTimeout(function(){var c;c="open"===d.mode?b.data("originalHeight"):d.closedHeight;var e=parseInt(b.css("height"));b.css("max-height",c+"px"),e==c&&a.openCloseEnd(b,d)},0)):a.openCloseEnd(b,d),!0)},openCloseEnd:function(b){var c=b.data("inOpenClose");c&&(b.removeData("inOpenClose"),b.removeData("originalHeight"),b.css("overflow",""),"open"===c.mode?(b.css("transition",""),b.css("max-height","")):"close"===c.mode&&(b.css("transition",""),c.closedHeight>0?b.css("max-height",c.closedHeight+"px"):(b.css("display","none"),b.css("max-height",""))),"disabled"==b.data("clickdisable")&&b.removeData("clickdisable"),c.after&&c.after(),a.animationFinished())},openDownAndToggleLink:function(b,c,d,e,f){void 0===f&&(f={}),void 0===f.linkDisplay&&(f.linkDisplay="inline"),void 0===f.focus&&(f.focus=!0),b.css("display","block"),void 0===e&&(e=a.getDefaultOpenTime(b.height())),b.css("display","none"),a.openDown(b,e),a.fadeOut(c,e/2,{after:function(){a.fadeIn(d,e/2,{display:f.linkDisplay,after:f.after}),f.focus&&d.focus(),f.halfTime&&f.halfTime()}})},closeUpAndToggleLink:function(b,c,d,e,f){void 0===f&&(f={}),void 0===f.linkDisplay&&(f.linkDisplay="inline"),void 0===f.focus&&(f.focus=!0),void 0===e&&(e=a.getDefaultOpenTime(b.height())),a.closeUp(b,e),a.fadeOut(d,e/2,{after:function(){a.fadeIn(c,e/2,{display:f.linkDisplay,after:f.after}),f.focus&&c.focus(),f.halfTime&&f.halfTime()}})}};return a});
define('theme_osep/blockhide', ["jquery","theme_osep/animations","theme_osep/responsive","core/ajax"],function(a,b,c,d){var e={addedWidthListener:!1,alternateAddWidthListener:!0,init:function(){a(document.body).on("click",".block .header .osep-showhide > img",function(){e.trigger(this)}),a(document.body).on("keydown",".block .header .osep-showhide > img",function(a){13===a.which&&e.trigger(this)}),a(document.body).on("click",".block .header .osep-desktopshowhide > img",function(){e.desktopTrigger(this)}),a(document.body).on("keydown",".block .header .osep-desktopshowhide > img",function(a){13===a.which&&e.desktopTrigger(this)}),a(document.body).on("click",".osep-showhidecontrols > span",function(){e.alternateTrigger(this)}),a(document.body).on("keydown",".osep-showhidecontrols > span",function(a){13===a.which&&e.alternateTrigger(this)}),a(document.body).hasClass("osep-courseformat-ousubject")&&e.tryReplacingBlockArrows(a(document.body).hasClass("ie")?10:2)},tryReplacingBlockArrows:function(b){return a("img.block-hider-hide").length?(a("img.block-hider-hide").prop("src",M.util.image_url("switch_minus_white","theme_osep")),a("img.block-hider-show").prop("src",M.util.image_url("switch_plus_white","theme_osep")),void a("img.block-hider-hide, img.block-hider-show").css("opacity",1)):(b--,void(b>0&&setTimeout(function(){e.tryReplacingBlockArrows(b)},50)))},trigger:function(b){var c=a(b).closest(".block");e.show(c,"osep-showblock"===b.className)},show:function(c,d){var f=a("> .content",c);if("disabled"!=f.data("clickdisable")){f.data("clickdisable","disabled");var g=a(".header .osep-showblock",c),h=a(".header .osep-hideblock",c);d&&!c.data("makingVisible")?(c.data("makingVisible",!0),b.openDownAndToggleLink(f,g,h,void 0,{halfTime:function(){c.data("makingVisible",!1)}})):d||c.data("makingHidden")||(c.data("makingHidden",!0),b.closeUpAndToggleLink(f,g,h,void 0,{halfTime:function(){c.data("makingHidden",!1)}})),e.addWidthListener()}},addWidthListener:function(){e.addedWidthListener||(e.addedWidthListener=!0,c.addWidthListener(function(b,c){"mobile"===c&&a(".block > .content").each(function(b,c){if("display"in c.style){c.style.removeProperty("display");var d=a(c).closest(".block"),e=a(".header .osep-showblock",d),f=a(".header .osep-hideblock",d);e.length>0&&e[0].style.removeProperty("display"),f.length>0&&f[0].style.removeProperty("display")}})}))},desktopTrigger:function(b){var c=a(b).closest(".block");e.desktopShow(c,"osep-showblock"===b.className)},desktopShow:function(b,c){c?(b.removeClass("hidden"),b.find(".header .osep-hideblock").focus()):(b.addClass("hidden"),b.find(".header .osep-showblock").focus()),a.ajax({url:M.cfg.wwwroot+"/theme/osep/desktopshow.php",method:"POST",data:{osepid:b.data("osepid"),show:c?1:0}})},alternateTrigger:function(b){var c=a(b).closest(".osep-showhidecontrols"),d=c.data("osepshowhide"),f=a(".osep-showhideblock[data-osepshowhide="+d+"]");e.alternateShow(d,c,f,"osep-showblock"===b.className),e.alternateAddWidthListener&&(e.alternateAddAWidthListener(),e.alternateAddWidthListener=!1)},alternateShow:function(f,g,h,i){if(!g.data("locked")){var j=a(".osep-showblock",g),k=a(".osep-hideblock",g),l="mobile"===c.getWidthCategory();g.data("locked",!0),i?b.openDownAndToggleLink(h,j,k,void 0,{after:function(){e.alternateAdjustContent(h,i,l,g),g.removeData("locked")}}):b.closeUpAndToggleLink(h,j,k,void 0,{after:function(){e.alternateAdjustContent(h,i,l,g),g.removeData("locked")}}),M.util.js_pending("theme_osep_alternateshow"),d.call([{methodname:"theme_osep_set_show_hide",args:{showhideid:f,hidden:!i,ismobile:l},done:function(){M.util.js_complete("theme_osep_alternateshow")},fail:function(){M.util.js_complete("theme_osep_alternateshow")}}])}},alternateAdjustContent:function(a,b,c,d){var e="";e=c?b?"osep-visible":"osep-mobilehidden":b?"osep-mobilehidden":"osep-hidden",a.removeClass("osep-mobilehidden osep-hidden osep-visible"),a.addClass(e),a.removeAttr("style"),d.removeClass("osep-mobilehidden osep-hidden osep-visible"),d.addClass(e)},alternateAddAWidthListener:function(){c.addWidthListener(function(b){var c=a(".osep-showhidecontrols");c.each(function(){var c=a(this).hasClass("osep-visible"),d=a(this).hasClass("osep-hidden"),e=a(this).hasClass("osep-mobilehidden"),f=a(".osep-showblock",this),g=a(".osep-hideblock",this);"desktop"===b||"tablet"===b?(c||e)&&f.is(":visible")?(f.css("display","none"),g.css("display","inline")):d&&g.is(":visible")&&(f.css("display","inline"),g.css("display","none")):"mobile"===b&&(c&&f.is(":visible")?(f.css("display","none"),g.css("display","inline")):(d||e)&&g.is(":visible")&&(f.css("display","inline"),g.css("display","none")))})})}};return e});
define('theme_osep/chromescrollbars', ["jquery","theme_osep/responsive"],function(a,b){var c={init:function(){window.innerWidth>document.documentElement.clientWidth&&(a("body").addClass("osep-chromescrollbars"),b.addWidthListener(function(b,c){"tablet"===b&&"desktop"===c&&(a("#block-region-side-post").css("display","none"),setTimeout(function(){a("#block-region-side-post").css("display","block")},0))}))}};return c});
define('theme_osep/editinghacks', ["jquery"],function(a){var b={init:function(){for(var b=a("#chooseform input#item_subpage, #chooseform input#item_sharedsubpage"),c=0;c<b.length;c++)a(b[c]).closest("div.option").remove();for(var d=a("#add_block option[value=course_forums],#add_block option[value=course_resources]"),e=0;e<d.length;e++)a(d[e]).remove()}};return b});
define('theme_osep/oucontentdownloads', ["jquery"],function(a){var b={dialogue:{}},c={init:function(){var d=a("#downloads");d.length>0&&window.require(["theme_osep/dialogue"],function(e){var f={headerContent:d.find("h2").detach().html(),bodyContent:d.html(),centered:!0,modal:!0,visibile:!1,extraClasses:["oucontent-downloadsbox"],width:"100%",done:function(a){b.dialogue=a}};e.makeDialogue(f),d.remove(),a("#osep-bottombutton-downloads").on("click",c.showDownloads)})},showDownloads:function(a){a.preventDefault(),b.dialogue.show(),window.scrollBy(0,1),window.scrollBy(0,-1)}};return c});
define('theme_osep/ouwiki', ["jquery"],function(a){var b={init:function(){a("#ouw_addnewsection").on("click",function(b){return b.preventDefault(),a("#ouw_create").parent().hasClass("ouw-display")&&a("#ouw_create").parent().toggleClass("ouw-display"),a("#ouw_add").parent().toggleClass("ouw-display"),!1}),a("#ouw_createnewpage").on("click",function(b){return b.preventDefault(),a("#ouw_add").parent().hasClass("ouw-display")&&a("#ouw_add").parent().toggleClass("ouw-display"),a("#ouw_create").parent().toggleClass("ouw-display"),!1})}};return b});
define('theme_osep/responsive', ["jquery"],function(a){var b={widthListeners:[],inited:!1,lastCategory:0,addWidthListener:function(c){b.widthListeners.push(c),b.inited||(b.inited=!0,b.lastCategory=b.getWidthCategory(),a(window).on("resize",function(){var a=b.getWidthCategory();if(a!=b.lastCategory){for(var c=0;c<b.widthListeners.length;c++)b.widthListeners[c](a,b.lastCategory);b.lastCategory=a}}))},removeWidthListener:function(a){var c=b.widthListeners.indexOf(a);b.widthListeners.splice(c,1)},getWidthCategory:function(a){return void 0===a&&(a=window.innerWidth),a<768?"mobile":a<1024?"tablet":"desktop"}};return b});
define('theme_osep/activitynav', ["jquery","theme_osep/animations"],function(a,b){var c={tab:-1,pageSize:0,page:0,numPages:0,currentTouch:null,touchStart:0,infoShowing:null,scrolling:!1,init:function(){for(var b=a("#osep-weektabs > ul > li"),d=0;d<b.length;d++)if("osep-current"===b[d].className){c.tab=d;break}c.initMetrics();var e=a("#osep-weeknext"),f=a("#osep-weekprev");e.on("click",function(a){a.preventDefault(),c.scrolling||c.scrollToPage(c.page+1,function(){c.page===c.numPages-1&&f.focus()})}),f.on("click",function(a){a.preventDefault(),c.scrolling||c.scrollToPage(c.page-1,function(){0===c.page&&e.focus()})}),f.css("transition","opacity 0.5s"),e.css("transition","opacity 0.5s"),a("#osep-weektabs > ul").on("focus","a",function(){var a=c.getTabPage(this);c.page!==a&&c.scrollToPage(a)}),a(document).on("keydown","#osep-weektabs *:focus",function(b){if(9===(b.keyCode||b.which)&&!a("*[tabindex=0]",this).length){var d,e=c.getTabPage(this);if(b.shiftKey){d=a(this).closest("li").prev("li").children("a");var f=a("*[tabindex=0]",d);f.length&&(d=f[f.length-1])}else d=a(this).closest("li").next("li").children("a");if(d.length>0){var g=c.getTabPage(d);g!=e&&(b.preventDefault(),c.scrollToPage(g,function(){d.focus()}))}}});var g=a("#osep-weektabs > ul > li:first-child a");a("#osep-weektabs > ul").on("touchstart",function(a){var b=a.originalEvent.changedTouches[0];c.currentTouch=b.identifier,c.touchStart=b.screenX});var h=function(a){for(var b=0;b<a.originalEvent.changedTouches.length;b++){var d=a.originalEvent.changedTouches[b];if(d.identifier===c.currentTouch)return d}return null};a("#osep-weektabs > ul").on("touchmove",function(a){a.preventDefault();var b=h(a);if(b){c.infoShowing&&c.showInfo(c.infoShowing.data("el"),!1);var d=b.screenX-c.touchStart;g.css("marginLeft",d+"px")}}),a("#osep-weektabs > ul").on("touchend",function(a){var b=h(a);if(b){var d,e=b.screenX-c.touchStart,f=c.getPageWidth();Math.abs(e)>f/2?(d=Math.round(c.page-e/f),d=Math.max(0,Math.min(d,c.numPages-1))):(d=c.page,e>20&&c.page>0?d--:e<-20&&c.page<c.numPages-1&&d++),c.scrollToPage(d),g.animate({marginLeft:0},500)}}),a("#osep-weektabs > ul").on("touchcancel",function(){g.animate({marginLeft:0},500)}),a("#osep-weektabs > ul").on("click",".osep-infoicon",function(a){a.preventDefault(),c.showInfo(this)}),a("#osep-weektabs > ul").on("keydown",".osep-infoicon",function(a){13===Number(a.which)&&(a.preventDefault(),c.showInfo(this))}),a("#osep-weektabs > ul").on("keyup keypress",".osep-infoicon",function(a){13===Number(a.which)&&a.preventDefault()});var i=function(){var b=a(this).closest(".osep-modinfopopup").data("el");c.showInfo(b,!1),b.focus()};a("#page").on("click","> .osep-modinfopopup .osep-closeinfo",function(){i.call(this)}),a("#page").on("keydown","> .osep-modinfopopup .osep-closeinfo",function(a){13===Number(a.which)&&i.call(this)}),a(window).on("resize",function(){if(c.getPageSize()!==c.pageSize){c.initMetrics();var b=a("#osep-weektabs > ul > li:first-child");c.setFinalTabScroll(b,c.page),c.infoShowing&&(c.infoShowing.css("display","none"),c.infoShowing=null)}})},getPageSize:function(){return"none"!==a("#osep-pageindicator").css("display")?4:1},initMetrics:function(){c.pageSize=c.getPageSize(),4===c.pageSize?(c.page=Math.floor(c.tab/4),c.numPages=Math.ceil(a("#osep-weektabs > ul > li").length/4)):(c.page=c.tab,c.numPages=a("#osep-weektabs > ul > li").length)},getPageWidth:function(){return a("#osep-weektabs > ul li:first-child a").outerWidth()*c.pageSize},getTabPage:function(b){return Math.floor(a(b).closest("li").prevAll("li").length/c.pageSize)},setFinalTabScroll:function(a,b){4===c.pageSize?a.css("marginLeft",b*-100+"%"):a.css("marginLeft","calc(-"+b+" * (100vw - 35px) + 20px)")},scrollToPage:function(b,d){if(c.page!==b){var e=1,f=1;b===c.numPages-1&&(e=0),0===b&&(f=0);var g=a("#osep-weekprev"),h=a("#osep-weeknext");f&&g.removeClass("osep-hidden"+c.pageSize),e&&h.removeClass("osep-hidden"+c.pageSize),setTimeout(function(){g.css("opacity",f),h.css("opacity",e)},0);var i=-b*c.getPageWidth();1===c.pageSize&&(i+=16);var j=-c.page*c.getPageWidth();1===c.pageSize&&(j+=16);var k=a("#osep-weektabs > ul > li:first-child");k.css("margin-left",j),c.scrolling=!0,M.util.js_pending("theme_osep_activitynavscroll"),k.animate({marginLeft:i},500,function(){e||(h.addClass("osep-hidden"+c.pageSize),h.css("opacity","")),f||(g.addClass("osep-hidden"+c.pageSize),g.css("opacity","")),c.scrolling=!1,d&&d(),c.setFinalTabScroll(k,b),M.util.js_complete("theme_osep_activitynavscroll")});var l=1===c.pageSize?"osep-1tab":"osep-4tabs",m=a(a("#osep-pageindicator ul."+l+" li")[c.page]);m.removeClass("osep-currentpage");var n=a(a("#osep-pageindicator ul."+l+" li")[b]);n.addClass("osep-currentpage"),c.page=b}},showInfo:function(d,e){var f,g=a("#page");if(d.infoPopup)f=d.infoPopup;else{f=a(d).closest("li").children(".osep-modinfopopup"),f.remove(),f.prependTo(g),d.infoPopup=f,f.data("el",d);var h=a('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="19px" height="11px" viewBox="0 0 19 11" aria-label=""><polygon points="0,11 9,0 19,11" fill="#832884"/></svg>');f.prepend(h),h.css("position","absolute"),h.css("top","-10px")}if(void 0===e&&(e=c.infoShowing!==f),e!==(c.infoShowing===f)){if(e){c.infoShowing&&c.showInfo(c.infoShowing.data("el"),!1),c.infoShowing=f,b.fadeIn(f);var i,j=a(d),k=j.offset().left,l=j.width(),m=a("#page-content");if(4===c.pageSize){i=k+(l-f.width())/2,i<0&&(i=0);var n=m.offset().left+m.width();i+f.outerWidth()>n-10&&(i=n-10-f.outerWidth())}else i=(m.width()-f.outerWidth())/2;f.css("left","0px"),f.css("left",i-f.offset().left+"px");var o=a("svg",f);o.css("left","0px");var p=k+(l-o.width())/2-o.offset().left;o.css("left",p+"px");var q=j.offset().top+j.outerHeight()-g.offset().top;f.css("top",q+14+"px"),a(".osep-closeinfo",f).focus()}else b.fadeOut(f),c.infoShowing=null;f.data("showing",e)}}};return c});
define('theme_osep/autoscroll', ["jquery"],function(a){var b={SCROLL_THRESHOLD:30,SCROLL_FREQUENCY:1e3/60,SCROLL_SPEED:.5,scrollingId:null,scrollAmount:0,callback:null,start:function(c){a(window).on("mousemove",b.mouseMove),a(window).on("touchmove",b.touchMove),b.callback=c},stop:function(){a(window).off("mousemove",b.mouseMove),a(window).off("touchmove",b.touchMove),null!==b.scrollingId&&b.stopScrolling()},touchMove:function(a){for(var c=0;c<a.changedTouches.length;c++)b.handleMove(a.changedTouches[c].clientX,a.changedTouches[c].clientY)},mouseMove:function(a){b.handleMove(a.clientX,a.clientY)},handleMove:function(c,d){d<b.SCROLL_THRESHOLD?b.scrollAmount=-Math.min(b.SCROLL_THRESHOLD-d,b.SCROLL_THRESHOLD):d>a(window).height()-b.SCROLL_THRESHOLD?b.scrollAmount=Math.min(d-(a(window).height()-b.SCROLL_THRESHOLD),b.SCROLL_THRESHOLD):b.scrollAmount=0,b.scrollAmount&&null===b.scrollingId?b.startScrolling():b.scrollAmount||null===b.scrollingId||b.stopScrolling()},startScrolling:function(){var c=a(document).height-a(window).height;b.scrollingId=window.setInterval(function(){var d=a(window).scrollTop(),e=Math.round(b.scrollAmount*b.SCROLL_SPEED);if(d+e<0&&(e=-d),d+e>c&&(e=c-d),0!==e){a(window).scrollTop(d+e);var f=a(window).scrollTop()-d;0!==f&&b.callback&&b.callback(f)}},b.SCROLL_FREQUENCY)},stopScrolling:function(){window.clearInterval(b.scrollingId),b.scrollingId=null}};return b});
define('theme_osep/dialogue', ["jquery","core/yui"],function(a,b){var c={makeDialogue:function(d,e){b.use("moodle-core-notification",function(){var b=new M.core.dialogue(d);c.resetMask(b),a(window).on("scroll",function(a){b.get("visible")&&(a.stopImmediatePropagation(),c.resetMask(b))});var f;a(window).on("resize",function(){b.get("visible")&&(clearTimeout(f),f=setTimeout(function(){c.centerDialogue(b,e)},250))}),a(window).on("orientationchange",function(){b.get("visible")&&c.centerDialogue(b,e)}),d.done&&d.done(b)})},resetMask:function(a){var b=a.get("maskNode");b.setStyle("position","fixed"),b.setStyle("width","100%"),b.setStyle("height","100%"),b.setStyle("left","0"),b.setStyle("top","0")},centerDialogue:function(a,b){a.centerDialogue(),a.shouldResizeFullscreen()&&(b?c.makeFullResponsiveHeight(a):a.makeResponsive())},makeFullResponsiveHeight:function(a){a.makeResponsive();var b=a.get("boundingBox"),c=a.headerNode,d=a.bodyNode,e=b.one(".moodle-dialogue-wrap"),f=e.get("offsetHeight")-c.get("offsetHeight")-d.getStyle("padding-top").replace(/px$/,"")-d.getStyle("padding-bottom").replace(/px$/,"");d.setStyle("height",f-8+"px")},makeDestroyOnClose:function(a){a.on("visibleChange",function(){a.visible||a.destroy()})}};return c});
define('theme_osep/drag', ["jquery","theme_osep/autoscroll"],function(a,b){var c={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(a){a.preventDefault();var b;if(b="touchstart"===a.type?null===c.touching&&a.changedTouches.length>0:1===a.which){var d=c.getEventXY(a);return d.start=!0,d}return{start:!1}},start:function(a,d,e,f){var g=c.getEventXY(a);switch(c.initialX=g.x,c.initialY=g.y,c.initialPosition=d.offset(),c.dragProxy=d,c.onMove=e,c.onDrop=f,a.type){case"mousedown":c.addEventSpecial("mousemove",c.mouseMove),c.addEventSpecial("mouseup",c.mouseUp);break;case"touchstart":c.addEventSpecial("touchend",c.touchEnd),c.addEventSpecial("touchcancel",c.touchEnd),c.addEventSpecial("touchmove",c.touchMove),c.touching=a.changedTouches[0].identifier;break;default:throw"Unexpected event type: "+a.type}b.start(c.scroll)},addEventSpecial:function(a,b){try{window.addEventListener(a,b,c.eventCaptureOptions)}catch(d){c.eventCaptureOptions=!0,window.addEventListener(a,b,c.eventCaptureOptions)}},getEventXY:function(a){switch(a.type){case"touchstart":return{x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};case"mousedown":return{x:a.pageX,y:a.pageY};default:throw"Unexpected event type: "+a.type}},touchMove:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleMove(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseMove:function(a){c.handleMove(a.pageX,a.pageY)},handleMove:function(b,d){var e=c.dragProxy.offset(),f=e.top-parseInt(c.dragProxy.css("top")),g=e.left-parseInt(c.dragProxy.css("left")),h=a(document).height()-c.dragProxy.outerHeight()-f,i=a(document).width()-c.dragProxy.outerWidth()-g,j=-f,k=-g,l=c.initialPosition,m={top:Math.max(j,Math.min(h,l.top+(d-c.initialY)-f)),left:Math.max(k,Math.min(i,l.left+(b-c.initialX)-g))};c.dragProxy.css(m),c.onMove(b,d,c.dragProxy)},touchEnd:function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)a.changedTouches[b].identifier===c.touching&&c.handleEnd(a.changedTouches[b].pageX,a.changedTouches[b].pageY)},mouseUp:function(a){c.handleEnd(a.pageX,a.pageY)},handleEnd:function(a,d){null!==c.touching?(window.removeEventListener("touchend",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchcancel",c.touchEnd,c.eventCaptureOptions),window.removeEventListener("touchmove",c.touchMove,c.eventCaptureOptions),c.touching=null):(window.removeEventListener("mousemove",c.mouseMove,c.eventCaptureOptions),window.removeEventListener("mouseup",c.mouseUp,c.eventCaptureOptions)),b.stop(),c.onDrop(a,d,c.dragProxy),"notremove"!==c.dragProxy.data("statusondrop")&&c.dragProxy.remove()},scroll:function(b){var d=a(document).height()-c.dragProxy.outerHeight(),e=c.dragProxy.offset();e.top=Math.min(d,e.top+b),c.dragProxy.css(e)}};return c});
define('theme_osep/expandareas', ["jquery"],function(a){var b={selectors:{".block-region .block:not(.block_fake) .header":{search:".title div.block_action:visible",trigger:".title div.block_action:visible img:visible, .osep-showhide img:visible"},".block.block_osep_arealinklist .header":{search:".title div img",trigger:".title div:visible img:visible"},".block-region .block.block_fake .header":{search:".osep-showhide img:visible",trigger:".osep-showhide img:visible"},"body:not(.editing).osep-layoutcourse .oustudyplan-sectionupper":{search:".oustudyplan-expandcollapse a",trigger:".oustudyplan-expandcollapse a:visible"},".section .left.side":{search:"+ div + div .oustudyplan-expandcollapse a",trigger:"+ div + div .oustudyplan-expandcollapse a:visible"}}},c={init:function(){for(var a in b.selectors)b.selectors.hasOwnProperty(a)&&c.applyClickHandler(a,b.selectors[a])},applyClickHandler:function(b,d){a(b).filter(function(){return a(this).find(d.search).length>0}).addClass("osep-expandarea").on("click",{selector:d.trigger},c.handleClick)},handleClick:function(b){var c=a(b.target);if(c.hasClass("block-hider-hide")||c.hasClass("block-hider-show")||c.hasClass("iconhelp")||c.parents(".block-control-actions").length>0)return!0;var d=a(b.currentTarget).find(b.data.selector);d.length>0&&b.target!=d[0]&&d.click()}};return c});
define('theme_osep/fractionalheaderfix', ["jquery"],function(a){var b={count:20,setOffset:0,init:function(){if(document.getElementById("ou-header")){var c=a("<div>Test</div>");c.css("font-size","20.5px"),c.css("line-height",1),c.appendTo(document.body);var d="20.5px"===getComputedStyle(c[0]).height;if(c.remove(),d){b.setOffset=Number(a("#page").css("margin-top").replace(/px$/,""));var e=0;e=setInterval(function(){b.updatePageMargin(),b.count--,b.count<=0&&clearInterval(e)},250),a(window).on("resize",b.updatePageMargin)}}},updatePageMargin:function(){var a=Number(getComputedStyle(document.getElementById("ou-header")).height.replace(/px$/,"")),c=1-(a-parseInt(a));c>.99&&(c=0),b.setOffset!=c&&(document.getElementById("page").style.marginTop=c+"px",b.setOffset=c)}};return b});
define('theme_osep/inpagenav', ["jquery","theme_osep/responsive","core/url"],function(a,b,c){var d={initdone:!1,navgroups:[],keys:{up:38,down:40,tab:9}},e={init:function(){d.initdone||(d.navgroups=a(".osep-inpagenav"),b.addWidthListener(function(a,b){"mobile"===a?e.addMobileFeatures():"mobile"===b&&e.removeMobileFeatures()}),"mobile"===b.getWidthCategory()&&e.addMobileFeatures(),d.initdone=!0)},addMobileFeatures:function(){d.navgroups.each(function(){var b=a(this),c=b.find(".osep-inpagenavbutton");b.find("ul.nav").attr({role:"listbox","aria-activedescendant":b.find("li.selected").attr("id")}).hide(),b.find("ul.nav li").attr("role","option"),b.find("li.here > a").attr("href","#"),b.find("li.active > a").on("click",e.cancelEvent),b.find("li.selected > a").on("click",e.clickActive),b.find(".dropdown-toggle").removeAttr("aria-haspopup"),b.on("keydown",e.handleKeyNav),c.on("click",e.toggleMobileSelect),c.find(".currentlabel").text(b.find("li.selected > a > span").text()),c.removeAttr("disabled")})},removeMobileFeatures:function(){d.navgroups.each(function(){var b=a(this),d=b.find(".osep-inpagenavbutton");b.find("ul.nav").removeAttr("role").show(),b.find("ul.nav li").removeAttr("role"),b.find("li.here > a").removeAttr("href"),b.find("li.active > a").off("click",e.cancelEvent),b.find("li.selected > a").off("click",e.clickActive),b.find(".dropdown-toggle").attr({href:"#","aria-haspopup":"true"}),b.off("keydown",e.handleKeyNav),d.off("click",e.toggleMobileSelect),d.find(".smallicon").attr("src",c.imageUrl("t/switch_plus")),d.attr({disabled:"disabled","aria-expanded":"false"})})},toggleMobileSelect:function(b){var d=a(b.currentTarget),e=d.siblings(".osep-inpagenavrow");"none"===e.css("display")?(e.show(),d.find(".smallicon, .icon").attr("src",c.imageUrl("t/switch_minus")),d.attr("aria-expanded","true"),e.find("li.selected a")[0].focus()):(e.hide(),d.find(".smallicon, .icon").attr("src",c.imageUrl("t/switch_plus")),e.find("a.dropdown-toggle").parent().removeClass("open"),d.attr("aria-expanded","false"))},handleKeyNav:function(b){var c=a(b.target);switch(b.keyCode){case d.keys.down:if(b.preventDefault(),c.hasClass("osep-inpagenavbutton"))"false"===c.attr("aria-expanded")&&c.click(),a(c.siblings(".osep-inpagenavrow").find("li.selected a")[0]).focus();else{var f=e.findNextLink(c);f&&f.focus()}break;case d.keys.up:if(c.parent().hasClass("osep-inpagenavitem")){b.preventDefault();var g=e.findPrevLink(c);g&&g.focus()}break;case d.keys.tab:var h,i=c.parents(".osep-inpagenav");h=c.hasClass("osep-inpagenavbutton")?c:c.parents(".osep-inpagenav").find(".osep-inpagenavbutton"),"true"===h.attr("aria-expanded")&&h.click(),i.next().focus()}},findNextLink:function(b){for(var c=b.parents(".osep-inpagenav").find("li a"),d=!1,e=0;e<c.length;e++){if(d)return a(c[e]);c[e]===b[0]&&(d=!0)}return!1},findPrevLink:function(b){for(var c=b.parents(".osep-inpagenav").find("li a"),d=!1,e=c.length;e>=0;e--){if(d)return a(c[e]);c[e]===b[0]&&(d=!0)}return!1},clickActive:function(b){b.preventDefault(),a(b.target).parents(".osep-inpagenav").find(".osep-inpagenavbutton").click()},cancelEvent:function(){return!1}};return e});
define('theme_osep/oufeedback', ["jquery"],function(a){var b={dialogue:{},init:!1,done:!1},c={init:function(){b.init||(a("#osep-bottombutton-feedback-upper, #osep-bottombutton-feedback").each(function(){"undefined"!==a(this).attr("href")&&a(this).on("click",c.showFeedback)}),b.init=!0)},showFeedback:function(d){d.preventDefault();var e=a(this).attr("href")+"&inline=1";e+="&referer=",e+=encodeURIComponent(window.location.href),window.require(["theme_osep/dialogue"],function(a){if(b.done)b.dialogue.show(),b.dialogue.shouldResizeFullscreen()&&a.makeFullResponsiveHeight(b.dialogue);else{var d={headerContent:"",bodyContent:'<div class="oufeedback-iframe-wrap"><iframe src="'+e+'" id="oufeedback-iframe" tabindex="0"></iframe></div>',centered:!0,constrain:!0,focused:!0,modal:!0,extraClasses:["oufeedback-dialogue"],responsive:!0,draggable:!0,width:"90%",done:c.firstShow};a.makeDialogue(d,!0)}})},firstShow:function(a){b.dialogue=a,b.done=!0,b.dialogue.bodyNode.one("iframe").on("load",function(){var a=b.dialogue.bodyNode.one("iframe").getDOMNode(),c=a.contentWindow.Y,d=c.one(".box.oufeedback h2");d&&(b.dialogue.set("headerContent",d.get("innerHTML")),d.setStyle("display","none")),b.dialogue.show(),b.dialogue.shouldResizeFullscreen()&&window.require(["theme_osep/dialogue"],function(a){a.makeFullResponsiveHeight(b.dialogue)}),c.all("a").each(function(a){a.get("parentNode").hasClass("oufeedback_editlink")||a.set("target","_blank")});var e=c.one(".oufeedback #id_cancel");e&&e.on("click",function(a){a.preventDefault(),b.dialogue.hide()}),c.on("keydown",function(a){27===a.keyCode&&(a.preventDefault(),b.dialogue.hide())})})}};return c});
define('theme_osep/printing', ["jquery"],function(a){var b={hiddenClass:"printable-hidden",doPrint:function(){window.onbeforeprint=function(){b.toggleElementForPrint(!0)},window.onafterprint=function(){b.toggleElementForPrint(!1)},a("#print-preview-button a").on("click",function(a){a.preventDefault(),window.print()})},toggleElementForPrint:function(c){var d=a("div.printable-header");c?d.hasClass(b.hiddenClass)||d.addClass(b.hiddenClass):d.removeClass(b.hiddenClass)}};return b});
define('theme_osep/quiznav', ["jquery","theme_osep/responsive","theme_osep/leftblocks","theme_osep/scrollto"],function(a,b,c,d){var e,f={init:function(){e=a("#osep-sidecol #mod_quiz_navblock a.qnbutton.thispage"),b.addWidthListener(function(a,b){"mobile"===a?f.addMobileFeatures():"mobile"===b&&f.addDesktopFeatures()}),"mobile"===b.getWidthCategory()?f.addMobileFeatures():f.addDesktopFeatures()},addMobileFeatures:function(){e.off("click"),e.off("keypress"),e.on("click",f.scrollToQuestionMobile),e.on("keypress",function(a){13===a.which&&f.scrollToQuestionMobile(a)})},addDesktopFeatures:function(){e.off("click"),e.off("keypress"),e.on("click",f.scrollToQuestion),e.on("keypress",function(a){13===a.which&&f.scrollToQuestion(a)})},scrollToQuestion:function(b){b.preventDefault();var c,e,g=a(document).scrollTop(),h=g+a(window).innerHeight(),i=a(b.currentTarget.hash);i.length>0?(c=i.offset().top,e=c):(i=a("#responseform .que:first-of-type"),c=i.offset().top,e=0),(c<g||c>h)&&(M.util.js_pending("theme_osep/quiznav-scrollToQuestion"),d.scrollToElement(e,i.find(".info h3"),"theme_osep/quiznav-scrollToQuestion")),f.setState(b.currentTarget.hash)},scrollToQuestionMobile:function(b){b.preventDefault();var d=a(b.currentTarget.hash).find(".info h3");c.hideNav(d),f.setState(b.currentTarget.hash)},setState:function(a){var b;b=a.length>0?a:window.location.protocol+"//"+window.location.host+location.pathname+window.location.search,window.history.pushState(null,null,b)}};return f});
define('theme_osep/scrollto', ["jquery"],function(a){var b={scrollToElement:function(b,c,d){a("html,body").animate({scrollTop:b},250,function(){void 0!==c&&c.length>0&&(c.focus(),c.is(":focus")||(c.attr("tabIndex",-1),c.focus())),void 0!==d&&M.util.js_complete(d)})}};return b});
define('theme_osep/focusable', ["jquery"],function(a){function b(a){for(var b=a.css("visibility");"inherit"===b;)a=a.parent(),b=a.css("visibility");return"hidden"!==b}return a.ui=a.ui?a.ui:{},a.ui.focusable=function(c,d){var e,f,g,h,i,j=c.nodeName.toLowerCase();return"area"===j?(e=c.parentNode,f=e.name,!(!c.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap='#"+f+"']"),g.length>0&&g.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(j)?(h=!c.disabled,h&&(i=a(c).closest("fieldset")[0],i&&(h=!i.disabled))):h="a"===j?c.href||d:d,h&&a(c).is(":visible")&&b(a(c)))},a.extend(a.expr[":"],{focusable:function(b){return a.ui.focusable(b,null!=a.attr(b,"tabindex"))}}),a.ui.focusable});
define('theme_osep/layouthacks', ["jquery"],function(a){var b={gradeReportUserIndex:function(){if(document.getElementById("page-grade-report-user-index")){var b=a("#graded_users_selector"),c=b.nextAll("table").css("width","99%");a(c).wrap("<div style='width:99%; overflow-x:auto;'></div>")}},iphoneGroupsSupport:function(){if(navigator.userAgent.toLowerCase().indexOf("iphone")!=-1){var b=a('<optgroup label="">'),c=a("#groups");c.children("option").each(function(){var c=a("<option></option>");c.val(this.value),c.text(this.text),c.attr("title",this.text),b.append(c)}),c.empty(),c.append(b)}},handleAddTooltipToCellResult:function(){var a="table#user-grades";Y.all(a+" tbody tr").each(function(b){var c=b.one("th.header.user a.username");if(c){var d=c.getHTML();Y.all(a+" tbody th.item.highlightable.cell").each(function(a){var c="";a.getAttribute("class").split(" ").map(function(a){a.indexOf("i")!=-1&&(c=a)});var e=b.one("td.grade.cell."+c),f=a.one(".gradeitemheader");if(f){var g=d+", "+f.get("text");e.setAttribute("title",g)}})}})}};return b});
define('theme_osep/debugging', ["jquery"],function(a){var b={FADE_TIME:5e3,fadeAt:0,fading:!1,log:function(c){var d=a("#osep-debugging");b.fading&&(d.remove(),d=a("#osep-debugging")),d.length||(d=a('<div id="osep-debugging"></div>'),d.appendTo(document.body),d.css({position:"fixed",bottom:"10px",left:"10px",right:"10px",background:"black",color:"#00ff00",padding:"10px",zIndex:100,boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.5)",transition:"opacity 1s"})),d.children().remove();var e=a("<span></span>");d.append(e),e.append(document.createTextNode(c)),b.fadeAt||setTimeout(b.fadeOut,b.FADE_TIME),b.fadeAt=(new Date).getTime()+b.FADE_TIME},fadeOut:function(){var c=(new Date).getTime();if(c<b.fadeAt)return void setTimeout(b.fadeOut,b.fadeAt-c);var d=a("#osep-debugging");b.fading=!0,d.css("opacity",0),d.on("transitionend",function(){b.fading=!1,b.fadeAt=0,d.remove()})}};return b});
define('theme_osep/sentencelist', ["jquery"],function(a){var b={inited:!1,init:function(){b.inited||(b.inited=!0,a("body").on("click",".osep-sentencelist-showall > a",b.showall),a("body").on("click",".osep-sentencelist-hide > a",b.hide))},showall:function(b){b.preventDefault();var c=a(this).closest(".osep-sentencelist-showall");c.css("display","none"),c.next(".osep-sentencelist-extra").css("display","inline")},hide:function(b){b.preventDefault();var c=a(this).closest(".osep-sentencelist-extra");c.css("display","none"),c.prev(".osep-sentencelist-showall").css("display","inline")}};return b});
define('theme_osep/copybutton', ["jquery"],function(a){var b={init:function(b,c){var d=a(b),e=a(c);d.on("click",function(a){a.preventDefault(),e.select(),e[0].setSelectionRange(0,999);var b=!1;try{document.execCommand("copy")&&(b=!0)}catch(c){}!b&&window.clipboardData&&window.clipboardData.setData&&window.clipboardData.setData("text",e.prop("value"))&&(b=!0),b||window.alert(M.util.get_string("copy_failed_do_manually","theme_osep")),b&&setTimeout(function(){e[0].setSelectionRange(0,999),d.focus()},150)})}};return b});
define('theme_osep/oublog-accordion', ["jquery"],function(a){var b={container:null,containerClass:null,openClass:"oublog-accordion-open",closeClass:"oublog-accordion-closed",id:0,init:function(c,d){if(b.containerClass=c,b.container=a("ul.oublog-accordion-"+b.containerClass),b.container){var e=1,f=b.container.children("li");(!d||f.length<d)&&(d=1),f.each(function(){var c=a(this).find(".oublog_statsview_title h2"),f=a(this).find(".oublog_statsview_content"),g=b.getNextId(),h=b.getNextId();c.attr("id",g),c.attr("aria-controls",h),c.attr("tabindex",0),f.attr("id",h),f.attr("aria-labelledby",g),f.attr("aria-live","polite"),a(this).data("state",1),d!=e?b.closeTab(a(this)):(f.addClass("oublog-accordion-open"),a(this).addClass("oublog-accordion-open")),c.on("click keypress",function(c){(!c.keyCode||c.keyCode&&13==c.keyCode)&&(1==a(this).closest("li").data("state")?b.closeTab(a(this)):b.openTab(a(this)),c.preventDefault(),c.stopPropagation())}),a(this).data("number",e++)})}},closeTab:function(a){var c=a.closest("li");c.removeClass(b.openClass).addClass(b.closeClass);var d=c.find(".oublog_statsview_content");d.removeClass(b.openClass).addClass(b.closeClass),c.data("state",0)},openTab:function(c){var d=b.container.children("li.oublog-accordion-open");d.each(function(){b.closeTab(a(this))});var e=c.closest("li");e.removeClass(b.closeClass).addClass(b.openClass);var f=e.find(".oublog_statsview_content");f.removeClass(b.closeClass).addClass(b.openClass),e.data("state",1),a("body").hasClass("notloggedin")||M.util.set_user_preference("oublog_accordion_"+b.containerClass+"_open",e.data("number"))},getNextId:function(){return"oublog_accordion_"+b.id++}};return b});
define('theme_osep/scrollindicator', ["jquery"],function(a){var b={DIR_LEFT:"left",DIR_RIGHT:"right",STICKY_LEFT:"osep-table-cell-sticky",ELEMENTS:[{name:"pre",allowIE:!1},{name:".osep-add-scrollindicator",allowIE:!1},{name:".quizattemptsummary",allowIE:!1},{name:".backup-files-table",allowIE:!1},{name:".forumng-discussionlist",allowIE:!1},{name:".oustudyplan_forumtable",allowIE:!1},{name:".oucontent-computerdisplay",allowIE:!1},{name:".oucontent-download-list .generaltable",allowIE:!1},{name:".ouw_history .generaltable",allowIE:!1},{name:".path-admin-roles table.rolecap",allowIE:!0},{name:".que .history table.generaltable",allowIE:!0},{name:"#workshop-viewlet-gradereport_inner .grading-report",allowIE:!1},{name:"#report-oucontentrange-course .generaltable",allowIE:!0,hsticky:[".c0"]},{name:"#page-mod-dataplus-manage .generaltable",allowIE:!1},{name:"#page-table-participation-index .reporttable",allowIE:!1},{name:"#page-report-outline-index #outlinetable",allowIE:!1},{name:"#page-mod-quiz-report #questionstograde",allowIE:!1},{name:"#page-mod-quiz-report table#attempts",allowIE:!0,hsticky:[".c0"],vsticky:!0,allowTooltip:!0,hideMobile:!0},{name:"#page-mod-quiz-report table#responses",allowIE:!0,hsticky:[".c0"],vsticky:!0,allowTooltip:!0},{name:"#page-admin-report-oualerts-manage #osep-maincol table",allowIE:!1},{name:"#page-mod-ouwiki-wikihistory #ouwiki_belowtabs .generaltable",allowIE:!1},{name:"#page-mod-useroptions-userselections #osep-maincol .generaltable",allowIE:!1},{name:"#page-mod-certificate-report #osep-maincol .generaltable",allowIE:!0},{name:"#block-workflow-overview .boxaligncenter",allowIE:!1},{name:".report_tracking",allowIE:!1},{name:".path-mod-questionnaire .generaltable",allowIE:!1},{name:".que.coderunner table.coderunner-test-results",allowIE:!1},{name:".que.coderunner table.coderunnerexamples",allowIE:!1},{name:"#page-admin-report-configlog-index #configchanges",allowIE:!1},{name:"#page-admin-report-customsql-index .generaltable",allowIE:!1},{name:"#page-admin-report-stats-index .generaltable",allowIE:!1},{name:"#page-admin-tool-filetypes-index .generaltable",allowIE:!1},{name:"#page-admin-tool-task-scheduledtasks .generaltable",allowIE:!1},{name:"#page-admin-tool-xmldb-index .generaltable",allowIE:!1},{name:"#page-admin-plugins #plugins-control-panel",allowIE:!1},{name:"#page-admin-filters #filterssetting",allowIE:!1},{name:"#page-mod-studentquiz-view #categoryquestions",allowIE:!1},{name:"#page-admin-tool-dataprivacy-purposes .generaltable",allowIE:!1}],WRAPPED_ELEMENTS:[{name:".gradingsummarytable",allowIE:!1},{name:".submissionstatustable",allowIE:!1},{name:".oustudyplan-tablewrapper",allowIE:!1},{name:".oucontent-table-wrapper",allowIE:!1},{name:".oucontent-sidenote-inner",allowIE:!1},{name:"body.path-mod-oucontent .oucontent-equation",allowIE:!1},{name:".portfolioact_responsive_div",allowIE:!1},{name:".gradingtable .no-overflow",allowIE:!0,hsticky:[".c0",".c2"]},{name:"#page-mod-quiz-report.pagelayout-report #attemptsform .no-overflow",allowIE:!0},{name:"body.pagelayout-report:not(.osep-widecontent) .no-overflow",allowIE:!1},{name:".path-mod-questionnaire .no-overflow",allowIE:!1},{name:"#ouwiki_belowtabs .no-overflow",allowIE:!1},{name:"#page-mod-oublog-participation .no-overflow",allowIE:!1},{name:"#page-report-participation-index .no-overflow",allowIE:!1},{name:"#page-mod-bookingsystem-history .no-overflow",allowIE:!1},{name:"#page-question-edit .categoryquestionscontainer",allowIE:!1}],scrollContainers:null,widthScrollbar:null,init:function(){b.preprocessFindNonInlineEquations(),b.addTooltipToCellResult(),b.widthScrollbar=b.getWidthScrollbar(),setTimeout(b.createIndicators,0)},preprocessFindNonInlineEquations:function(){a("body:not(.path-mod-oucontent) .filter_oumaths_equation").filter(b.isOnlyChildOfBlock).addClass("osep-add-scrollindicator")},isOnlyChildOfBlock:function(b,c){var d=a(c).parent(),e=d[0];if("inline"===d.css("display"))return!1;for(var f=!1,g=e.firstChild;null!==g;g=g.nextSibling){switch(g.nodeType){case 1:g!==c&&(f=!0);break;case 3:case 4:""!==g.nodeValue.trim()&&(f=!0);break;case 8:}if(f)break}return!f},addTooltipToCellResult:function(){var c=b.ELEMENTS;c=c.filter(function(a){return"undefined"!=typeof a.allowTooltip&&a.allowTooltip}),c.forEach(function(b){a(b.name+" tbody tr").each(function(c,d){if("#page-mod-quiz-report table#attempts"==b.name){var e=a(d).find("td.cell.bold a[href*='user/view.php']").html();if(!e)return;a(b.name+' a[href*="sort=qsgrade"]').each(function(b,c){var f=a(c).parent().attr("class");f=f.replace("header","cell");var g=a(d).find('td[class="'+f+'"]'),h=b+1,i=e+", Q."+h;g.attr("title",i)})}if("#page-mod-quiz-report table#responses"==b.name){var e=a(d).find("td.cell.bold a[href*='user/view.php']").html();if(!e)return;a(b.name+' a[href*="tsort=response"],[href*="tsort=right"],[href*="tsort=question"]').each(function(b,c){var f=a(c).clone();f.find("span").remove();var g=a(c).parent().attr("class");g=g.replace("header","cell");var h=a(d).find('td[class="'+g+'"]'),i=e+", "+f.text();h.attr("title",i)})}})})},responsiveTableSticky:function(){b.changeHeightCellStickies();var c=b.ELEMENTS;c=c.filter(function(a){return"undefined"!=typeof a.vsticky&&a.vsticky}),c.forEach(function(c){var d=a(c.name).parents(".osep-scrollparent").last();if(0!=d.length){var e=a(".osep-scrollparent-sticky-body"),f=a(".osep-scrollparent-sticky-head"),g=a(".osep-scrollparent-sticky-scrollbar"),h=b.widthScrollbar,i=e.find("table").width();f.find("table").width(i).css("max-width",i),g.find("table").width(i+h).css("max-width",i+h),g.width(e.width()),f.find(".osep-canscrollright").css("right",h),f.find(".osep-scrollparent").css("padding-right",h);var j=g.outerHeight()+f.outerHeight()+e.outerHeight();d.css("max-height",j)}})},changeHeightCellStickies:function(){var c=a("."+b.STICKY_LEFT);c.each(function(b,c){var d=a(c);if(!d.is(":visible"))return!0;var e=d.parent("tr"),f=e.outerHeight(),g=parseFloat(d.css("border-bottom-width"),10),h=parseFloat(d.css("border-top-width"),10),i=parseFloat(d.css("padding-bottom"),10),j=parseFloat(d.css("padding-top"),10);if(d.outerHeight()!=e.outerHeight()){var k=j+i+g+h;d.height(parseFloat(f)-k)}})},createSticky:function(){var c=b.ELEMENTS,d=b.WRAPPED_ELEMENTS;c=c.filter(function(a){return"undefined"!=typeof a.hsticky&&a.hsticky}),d=d.filter(function(a){return"undefined"!=typeof a.hsticky&&a.hsticky});for(var e=c.concat(d),f=0,g=e.length;f<g;f++)if(!a("body").hasClass("ie")||e[f].allowIE!==!1){var h=a(e[f].name).first();h.length&&!h.is("table")&&(h=h.find("table").first()),h.length&&(".gradingtable .no-overflow"===e[f].name&&(e[f].hsticky=b.fixupAssignment(h,e[f].hsticky)),"#page-mod-quiz-report table#attempts"!==e[f].name&&"#page-mod-quiz-report table#responses"!==e[f].name||(e[f].hsticky=b.getStickyColumnsForQuizReport(h,e[f].hsticky)),b.initHorizontalSticky(h,e[f].hsticky))}},getWidthScrollbar:function(){var a=document.createElement("div");a.style.visibility="hidden",a.style.width="100px",a.style.msOverflowStyle="scrollbar",document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var c=document.createElement("div");c.style.width="100%",a.appendChild(c);var d=c.offsetWidth;return a.parentNode.removeChild(a),b-d},initVerticalSticky:function(){var c=b.ELEMENTS;c=c.filter(function(a){return"undefined"!=typeof a.vsticky&&a.vsticky}),c.forEach(function(c){var d=a(c.name).parents(".no-overflow");if(0!=d.length){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),f=d.height(),g=d.find(".osep-scrollcontainer").first(),h=d.find("table").width(),i=g.find("thead").outerHeight();e&&(d.find("table").css("display","table-cell"),h=d.find("table").width(),d.find("table").css("display","table"),f-=i),0==d.find(".osep-scrollcontainer .osep-scrollparent").length&&(d.addClass("osep-scrollparent"),g=d.find(".osep-scrollparent").first(),g=a('<div class="osep-scrollcontainer"></div>').html(g));var j=g.clone(!0),k=g.clone(!0),l=b.widthScrollbar,m=g.find(".osep-scrollcontainer").last();if(g.find("table").css("margin-top",0).css("margin-bottom",0).width(h).css("max-width",h),g.addClass("osep-scrollparent-sticky-body"),g.find("thead").css("visibility","collapse"),m.css("overflow","hidden"),(a("body").hasClass("android")||a("body").hasClass("ios"))&&m.css("overflow-x","scroll"),a("body").hasClass("ios")){var n,o,p,q=!1;g.find(".osep-scrollparent").first().on("touchstart",function(b){n=b.originalEvent.touches[0].clientY,o=b.originalEvent.touches[0].clientX,p=a(this).scrollLeft()}),g.find(".osep-scrollparent").first().on("touchmove",function(b){var c=b.originalEvent.touches[0].clientY,d=b.originalEvent.touches[0].clientX,e=10;d<=o+e&&d>=o-e&&!q?(m.css("overflow-x","hidden"),m.css("overflow-y","scroll"),a(this).scrollLeft(p),q=!0):c<=n+e&&c>=n-e&&(m.css("overflow-y","hidden"),m.css("overflow-x","scroll"),q=!1),n=c,o=d})}var r=g.find("table").outerHeight();e&&(r-=i),g.find(".osep-scrollparent").first().css("overflow-y","scroll").css("max-height",f).scroll(function(){a(".osep-showing").height(r)}),d.prepend(g),k.css("padding-bottom",0).css("overflow-y","hidden");var s=g.find("tbody").outerHeight();e&&(g.css("margin-top",-s),g.find("table").css("margin-top",-i)),k.find("tbody").css("visibility","collapse"),k.addClass("osep-scrollparent-sticky-head"),k.find(".osep-canscrollright").css("right",l),k.find(".osep-scrollparent").css("padding-right",l),k.find(".osep-scrollcontainer").last().css("padding-bottom",0).css("overflow","hidden"),k.find("table thead tr:first > *").each(function(c,d){var e=a(d),f=g.find("tbody tr:first td.cell.c"+c);e.hasClass(b.STICKY_LEFT)||f.each(function(b,c){return c=a(c),!c.is(":visible")||void("&nbsp;"==c.html()&&c.css("padding-left",10).css("padding-right",10))})}),d.prepend(k),j.find("table tbody , table thead").remove(),j.find("table").width(h).css("max-width",h).height(1).css("margin-top",0).css("margin-bottom",0);var t=k.find(".osep-scrollcontainer").last(),u=g.find(".osep-scrollcontainer").last(),v=j.find(".osep-scrollcontainer").last();v.on("scroll",function(){var b=a(this).scrollLeft();t.last().scrollLeft(b),u.scrollLeft(b),a(".osep-showing").height(r)}),u.on("scroll",function(){var b=a(this).scrollLeft();t.scrollLeft(b),a(".osep-showing").height(r)}),j.addClass("osep-scrollparent-sticky-scrollbar").css("overflow-y","hidden").width(g.width()),d.append(j),j.find(".osep-scrollcontainer").last().addClass("osep-scrollbar-active"),k.find("table").width(h).css("max-width",h).css("margin-bottom",0).css("padding-bottom",0).css("margin-top",0);var w=j.outerHeight()+k.find("thead").outerHeight();w+=g.outerHeight(),d.css("overflow","hidden").css("max-height",w),b.changeHeightCellStickies()}})},initHorizontalSticky:function(c,d){var e,f=0,g=0,h=[],i=[],j=[];if(M.util.js_pending("theme_osep/oucontentscrollindicator-initHorizontalSticky"),c.parents(".gradingtable").length){var k="9";if(c.find("th.c0 input[type=checkbox]").length||(k=7),c.find("td.c"+k+" img").length&&!c.find("div.ygtvitem").length)return void setTimeout(function(){b.initHorizontalSticky(c,d)},500)}c.css("border-collapse","separate"),a.each(d,function(b,d){var k=0;g=parseInt(c.css("margin-top"),10),e=c.find(d),e.length&&e.each(function(b,c){if(c=a(c),!c.is(":visible"))return!0;var d=0;c.get(0).clientHeight>c.innerHeight()&&(d=c.get(0).clientHeight-c.innerHeight()),h.push({width:c.width(),height:Math.round(c.height())+d,pos:c.position()}),c.outerWidth()>k&&(k=c.outerWidth()),j.push(g),g+=c.get(0).getBoundingClientRect().height+d}),i.push(f),f+=k});var l=0,m=0;a.each(d,function(d,f){e=c.find(f),e.length&&(c.find("tbody tr:first").length>=1&&(m+=a(e.get(1)).outerWidth()),e.each(function(c,e){if(e=a(e),!e.is(":visible"))return!0;e.addClass(b.STICKY_LEFT),e.width(h[l].width),e.height(h[l].height);var f=e.nextAll("th, td").filter(":visible").first();f.length&&f.height(h[l].height),e.css("left",i[d]+"px"),l++}))});var n=a(".tabledivider");if(m>0&&n.length>0){var o=n.parent("td"),p=o.css("border-bottom-width"),q=o.outerHeight()-parseInt(p,10),r='<td class="cell '+b.STICKY_LEFT+'" style="left: 0px;"></td>';r=a(r).height(q).width(m),r.css("padding",0).css("max-width",m),o.before(r)}if(e.length&&(c.css("margin-left",function(a,b){return parseInt(b,10)+f+"px"}),c.parent(".osep-scrollcontainer").css("max-height","none"),c.parents(".gradingtable").length)){var s=function(b,c){"undefined"!=typeof c&&a(c).length&&setTimeout(function(){s(b,c)},250);var e=a(b),f=e.parents("td.c10").first(),g=f.find("textarea[name=content]");(f.find(".commentscontainer .mdl-align > img").length||g.length&&"none"!==g.css("background-image"))&&setTimeout(function(){s(b)},250);var h=e.parents("tr").first();h.length&&a.each(d,function(a,b){h.find(b).height(f.height())}),f.find(".comment-delete a").click(function(){var b=a(this),c=a(this).parents("div.comment-ctrl").first();setTimeout(function(){s(c,"#"+a(b).parents("li").first().attr("id"))},1e3)})};c.find("a.comment-link, div.comment-ctrl .fd a").click(function(){var a=this;setTimeout(function(){s(a)},250)})}var t=a("."+b.STICKY_LEFT+d[d.length-1]),u=a("table.flexible.generaltable td").last().css("border-bottom-width"),v=a("table.flexible.generaltable td").last().css("border-bottom-color"),w=a("table.flexible.generaltable td").last().css("border-bottom-style");t.css("border-right-width",u),t.css("border-right-color",v),t.css("border-right-style",w),M.util.js_complete("theme_osep/oucontentscrollindicator-initHorizontalSticky")},fixupAssignment:function(a,b){return a.find("th.c0 input[type=checkbox]").length||(b=[".c1"],a.find("th.c0, td.c0").hide(),a.find("th.c1, td.c1").show()),b},getStickyColumnsForQuizReport:function(b,c){var d=b.find("th.header").slice(0,8);return d.each(function(e){var f=a(d[e]),g=f.attr("class"),h=g.match(/\sc\d\s*/g),i=null;h&&(i=h[0].replace(/^\s+|\s+$/g,""));var j=f.find(">a").attr("href");j.indexOf("sort=firstname")===-1&&j.indexOf("sort=lastname")===-1&&j.indexOf("sort=username")===-1&&j.indexOf("sort=idnumber")===-1||null!==i&&c.indexOf("."+i)===-1&&c.push("."+i),j.indexOf("sort=email")!==-1&&null!==i&&(b.find("th."+i).hide(),b.find("td."+i).hide())}),c},createIndicators:function(){b.createSticky();var c=b.ELEMENTS,d=b.WRAPPED_ELEMENTS;if(a("body").hasClass("ie")&&(c=c.filter(function(a){return"undefined"!=typeof a.allowIE&&a.allowIE}),d=d.filter(function(a){return"undefined"!=typeof a.allowIE&&a.allowIE})),c=a(c.map(function(a){return a.name}).join(", ")),d=a(d.map(function(a){return a.name}).join(", ")),0!==c.length||0!==d.length){c.length>0&&c.wrap('<div class="osep-scrollparent"></div>');var e=a(".osep-scrollparent");d.length>0&&d.addClass("osep-scrollparent"),d=d.add(e),d.length>0&&(d.wrapInner('<div class="osep-scrollcontainer"></div>'),b.scrollContainers=d.children(),b.checkAllIndicators(),a(b.scrollContainers).scroll(b.scrollHandler),a(window).resize(function(){M.util.js_pending("theme_osep/oucontentscrollindicator-resizeHandler"),b.checkAllIndicators()})),b.initVerticalSticky(),a(window).on("resize",b.responsiveTableSticky)}},scrollHandler:function(a){var c=a.target;b.checkIndicator(c)},checkAllIndicators:function(){b.scrollContainers.each(function(){b.checkIndicator(this)}),M.util.js_complete("theme_osep/oucontentscrollindicator-resizeHandler")},checkIndicator:function(c){var d=!1,e=!1;c.scrollWidth>c.clientWidth+1?(a(c).attr("tabindex",0),0===c.scrollLeft?e=!0:c.scrollLeft+c.clientWidth>=c.scrollWidth-1?d=!0:(d=!0,e=!0)):a(c).removeAttr("tabindex");var f=a(c),g=f.find(".osep-canscrollleft.osep-showing"),h=f.find(".osep-canscrollright.osep-showing");d&&0===g.length?b.showIndicator(f,b.DIR_LEFT):d||0===g.length||g.removeClass("osep-showing"),e&&0===h.length?b.showIndicator(f,b.DIR_RIGHT):e||0===h.length||h.removeClass("osep-showing")},showIndicator:function(b,c){var d=b.find(".osep-canscroll"+c);d.length||(d=a('<div class="osep-canscroll'+c+'"></div>'),d.prependTo(b)),d.addClass("osep-showing")}};return b});
define('theme_osep/drag_reorder', ["jquery","core/modal_factory","core/modal_events","theme_osep/drag"],function(a,b,c,d){return function(e){var f=null,g=null,h=null,i=null,j=null,k=null,l=function(b,c){f={time:(new Date).getTime(),x:c.x,y:c.y},h=a(b.currentTarget).closest(e.itemInPage),"undefined"!=typeof e.reorderStart&&e.reorderStart(h.closest(e.list),h),g=u(),j=a(e.proxyHtml.replace("%%ITEM_HTML%%",h.html()).replace("%%ITEM_CLASS_NAME%%",h.attr("class"))),a(document.body).append(j),j.css(h.offset()),j.width(h.outerWidth()),j.height(h.outerHeight()),h.addClass(e.itemMovingClass),d.start(b,j,m,o)},m=function(){var b=h.closest(e.list),c=null,d=null;b.find(e.item).each(function(b,e){var f=t(e,j);(null===c||f<d)&&(c=a(e),d=f)}),c[0]!==h[0]&&(s(j)<s(c)?h.insertBefore(c):h.insertAfter(c))},n=function(a,b){var c=[];return a.split(",").forEach(function(a){b.split(",").forEach(function(b){c.push(a.trim()+" "+b.trim())})}),c.join(", ")},o=function(a,b){"undefined"!=typeof e.reorderEnd&&e.reorderEnd(h.closest(e.list),h);var c=u();w(g,c)?(new Date).getTime()-f.time<500&&Math.abs(f.x-a)<10&&Math.abs(f.y-b)<10&&p({currentTarget:h[0]}):e.reorderDone(h.closest(e.list),h,c),j.remove(),j=null,h.removeClass(e.itemMovingClass),h=null,f=null},p=function(d){i=a(d.currentTarget).closest(e.itemInPage),g=u(),"undefined"!=typeof e.reorderStart&&e.reorderStart(i.closest(e.list),i);var f='<ul class="dragdrop-keyboard">',h=null;a(i.closest(e.list).find(e.item)).each(function(b,c){0===a(c).find(e.handle).length?f+='<li><a href="#" data-direction="before" data-id="'+e.idGetter(c)+'">'+M.util.get_string("dragorderintox","theme_osep",x(e.nameGetter(c)))+"</a></li>":(null!==h&&a(c).prev()[0]===h||i[0]!==c&&i.next()[0]!==c&&(f+='<li><a href="#" data-direction="before" data-id="'+e.idGetter(c)+'">'+M.util.get_string("dragorderbeforex","theme_osep",x(e.nameGetter(c)))+"</a></li>"),i.prev()[0]!==c&&i[0]!==c&&(f+='<li><a href="#" data-direction="after" data-id="'+e.idGetter(c)+'">'+M.util.get_string("dragorderafterx","theme_osep",x(e.nameGetter(c)))+"</a></li>")),h=c}),f+="</ul>",b.create({title:M.util.get_string("dragordermovex","theme_osep",x(e.nameGetter(i[0]))),body:f}).done(function(a){k=a,a.show(),a.getRoot().on(c.hidden,function(){a.destroy(),null!==i&&"undefined"!=typeof e.reorderEnd&&e.reorderEnd(i.closest(e.list),i)})})},q=function(b){if(null!==i){var c=a(b.currentTarget),d=v(c.data("id"));"before"===c.data("direction")?i.insertBefore(d):"after"===c.data("direction")&&i.insertAfter(d),"undefined"!=typeof e.reorderEnd&&e.reorderEnd(i.closest(e.list),i);var f=u();w(g,f)||e.reorderDone(i.closest(e.list),i,f),i=null,k.hide()}},r=function(a){return a.offset().left+a.outerWidth()/2},s=function(a){return a.offset().top+a.outerHeight()/2},t=function(b,c){var d=a(b),e=a(c),f=r(d)-r(e),g=s(d)-s(e);return Math.sqrt(f*f+g*g)},u=function(){return(h||i).closest(e.list).find(e.item).map(function(a,b){return e.idGetter(b)}).get()},v=function(a){var b=null;return(h||i).closest(e.list).find(e.item).each(function(c,d){e.idGetter(d)===a&&(b=d)}),b},w=function(a,b){return a.length===b.length&&a.every(function(a,c){return a===b[c]})},x=function(b){return a("<div />").text(b).html()};e.itemInPage=n(e.list,e.item),e.handleInList=n(e.item,e.handle),a(e.list).on("mousedown touchstart",e.handleInList,function(a){var b=d.prepare(a);b.start&&l(a,b)}),a(e.list).on("click",e.handleInList,function(a){a.preventDefault(),p(a)}),a(document.body).on("click","ul.dragdrop-keyboard a",function(a){a.preventDefault(),q(a)})}});
define('theme_osep/imagecopyright', ["jquery","theme_osep/dialogue"],function(a,b){"use strict";var c={dialogue:null,started:!1,editing:!1,title:null,content:null,oldtext:null,newtext:null},d={init:function(){var b=a(".osep-bannercopyright").data();c.title=b.title,c.content=b.content,0===c.content.search("<span")&&(c.editing=!0,c.oldtext=a(c.content).data().value,c.newtext=c.oldtext),a(".osep-bannercopyright").on("click",d.showdialogue)},showdialogue:function(d){if(d.preventDefault(),c.started)c.dialogue.show();else{var e={headerContent:c.title,bodyContent:c.content,centered:!0,constrain:!0,focused:!0,modal:!0,responsive:!0,draggable:!0,width:"350px",focusOnShowSelector:"button",done:function(b){c.dialogue=b,c.started=!0,b.show(),c.editing&&b.on("visibleChange",function(){b.visible||(c.newtext=b.bodyNode._node.innerText.trim(),c.oldtext!==c.newtext&&(c.content=c.content.replace(c.oldtext,c.newtext)),a(".osep-bannercopyright").data("content",c.content))})}};b.makeDialogue(e,!0)}}};return d});
define('theme_osep/bookmarks', ["jquery","core/ajax","core/str","core/modal_factory","core/templates"],function(a,b,c,d,e){var f={bElement:null,bNavigate:null,bDialog:null,bDialogInput:null,bDialogClear:null,bDialogSave:null,bDialogDelete:null,bDialogTitle:null,bId:null,bTitle:null,langStrings:[],init:function(){var b=this;if(b.bElement=a("#bookmarks-element"),b.bNavigate=a("#bookmarks-navigate"),b.bDialog=a("#bookmarks-dialog"),b.bDialogInput=b.bDialog.find("#title"),b.bDialogClear=b.bDialog.find("#clear"),b.bDialogSave=b.bDialog.find("#save"),b.bDialogDelete=b.bDialog.find("#delete"),b.bDialogTitle=b.bDialog.find(".modal-title"),b.bId=parseInt(b.bElement.attr("data-bookmarks-id")),b.bTitle=b.bElement.attr("data-bookmarks-title"),c.get_strings([{key:"error",component:"core"},{key:"saveforlater",component:"theme_osep"},{key:"savedforlater",component:"theme_osep"}]).done(function(a){b.langStrings.error=a[0],b.langStrings.saveforlater=a[1],b.langStrings.savedforlater=a[2]}),window.performance&&window.performance.navigation.type===window.performance.navigation.TYPE_BACK_FORWARD){var d=b.getUrlParam("id");M.util.js_pending("get_bookmarks_by_cmid"),b.getBookmarksByCm(d,function(c){var d=b.getUrlParam("section");b.bId=0,a.each(c,function(a,c){var e=JSON.parse(c.params);if(d===e.sectionid)return b.bId=c.id,!1}),b.bId?b.bElement.addClass("fill"):(b.bElement.removeClass("fill"),a(".bookmarks .bookmark.current").remove()),b.bElement.show(),M.util.js_complete("get_bookmarks_by_cmid")})}else b.bElement.show();b.bindEvent()},bindEvent:function(){var b=this,c=function(c){c.preventDefault();var d=null;d="0"!==b.bTitle&&""!==b.bTitle?b.bTitle:a('h1[class*="oucontent-title"]').text(),d=b.titleValidator(d),0===b.bId?(b.bElement.addClass("fill"),b.updateDialog(d,0)):b.updateDialog(d,1),b.showBookmarkDialog()};b.bElement.click(c),b.bElement.on("keypress",function(a){13===a.keyCode&&c(a)}),b.bDialog.find('button[data-action="hide"]').click(function(){0===b.bId&&b.bElement.removeClass("fill"),b.hideDialog()}),b.bDialogInput.on("keyup",function(){""===a(this).val()?(b.bDialogSave.attr("disabled",!0),b.bDialogClear.attr("disabled",!0)):(b.bDialogSave.removeAttr("disabled"),b.bDialogClear.removeAttr("disabled"))}),b.bDialogSave.click(function(){var c=b.bDialogInput.val();if(0===b.bId){var d=b.getUrlParam("id"),f="oucontent",g=JSON.stringify({sectionid:b.getUrlParam("section")});M.util.js_pending("create_bookmark"),b.addBookmarks(d,c,f,g,function(c){b.bTitle=c.title,b.bId=c.id,b.bElement.prop("title",b.langStrings.savedforlater),e.render("theme_osep/savedforlater_item",{id:c.id,title:c.title,url:c.url,current:!0}).done(function(b){M.util.js_complete("create_bookmark"),a("#bookmarks-navigate").find(".bookmarks").prepend(b)}),b.hideDialog()})}else M.util.js_pending("update_bookmark"),b.updateBookmarks(b.bId,c,function(){b.bTitle=c,a("#bookmarks-navigate").find("a[data-bookmark-id="+b.bId+"] span.text").html(c),b.hideDialog(),M.util.js_complete("update_bookmark")})}),b.bDialogDelete.click(function(){M.util.js_pending("delete_bookmark"),b.deleteBookmarks(b.bId,function(){a("#bookmarks-navigate").find("a[data-bookmark-id="+b.bId+"]").remove(),b.bId=0,b.bTitle="",b.bElement.prop("title",b.langStrings.saveforlater),b.bElement.removeClass("fill"),b.hideDialog(),M.util.js_complete("update_bookmark")})}),b.bDialogClear.click(function(){b.bDialogInput.val(""),b.bDialogInput.trigger("keyup")})},showBookmarkDialog:function(){var a=this,b=a.langStrings.savedforlater;0===a.bId&&(b=a.langStrings.saveforlater),a.bDialogTitle.html(b),a.bDialog.show(),a.bDialogInput.focus()},hideDialog:function(){var a=this;a.bDialog.hide(),a.bElement.focus()},addBookmarks:function(a,c,d,e,f){var g=this;b.call([{methodname:"local_bookmarks_external_add_bookmark",args:{cmid:a,title:c,component:d,params:e},done:function(a){f(a)},fail:function(a){M.util.js_complete("add_bookmark"),g.showError(a.message)}}])},updateBookmarks:function(a,c,d){var e=this;b.call([{methodname:"local_bookmarks_external_update_bookmark_title",args:{id:a,title:c},done:function(a){d(a)},fail:function(a){M.util.js_complete("update_bookmark"),e.showError(a.message)}}])},deleteBookmarks:function(a,c){var d=this;b.call([{methodname:"local_bookmarks_external_delete_bookmark",args:{id:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("delete_bookmark"),d.showError(a.message)}}])},getBookmarksByCm:function(a,c){var d=this;b.call([{methodname:"local_bookmarks_external_get_bookmarks_by_cm",args:{cmid:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("get_bookmarks_by_cmid"),d.showError(a.message)}}])},updateDialog:function(a,b){var c=this;b?1===b&&(c.bDialogClear.hide(),c.bDialogDelete.show()):(c.bDialogClear.show(),c.bDialogDelete.hide()),c.bDialogInput.val(a),c.bDialogInput.trigger("keyup")},showError:function(a){var b=this;b.showDialog(b.langStrings.error,a)},showDialog:function(a,b){var c=this;c.dialogue?(c.dialogue.title.html(a),c.dialogue.body.html(b),c.dialogue.show()):d.create({type:d.types.DEFAULT,title:a,body:b}).done(function(a){c.dialogue=a,c.dialogue.show()})},getUrlParam:function(a){return(window.location.search.split(a+"=")[1]||"").split("&")[0]},titleValidator:function(a){var b=a.length;return b>100&&(a=a.substring(0,96)+"..."),a}};return f});
define('theme_osep/oucontentbookmarks', ["jquery"],function(a){var b={dialogue:{}},c={init:function(){var d=a(".bookmarks-navigate-container");d.length>0&&window.require(["theme_osep/dialogue"],function(e){var f={headerContent:d.find("h2").detach().html(),bodyContent:d.html(),centered:!0,modal:!0,visibile:!1,extraClasses:["oucontent-bookmarksbox"],width:"60%",done:function(a){b.dialogue=a}};e.makeDialogue(f),d.remove(),a("#osep-bottombutton-bookmarks").on("click",c.showBookmarks)})},showBookmarks:function(a){a.preventDefault(),b.dialogue.show(),window.scrollBy(0,1),window.scrollBy(0,-1)}};return c});
define('theme_osep/defaultdescription', [],function(){var a={init:function(){var a=document.getElementById("id_showdescription");a.checked===!1&&(a.checked=!0)}};return a});
define('theme_osep/overridebookmarkbutton', ["jquery"],function(a){var b={dialogue:{}},c={init:function(){var d=a(".bookmarks-navigate-container");d.length>0&&window.require(["theme_osep/dialogue"],function(e){var f={headerContent:d.find("h2").detach().html(),bodyContent:d.html(),centered:!0,modal:!0,visibile:!1,extraClasses:["bookmarksbox"],width:"60%",done:function(a){b.dialogue=a}};e.makeDialogue(f),d.remove(),a("#osep-bottombutton-bookmarks").on("click",c.showBookmarks)})},showBookmarks:function(a){a.preventDefault(),b.dialogue.show(),window.scrollBy(0,1),window.scrollBy(0,-1)}};return c});
define('atto_embedquestion/dialogue_manager', ["jquery","core/notification","core/fragment","core/templates","core/ajax"],function(a,b,c,d,e){"use strict";function f(f){function g(b,c,e){var f=a.Deferred();return b.fadeOut("fast",function(){d.replaceNodeContents(b,c,e),b.fadeIn("fast",function(){f.resolve(),a("#embedqform #id_submitbutton").on("click",h)})}),f.promise()}function h(b){b.preventDefault(),e.call([{methodname:"filter_embedquestion_get_embed_code",args:{courseid:a("input[name=courseid]").val(),categoryidnumber:a("select#id_categoryidnumber").val(),questionidnumber:a("select#id_questionidnumber").val(),behaviour:a("select#id_behaviour").val(),maxmark:a("input#id_maxmark").val(),variant:a("input#id_variant").val(),correctness:a("select#id_correctness").val(),marks:a("select#id_marks").val(),markdp:a("select#id_markdp").val(),feedback:a("select#id_feedback").val(),generalfeedback:a("select#id_generalfeedback").val(),rightanswer:a("select#id_rightanswer").val(),history:a("select#id_history").val()}}])[0].done(i)}function i(a){var b,c,d,e,g;b=f.getDialogue({focusAfterHide:null}),b.hide(),c=f.get("host"),c.setSelection(j),g=f.getEmbedCodeAtSelection(),g?(d=c.getSelectionParentNode(),e=d.textContent,d.textContent=e.slice(0,g.start)+a+e.slice(g.end)):c.insertContentAtFocusPoint(a),f.markUpdated()}var j,k,l;j=f.get("host").getSelection(),k=f.getDialogue({headerContent:M.util.get_string("pluginname","atto_embedquestion"),focusAfterHide:!0},!0),k.set("bodyContent",'<div class="atto_embedquestion-wrap"><img class="icon" src="'+M.util.image_url("y/loading")+'" alt="'+M.util.get_string("loading","atto_embedquestion")+'"></div>'),k.show(),l=f.getEmbedCodeAtSelection(),l&&(l=l.embedCode),c.loadFragment("atto_embedquestion","questionselector",f.get("contextid"),{contextId:f.get("contextid"),embedCode:l}).done(function(b,c){g(a(".atto_embedquestion-wrap"),b,c)}).fail(b.exception)}return{showDialogueFor:function(a){new f(a)}}});
define('local_bookmarks/bookmark_oucontent', ["jquery","core/ajax","core/str","core/modal_factory","core/templates"],function(a,b,c,d,e){var f={bElement:null,bDialog:null,bDialogInput:null,bDialogClear:null,bDialogSave:null,bDialogDelete:null,bDialogTitle:null,bId:null,bTitle:null,langStrings:[],isAlias:!1,init:function(){if(f.bElement=a("#bookmarks-element"),f.bDialog=a("#bookmarks-dialog"),f.bDialogInput=f.bDialog.find("#title"),f.bDialogClear=f.bDialog.find("#clear"),f.bDialogSave=f.bDialog.find("#save"),f.bDialogDelete=f.bDialog.find("#delete"),f.bDialogTitle=f.bDialog.find(".modal-title"),f.bId=parseInt(f.bElement.attr("data-bookmarks-id")),f.bTitle=f.bElement.attr("data-bookmarks-title"),c.get_strings([{key:"error",component:"core"},{key:"saveforlater",component:"local_bookmarks"},{key:"savedforlater",component:"local_bookmarks"},{key:"bookmarkdescription",component:"local_bookmarks"},{key:"bookmarkdescription_empty",component:"local_bookmarks"},{key:"eqn",component:"oucontent"}]).done(function(a){f.langStrings.error=a[0],f.langStrings.saveforlater=a[1],f.langStrings.savedforlater=a[2],f.langStrings.bookmarkdescription=a[3],f.langStrings.bookmarkdescriptionempty=a[4],f.langStrings.eqn=a[5]}),f.bElement.hasClass("alias")&&(f.isAlias=!0),window.performance&&window.performance.navigation.type===window.performance.navigation.TYPE_BACK_FORWARD){var b=f.getUrlParam("id");M.util.js_pending("get_bookmarks_by_cmid"),f.getBookmarksByCm(b,function(b){var c=f.getUrlParam("section");f.bId=0,a.each(b,function(a,b){var d=JSON.parse(b.params);if(c===d.sectionid)return f.bId=b.id,b.current=!0,!1}),f.bId?f.bElement.addClass("fill"):(f.bElement.removeClass("fill"),a(".bookmarks .bookmark.current").remove()),f.bElement.show(),e.render("theme_osep/savedforlater_list",{bookmarks:b}).done(function(b){a(".bookmarks").html(b).show(0,"linear",function(){f.updateBookmarkDescription()})}),M.util.js_complete("get_bookmarks_by_cmid")})}else f.bElement.show();f.bindEvent()},bindEvent:function(){var b=function(b){b.preventDefault();var c="";if("0"!==f.bTitle&&""!==f.bTitle)c=f.bTitle;else{var d=a(".oucontent-content [class*=oucontent-title-]");if(d.length){var e=a(d[d.length-1]);c=f.getBookmarkTitleFromDom(e)}}0!==f.bId||f.isAlias?f.updateDialog(c,1):(f.bElement.addClass("fill"),f.updateDialog(c,0)),f.showBookmarkDialog()};f.bElement.click(b),f.bElement.on("keydown",function(a){13===a.keyCode&&b(a)}),f.bDialog.find('button[data-action="hide"]').click(function(){0===f.bId&&f.bElement.removeClass("fill"),f.hideDialog()}),f.bDialogInput.on("input",function(){""===a(this).val()?(f.bDialogSave.attr("disabled",!0),f.bDialogClear.attr("disabled",!0)):(f.bDialogSave.removeAttr("disabled"),f.bDialogClear.removeAttr("disabled"))}),f.bDialogSave.click(function(){var b=f.bDialogInput.val();if(0===f.bId){var c=f.getUrlParam("id"),d="oucontent",g=JSON.stringify({sectionid:f.getUrlParam("section")});M.util.js_pending("create_bookmark"),f.addBookmarks(c,b,d,g,function(b){f.bTitle=b.title,f.bId=b.id,f.bElement.prop("title",f.langStrings.savedforlater),e.render("theme_osep/savedforlater_item",{id:b.id,title:b.title,url:b.url,current:!0}).done(function(b){a("#bookmarks-navigate").find(".bookmarks").prepend(b),f.updateBookmarkDescription(),M.util.js_complete("create_bookmark")}),f.hideDialog()})}else M.util.js_pending("update_bookmark"),f.updateBookmarks(f.bId,b,function(){f.bTitle=b,a("#bookmarks-navigate").find("a[data-bookmark-id="+f.bId+"] span.text").html(b),f.hideDialog(),M.util.js_complete("update_bookmark")})}),f.bDialogDelete.click(function(){M.util.js_pending("delete_bookmark"),f.deleteBookmarks(f.bId,function(){a("#bookmarks-navigate").find("a[data-bookmark-id="+f.bId+"]").remove(),f.bId=0,f.bTitle="",f.bElement.prop("title",f.langStrings.saveforlater),f.bElement.removeClass("fill"),f.updateBookmarkDescription(),f.hideDialog(),M.util.js_complete("update_bookmark")})}),f.bDialogClear.click(function(){f.bDialogInput.val(""),f.bDialogInput.trigger("input")})},showBookmarkDialog:function(){var b=f.langStrings.savedforlater;0===f.bId&&(b=f.langStrings.saveforlater),f.bDialogTitle.html(b),f.bDialog.show(),f.bDialogInput.css("font-size","16px"),a(f.bDialogInput).focus(),f.bDialogInput.css("font-size",""),a(f.bDialogInput)[0].setSelectionRange(0,parseInt(f.bDialogInput.val().length))},hideDialog:function(){f.bDialog.hide(),f.bElement.focus()},addBookmarks:function(a,c,d,e,g){b.call([{methodname:"local_bookmarks_external_add_bookmark",args:{cmid:a,title:c,component:d,params:e},done:function(a){g(a)},fail:function(a){M.util.js_complete("add_bookmark"),f.showError(a.message)}}])},updateBookmarks:function(a,c,d){b.call([{methodname:"local_bookmarks_external_update_bookmark_title",args:{id:a,title:c},done:function(a){d(a)},fail:function(a){M.util.js_complete("update_bookmark"),f.showError(a.message)}}])},deleteBookmarks:function(a,c){b.call([{methodname:"local_bookmarks_external_delete_bookmark",args:{id:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("delete_bookmark"),f.showError(a.message)}}])},getBookmarksByCm:function(a,c){b.call([{methodname:"local_bookmarks_external_get_bookmarks_by_cm",args:{cmid:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("get_bookmarks_by_cmid"),f.showError(a.message)}}])},updateDialog:function(a,b){b?1===b&&f.bDialogDelete.show():f.bDialogDelete.hide(),f.bDialogInput.val(a),f.bDialogInput.trigger("input")},showError:function(a){f.showDialog(f.langStrings.error,a)},showDialog:function(a,b){f.dialogue?(f.dialogue.title.html(a),f.dialogue.body.html(b),f.dialogue.show()):d.create({type:d.types.DEFAULT,title:a,body:b}).done(function(a){f.dialogue=a,f.dialogue.show()})},getUrlParam:function(a){return(window.location.search.split(a+"=")[1]||"").split("&")[0]},updateBookmarkDescription:function(){var b=f.langStrings.bookmarkdescription;0===a(".bookmarks > a.bookmark").length&&(b=f.langStrings.bookmarkdescriptionempty),a(".bookmarks-navigate > span.description").html(b)},getBookmarkTitleFromDom:function(a){var b=a.text(),c=a.html(),d=c.match(/<desc id="[A-Za-z0-9_.-]*">(.*?)<\/desc>/);if(d)return b.replace(d[1],f.langStrings.eqn).replace(/\s+/g," ");var d=c.match(/<math(.*?)><semantics>(.*?)<\/semantics><\/math>/);return d?c.replace(d[0],f.langStrings.eqn).replace(/\s+/g," ").replace(/<(?:.|\n)*?>/gm,""):b}};return f});
define('local_bookmarks/manage_bookmarks', ["jquery","core/str","core/modal_factory"],function(a,b,c){var d={bookmarkForm:null,btnSelectAll:null,btnSelectNone:null,btnDeleteSelected:null,checkboxes:null,bookmarkTable:null,confirmDeleteDialog:null,langStrings:[],init:function(){d.bookmarkForm=a("#manage-bookmark"),d.btnSelectAll=a(".local_bookmark-selectall"),d.btnSelectNone=a(".local_bookmark-selectnone"),d.btnDeleteSelected=a(".local_bookmark-deleteselected"),d.checkboxes=d.bookmarkForm.find('input[name="delete[]"]'),d.bookmarkTable=a(".bookmarks-table"),b.get_strings([{key:"yes",component:"core"},{key:"no",component:"core"},{key:"deletebookmark_title",component:"local_bookmarks"},{key:"deletebookmark_content",component:"local_bookmarks"},{key:"error",component:"core"}]).done(function(a){d.langStrings.yes=a[0],d.langStrings.no=a[1],d.langStrings.deleteBookmarkTitle=a[2],d.langStrings.deleteBookmarkContent=a[3],d.langStrings.error=a[4]}),a("body").on("updatefailed","[data-inplaceeditable]",function(a){var b=a.exception;"error_emptytitle"===b.errorcode&&a.preventDefault()}),d.bindEvents()},bindEvents:function(){d.btnSelectAll.click(function(a){a.preventDefault(),d.bookmarkTable.find('input[type="checkbox"]').prop("checked",!0),d.btnDeleteSelected.prop("disabled",!1)}),d.btnSelectNone.click(function(a){a.preventDefault(),d.bookmarkTable.find('input[type="checkbox"]').prop("checked",!1),d.btnDeleteSelected.prop("disabled",!0)}),a(".bookmarks-table tbody").on("change",'input[type="checkbox"]',function(b){b.preventDefault();var c=!0;a.each(d.checkboxes,function(b,d){if(a(d).is(":checked"))return c=!1,!1}),d.btnDeleteSelected.prop("disabled",c)}),d.btnDeleteSelected.click(function(a){if(a.preventDefault(),d.confirmDeleteDialog)d.confirmDeleteDialog.show();else{var b="<p>"+d.langStrings.deleteBookmarkContent+"</p>";b+='<button data-action="submit">'+d.langStrings.yes+"</button>",b+='<button data-action="close">'+d.langStrings.no+"</button>",c.create({type:c.DEFAULT,title:d.langStrings.deleteBookmarkTitle,body:b}).done(function(a){d.confirmDeleteDialog=a,a.body.find("button[data-action=close]").click(function(){a.hide()}),a.body.find("button[data-action=submit]").click(function(){d.bookmarkForm.submit()}),d.confirmDeleteDialog.show()})}})}};return d});
define('local_bookmarks/bookmarks_base', ["jquery","core/ajax","core/str","core/modal_factory","core/templates"],function(a,b,c,d,e){var f={component:null,bContainer:null,hasBookmarkNavigate:null,bElement:null,bDialog:null,bDialogInput:null,bDialogClear:null,bDialogSave:null,bDialogDelete:null,bDialogTitle:null,bId:null,bTitle:null,langStrings:[],isAlias:!1,init:function(b,c,d,g,h){if(f.bId=b,f.bTitle=d,f.isAlias=h,f.component=c,f.bContainer=a(g),f.hasBookmarkNavigate=a("#osep-bottombutton-bookmarks").length>0,this.langStrings={error:M.util.get_string("error","core"),saveforlater:M.util.get_string("saveforlater","local_bookmarks"),savedforlater:M.util.get_string("savedforlater","local_bookmarks"),eqn:M.util.get_string("eqn","oucontent")},f.bElement=f.bContainer.find(".bookmarks-element"),f.bDialog=f.bContainer.find(".bookmarks-dialog"),f.bDialogInput=f.bContainer.find("input.title"),f.bDialogClear=f.bContainer.find("button.clear"),f.bDialogSave=f.bContainer.find("button.save"),f.bDialogDelete=f.bContainer.find("button.delete"),f.bDialogTitle=f.bContainer.find(".modal-title"),f.bindEvent(),window.performance&&window.performance.navigation.type===window.performance.navigation.TYPE_BACK_FORWARD){var i=f.getcmid();M.util.js_pending("get_bookmarks_by_cmid"),f.getBookmarksByCm(i,function(b){f.bId=0,a.each(b,function(a,b){var c=JSON.parse(b.params);if(f.isCurrent(c))return f.bId=b.id,b.current=!0,!1}),f.bId?f.bElement.addClass("fill"):(f.bElement.removeClass("fill"),a(".bookmarks .bookmark.current").remove()),f.bElement.show(),e.render("theme_osep/savedforlater_list",{bookmarks:b}).done(function(b){a(".bookmarks").html(b).show(0,"linear",function(){f.updateBookmarkDescription()})}),M.util.js_complete("get_bookmarks_by_cmid")})}else f.updateBookmarkDescription(),f.bElement.show()},bindEvent:function(){var b=function(a){a.preventDefault();var b="";b="0"!==f.bTitle&&""!==f.bTitle?f.bTitle:f.getTitle(),0!==f.bId||f.isAlias?f.updateDialog(b,1):(f.bElement.addClass("fill"),f.updateDialog(b,0)),f.showBookmarkDialog()};f.bElement.click(b),f.bElement.on("keydown",function(a){13===a.keyCode&&b(a)}),f.bDialog.find('button[data-action="hide"]').click(function(){0===f.bId&&f.bElement.removeClass("fill"),f.hideDialog()}),f.bDialogInput.on("input",function(){""===a(this).val()?(f.bDialogSave.attr("disabled",!0),f.bDialogClear.attr("disabled",!0)):(f.bDialogSave.removeAttr("disabled"),f.bDialogClear.removeAttr("disabled"))}),f.bDialogSave.click(function(){var b=f.bDialogInput.val();if(0===f.bId){var c=f.getcmid(),d=JSON.stringify(f.getParam());M.util.js_pending("create_bookmark"),f.addBookmarks(c,b,f.component,d,function(b){f.bTitle=b.title,f.bId=b.id,f.bElement.prop("title",f.langStrings.savedforlater),f.hasBookmarkNavigate&&e.render("theme_osep/savedforlater_item",{id:b.id,title:b.title,url:b.url,current:!0}).done(function(b){a("#bookmarks-navigate").find(".bookmarks").prepend(b),f.updateBookmarkDescription(),M.util.js_complete("create_bookmark")}),f.hideDialog()})}else M.util.js_pending("update_bookmark"),f.updateBookmarks(f.bId,b,function(){f.bTitle=b,f.hasBookmarkNavigate&&a("#bookmarks-navigate").find("a[data-bookmark-id="+f.bId+"] span.text").html(b),f.hideDialog(),M.util.js_complete("update_bookmark")})}),f.bDialogDelete.click(function(){M.util.js_pending("delete_bookmark"),f.deleteBookmarks(f.bId,function(){f.hasBookmarkNavigate&&a("#bookmarks-navigate").find("a[data-bookmark-id="+f.bId+"]").remove(),f.bId=0,f.bTitle="",f.bElement.prop("title",f.langStrings.saveforlater),f.bElement.removeClass("fill"),f.updateBookmarkDescription(),f.hideDialog(),M.util.js_complete("delete_bookmark")})}),f.bDialogClear.click(function(){f.bDialogInput.val(""),f.bDialogInput.trigger("input")})},showBookmarkDialog:function(){var b=f.langStrings.savedforlater;0===f.bId&&(b=f.langStrings.saveforlater),f.bDialogTitle.html(b),f.bDialog.show(),f.bDialogInput.css("font-size","16px"),a(f.bDialogInput).focus(),f.bDialogInput.css("font-size",""),a(f.bDialogInput)[0].setSelectionRange(0,parseInt(f.bDialogInput.val().length))},hideDialog:function(){f.bDialog.hide(),f.bElement.focus()},addBookmarks:function(a,c,d,e,g){b.call([{methodname:"local_bookmarks_external_add_bookmark",args:{cmid:a,title:c,component:d,params:e},done:function(a){g(a)},fail:function(a){M.util.js_complete("add_bookmark"),f.showError(a.message)}}])},updateBookmarks:function(a,c,d){b.call([{methodname:"local_bookmarks_external_update_bookmark_title",args:{id:a,title:c},done:function(a){d(a)},fail:function(a){M.util.js_complete("update_bookmark"),f.showError(a.message)}}])},deleteBookmarks:function(a,c){b.call([{methodname:"local_bookmarks_external_delete_bookmark",args:{id:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("delete_bookmark"),f.showError(a.message)}}])},getBookmarksByCm:function(a,c){b.call([{methodname:"local_bookmarks_external_get_bookmarks_by_cm",args:{cmid:a},done:function(a){c(a)},fail:function(a){M.util.js_complete("get_bookmarks_by_cmid"),f.showError(a.message)}}])},updateDialog:function(a,b){b?1===b&&f.bDialogDelete.show():f.bDialogDelete.hide(),f.bDialogInput.val(a),f.bDialogInput.trigger("input")},showError:function(a){f.showDialog(f.langStrings.error,a)},showDialog:function(a,b){f.dialogue?(f.dialogue.title.html(a),f.dialogue.body.html(b),f.dialogue.show()):d.create({type:d.types.DEFAULT,title:a,body:b}).done(function(a){f.dialogue=a,f.dialogue.show()})},getBookmarkTitleFromDom:function(a){var b=a.text(),c=a.html(),d=c.match(/<desc id="[A-Za-z0-9_.-]*">(.*?)<\/desc>/),e=c.match(/<math(.*?)semantics>(.*?)<\/semantics(.*?)\/math>/);return d?b=b.replace(d[1],f.langStrings.eqn):e&&(b=c.replace(e[0],f.langStrings.eqn).replace(/<(?:.|\n)*?>/gm,"")),b.replace(/\s+/g," ")},getUrlParam:function(a){return(window.location.search.split(a+"=")[1]||"").split("&")[0]},updateBookmarkDescription:function(){},isCurrent:function(a){return!0},getTitle:function(){return""},getcmid:function(){return f.getUrlParam("id")},getParam:function(){return{}}};return f});
define('local_bookmarks/bookmarks_oucontent', ["jquery","core/str","local_bookmarks/bookmarks_base"],function(a,b,c){return{init:function(b,d,e,f,g){var h={bookmarkdescription:M.util.get_string("bookmarkdescription","local_bookmarks"),bookmarkdescriptionempty:M.util.get_string("bookmarkdescription_empty","local_bookmarks")};c.getParam=function(){return{sectionid:c.getUrlParam("section")}},c.getTitle=function(){var b="",d=a(".oucontent-content [class*=oucontent-title-]");if(d.length){var e=a(d[d.length-1]);b=c.getBookmarkTitleFromDom(e)}return b},c.isCurrent=function(a){var b=c.getUrlParam("section");return b===a.sectionid},c.updateBookmarkDescription=function(){var b=h.bookmarkdescription;0===a(".bookmarks > a.bookmark").length&&(b=h.bookmarkdescriptionempty),a(".bookmarks-navigate > span.description").html(b)},c.init(b,d,e,f,g)}}});
define('local_bookmarks/bookmarks_oustudyplansubpage', ["jquery","core/str","local_bookmarks/bookmarks_base"],function(a,b,c){return{init:function(b,d,e,f,g){var h={bookmarkdescription:M.util.get_string("bookmarkdescription","mod_oustudyplansubpage"),bookmarkdescriptionempty:M.util.get_string("bookmarkdescription_empty","mod_oustudyplansubpage")};c.getcmid=function(){return c.getUrlParam("cmid")},c.getParam=function(){return{courseid:c.getUrlParam("id")}},c.updateBookmarkDescription=function(){var b=h.bookmarkdescription;0===a(".bookmarks > a.bookmark").length&&(b=h.bookmarkdescriptionempty),a(".bookmarks-navigate > span.description").html(b)},c.getTitle=function(){var b=a(".osep-heading-text").text();return b||(b=a(".oustudyplan-areaheading > span").text()),b},c.init(b,d,e,f,g);var i=function(b){b?a(".bookmarks-element").show():a(".bookmarks-element").hide()};a("#oustudyplan-lastinsert-secondcolumn").on("submit","form",function(b){b.preventDefault(),i(!1);var c=setInterval(function(){0!==a(".oustudyplan-secondcolumn").length&&(a(".oustudyplansubpage-header").addClass("oustudyplansubpage-secondcolumn"),i(!0),clearInterval(c),c=null)},150);setTimeout(function(){null!==c&&(i(!0),clearInterval(c))},15e3)}),a(".oustudyplan-columns").on("submit",".oustudyplan-secondcolumn .oustudyplan-delete",function(b){b.preventDefault(),i(!1);var c=setInterval(function(){0!==a(".oustudyplan-notification").length&&(0===a(".oustudyplan-secondcolumn").length&&a(".oustudyplansubpage-header.oustudyplansubpage-secondcolumn").removeClass("oustudyplansubpage-secondcolumn"),i(!0),clearInterval(c),c=null)},150);setTimeout(function(){null!==c&&(i(!0),clearInterval(c))},15e3)});var j=a("#osep-mobileheading");a(j).length&&(j.addClass("oustudyplansubpage-hasbookmark"),j.parent().prepend(a(".oustudyplansubpage-bookmark-specialsubpage")))}}});
define('local_loadingstatus/loading', ["jquery"],function(a){var b={WARNING_TIME:5e3,FINISHED_TIME:3e3,currentTags:{},doneCount:0,totalCount:0,statusUpdatePending:!1,finishedTime:0,start:function(c,d){if(void 0!==b.currentTags[c])throw"Cannot start tag, already started: "+c;b.totalCount>0&&b.doneCount===b.totalCount&&0!==b.finishedTime&&b.finishedTime+b.FINISHED_TIME<Date.now()?(b.totalCount=0,b.doneCount=0,b.finishedTime=0,b.currentTags={}):b.finishedTime=0,b.currentTags[c]={started:Date.now(),name:d,error:null,errored:null},b.totalCount++,b.updateProgress();var e=a("#loadingstatus");e.hasClass("loadingstatus-showing")||e.addClass("loadingstatus-showing"),a("#loadingstatus .loadingstatus-spinner img").css("visibility",""),b.requestDelayedUpdate(b.WARNING_TIME)},requestDelayedUpdate:function(a){b.statusUpdatePending||(b.statusUpdatePending=!0,setTimeout(function(){b.statusUpdatePending=!1,b.updateStatus()},a))},error:function(a,c){if(void 0===b.currentTags[a])throw"Cannot error tag, tag not known: "+a;b.currentTags[a].error=c,b.currentTags[a].errored=Date.now(),b.doneCount++,b.updateStatus()},finish:function(a){if(void 0===b.currentTags[a])throw"Cannot finish tag, tag not known: "+a;b.currentTags[a].error||b.doneCount++,delete b.currentTags[a],b.updateStatus()},updateProgress:function(){var c,d=a("#loadingstatus-progress");c=b.totalCount>0?100*b.doneCount/b.totalCount:0,d.css("width",c+"%"),d.find(".accesshide").text(Math.round(c)+"%")},updateStatus:function(){b.updateProgress();var c=null,d=!1,e=0,f=0;for(var g in b.currentTags){var h=b.currentTags[g];h.error&&(0===f||h.errored<f?(f=h.errored,c=h.name+": "+h.error,d=!0):e++)}var i=Date.now();if(!c){var j=0;for(var k in b.currentTags){var l=b.currentTags[k];l.started+b.WARNING_TIME<i&&(0===j||l.started<j?(j=l.started,c=l.name+"..."):e++)}}if(null!==c){if(e>0&&(c+=" "+M.util.get_string("more","local_loadingstatus",e)),d){var m='<img src="'+M.util.image_url("error","local_loadingstatus");m+='" alt="'+M.util.get_string("error","moodle"),m+='" id="loadingstatus-erroricon" /> ',a("#loadingstatus .loadingstatus-spinner img").css("display","none"),a("#loadingstatus .loadingstatus-spinner").append(a(m))}a("#loadingstatus .loadingstatus-message").html(c)}else a("#loadingstatus .loadingstatus-message").html("");if(b.doneCount===b.totalCount&&(c||a("#loadingstatus").removeClass("loadingstatus-showing"),0===b.finishedTime&&(b.finishedTime=i)),!b.statusUpdatePending){var n=-1;for(var o in b.currentTags){var p=b.currentTags[o];if(!p.error&&p.started+b.WARNING_TIME>=i){var q=p.started+b.WARNING_TIME-i;(-1===n||n>q)&&(n=q)}}-1!==n&&b.requestDelayedUpdate(n)}}};return b});
define('local_moodleglobalsearch/searchtracking', ["jquery"],function(a){var b={searchData:null,init:function(c,d,e,f,g,h,i){b.searchData={key:c,session:d,query:e,shownHits:f,totalHits:g,pageNo:i},window._msq=[],a.getScript("https://static.searchstax.com/js/ms2.js",function(){var c=a.extend({},b.searchData,{latency:h});window._msq.push(["track",c])}),a(".search-results").on("click",".result-title > a",b.linkClick)},linkClick:function(c){c.preventDefault(),a("script").each(function(a,b){b.scriptTagKnown=!0});var d=a(c.target).closest("a"),e=a.extend({},b.searchData,{cDocId:d.data("targethref"),cDocTitle:d.text(),position:d.data("pos")});window._msq.push(["trackClick",e]);var f=!1;a("script").each(function(b,c){c.scriptTagKnown||a(c).on("load",function(){f=!0,location.href=d[0].href})}),setTimeout(function(){f||(location.href=d[0].href)},1e3)}};return b});
define('local_oump/mloader', [],function(){var a="omp-id-",b="OU Player: Please provide media type ",c="OU Player: Identified type is not support ",d="OU Player: Invalid source ",e="OU Player: Invalid track ",f="OU Player: Invalid ID ",g="OU Player: Selector not found ",h="OU Player: Failed to generate media instance ",i="OU Player: Media not found ",j=1e4,k="OU Player: Load media timeout.";return{initialise:function(l){window.oump?window.oump.harvest&&window.oump.harvest():(window.oump={wwwroot:l.wwwroot,debugLevel:1,models:{},active:!1,logHelper:"app/helpers/log/moodle",urlArgs:l.urlargs||"",dependency:l.jsdependency,mediaplayerversion:l.mediaplayerversion,enablethumbnail:"1"===l.enablethumbnail,init:function(){this.initPollyfill(),this.initOUMP()},appendStylesheet:function(a,b){if(!document.getElementById("omp-css-"+a)){var c=this.wwwroot,d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.href=c+b+"?"+window.oump.urlArgs.css,d.setAttribute("id","omp-css-"+a);var e=document.getElementsByTagName("head")[0];e.appendChild(d)}},appendScript:function(a,b){if(!document.getElementById("omp-js-"+a)){var c=document.createElement("script");c.type="text/javascript",c.src=this.wwwroot+b,c.setAttribute("id","omp-js-"+a);var d=document.getElementsByTagName("head")[0];d.appendChild(c)}},debug:function(a,b){if(this.debugLevel)switch(b){case 4:window.console.log(a);break;case 3:window.console.info(a);break;case 2:window.console.warn(a);break;case 1:window.console.error(a);break;default:window.console.error(a)}},initPollyfill:function(){window.console||(window.console={log:function(){}}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;++c)a.call(b,this[c],c,this)}),Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof String.prototype.trunc&&(String.prototype.trunc=function(a,b){var c=this.length>a,d=c?this.substr(0,a-1):this;return d=b&&c?d.substr(0,d.lastIndexOf(" ")):d,c?d+"&hellip;":d}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1}),Date.now||(Date.now=function(){return new Date.getTime})},initOUMP:function(){window.oump.defineOUMP=window.require.config({context:"oump",baseUrl:this.wwwroot+"/js/lib",urlArgs:window.oump.urlArgs.js,paths:{app:"../../js",templates:"../tpl",jquery:"jquery/jquery",jqueryui:"jquery/jquery-ui-1.11.4custom",jquerynoconflict:"jquerynoconflict/jquerynoconflict",underscore:"underscore/underscore",backbone:"backbone/backbone",domReady:"requirejs/domReady",text:"requirejs/text",i18n:"requirejs/i18n",draggabilly:"draggabilly/draggabilly.pkgd",download:"download/download"},map:{"*":{jquery:"jquerynoconflict"},jquerynoconflict:{jquery:"jquery"}}}),window.oump.defineOUMP(["require"],function(a){a(["app/oump"],function(a){if(a){var b=0;b=1}})})},create:function(a){return this.createMarkup(a)===!1?void this.debug(h):void this.bootstrap(a)},createMarkup:function(a){var b=this,c=this.getSupportedType(a.type);if(c===!1)return!1;a.id=this.normalizeId(a.selector);var f=document.createElement(c);f.setAttribute("data-omp-custom-id",a.id);var h;for(h in a){var i="";switch(h){case"disablefeatures":case"language":case"uilanguage":case"sizing":case"player":case"type":i="data-omp-"+h;break;case"width":case"height":case"poster":i=h}i&&f.setAttribute(i,a[h])}a.hasOwnProperty("sources")&&this.isArray(a.sources)&&a.sources.forEach(function(a,c){if("undefined"==typeof a.src||""===a.src)return void b.debug(d+c);var e=document.createElement("source");e.setAttribute("type",a.type),e.setAttribute("src",a.src),e.setAttribute("data-omp-label",a.label),a.resolution&&e.setAttribute("data-omp-resolution",a.resolution),a.player&&e.setAttribute("data-omp-player",a.player),a["default"]&&e.setAttribute("data-omp-default","default"),f.appendChild(e)}),a.hasOwnProperty("tracks")&&this.isArray(a.tracks)&&a.tracks.forEach(function(a,c){if("undefined"==typeof a.src||""===a.src)return void b.debug(e+c);var d=document.createElement("div");d.setAttribute("data-omp-name","track"),d.setAttribute("data-omp-kind",a.kind),d.setAttribute("data-omp-srclang",a.srclang),d.setAttribute("data-omp-type",a.type),d.setAttribute("data-omp-src",a.src),d.setAttribute("data-omp-label",a.label),f.appendChild(d)});for(h in a){var j=null;switch(h){case"title":case"description":case"copyright":j=document.createElement("div"),j.setAttribute("data-omp-name",h);var k=document.createTextNode(a[h]);j.appendChild(k);break;case"manifest":j=document.createElement("div"),j.setAttribute("data-omp-name",h),j.setAttribute("data-omp-manifest",a[h])}j&&f.appendChild(j)}if("undefined"==typeof a.selector)return this.debug(g),!1;var l=document.getElementById(a.selector);return"undefined"==typeof l?(this.debug(g),!1):(l.appendChild(f),f)},get:function(b){return"string"!=typeof b||""===b?(this.debug(f),null):(b=b.toLowerCase(),b=a+b,window.oump.models&&"undefined"!=typeof window.oump.models[b]?window.oump.models[b]:(this.debug(i),null))},getAll:function(){return window.oump.models},bootstrap:function(a){var b=a.timeout||j,c=0,d=setInterval(function(){return c+=200,c>b?(clearInterval(d),void window.oump.debug(k)):window.oump.harvest?(window.oump.harvest(),window.oump.models[a.id].set("apioptions",a),clearInterval(d),void a.onReadyCallback(window.oump.models[a.id])):void 0},200)},getSupportedType:function(a){if("undefined"==typeof a)return this.debug(b),!1;a=a.toLowerCase();var d;switch(a){case"audio":case"video":d=a;break;default:return this.debug(c),!1}return d},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},normalizeId:function(b){var c;return"undefined"==typeof b?(c=Math.floor(99999*Math.random()),c=a+String(c)):(c=a+String(b),c=c.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,""),c=c.toLowerCase()),c}},window.oump.init())}}});
define('local_outage/warning', ["jquery"],function(a){var b={mainDiv:null,urgentTime:0,outageTime:0,init:function(){if(b.mainDiv=a("#local_outage_warning"),b.mainDiv.length){var c=Date.now(),d=parseInt(b.mainDiv.data("untilwarning")),e=parseInt(b.mainDiv.data("untilurgent")),f=parseInt(b.mainDiv.data("untilduring")),g=parseInt(b.mainDiv.data("untilend"));e>0&&(b.urgentTime=c+1e3*e),f>0&&(b.outageTime=c+1e3*f),d>0&&(setTimeout(function(){b.mainDiv.removeClass("local_outage_advance"),b.mainDiv.addClass("local_outage_warning"),b.startCountdown()},1e3*d),a("#local_outage_warning .local_outage_hidebutton a").on("click",function(c){c.preventDefault(),M.util.set_user_preference(b.mainDiv.data("prefname"),1),a("#local_outage_warning").css("display","none")})),b.outageTime&&b.startCountdown(),g>0&&setTimeout(function(){b.mainDiv.remove()},1e3*g)}},startCountdown:function(){a("#local_outage_warning").css("display","block"),a("#local_outage_warning .local_outage_countdown").css("opacity",1),b.updateCountdown()},updateCountdown:function(){var c=Date.now();if(b.urgentTime&&c>b.urgentTime&&(b.mainDiv.removeClass("local_outage_warning"),b.mainDiv.addClass("local_outage_urgentwarning"),b.urgentTime=0),b.outageTime&&c>b.outageTime)return b.mainDiv.removeClass("local_outage_warning"),b.mainDiv.removeClass("local_outage_urgentwarning"),b.mainDiv.addClass("local_outage_during"),void(b.outageTime=0);var d=parseInt((b.outageTime-c)/1e3),e=parseInt(d/60);d-=60*e;var f=e+":"+(d<10?"0":"")+d;a("#local_outage_warning .local_outage_countdown").text(f);var g=1e3-c%1e3;setTimeout(b.updateCountdown,g)}};return b});
